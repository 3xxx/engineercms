***********系统运行************************

	如果是首次使用，请：

	1. 解压到d:\engineercms\；（其他盘根目录下也行，因为上传附件会使得这个文件夹越来越大，所以，要考虑空间大一些的盘。）

	2. 根据需要修改配置文件conf\app.conf,打开app.conf,看到里面的httpport = 8082，可以修改成其他端口。

	3. 数据库文件在database\engineer.db。可以删除数据库，系统运行后会自动建立，但是需要运行2次系统，即运行第一次后，关闭，再运行一次。

	4. windows系统里，直接运行engineercms即可在chrome浏览器中输入本地ip和端口号（127.0.0.1:8082）进行访问。如果是80端口，则端口号可省略。如果运行后闪退，打开cmd窗口里，进入engineercms所在目录下，在命令行里键入可执行文件名，可以发现问题梭子。比如可能是端口号被占用了，请修改端口号再运行；也可能是runmode=dev开发者模式，应该改为prod产品模式。运行后不要关闭窗口，它是服务。IE浏览器支持不好，推荐使用chrome，可以使用firefox、opra。加入开机启动请自行设置。

	5. linux系统：请将linux平台的可执行文件engineercms放到engineercms目录下（前文1中解压的文件夹下），swagger文件夹下的swagger.json和swagger.yml两个文件拷贝到engineercms目录里（前文1中解压的文件夹下）的swagger文件夹里。输入命令 nohup ./engineercms & 即可运行系统。如果linux系统提示Permission denied，说明要修改一下文件权限，执行命令：chmod +x engineercms

	6. 如果使用mysql数据库，请设置conf文件夹内的app.conf文件。

***********后台设置************************

	5. 进入admin后台页面：/admin，用户名是admin，密码是admin，见usermodel里的InsertUser()。

	6. admin页——分级目录：设置项目目录结构，按系统自带的例子理解。

	7. admin页——组织结构：设置部门（分院），下级是科室（专业组），也可以无下级。

	8. admin页——用户-角色：

	（1）可以按规定格式批量导入用户；也可以逐一添加用户。用户可以没有科室属性。端口号是这个用户运行cms系统的服务端口号(这个可以暂时不理)。这里的权限属于历史遗留问题，没有意义。

	（2）点击用户，下方出现角色表，添加角色表（类似用户组）。然后给用户赋予角色，勾选角色——保存。

	（3）设置用户IP后，系统自动根据IP匹配用户权限，免去局域网内用户登录的麻烦——这个废弃了。

	9.admin页——编辑目录：对已经建立的项目目录进行编辑，包括增加选中目录的子目录、删除选中的目录以及修改选中的目录。

	10.admin页——同步IP：多人建立相同项目及目录，在这里向这个项目中填入他们的ip和端口号，就可以在自己cms中，这个项目的任何目录下同步他们的成果列表过来。

	11.admin页——基本设置——首页轮播图片：点击首页轮播图片（4:1）行，下方出现图片列表，向这个列表中添加宽幅图片即可在首页轮播了，系统采用最新的10张图片在首页轮播。（其他功能未完成）

	12.admin页——角色—用户：通过点击角色，出现所有用户，选择添加删除用户。（该功能未提供）

	13.admin页——角色—权限：点击勾选角色；点击勾选权限；点击项目，出现项目目录，勾选赋予权限的目录，保存。

	14.admin页——快捷编辑，这个和编辑目录一致，只是验证ztree的演示。

	15.admin页——用户-组织结构：（该功能未提供）选择组织结构，出现用户，添加和删除这个组织里的用户。

	16.admin页——IP地址段：（IP权限目前没有启用）。

	17.admin页——搜索IP：（该功能未提供）首页全局检索用到的ip。

	18.admin页——用户—权限：（该功能未提供）点击勾选用户；点击勾选权限；点击项目，出现项目目录，勾选赋予权限的目录，保存。

*************前端使用***********************

	19.项目——项目列表页——添加：分级目录就是后台admin页上文第6点定义的。新建项目除了建立数据表中的目录，还在cms系统文件夹attachment中建立目录文件夹，以后所有上传的成果附件都放在这些文件夹中。

	20.项目——项目列表页——编辑、删除：删除会连带文件夹一起删除，所以提示了3次。

	21.项目——具体一个项目——成果列表——添加：系统设计上按照 成果—附件来保存文件，成果里可以放pdf格式的附件，可以放dwg、dgn、word、excel、jpg等格式的附件，可以放文章，这些附件的名称和成果的编号+成果的名称是否一至取决于下面的添加方式。添加按钮鼠标放上有提示，3个添加按钮分别用于批量上传、多附件模式和添加文章。批量上传就是不用填写成果编号和成果名称，系统自动根据附件文件名截取编号和名称作为成果编号和成果名称，但上传的附件文件名必须按编号+名称命名；多附件模式指一个成果中包含多个附件，比如一张图有参照图，一份报告有多个章节等；文章模式可以将图文word直接粘贴进来，然后按提示导入word中的图片，非常快捷了。也可以批量上传设代现场照片……；上传的office或wps文档可以调用onlyoffice进行写作。

	22.项目——具体一个项目——成果列表——编辑：第一个编辑是修改成果编号和名称等，另一个编辑是编辑成果附件，可以删除和追加附件。文章的编辑需要点击进入文章中，然后编辑或者删除文章，文章删除后成果还在。

	23.项目——具体一个项目——成果列表——同步：这里对应后台admin页面上文11条，确保他们已经运行cms，并且相应的项目目录中有成果。同步后，他们的成果会追加到这这个成果表中。重复的成果暂时没处理，一般也不影响。

	24.项目——大事记——日历：每个项目提供一个日历日程，添加事件后，可以勾选作为大事记，则可以看到大事记时间轴。

	25.首页——侧栏：这里对应admin页上文第8条，用户的ip和cms服务端口号，点击人名，就可以进入他们的cms。

	26.首页——检索：暂时只能检索本人cms中的成果。todo：深度搜索和全局搜索，比如搜索附件、文章全文等。全局是对应admin页上文第13条，设置了需要全局检索的别人的cms和端口号，就可以检索到他们cms中成果、附件和文章了。

	27.wiki和chat：类似论坛和聊天室。

	28.项目进度展示：这个暂时只是简单的甘特图展示。

	29.ONLYOFFICE文档协作：上传指定的文档格式文件。这个页面的权限是独立于项目的，所以要在本页面上设置权限，选择用户、角色，赋予对文档的各种权限。用户和角色需要到后台添加和编辑。

*************用户注册、登录、退出、权限和日历***********

	30.新用户注册后需要管理员进入后台进行权限赋予。

	31.权限：本系统原来提供2种权限，即用户-角色-权限和IP权限，系统根据IP匹配用户，IP区段作为用户名，给IP区段用户赋权或赋角色（暂未开放）。
	用户登录后用/user地址修改自己的密码。

	32.日历：管理员进入后台admin页首先出现的是日历日程，点击就可以添加日程安排，可以拖动，拉伸，右上角分别有月视图、周视图和日视图，默认是月视图，这个视图中拉伸的时间按整数天计，日视图中拉伸的时间段按0.5小时计……。添加日程有全天和公开选项，公开的日程，任何人访问这个cms都可以在导航条右端进入查看，私有的日程只能1级权限的自己看。

*************升级注意***********************

	如果是升级，请：
	备份自己修改的文件，然后解压覆盖其他文件。
	用beyond compare对比新旧文件的区别，小心覆盖旧文件。

*************其他注意***********************

	33.添加项目没有做项目编号重复的判断。成果添加则进行了重复编号的判断，如果重号，则用新的附件覆盖掉旧的。

	34.cms用于个人项目管理，建议不要在建立项目的时候选择过多的目录，比如，你是水工专业的，就建立一个综合和水工的目录，不要将机电的也建立起来。级别也尽量不要每个目录都用到5级，一般用到4级。

	35.一般编辑和删除都不允许多选，但翻页后可多选，这是table的bug，要取消翻页的多选，则点击表格右上角的刷新按钮即可取消选择了。

	36.不提供批量打包下载和批量删除。

	31.上文关于权限的，完整的权限就是admin页面中的“用户-角色-权限”。

*************ONLYOFFICE document server*****

	32.请看网盘中的文档参考，win环境下请看对应win的；linux环境下，需要先看win的，再看linux下的。
	你可以在win或linux系统里，安装docker，然后载入onlyoffice包，pull官方的或比如导入我提供的离线包，运行镜像，即得到容器。
	onlyoffice document server在docker里运行起来后，再回到engineercms的conf/app.conf里修改配置onlyoffice——onlyofficeapi_url和engineercmsapi_url，一看便知。
	运行cms，然后在/onlyoffice页面上传非空文档，就可以调用onlyoffice进行协作了。
	
*************小程序*************************

	33.小程序端需要申请发布小程序，本cms已经提供API接口。

	34.用小程序开发工具，新建项目，输入appid，然后下载本engineercms提供的小程序代码进行替换。工具——上传……发布

	35.小程序的代码中，请求的地址填入engineercms的接口地址就可以了。

*************flow事务流程********************

	36.请看网盘里的文档[链接：https://pan.baidu.com/s/1MDJ-QfCmv_LiychDSLn8jw 提取码：nhar ](https://pan.baidu.com/s/1MDJ-QfCmv_LiychDSLn8jw)《20190922 engineercms怎样做流程设置 flow nginx node mysql》，flow只支持mysql数据库。

*************mindoc创作书籍********************

	37.管理员用户名为admin，密码为123456。

	38.它的验证码不是很清晰，很难输入准确。所以用sqlite expert professional先打开sqlite数据库，将md_options表中的“是否启用验证码”的option_value填上false。

	更换域名记录
	购买域名，只要在.net那个域名里购买，填写hotqin即可，默认就是www.hotqin.net
	上传身份证进行备案
	engineercms的app里小程序的服务地址要修改成新的域名

*************更换域名和申请证书********************	
	
	申请SSL证书要操作迅速：打开服务器远程桌面，打开文件夹engineercms的static里的download目录，再回到（腾讯云）免费证书申请页面，点击申请证书，选择文件验证方式，页面生成了文件名和文件后，拷贝文件名和文件内容到远程桌面download里，名称也要符合证书验证要求的名称，
	例如0452072B8618471E45B2492D3206D8A8.txt，内容为
	2AB4454B570236BA78893258A3FE32EDC949DB38CAF47BFB7231D30DF08DC0E3
	COMODOCA.COM
	pssl8736177178165288
	回到腾讯云的证书申请页面里，点击验证，显示验证成功。很快证书就下发了，可以下载。
	获得证书后，使用nginx证书解压后，改名为server.crt和server.key，和app.conf里的名称一致即可，放到engineercms的根目录下，重启engineercms服务，验证一下web端和小程序端是否可以访问到。
	
*************全文检索********************
	1.docker拉取和运行tika，解析文档内容用
	You can pull down the version you would like using:
	docker pull apache/tika:<tag>
	Then to run the container, execute the following command:
	docker run -d -p 9998:9998 apache/tika:<tag>

	2.拉取并运行elasticsearch
	查看版本
	docker search elasticsearch
	下载镜像
	docker pull elasticsearch:7.14.2
	启动es
	docker run -it -e "discovery.type=single-node" --name="es714" -p 9200:9200 -p 9300:9300 elasticsearch
	或
	docker run -p 9200:9200 -p 9300:9300 --name es714 -e "discovery.type=single-node" -e "TAKE_FILE_OWNERSHIP=true" -v /es/logs:/usr/share/elasticsearch/logs -v /es/data:/usr/share/elasticsearch/data -d 2ab

	3.需要配置/config/elasticsearch.yml文件，加入开放远程访问：
	http.cors.enabled: true
	http.cors.allow-origin: "*"

	4.安装ik分词器

*************minio分布式存储设置************************
	1. 下载编译好的minio.exe文件的压缩包，见官网https://min.io/download#/windows或我的网盘https://pan.baidu.com/s/1f4zuhoymaHMN_QAEgZLwOg?pwd=upvm 。解压后进入minio.exe所在文件夹，执行以下命令
	2. minio.exe server e:\  ，留意提示里的ip和端口，用API的IP和端口9000即可，不要用第一个IP，每次都会变化。
	3. 浏览器进入minio管理截面，新建bucket，设置新建的bucket的密钥，设置bucket的访问策略，例如设置为public
	4. 设置engineercms的app.conf里minio有关参数：IP和端口，密钥，SSL之类
	5. 运行engineercms，上传文件
  详细操作文档见https://zsj.itdos.net/docs/engineercms_008


