!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.io=t():n.io=t()}(this,function(){return function(n){function t(r){if(i[r])return i[r].exports;var u=i[r]={exports:{},id:r,loaded:!1};return n[r].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var i={};return t.m=n,t.c=i,t.p="",t(0)}([function(n,t,i){"use strict";function u(n,t){"object"===("undefined"==typeof n?"undefined":o(n))&&(t=n,n=void 0);t=t||{};var c,i=s(n),h=i.source,u=i.id,l=i.path,a=r[u]&&l in r[u].nsps,v=t.forceNew||t["force new connection"]||!1===t.multiplex||a;return v?(e("ignoring socket cache for %s",h),c=f(h,t)):(r[u]||(e("new io instance for %s",h),r[u]=f(h,t)),c=r[u]),i.query&&!t.query&&(t.query=i.query),c.socket(i.path,t)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},s=i(1),h=i(7),f=i(13),e=i(3)("socket.io-client"),r;n.exports=t=u;r=t.managers={};t.protocol=h.protocol;t.connect=u;t.Manager=i(13);t.Socket=i(37)},function(n,t,i){(function(t){"use strict";function u(n,i){var u=n,o,e;return i=i||t.location,null==n&&(n=i.protocol+"//"+i.host),"string"==typeof n&&("/"===n.charAt(0)&&(n="/"===n.charAt(1)?i.protocol+n:i.host+n),/^(https?|wss?):\/\//.test(n)||(r("protocol-less url %s",n),n="undefined"!=typeof i?i.protocol+"//"+n:"https://"+n),r("parse %s",n),u=f(n)),u.port||(/^(http|ws)$/.test(u.protocol)?u.port="80":/^(http|ws)s$/.test(u.protocol)&&(u.port="443")),u.path=u.path||"/",o=u.host.indexOf(":")!==-1,e=o?"["+u.host+"]":u.host,u.id=u.protocol+"://"+e+":"+u.port,u.href=u.protocol+"://"+e+(i&&i.port===u.port?"":":"+u.port),u}var f=i(2),r=i(3)("socket.io-client:url");n.exports=u}).call(t,function(){return this}())},function(n){var t=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.exports=function(n){var o=n,u=n.indexOf("["),f=n.indexOf("]");u!=-1&&f!=-1&&(n=n.substring(0,u)+n.substring(u,f).replace(/:/g,";")+n.substring(f,n.length));for(var s=t.exec(n||""),r={},e=14;e--;)r[i[e]]=s[e]||"";return u!=-1&&f!=-1&&(r.source=o,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r}},function(n,t,i){(function(r){function f(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function e(n){var i=this.useColors,r,u,f;(n[0]=(i?"%c":"")+this.namespace+(i?" %c":" ")+n[0]+(i?"%c ":" ")+"+"+t.humanize(this.diff),i)&&(r="color: "+this.color,n.splice(1,0,r,"color: inherit"),u=0,f=0,n[0].replace(/%[a-zA-Z%]/g,function(n){"%%"!==n&&(u++,"%c"===n&&(f=u))}),n.splice(f,0,r))}function o(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(n){try{null==n?t.storage.removeItem("debug"):t.storage.debug=n}catch(i){}}function u(){var n;try{n=t.storage.debug}catch(i){}return!n&&"undefined"!=typeof r&&"env"in r&&(n=r.env.DEBUG),n}function h(){try{return window.localStorage}catch(n){}}t=n.exports=i(5);t.log=o;t.formatArgs=e;t.save=s;t.load=u;t.useColors=f;t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:h();t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];t.formatters.j=function(n){try{return JSON.stringify(n)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}};t.enable(u())}).call(t,i(4))},function(n){function h(){throw new Error("setTimeout has not been defined");}function c(){throw new Error("clearTimeout has not been defined");}function l(n){if(r===setTimeout)return setTimeout(n,0);if((r===h||!r)&&setTimeout)return r=setTimeout,setTimeout(n,0);try{return r(n,0)}catch(t){try{return r.call(null,n,0)}catch(t){return r.call(this,n,0)}}}function y(n){if(u===clearTimeout)return clearTimeout(n);if((u===c||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(n);try{return u(n)}catch(t){try{return u.call(null,n)}catch(t){return u.call(this,n)}}}function p(){o&&e&&(o=!1,e.length?f=e.concat(f):s=-1,f.length&&a())}function a(){var t,n;if(!o){for(t=l(p),o=!0,n=f.length;n;){for(e=f,f=[];++s<n;)e&&e[s].run();s=-1;n=f.length}e=null;o=!1;y(t)}}function v(n,t){this.fun=n;this.array=t}function i(){}var r,u,t=n.exports={};!function(){try{r="function"==typeof setTimeout?setTimeout:h}catch(n){r=h}try{u="function"==typeof clearTimeout?clearTimeout:c}catch(n){u=c}}();var e,f=[],o=!1,s=-1;t.nextTick=function(n){var i=new Array(arguments.length-1),t;if(arguments.length>1)for(t=1;t<arguments.length;t++)i[t-1]=arguments[t];f.push(new v(n,i));1!==f.length||o||l(a)};v.prototype.run=function(){this.fun.apply(null,this.array)};t.title="browser";t.browser=!0;t.env={};t.argv=[];t.version="";t.versions={};t.on=i;t.addListener=i;t.once=i;t.off=i;t.removeListener=i;t.removeAllListeners=i;t.emit=i;t.prependListener=i;t.prependOnceListener=i;t.listeners=function(){return[]};t.binding=function(){throw new Error("process.binding is not supported");};t.cwd=function(){return"/"};t.chdir=function(){throw new Error("process.chdir is not supported");};t.umask=function(){return 0}},function(n,t,i){function f(n){var r,i=0;for(r in n)i=(i<<5)-i+n.charCodeAt(r),i|=0;return t.colors[Math.abs(i)%t.colors.length]}function r(n){function i(){var n,f,e,s;if(i.enabled){var r=i,o=+new Date,h=o-(u||o);for(r.diff=h,r.prev=u,r.curr=o,u=o,n=new Array(arguments.length),f=0;f<n.length;f++)n[f]=arguments[f];n[0]=t.coerce(n[0]);"string"!=typeof n[0]&&n.unshift("%O");e=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,function(i,u){var f,o;return"%%"===i?i:(e++,f=t.formatters[u],"function"==typeof f&&(o=n[e],i=f.call(r,o),n.splice(e,1),e--),i)});t.formatArgs.call(r,n);s=i.log||t.log||console.log.bind(console);s.apply(r,n)}}return i.namespace=n,i.enabled=t.enabled(n),i.useColors=t.useColors(),i.color=f(n),"function"==typeof t.init&&t.init(i),i}function e(n){t.save(n);t.names=[];t.skips=[];for(var r=("string"==typeof n?n:"").split(/[\s,]+/),u=r.length,i=0;i<u;i++)r[i]&&(n=r[i].replace(/\*/g,".*?"),"-"===n[0]?t.skips.push(new RegExp("^"+n.substr(1)+"$")):t.names.push(new RegExp("^"+n+"$")))}function o(){t.enable("")}function s(n){for(var i=0,r=t.skips.length;i<r;i++)if(t.skips[i].test(n))return!1;for(i=0,r=t.names.length;i<r;i++)if(t.names[i].test(n))return!0;return!1}function h(n){return n instanceof Error?n.stack||n.message:n}t=n.exports=r.debug=r["default"]=r;t.coerce=h;t.disable=o;t.enable=e;t.enabled=s;t.humanize=i(6);t.names=[];t.skips=[];t.formatters={};var u},function(n){function e(n){var e,f,o;if((n=String(n),!(n.length>100))&&(e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(n),e)){f=parseFloat(e[1]);o=(e[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return f*h;case"days":case"day":case"d":return f*u;case"hours":case"hour":case"hrs":case"hr":case"h":return f*r;case"minutes":case"minute":case"mins":case"min":case"m":return f*i;case"seconds":case"second":case"secs":case"sec":case"s":return f*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}function o(n){return n>=u?Math.round(n/u)+"d":n>=r?Math.round(n/r)+"h":n>=i?Math.round(n/i)+"m":n>=t?Math.round(n/t)+"s":n+"ms"}function s(n){return f(n,u,"day")||f(n,r,"hour")||f(n,i,"minute")||f(n,t,"second")||n+" ms"}function f(n,t,i){if(!(n<t))return n<1.5*t?Math.floor(n/t)+" "+i:Math.ceil(n/t)+" "+i+"s"}var t=1e3,i=60*t,r=60*i,u=24*r,h=365.25*u;n.exports=function(n,t){t=t||{};var i=typeof n;if("string"===i&&n.length>0)return e(n);if("number"===i&&isNaN(n)===!1)return t.long?s(n):o(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n));}},function(n,t,i){function o(){}function s(n){var i=""+n.type;return t.BINARY_EVENT!==n.type&&t.BINARY_ACK!==n.type||(i+=n.attachments+"-"),n.nsp&&"/"!==n.nsp&&(i+=n.nsp+","),null!=n.id&&(i+=n.id),null!=n.data&&(i+=JSON.stringify(n.data)),f("encoded %j as %s",n,i),i}function c(n,t){function i(n){var i=e.deconstructPacket(n),u=s(i.packet),r=i.buffers;r.unshift(u);t(r)}e.removeBlobs(n,i)}function r(){this.reconstructor=null}function l(n){var i=0,r={type:Number(n.charAt(0))},e,o,u;if(null==t.types[r.type])return h();if(t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type){for(e="";"-"!==n.charAt(++i)&&(e+=n.charAt(i),i!=n.length););if(e!=Number(e)||"-"!==n.charAt(i))throw new Error("Illegal attachments");r.attachments=Number(e)}if("/"===n.charAt(i+1))for(r.nsp="";++i;){if(u=n.charAt(i),","===u)break;if(r.nsp+=u,i===n.length)break}else r.nsp="/";if(o=n.charAt(i+1),""!==o&&Number(o)==o){for(r.id="";++i;){if(u=n.charAt(i),null==u||Number(u)!=u){--i;break}if(r.id+=n.charAt(i),i===n.length)break}r.id=Number(r.id)}return n.charAt(++i)&&(r=a(r,n.substr(i))),f("decoded %s as %j",n,r),r}function a(n,t){try{n.data=JSON.parse(t)}catch(i){return h()}return n}function u(n){this.reconPack=n;this.buffers=[]}function h(){return{type:t.ERROR,data:"parser error"}}var f=i(3)("socket.io-parser"),v=i(8),y=i(9),e=i(11),p=i(12);t.protocol=4;t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"];t.CONNECT=0;t.DISCONNECT=1;t.EVENT=2;t.ACK=3;t.ERROR=4;t.BINARY_EVENT=5;t.BINARY_ACK=6;t.Encoder=o;t.Decoder=r;o.prototype.encode=function(n,i){if(n.type!==t.EVENT&&n.type!==t.ACK||!y(n.data)||(n.type=n.type===t.EVENT?t.BINARY_EVENT:t.BINARY_ACK),f("encoding packet %j",n),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type)c(n,i);else{var r=s(n);i([r])}};v(r.prototype);r.prototype.add=function(n){var i;if("string"==typeof n)i=l(n),t.BINARY_EVENT===i.type||t.BINARY_ACK===i.type?(this.reconstructor=new u(i),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",i)):this.emit("decoded",i);else{if(!p(n)&&!n.base64)throw new Error("Unknown type: "+n);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");i=this.reconstructor.takeBinaryData(n);i&&(this.reconstructor=null,this.emit("decoded",i))}};r.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};u.prototype.takeBinaryData=function(n){if(this.buffers.push(n),this.buffers.length===this.reconPack.attachments){var t=e.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null};u.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},function(n){function t(n){if(n)return i(n)}function i(n){for(var i in t.prototype)n[i]=t.prototype[i];return n}n.exports=t;t.prototype.on=t.prototype.addEventListener=function(n,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(t),this};t.prototype.once=function(n,t){function i(){this.off(n,i);t.apply(this,arguments)}return i.fn=t,this.on(n,i),this};t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(n,t){var i,u,r;if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;if(i=this._callbacks["$"+n],!i)return this;if(1==arguments.length)return delete this._callbacks["$"+n],this;for(r=0;r<i.length;r++)if(u=i[r],u===t||u.fn===t){i.splice(r,1);break}return this};t.prototype.emit=function(n){var r,t,i,u;if(this._callbacks=this._callbacks||{},r=[].slice.call(arguments,1),t=this._callbacks["$"+n],t)for(t=t.slice(0),i=0,u=t.length;i<u;++i)t[i].apply(this,r);return this};t.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};t.prototype.hasListeners=function(n){return!!this.listeners(n).length}},function(n,t,i){(function(t){function r(n){var i,s,u;if(!n||"object"!=typeof n)return!1;if(f(n)){for(i=0,s=n.length;i<s;i++)if(r(n[i]))return!0;return!1}if("function"==typeof t.Buffer&&t.Buffer.isBuffer&&t.Buffer.isBuffer(n)||"function"==typeof t.ArrayBuffer&&n instanceof ArrayBuffer||e&&n instanceof Blob||o&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return r(n.toJSON(),!0);for(u in n)if(Object.prototype.hasOwnProperty.call(n,u)&&r(n[u]))return!0;return!1}var f=i(10),u=Object.prototype.toString,e="function"==typeof t.Blob||"[object BlobConstructor]"===u.call(t.Blob),o="function"==typeof t.File||"[object FileConstructor]"===u.call(t.File);n.exports=r}).call(t,function(){return this}())},function(n){var t={}.toString;n.exports=Array.isArray||function(n){return"[object Array]"==t.call(n)}},function(n,t,i){(function(n){function r(n,t){var s,u,i,o;if(!n)return n;if(e(n))return s={_placeholder:!0,num:t.length},t.push(n),s;if(f(n)){for(i=new Array(n.length),u=0;u<n.length;u++)i[u]=r(n[u],t);return i}if("object"==typeof n&&!(n instanceof Date)){i={};for(o in n)i[o]=r(n[o],t);return i}return n}function u(n,t){var i,r;if(!n)return n;if(n&&n._placeholder)return t[n.num];if(f(n))for(i=0;i<n.length;i++)n[i]=u(n[i],t);else if("object"==typeof n)for(r in n)n[r]=u(n[r],t);return n}var f=i(10),e=i(12),o=Object.prototype.toString,s="function"==typeof n.Blob||"[object BlobConstructor]"===o.call(n.Blob),h="function"==typeof n.File||"[object FileConstructor]"===o.call(n.File);t.deconstructPacket=function(n){var t=[],u=n.data,i=n;return i.data=r(u,t),i.attachments=t.length,{packet:i,buffers:t}};t.reconstructPacket=function(n,t){return n.data=u(n.data,t),n.attachments=void 0,n};t.removeBlobs=function(n,t){function r(n,o,c){var a,l,v;if(!n)return n;if(s&&n instanceof Blob||h&&n instanceof File)u++,a=new FileReader,a.onload=function(){c?c[o]=this.result:i=this.result;--u||t(i)},a.readAsArrayBuffer(n);else if(f(n))for(l=0;l<n.length;l++)r(n[l],l,n);else if("object"==typeof n&&!e(n))for(v in n)r(n[v],v,n)}var u=0,i=n;r(i);u||t(i)}}).call(t,function(){return this}())},function(n,t){(function(t){function i(n){return t.Buffer&&t.Buffer.isBuffer(n)||t.ArrayBuffer&&n instanceof ArrayBuffer}n.exports=i}).call(t,function(){return this}())},function(n,t,i){"use strict";function r(n,t){if(!(this instanceof r))return new r(n,t);n&&"object"===("undefined"==typeof n?"undefined":h(n))&&(t=n,n=void 0);t=t||{};t.path=t.path||"/socket.io";this.nsps={};this.subs=[];this.opts=t;this.reconnection(t.reconnection!==!1);this.reconnectionAttempts(t.reconnectionAttempts||1/0);this.reconnectionDelay(t.reconnectionDelay||1e3);this.reconnectionDelayMax(t.reconnectionDelayMax||5e3);this.randomizationFactor(t.randomizationFactor||.5);this.backoff=new y({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==t.timeout?2e4:t.timeout);this.readyState="closed";this.uri=n;this.connecting=[];this.lastPing=null;this.encoding=!1;this.packetBuffer=[];var i=t.parser||v;this.encoder=new i.Encoder;this.decoder=new i.Decoder;this.autoConnect=t.autoConnect!==!1;this.autoConnect&&this.open()}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},c=i(14),l=i(37),a=i(8),v=i(7),f=i(39),e=i(40),u=i(3)("socket.io-client:manager"),o=i(36),y=i(41),s=Object.prototype.hasOwnProperty;n.exports=r;r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var n in this.nsps)s.call(this.nsps,n)&&this.nsps[n].emit.apply(this.nsps[n],arguments)};r.prototype.updateSocketIds=function(){for(var n in this.nsps)s.call(this.nsps,n)&&(this.nsps[n].id=this.generateId(n))};r.prototype.generateId=function(n){return("/"===n?"":n+"#")+this.engine.id};a(r.prototype);r.prototype.reconnection=function(n){return arguments.length?(this._reconnection=!!n,this):this._reconnection};r.prototype.reconnectionAttempts=function(n){return arguments.length?(this._reconnectionAttempts=n,this):this._reconnectionAttempts};r.prototype.reconnectionDelay=function(n){return arguments.length?(this._reconnectionDelay=n,this.backoff&&this.backoff.setMin(n),this):this._reconnectionDelay};r.prototype.randomizationFactor=function(n){return arguments.length?(this._randomizationFactor=n,this.backoff&&this.backoff.setJitter(n),this):this._randomizationFactor};r.prototype.reconnectionDelayMax=function(n){return arguments.length?(this._reconnectionDelayMax=n,this.backoff&&this.backoff.setMax(n),this):this._reconnectionDelayMax};r.prototype.timeout=function(n){return arguments.length?(this._timeout=n,this):this._timeout};r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};r.prototype.open=r.prototype.connect=function(n){var i,t,e,o,r,s;return(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))?this:(u("opening %s",this.uri),this.engine=c(this.uri,this.opts),i=this.engine,t=this,this.readyState="opening",this.skipReconnect=!1,e=f(i,"open",function(){t.onopen();n&&n()}),o=f(i,"error",function(i){if(u("connect_error"),t.cleanup(),t.readyState="closed",t.emitAll("connect_error",i),n){var r=new Error("Connection error");r.data=i;n(r)}else t.maybeReconnectOnOpen()}),!1!==this._timeout&&(r=this._timeout,u("connect attempt will timeout after %d",r),s=setTimeout(function(){u("connect attempt timed out after %d",r);e.destroy();i.close();i.emit("error","timeout");t.emitAll("connect_timeout",r)},r),this.subs.push({destroy:function(){clearTimeout(s)}})),this.subs.push(e),this.subs.push(o),this)};r.prototype.onopen=function(){u("open");this.cleanup();this.readyState="open";this.emit("open");var n=this.engine;this.subs.push(f(n,"data",e(this,"ondata")));this.subs.push(f(n,"ping",e(this,"onping")));this.subs.push(f(n,"pong",e(this,"onpong")));this.subs.push(f(n,"error",e(this,"onerror")));this.subs.push(f(n,"close",e(this,"onclose")));this.subs.push(f(this.decoder,"decoded",e(this,"ondecoded")))};r.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};r.prototype.ondata=function(n){this.decoder.add(n)};r.prototype.ondecoded=function(n){this.emit("packet",n)};r.prototype.onerror=function(n){u("error",n);this.emitAll("error",n)};r.prototype.socket=function(n,t){function u(){~o(r.connecting,i)||r.connecting.push(i)}var i=this.nsps[n],r;return i||(i=new l(this,n,t),this.nsps[n]=i,r=this,i.on("connecting",u),i.on("connect",function(){i.id=r.generateId(n)}),this.autoConnect&&u()),i};r.prototype.destroy=function(n){var t=o(this.connecting,n);~t&&this.connecting.splice(t,1);this.connecting.length||this.close()};r.prototype.packet=function(n){u("writing packet %j",n);var t=this;n.query&&0===n.type&&(n.nsp+="?"+n.query);t.encoding?t.packetBuffer.push(n):(t.encoding=!0,this.encoder.encode(n,function(i){for(var r=0;r<i.length;r++)t.engine.write(i[r],n.options);t.encoding=!1;t.processPacketQueue()}))};r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var n=this.packetBuffer.shift();this.packet(n)}};r.prototype.cleanup=function(){var t,n,i;for(u("cleanup"),t=this.subs.length,n=0;n<t;n++)i=this.subs.shift(),i.destroy();this.packetBuffer=[];this.encoding=!1;this.lastPing=null;this.decoder.destroy()};r.prototype.close=r.prototype.disconnect=function(){u("disconnect");this.skipReconnect=!0;this.reconnecting=!1;"opening"===this.readyState&&this.cleanup();this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};r.prototype.onclose=function(n){u("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",n);this._reconnection&&!this.skipReconnect&&this.reconnect()};r.prototype.reconnect=function(){var n,t,i;if(this.reconnecting||this.skipReconnect)return this;n=this;this.backoff.attempts>=this._reconnectionAttempts?(u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1):(t=this.backoff.duration(),u("will wait %dms before reconnect attempt",t),this.reconnecting=!0,i=setTimeout(function(){n.skipReconnect||(u("attempting reconnect"),n.emitAll("reconnect_attempt",n.backoff.attempts),n.emitAll("reconnecting",n.backoff.attempts),n.skipReconnect||n.open(function(t){t?(u("reconnect attempt error"),n.reconnecting=!1,n.reconnect(),n.emitAll("reconnect_error",t.data)):(u("reconnect success"),n.onreconnect())}))},t),this.subs.push({destroy:function(){clearTimeout(i)}}))};r.prototype.onreconnect=function(){var n=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",n)}},function(n,t,i){n.exports=i(15);n.exports.parser=i(22)},function(n,t,i){(function(t){function r(n,i){if(!(this instanceof r))return new r(n,i);i=i||{};n&&"object"==typeof n&&(i=n,n=null);n?(n=e(n),i.hostname=n.host,i.secure="https"===n.protocol||"wss"===n.protocol,i.port=n.port,n.query&&(i.query=n.query)):i.host&&(i.hostname=e(i.host).host);this.secure=null!=i.secure?i.secure:t.location&&"https:"===location.protocol;i.hostname&&!i.port&&(i.port=this.secure?"443":"80");this.agent=i.agent||!1;this.hostname=i.hostname||(t.location?location.hostname:"localhost");this.port=i.port||(t.location&&location.port?location.port:this.secure?443:80);this.query=i.query||{};"string"==typeof this.query&&(this.query=l.decode(this.query));this.upgrade=!1!==i.upgrade;this.path=(i.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!i.forceJSONP;this.jsonp=!1!==i.jsonp;this.forceBase64=!!i.forceBase64;this.enablesXDR=!!i.enablesXDR;this.timestampParam=i.timestampParam||"t";this.timestampRequests=i.timestampRequests;this.transports=i.transports||["polling","websocket"];this.transportOptions=i.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=i.policyPort||843;this.rememberUpgrade=i.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=i.onlyBinaryUpgrades;this.perMessageDeflate=!1!==i.perMessageDeflate&&(i.perMessageDeflate||{});!0===this.perMessageDeflate&&(this.perMessageDeflate={});this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024);this.pfx=i.pfx||null;this.key=i.key||null;this.passphrase=i.passphrase||null;this.cert=i.cert||null;this.ca=i.ca||null;this.ciphers=i.ciphers||null;this.rejectUnauthorized=void 0===i.rejectUnauthorized||i.rejectUnauthorized;this.forceNode=!!i.forceNode;var u="object"==typeof t&&t;u.global===u&&(i.extraHeaders&&Object.keys(i.extraHeaders).length>0&&(this.extraHeaders=i.extraHeaders),i.localAddress&&(this.localAddress=i.localAddress));this.id=null;this.upgrades=null;this.pingInterval=null;this.pingTimeout=null;this.pingIntervalTimer=null;this.pingTimeoutTimer=null;this.open()}function o(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i}var s=i(16),h=i(8),u=i(3)("engine.io-client:socket"),c=i(36),f=i(22),e=i(2),l=i(30);n.exports=r;r.priorWebsocketSuccess=!1;h(r.prototype);r.protocol=f.protocol;r.Socket=r;r.Transport=i(21);r.transports=i(16);r.parser=i(22);r.prototype.createTransport=function(n){var i,t;return u('creating transport "%s"',n),i=o(this.query),i.EIO=f.protocol,i.transport=n,t=this.transportOptions[n]||{},this.id&&(i.sid=this.id),new s[n]({query:i,socket:this,agent:t.agent||this.agent,hostname:t.hostname||this.hostname,port:t.port||this.port,secure:t.secure||this.secure,path:t.path||this.path,forceJSONP:t.forceJSONP||this.forceJSONP,jsonp:t.jsonp||this.jsonp,forceBase64:t.forceBase64||this.forceBase64,enablesXDR:t.enablesXDR||this.enablesXDR,timestampRequests:t.timestampRequests||this.timestampRequests,timestampParam:t.timestampParam||this.timestampParam,policyPort:t.policyPort||this.policyPort,pfx:t.pfx||this.pfx,key:t.key||this.key,passphrase:t.passphrase||this.passphrase,cert:t.cert||this.cert,ca:t.ca||this.ca,ciphers:t.ciphers||this.ciphers,rejectUnauthorized:t.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:t.perMessageDeflate||this.perMessageDeflate,extraHeaders:t.extraHeaders||this.extraHeaders,forceNode:t.forceNode||this.forceNode,localAddress:t.localAddress||this.localAddress,requestTimeout:t.requestTimeout||this.requestTimeout,protocols:t.protocols||void 0})};r.prototype.open=function(){var n,t;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)n="websocket";else{if(0===this.transports.length)return t=this,void setTimeout(function(){t.emit("error","No transports available")},0);n=this.transports[0]}this.readyState="opening";try{n=this.createTransport(n)}catch(i){return this.transports.shift(),void this.open()}n.open();this.setTransport(n)};r.prototype.setTransport=function(n){u("setting transport %s",n.name);var t=this;this.transport&&(u("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=n;n.on("drain",function(){t.onDrain()}).on("packet",function(n){t.onPacket(n)}).on("error",function(n){t.onError(n)}).on("close",function(){t.onClose("transport close")})};r.prototype.probe=function(n){function o(){if(i.onlyBinaryUpgrades){var e=!this.supportsBinary&&i.transport.supportsBinary;f=f||e}f||(u('probe transport "%s" opened',n),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(e){if(!f)if("pong"===e.type&&"probe"===e.data){if(u('probe transport "%s" pong',n),i.upgrading=!0,i.emit("upgrading",t),!t)return;r.priorWebsocketSuccess="websocket"===t.name;u('pausing current transport "%s"',i.transport.name);i.transport.pause(function(){f||"closed"!==i.readyState&&(u("changing transport and sending upgrade packet"),a(),i.setTransport(t),t.send([{type:"upgrade"}]),i.emit("upgrade",t),t=null,i.upgrading=!1,i.flush())})}else{u('probe transport "%s" failed',n);var o=new Error("probe error");o.transport=t.name;i.emit("upgradeError",o)}}))}function s(){f||(f=!0,a(),t.close(),t=null)}function e(r){var f=new Error("probe error: "+r);f.transport=t.name;s();u('probe transport "%s" failed because of error: %s',n,r);i.emit("upgradeError",f)}function h(){e("transport closed")}function c(){e("socket closed")}function l(n){t&&n.name!==t.name&&(u('"%s" works - aborting "%s"',n.name,t.name),s())}function a(){t.removeListener("open",o);t.removeListener("error",e);t.removeListener("close",h);i.removeListener("close",c);i.removeListener("upgrading",l)}u('probing transport "%s"',n);var t=this.createTransport(n,{probe:1}),f=!1,i=this;r.priorWebsocketSuccess=!1;t.once("open",o);t.once("error",e);t.once("close",h);this.once("close",c);this.once("upgrading",l);t.open()};r.prototype.onOpen=function(){if(u("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var n=0,t=this.upgrades.length;n<t;n++)this.probe(this.upgrades[n])}};r.prototype.onPacket=function(n){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(u('socket receive: type "%s", data "%s"',n.type,n.data),this.emit("packet",n),this.emit("heartbeat"),n.type){case"open":this.onHandshake(JSON.parse(n.data));break;case"pong":this.setPing();this.emit("pong");break;case"error":var t=new Error("server error");t.code=n.data;this.onError(t);break;case"message":this.emit("data",n.data);this.emit("message",n.data)}else u('packet received with socket readyState "%s"',this.readyState)};r.prototype.onHandshake=function(n){this.emit("handshake",n);this.id=n.sid;this.transport.query.sid=n.sid;this.upgrades=this.filterUpgrades(n.upgrades);this.pingInterval=n.pingInterval;this.pingTimeout=n.pingTimeout;this.onOpen();"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};r.prototype.onHeartbeat=function(n){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},n||t.pingInterval+t.pingTimeout)};r.prototype.setPing=function(){var n=this;clearTimeout(n.pingIntervalTimer);n.pingIntervalTimer=setTimeout(function(){u("writing ping packet - expecting pong within %sms",n.pingTimeout);n.ping();n.onHeartbeat(n.pingTimeout)},n.pingInterval)};r.prototype.ping=function(){var n=this;this.sendPacket("ping",function(){n.emit("ping")})};r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0===this.writeBuffer.length?this.emit("drain"):this.flush()};r.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(u("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};r.prototype.write=r.prototype.send=function(n,t,i){return this.sendPacket("message",n,t,i),this};r.prototype.sendPacket=function(n,t,i,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof i&&(r=i,i=null),"closing"!==this.readyState&&"closed"!==this.readyState){i=i||{};i.compress=!1!==i.compress;var u={type:n,data:t,options:i};this.emit("packetCreate",u);this.writeBuffer.push(u);r&&this.once("flush",r);this.flush()}};r.prototype.close=function(){function i(){n.onClose("forced close");u("socket closing - telling transport to close");n.transport.close()}function t(){n.removeListener("upgrade",t);n.removeListener("upgradeError",t);i()}function r(){n.once("upgrade",t);n.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var n=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():i()}):this.upgrading?r():i()}return this};r.prototype.onError=function(n){u("socket error %j",n);r.priorWebsocketSuccess=!1;this.emit("error",n);this.onClose("transport error",n)};r.prototype.onClose=function(n,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){u('socket close with reason: "%s"',n);var i=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",n,t);i.writeBuffer=[];i.prevBufferLen=0}};r.prototype.filterUpgrades=function(n){for(var i=[],t=0,r=n.length;t<r;t++)~c(this.transports,n[t])&&i.push(n[t]);return i}}).call(t,function(){return this}())},function(n,t,i){(function(n){function r(t){var o,s=!1,h=!1,c=!1!==t.jsonp,r,i;if(n.location&&(r="https:"===location.protocol,i=location.port,i||(i=r?443:80),s=t.hostname!==location.hostname||i!==t.port,h=t.secure!==r),t.xdomain=s,t.xscheme=h,o=new u(t),"open"in o&&!t.forceJSONP)return new f(t);if(!c)throw new Error("JSONP disabled");return new e(t)}var u=i(17),f=i(19),e=i(33),o=i(34);t.polling=r;t.websocket=o}).call(t,function(){return this}())},function(n,t,i){(function(t){var r=i(18);n.exports=function(n){var i=n.xdomain,u=n.xscheme,f=n.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!i||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!u&&f)return new XDomainRequest}catch(e){}if(!i)try{return new t[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}}).call(t,function(){return this}())},function(n){try{n.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){n.exports=!1}},function(n,t,i){(function(t){function e(){}function u(n){if(s.call(this,n),this.requestTimeout=n.requestTimeout,this.extraHeaders=n.extraHeaders,t.location){var r="https:"===location.protocol,i=location.port;i||(i=r?443:80);this.xd=n.hostname!==t.location.hostname||i!==n.port;this.xs=n.secure!==r}}function r(n){this.method=n.method||"GET";this.uri=n.uri;this.xd=!!n.xd;this.xs=!!n.xs;this.async=!1!==n.async;this.data=void 0!==n.data?n.data:null;this.agent=n.agent;this.isBinary=n.isBinary;this.supportsBinary=n.supportsBinary;this.enablesXDR=n.enablesXDR;this.requestTimeout=n.requestTimeout;this.pfx=n.pfx;this.key=n.key;this.passphrase=n.passphrase;this.cert=n.cert;this.ca=n.ca;this.ciphers=n.ciphers;this.rejectUnauthorized=n.rejectUnauthorized;this.extraHeaders=n.extraHeaders;this.create()}function o(){for(var n in r.requests)r.requests.hasOwnProperty(n)&&r.requests[n].abort()}var h=i(17),s=i(20),c=i(8),l=i(31),f=i(3)("engine.io-client:polling-xhr");n.exports=u;n.exports.Request=r;l(u,s);u.prototype.supportsBinary=!0;u.prototype.request=function(n){return n=n||{},n.uri=this.uri(),n.xd=this.xd,n.xs=this.xs,n.agent=this.agent||!1,n.supportsBinary=this.supportsBinary,n.enablesXDR=this.enablesXDR,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,n.requestTimeout=this.requestTimeout,n.extraHeaders=this.extraHeaders,new r(n)};u.prototype.doWrite=function(n,t){var r="string"!=typeof n&&void 0!==n,i=this.request({method:"POST",data:n,isBinary:r}),u=this;i.on("success",t);i.on("error",function(n){u.onError("xhr post error",n)});this.sendXhr=i};u.prototype.doPoll=function(){f("xhr poll");var n=this.request(),t=this;n.on("data",function(n){t.onData(n)});n.on("error",function(n){t.onError("xhr poll error",n)});this.pollXhr=n};c(r.prototype);r.prototype.create=function(){var i={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR},n,u,e;i.pfx=this.pfx;i.key=this.key;i.passphrase=this.passphrase;i.cert=this.cert;i.ca=this.ca;i.ciphers=this.ciphers;i.rejectUnauthorized=this.rejectUnauthorized;n=this.xhr=new h(i);u=this;try{f("xhr open %s: %s",this.method,this.uri);n.open(this.method,this.uri,this.async);try{if(this.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(e in this.extraHeaders)this.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this.extraHeaders[e])}}catch(o){}if("POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(o){}try{n.setRequestHeader("Accept","*/*")}catch(o){}"withCredentials"in n&&(n.withCredentials=!0);this.requestTimeout&&(n.timeout=this.requestTimeout);this.hasXDR()?(n.onload=function(){u.onLoad()},n.onerror=function(){u.onError(n.responseText)}):n.onreadystatechange=function(){if(2===n.readyState){var t;try{t=n.getResponseHeader("Content-Type")}catch(i){}"application/octet-stream"===t&&(n.responseType="arraybuffer")}4===n.readyState&&(200===n.status||1223===n.status?u.onLoad():setTimeout(function(){u.onError(n.status)},0))};f("xhr data %s",this.data);n.send(this.data)}catch(o){return void setTimeout(function(){u.onError(o)},0)}t.document&&(this.index=r.requestsCount++,r.requests[this.index]=this)};r.prototype.onSuccess=function(){this.emit("success");this.cleanup()};r.prototype.onData=function(n){this.emit("data",n);this.onSuccess()};r.prototype.onError=function(n){this.emit("error",n);this.cleanup(!0)};r.prototype.cleanup=function(n){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=e:this.xhr.onreadystatechange=e,n)try{this.xhr.abort()}catch(i){}t.document&&delete r.requests[this.index];this.xhr=null}};r.prototype.onLoad=function(){var n,t;try{try{t=this.xhr.getResponseHeader("Content-Type")}catch(i){}n="application/octet-stream"===t?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(i){this.onError(i)}null!=n&&this.onData(n)};r.prototype.hasXDR=function(){return"undefined"!=typeof t.XDomainRequest&&!this.xs&&this.enablesXDR};r.prototype.abort=function(){this.cleanup()};r.requestsCount=0;r.requests={};t.document&&(t.attachEvent?t.attachEvent("onunload",o):t.addEventListener&&t.addEventListener("beforeunload",o,!1))}).call(t,function(){return this}())},function(n,t,i){function u(n){var t=n&&n.forceBase64;o&&!t||(this.supportsBinary=!1);f.call(this,n)}var f=i(21),s=i(30),e=i(22),h=i(31),c=i(32),r=i(3)("engine.io-client:polling"),o;n.exports=u;o=function(){var n=i(17),t=new n({xdomain:!1});return null!=t.responseType}();h(u,f);u.prototype.name="polling";u.prototype.doOpen=function(){this.poll()};u.prototype.pause=function(n){function i(){r("paused");u.readyState="paused";n()}var u=this,t;(this.readyState="pausing",this.polling||!this.writable)?(t=0,this.polling&&(r("we are currently polling - waiting to pause"),t++,this.once("pollComplete",function(){r("pre-pause polling complete");--t||i()})),this.writable||(r("we are currently writing - waiting to pause"),t++,this.once("drain",function(){r("pre-pause writing complete");--t||i()}))):i()};u.prototype.poll=function(){r("polling");this.polling=!0;this.doPoll();this.emit("poll")};u.prototype.onData=function(n){var t=this,i;r("polling got data %s",n);i=function(n){return"opening"===t.readyState&&t.onOpen(),"close"===n.type?(t.onClose(),!1):void t.onPacket(n)};e.decodePayload(n,this.socket.binaryType,i);"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():r('ignoring poll - transport state "%s"',this.readyState))};u.prototype.doClose=function(){function n(){r("writing close packet");t.write([{type:"close"}])}var t=this;"open"===this.readyState?(r("transport open - closing"),n()):(r("transport not open - deferring close"),this.once("open",n))};u.prototype.write=function(n){var t=this,i;this.writable=!1;i=function(){t.writable=!0;t.emit("drain")};e.encodePayload(n,this.supportsBinary,function(n){t.doWrite(n,i)})};u.prototype.uri=function(){var n=this.query||{},t=this.secure?"https":"http",i="",r;return!1!==this.timestampRequests&&(n[this.timestampParam]=c()),this.supportsBinary||n.sid||(n.b64=1),n=s.encode(n),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(i=":"+this.port),n.length&&(n="?"+n),r=this.hostname.indexOf(":")!==-1,t+"://"+(r?"["+this.hostname+"]":this.hostname)+i+this.path+n}},function(n,t,i){function r(n){this.path=n.path;this.hostname=n.hostname;this.port=n.port;this.secure=n.secure;this.query=n.query;this.timestampParam=n.timestampParam;this.timestampRequests=n.timestampRequests;this.readyState="";this.agent=n.agent||!1;this.socket=n.socket;this.enablesXDR=n.enablesXDR;this.pfx=n.pfx;this.key=n.key;this.passphrase=n.passphrase;this.cert=n.cert;this.ca=n.ca;this.ciphers=n.ciphers;this.rejectUnauthorized=n.rejectUnauthorized;this.forceNode=n.forceNode;this.extraHeaders=n.extraHeaders;this.localAddress=n.localAddress}var u=i(22),f=i(8);n.exports=r;f(r.prototype);r.prototype.onError=function(n,t){var i=new Error(n);return i.type="TransportError",i.description=t,this.emit("error",i),this};r.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this};r.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this};r.prototype.send=function(n){if("open"!==this.readyState)throw new Error("Transport not open");this.write(n)};r.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};r.prototype.onData=function(n){var t=u.decodePacket(n,this.socket.binaryType);this.onPacket(t)};r.prototype.onPacket=function(n){this.emit("packet",n)};r.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},function(n,t,i){(function(n){function a(n,i){var r="b"+t.packets[n.type]+n.data.data;return i(r)}function v(n,i,r){var u;if(!i)return t.encodeBase64Packet(n,r);var e=n.data,s=new Uint8Array(e),f=new Uint8Array(1+e.byteLength);for(f[0]=o[n.type],u=0;u<s.length;u++)f[u+1]=s[u];return r(f.buffer)}function y(n,i,r){if(!i)return t.encodeBase64Packet(n,r);var u=new FileReader;return u.onload=function(){n.data=u.result;t.encodePacket(n,i,!0,r)},u.readAsArrayBuffer(n.data)}function p(n,i,r){var f,e;return i?l?y(n,i,r):(f=new Uint8Array(1),f[0]=o[n.type],e=new u([f.buffer,n.data]),r(e)):t.encodeBase64Packet(n,r)}function w(n){try{n=c.decode(n,{strict:!1})}catch(t){return!1}return n}function s(n,t,i){for(var u=new Array(n.length),f=d(n.length,i),e=function(n,i,r){t(i,function(t,i){u[n]=i;r(t,u)})},r=0;r<n.length;r++)e(r,n[r],f)}var h,b=i(23),k=i(9),e=i(24),d=i(25),c=i(26);n&&n.ArrayBuffer&&(h=i(28));var g="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),nt="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=g||nt;t.protocol=3;var o=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=b(o),r={type:"error",data:"parser error"},u=i(29);t.encodePacket=function(t,i,r,f){var e,s;return("function"==typeof i&&(f=i,i=!1),"function"==typeof r&&(f=r,r=null),e=void 0===t.data?void 0:t.data.buffer||t.data,n.ArrayBuffer&&e instanceof ArrayBuffer)?v(t,i,f):u&&e instanceof n.Blob?p(t,i,f):e&&e.base64?a(t,f):(s=o[t.type],void 0!==t.data&&(s+=r?c.encode(String(t.data),{strict:!1}):String(t.data)),f(""+s))};t.encodeBase64Packet=function(i,r){var o="b"+t.packets[i.type],f,s;if(u&&i.data instanceof n.Blob)return f=new FileReader,f.onload=function(){var n=f.result.split(",")[1];r(o+n)},f.readAsDataURL(i.data);try{s=String.fromCharCode.apply(null,new Uint8Array(i.data))}catch(l){for(var h=new Uint8Array(i.data),c=new Array(h.length),e=0;e<h.length;e++)c[e]=h[e];s=String.fromCharCode.apply(null,c)}return o+=n.btoa(s),r(o)};t.decodePacket=function(n,i,o){var s;if(void 0===n)return r;if("string"==typeof n)return"b"===n.charAt(0)?t.decodeBase64Packet(n.substr(1),i):o&&(n=w(n),n===!1)?r:(s=n.charAt(0),Number(s)==s&&f[s]?n.length>1?{type:f[s],data:n.substring(1)}:{type:f[s]}:r);var c=new Uint8Array(n),s=c[0],h=e(n,1);return u&&"blob"===i&&(h=new u([h])),{type:f[s],data:h}};t.decodeBase64Packet=function(n,t){var r=f[n.charAt(0)],i;return h?(i=h.decode(n.substr(1)),"blob"===t&&u&&(i=new u([i])),{type:r,data:i}):{type:r,data:{base64:!0,data:n.substr(1)}}};t.encodePayload=function(n,i,r){function e(n){return n.length+":"+n}function o(n,r){t.encodePacket(n,!!f&&i,!1,function(n){r(null,e(n))})}"function"==typeof i&&(r=i,i=null);var f=k(n);return i&&f?u&&!l?t.encodePayloadAsBlob(n,r):t.encodePayloadAsArrayBuffer(n,r):n.length?void s(n,o,function(n,t){return r(t.join(""))}):r("0:")};t.decodePayload=function(n,i,u){var o,c,a;if("string"!=typeof n)return t.decodePayloadAsBinary(n,i,u);if("function"==typeof i&&(u=i,i=null),""===n)return u(r,0,1);for(var s,h,f="",e=0,l=n.length;e<l;e++)if(c=n.charAt(e),":"===c){if(""===f||f!=(s=Number(f))||(h=n.substr(e+1,s),f!=h.length))return u(r,0,1);if(h.length){if(o=t.decodePacket(h,i,!1),r.type===o.type&&r.data===o.data)return u(r,0,1);if(a=u(o,e+s,l),!1===a)return}e+=s;f=""}else f+=c;if(""!==f)return u(r,0,1)};t.encodePayloadAsArrayBuffer=function(n,i){function r(n,i){t.encodePacket(n,!0,!0,function(n){return i(null,n)})}return n.length?void s(n,r,function(n,t){var f=t.reduce(function(n,t){var i;return i="string"==typeof t?t.length:t.byteLength,n+i.toString().length+i+2},0),r=new Uint8Array(f),u=0;return t.forEach(function(n){var o="string"==typeof n,f=n,e,i,t;if(o){for(i=new Uint8Array(n.length),t=0;t<n.length;t++)i[t]=n.charCodeAt(t);f=i.buffer}for(r[u++]=o?0:1,e=f.byteLength.toString(),t=0;t<e.length;t++)r[u++]=parseInt(e[t]);for(r[u++]=255,i=new Uint8Array(f),t=0;t<i.length;t++)r[u++]=i[t]}),i(r.buffer)}):i(new ArrayBuffer(0))};t.encodePayloadAsBlob=function(n,i){function r(n,i){t.encodePacket(n,!0,!0,function(n){var f=new Uint8Array(1),e,t,s;if(f[0]=1,"string"==typeof n){for(e=new Uint8Array(n.length),t=0;t<n.length;t++)e[t]=n.charCodeAt(t);n=e.buffer;f[0]=0}for(var h=n instanceof ArrayBuffer?n.byteLength:n.size,r=h.toString(),o=new Uint8Array(r.length+1),t=0;t<r.length;t++)o[t]=parseInt(r[t]);(o[r.length]=255,u)&&(s=new u([f.buffer,o.buffer,n]),i(null,s))})}s(n,r,function(n,t){return i(new u(t))})};t.decodePayloadAsBinary=function(n,i,u){var f,c,h,a,s,v;for("function"==typeof i&&(u=i,i=null),f=n,c=[];f.byteLength>0;){for(var l=new Uint8Array(f),y=0===l[0],o="",s=1;255!==l[s];s++){if(o.length>310)return u(r,0,1);o+=l[s]}if(f=e(f,2+o.length),o=parseInt(o),h=e(f,0,o),y)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(p){for(a=new Uint8Array(h),h="",s=0;s<a.length;s++)h+=String.fromCharCode(a[s])}c.push(h);f=e(f,o)}v=c.length;c.forEach(function(n,r){u(t.decodePacket(n,i,!0),r,v)})}}).call(t,function(){return this}())},function(n){n.exports=Object.keys||function(n){var t=[],r=Object.prototype.hasOwnProperty;for(var i in n)r.call(n,i)&&t.push(i);return t}},function(n){n.exports=function(n,t,i){var r=n.byteLength;if(t=t||0,i=i||r,n.slice)return n.slice(t,i);if(t<0&&(t+=r),i<0&&(i+=r),i>r&&(i=r),t>=r||t>=i||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(n),f=new Uint8Array(i-t),u=t,e=0;u<i;u++,e++)f[e]=o[u];return f.buffer}},function(n){function t(n,t,r){function u(n,i){if(u.count<=0)throw new Error("after called too many times");--u.count;n?(f=!0,t(n),t=r):0!==u.count||f||t(null,i)}var f=!1;return r=r||i,u.count=n,0===n?t():u}function i(){}n.exports=t},function(n,t,i){var r;(function(n,u){!function(f){function v(n){for(var t,u,r=[],i=0,f=n.length;i<f;)t=n.charCodeAt(i++),t>=55296&&t<=56319&&i<f?(u=n.charCodeAt(i++),56320==(64512&u)?r.push(((1023&t)<<10)+(1023&u)+65536):(r.push(t),i--)):r.push(t);return r}function w(n){for(var t,u=n.length,r=-1,i="";++r<u;)t=n[r],t>65535&&(t-=65536,i+=e(t>>>10&1023|55296),t=56320|1023&t),i+=e(t);return i}function y(n,t){if(n>=55296&&n<=57343){if(t)throw Error("Lone surrogate U+"+n.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function a(n,t){return e(n>>t&63|128)}function b(n,t){if(0==(4294967168&n))return e(n);var i="";return 0==(4294965248&n)?i=e(n>>6&31|192):0==(4294901760&n)?(y(n,t)||(n=65533),i=e(n>>12&15|224),i+=a(n,6)):0==(4292870144&n)&&(i=e(n>>18&7|240),i+=a(n,12),i+=a(n,6)),i+e(63&n|128)}function k(n,t){t=t||{};for(var i,e=!1!==t.strict,r=v(n),o=r.length,u=-1,f="";++u<o;)i=r[u],f+=b(i,e);return f}function s(){if(o>=l)throw Error("Invalid byte index");var n=255&c[o];if(o++,128==(192&n))return 63&n;throw Error("Invalid continuation byte");}function d(n){var i,r,u,f,t;if(o>l)throw Error("Invalid byte index");if(o==l)return!1;if(i=255&c[o],o++,0==(128&i))return i;if(192==(224&i)){if(r=s(),t=(31&i)<<6|r,t>=128)return t;throw Error("Invalid continuation byte");}if(224==(240&i)){if(r=s(),u=s(),t=(15&i)<<12|r<<6|u,t>=2048)return y(t,n)?t:65533;throw Error("Invalid continuation byte");}if(240==(248&i)&&(r=s(),u=s(),f=s(),t=(7&i)<<18|r<<12|u<<6|f,t>=65536&&t<=1114111))return t;throw Error("Invalid UTF-8 detected");}function g(n,t){var r,u,i;for(t=t||{},r=!1!==t.strict,c=v(n),l=c.length,o=0,i=[];(u=d(r))!==!1;)i.push(u);return w(i)}var nt="object"==typeof t&&t,h=("object"==typeof n&&n&&n.exports==nt&&n,"object"==typeof u&&u),c,l,o,e,p;h.global!==h&&h.window!==h||(f=h);e=String.fromCharCode;p={version:"2.1.2",encode:k,decode:g};r=function(){return p}.call(t,i,t,n);!(void 0!==r&&(n.exports=r))}(this)}).call(t,i(27)(n),function(){return this}())},function(n){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children=[],n.webpackPolyfill=1),n}},function(n,t){!function(){"use strict";for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256),r=0;r<n.length;r++)i[n.charCodeAt(r)]=r;t.encode=function(t){for(var u=new Uint8Array(t),f=u.length,i="",r=0;r<f;r+=3)i+=n[u[r]>>2],i+=n[(3&u[r])<<4|u[r+1]>>4],i+=n[(15&u[r+1])<<2|u[r+2]>>6],i+=n[63&u[r+2]];return f%3==2?i=i.substring(0,i.length-1)+"=":f%3==1&&(i=i.substring(0,i.length-2)+"=="),i};t.decode=function(n){var t,h,u,f,c,e=.75*n.length,l=n.length,o=0,s,r;for("="===n[n.length-1]&&(e--,"="===n[n.length-2]&&e--),s=new ArrayBuffer(e),r=new Uint8Array(s),t=0;t<l;t+=4)h=i[n.charCodeAt(t)],u=i[n.charCodeAt(t+1)],f=i[n.charCodeAt(t+2)],c=i[n.charCodeAt(t+3)],r[o++]=h<<2|u>>4,r[o++]=(15&u)<<4|f>>2,r[o++]=(3&f)<<6|63&c;return s}}()},function(n,t){(function(t){function r(n){for(var t,r,u,i=0;i<n.length;i++)t=n[i],t.buffer instanceof ArrayBuffer&&(r=t.buffer,t.byteLength!==r.byteLength&&(u=new Uint8Array(t.byteLength),u.set(new Uint8Array(r,t.byteOffset,t.byteLength)),r=u.buffer),n[i]=r)}function f(n,t){var u,f;for(t=t||{},u=new i,r(n),f=0;f<n.length;f++)u.append(n[f]);return t.type?u.getBlob(t.type):u.getBlob()}function e(n,t){return r(n),new Blob(n,t||{})}var i=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,u=function(){try{var n=new Blob(["hi"]);return 2===n.size}catch(t){return!1}}(),o=u&&function(){try{var n=new Blob([new Uint8Array([1,2])]);return 2===n.size}catch(t){return!1}}(),s=i&&i.prototype.append&&i.prototype.getBlob;n.exports=function(){return u?o?t.Blob:e:s?f:void 0}()}).call(t,function(){return this}())},function(n,t){t.encode=function(n){var t="";for(var i in n)n.hasOwnProperty(i)&&(t.length&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(n[i]));return t};t.decode=function(n){for(var i,r={},u=n.split("&"),t=0,f=u.length;t<f;t++)i=u[t].split("="),r[decodeURIComponent(i[0])]=decodeURIComponent(i[1]);return r}},function(n){n.exports=function(n,t){var i=function(){};i.prototype=t.prototype;n.prototype=new i;n.prototype.constructor=n}},function(n){"use strict";function r(n){var t="";do t=e[n%i]+t,n=Math.floor(n/i);while(n>0);return t}function h(n){var r=0;for(t=0;t<n.length;t++)r=r*i+o[n.charAt(t)];return r}function u(){var n=r(+new Date);return n!==f?(s=0,f=n):n+"."+r(s++)}for(var f,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,o={},s=0,t=0;t<i;t++)o[e[t]]=t;u.encode=r;u.decode=h;n.exports=u},function(n,t,i){(function(t){function s(){}function r(n){f.call(this,n);this.query=this.query||{};u||(t.___eio||(t.___eio=[]),u=t.___eio);this.index=u.length;var i=this;u.push(function(n){i.onData(n)});this.query.j=this.index;t.document&&t.addEventListener&&t.addEventListener("beforeunload",function(){i.script&&(i.script.onerror=s)},!1)}var f=i(20),h=i(31),u,e,o;n.exports=r;e=/\n/g;o=/\\n/g;h(r,f);r.prototype.supportsBinary=!1;r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);f.prototype.doClose.call(this)};r.prototype.doPoll=function(){var r=this,n=document.createElement("script"),t,i;this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);n.async=!0;n.src=this.uri();n.onerror=function(n){r.onError("jsonp poll error",n)};t=document.getElementsByTagName("script")[0];t?t.parentNode.insertBefore(n,t):(document.head||document.body).appendChild(n);this.script=n;i="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);i&&setTimeout(function(){var n=document.createElement("iframe");document.body.appendChild(n);document.body.removeChild(n)},100)};r.prototype.doWrite=function(n,t){function s(){h();t()}function h(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(n){i.onError("jsonp polling iframe removal error",n)}try{var t='<iframe src="javascript:0" name="'+i.iframeId+'">';u=document.createElement(t)}catch(n){u=document.createElement("iframe");u.name=i.iframeId;u.src="javascript:0"}u.id=i.iframeId;i.form.appendChild(u);i.iframe=u}var i=this;if(!this.form){var u,r=document.createElement("form"),f=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;r.className="socketio";r.style.position="absolute";r.style.top="-1000px";r.style.left="-1000px";r.target=c;r.method="POST";r.setAttribute("accept-charset","utf-8");f.name="d";r.appendChild(f);document.body.appendChild(r);this.form=r;this.area=f}this.form.action=this.uri();h();n=n.replace(o,"\\\n");this.area.value=n.replace(e,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===i.iframe.readyState&&s()}:this.iframe.onload=s}}).call(t,function(){return this}())},function(n,t,i){(function(t){function r(n){var t=n&&n.forceBase64;t&&(this.supportsBinary=!1);this.perMessageDeflate=n.perMessageDeflate;this.usingBrowserWebSocket=o&&!n.forceNode;this.protocols=n.protocols;this.usingBrowserWebSocket||(u=f);e.call(this,n)}var f,e=i(21),s=i(22),h=i(30),c=i(31),l=i(32),a=i(3)("engine.io-client:websocket"),o=t.WebSocket||t.MozWebSocket,u;if("undefined"==typeof window)try{f=i(35)}catch(v){}u=o;u||"undefined"!=typeof window||(u=f);n.exports=r;c(r,e);r.prototype.name="websocket";r.prototype.supportsBinary=!0;r.prototype.doOpen=function(){if(this.check()){var t=this.uri(),i=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx;n.key=this.key;n.passphrase=this.passphrase;n.cert=this.cert;n.ca=this.ca;n.ciphers=this.ciphers;n.rejectUnauthorized=this.rejectUnauthorized;this.extraHeaders&&(n.headers=this.extraHeaders);this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?i?new u(t,i):new u(t):new u(t,i,n)}catch(r){return this.emit("error",r)}void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer";this.addEventListeners()}};r.prototype.addEventListeners=function(){var n=this;this.ws.onopen=function(){n.onOpen()};this.ws.onclose=function(){n.onClose()};this.ws.onmessage=function(t){n.onData(t.data)};this.ws.onerror=function(t){n.onError("websocket error",t)}};r.prototype.write=function(n){function f(){i.emit("flush");setTimeout(function(){i.writable=!0;i.emit("drain")},0)}var i=this;this.writable=!1;for(var u=n.length,r=0,e=u;r<e;r++)!function(n){s.encodePacket(n,i.supportsBinary,function(r){var e,o;i.usingBrowserWebSocket||(e={},(n.options&&(e.compress=n.options.compress),i.perMessageDeflate)&&(o="string"==typeof r?t.Buffer.byteLength(r):r.length,o<i.perMessageDeflate.threshold&&(e.compress=!1)));try{i.usingBrowserWebSocket?i.ws.send(r):i.ws.send(r,e)}catch(s){a("websocket closed before onclose event")}--u||f()})}(n[r])};r.prototype.onClose=function(){e.prototype.onClose.call(this)};r.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()};r.prototype.uri=function(){var n=this.query||{},t=this.secure?"wss":"ws",i="",r;return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(i=":"+this.port),this.timestampRequests&&(n[this.timestampParam]=l()),this.supportsBinary||(n.b64=1),n=h.encode(n),n.length&&(n="?"+n),r=this.hostname.indexOf(":")!==-1,t+"://"+(r?"["+this.hostname+"]":this.hostname)+i+this.path+n};r.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===r.prototype.name)}}).call(t,function(){return this}())},function(){},function(n){var t=[].indexOf;n.exports=function(n,i){if(t)return n.indexOf(i);for(var r=0;r<n.length;++r)if(n[r]===i)return r;return-1}},function(n,t,i){"use strict";function r(n,t,i){this.io=n;this.nsp=t;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;i&&i.query&&(this.query=i.query);this.io.autoConnect&&this.open()}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},u=i(7),c=i(8),o=i(38),s=i(39),h=i(40),f=i(3)("socket.io-client:socket"),v=i(30),l,e;n.exports=t=r;l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};e=c.prototype.emit;c(r.prototype);r.prototype.subEvents=function(){if(!this.subs){var n=this.io;this.subs=[s(n,"open",h(this,"onopen")),s(n,"packet",h(this,"onpacket")),s(n,"close",h(this,"onclose"))]}};r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)};r.prototype.send=function(){var n=o(arguments);return n.unshift("message"),this.emit.apply(this,n),this};r.prototype.emit=function(n){if(l.hasOwnProperty(n))return e.apply(this,arguments),this;var i=o(arguments),t={type:u.EVENT,data:i};return t.options={},t.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof i[i.length-1]&&(f("emitting packet with ack id %d",this.ids),this.acks[this.ids]=i.pop(),t.id=this.ids++),this.connected?this.packet(t):this.sendBuffer.push(t),delete this.flags,this};r.prototype.packet=function(n){n.nsp=this.nsp;this.io.packet(n)};r.prototype.onopen=function(){if(f("transport is open - connecting"),"/"!==this.nsp)if(this.query){var n="object"===a(this.query)?v.encode(this.query):this.query;f("sending connect packet with query %s",n);this.packet({type:u.CONNECT,query:n})}else this.packet({type:u.CONNECT})};r.prototype.onclose=function(n){f("close (%s)",n);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",n)};r.prototype.onpacket=function(n){if(n.nsp===this.nsp)switch(n.type){case u.CONNECT:this.onconnect();break;case u.EVENT:this.onevent(n);break;case u.BINARY_EVENT:this.onevent(n);break;case u.ACK:this.onack(n);break;case u.BINARY_ACK:this.onack(n);break;case u.DISCONNECT:this.ondisconnect();break;case u.ERROR:this.emit("error",n.data)}};r.prototype.onevent=function(n){var t=n.data||[];f("emitting event %j",t);null!=n.id&&(f("attaching ack callback to event"),t.push(this.ack(n.id)));this.connected?e.apply(this,t):this.receiveBuffer.push(t)};r.prototype.ack=function(n){var i=this,t=!1;return function(){if(!t){t=!0;var r=o(arguments);f("sending ack %j",r);i.packet({type:u.ACK,id:n,data:r})}}};r.prototype.onack=function(n){var t=this.acks[n.id];"function"==typeof t?(f("calling ack %s with %j",n.id,n.data),t.apply(this,n.data),delete this.acks[n.id]):f("bad ack %s",n.id)};r.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};r.prototype.emitBuffered=function(){for(var n=0;n<this.receiveBuffer.length;n++)e.apply(this,this.receiveBuffer[n]);for(this.receiveBuffer=[],n=0;n<this.sendBuffer.length;n++)this.packet(this.sendBuffer[n]);this.sendBuffer=[]};r.prototype.ondisconnect=function(){f("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};r.prototype.destroy=function(){if(this.subs){for(var n=0;n<this.subs.length;n++)this.subs[n].destroy();this.subs=null}this.io.destroy(this)};r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(f("performing disconnect (%s)",this.nsp),this.packet({type:u.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this};r.prototype.compress=function(n){return this.flags=this.flags||{},this.flags.compress=n,this}},function(n){function t(n,t){var r=[],i;for(t=t||0,i=t||0;i<n.length;i++)r[i-t]=n[i];return r}n.exports=t},function(n){"use strict";function t(n,t,i){return n.on(t,i),{destroy:function(){n.removeListener(t,i)}}}n.exports=t},function(n){var t=[].slice;n.exports=function(n,i){if("string"==typeof i&&(i=n[i]),"function"!=typeof i)throw new Error("bind() requires a function");var r=t.call(arguments,2);return function(){return i.apply(n,r.concat(t.call(arguments)))}}},function(n){function t(n){n=n||{};this.ms=n.min||100;this.max=n.max||1e4;this.factor=n.factor||2;this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0;this.attempts=0}n.exports=t;t.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++),t,i;return this.jitter&&(t=Math.random(),i=Math.floor(t*this.jitter*n),n=0==(1&Math.floor(10*t))?n-i:n+i),0|Math.min(n,this.max)};t.prototype.reset=function(){this.attempts=0};t.prototype.setMin=function(n){this.ms=n};t.prototype.setMax=function(n){this.max=n};t.prototype.setJitter=function(n){this.jitter=n}}])});
typeof ASC=="undefined"&&(ASC={});ASC.SocketIO=function(n){var t=ASC.Resources.Master,i,r;t.Hub&&t.Hub.Url&&(i=t.Hub,r={path:i.Url,reconnectionAttempts:5,perMessageDeflate:"false"},t.numberId&&i.VoipEnabled&&(r.query={numberId:t.numberId}),this.socket=io(n,r))};ASC.SocketIO.prototype.emit=function(){return this.socket&&this.socket.emit.apply(this.socket,arguments),this};ASC.SocketIO.prototype.on=function(){return this.socket&&(arguments[0]==="connect"&&typeof arguments[1]=="function"&&this.socket.connected?arguments[1]():this.socket.on.apply(this.socket,arguments)),this};ASC.SocketIO.prototype.connect=function(){return this.on.call(this,"connect",arguments[0])};ASC.SocketIO.prototype.reconnect_failed=function(){return this.on.call(this,"reconnect_failed",arguments[0])};ASC.SocketIO.prototype.connected=function(){return this.socket&&this.socket.connected};ASC.SocketIO.disabled=function(){return!ASC.Resources.Master.Hub||!ASC.Resources.Master.Hub.Url};ASC.SocketIO.init=function(){var t=ASC.Resources.Master,n,i;t.Hub&&t.Hub.Url&&(n=ASC.Resources.Master.Hub.Url,i=n.length-1,n.lastIndexOf("/")===n.length-1&&(n=n.substring(0,i)),jq.ajax({type:"OPTIONS",url:n+"/?EIO=3&transport=polling",async:!0}))};ASC.SocketIO.Factory=function(){var n,t,i,r;return{get chat(){return n||(n=new ASC.SocketIO("/chat")),n},get voip(){return t||(t=new ASC.SocketIO("/voip")),t},get counters(){return i||(i=new ASC.SocketIO("/counters")),i},get files(){return r||(r=new ASC.SocketIO("/files")),r}}}();jq(document).ready(function(){ASC.SocketIO.init();ASC.SocketIO.Factory.counters.on("getNewMessagesCount",function(n){ASC.Controls.MailReader&&ASC.Controls.MailReader.setUnreadMailMessagesCount(n.ma)}).on("sendMailNotification",function(n){ASC.Mail.Utility._showSignalRMailNotification(n)}).on("updateFolders",function(n,t){window.serviceManager?(window.serviceManager.updateFolders(),t&&window.serviceManager.getAccounts()):ASC.Controls.MailReader&&ASC.Controls.MailReader.setUnreadMailMessagesCount(n)})});
!function(n,t,i){"use strict";function r(n,t){this._defaults=u;this.element=n;this.setOptions(t);this.init()}var u={tagName:"a",newLine:"\n",target:"_blank",linkClass:null,linkClasses:[],linkAttributes:null};r.prototype={constructor:r,init:function(){1===this.element.nodeType?r.linkifyNode.call(this,this.element):this.element=r.linkify.call(this,this.element.toString())},setOptions:function(n){this.settings=r.extendSettings(n,this.settings)},toString:function(){return this.element.toString()}};r.extendSettings=function(n,t){var i;t=t||{};for(i in u)t[i]||(t[i]=u[i]);for(i in n)t[i]=n[i];return t};r.linkMatch=new RegExp('(\\s|[^a-zA-Z0-9.\\+_\\/"\\>\\-]|^)(?:([a-zA-Z0-9\\+_\\-]+(?:\\.[a-zA-Z0-9\\+_\\-]+)*@)?(http:\\/\\/|https:\\/\\/|ftp:\\/\\/)?((?:(?:[a-z0-9][a-z0-9_%\\-_+]*\\.)+))((?:com|ca|co|edu|gov|net|org|dev|biz|cat|int|pro|tel|mil|aero|asia|coop|info|jobs|mobi|museum|name|post|travel|local|[a-z]{2}))((?::\\d{1,5}))?((?:[\\/|\\?](?:[\\-a-zA-Z0-9_%#*&+=~!?,;:.\\/]*)*)[\\-\\/a-zA-Z0-9_%#*&+=~]|\\/?)?)([^a-zA-Z0-9\\+_\\/"\\<\\-]|$)',"g");r.emailLinkMatch=/(<[a-z]+ href=\")(http:\/\/)([a-zA-Z0-9\+_\-]+(?:\.[a-zA-Z0-9\+_\-]+)*@)/g;r.linkify=function(n,t){var e,i,f,u=[];this.constructor===r&&this.settings?(i=this.settings,t&&(i=r.extendSettings(t,i))):i=r.extendSettings(t);f=i.linkClass?i.linkClass.split(/\s+/):[];f.push.apply(f,i.linkClasses);n=n.replace(/</g,"&lt;").replace(/(\s)/g,"$1$1");u.push("$1<"+i.tagName,'href="http://$2$4$5$6$7"');u.push('class="linkified'+(f.length>0?" "+f.join(" "):"")+'"');i.target&&u.push('target="'+i.target+'"');for(e in i.linkAttributes)u.push([e,'="',i.linkAttributes[e].replace(/\"/g,"&quot;").replace(/\$/g,"&#36;"),'"'].join(""));return u.push(">$2$3$4$5$6$7<\/"+i.tagName+">$8"),n=n.replace(r.linkMatch,u.join(" ")),n=n.replace(r.emailLinkMatch,"$1mailto:$3"),n=n.replace(/(\s){2}/g,"$1"),n=n.replace(/\n/g,i.newLine)};r.linkifyNode=function(n){var f,t,o,u,e;if(n&&"object"==typeof n&&1===n.nodeType&&"a"!==n.tagName.toLowerCase()&&!/[^\s]linkified[\s$]/.test(n.className)){for(f=[],u=r._dummyElement||i.createElement("div"),t=n.firstChild,o=n.childElementCount;t;){if(3===t.nodeType){for(;u.firstChild;)u.removeChild(u.firstChild);for(u.innerHTML=r.linkify.call(this,t.textContent||t.innerText||t.nodeValue),f.push.apply(f,u.childNodes);u.firstChild;)u.removeChild(u.firstChild)}else 1===t.nodeType?f.push(r.linkifyNode(t)):f.push(t);t=t.nextSibling}for(;n.firstChild;)n.removeChild(n.firstChild);for(e=0;e<f.length;e++)n.appendChild(f[e])}return n};r._dummyElement=i.createElement("div");n.fn.linkify=function(t){return this.each(function(){var i;(i=n.data(this,"plugin-linkify"))?(i.setOptions(t),i.init()):n.data(this,"plugin-linkify",new r(this,t))})};n.fn.linkify.Constructor=r;n(t).on("load",function(){n("[data-linkify]").each(function(){var r,t=n(this),u=t.attr("data-linkify"),i={tagName:t.attr("data-linkify-tagname"),newLine:t.attr("data-linkify-newline"),target:t.attr("data-linkify-target"),linkClass:t.attr("data-linkify-linkclass")};for(var f in i)"undefined"==typeof i[f]&&delete i[f];r="this"===u?t:t.find(u);r.linkify(i)})});n("body").on("click",".linkified",function(){var r=n(this),i=r.attr("href"),u=/^mailto:/i.test(i),f=r.attr("target");return u?t.location.href=i:t.open(i,f),!1})}(jQuery,window,document);
typeof Object.create!="function"&&(Object.create=function(n){function t(){}return t.prototype=n,new t}),function(n){var i={init:function(t){return this.options=n.extend({},n.noty.defaults,t),this.options.layout=this.options.custom?n.noty.layouts.inline:n.noty.layouts[this.options.layout],this.options.theme=n.noty.themes[this.options.theme],delete t.layout,delete t.theme,this.options=n.extend({},this.options,this.options.layout.options),this.options.id="noty_"+(new Date).getTime()*Math.floor(Math.random()*1e6),this.options=n.extend({},this.options,t),this._build(),this},_build:function(){var t=n('<div class="noty_bar"><\/div>').attr("id",this.options.id),i,r;t.append(this.options.template).find(".noty_text").html(this.options.text);this.$bar=this.options.layout.parent.object!==null?n(this.options.layout.parent.object).css(this.options.layout.parent.css).append(t):t;this.options.buttons&&(this.options.closeWith=[],this.options.timeout=!1,i=n("<div/>").addClass("noty_buttons"),this.options.layout.parent.object!==null?this.$bar.find(".noty_bar").append(i):this.$bar.append(i),r=this,n.each(this.options.buttons,function(t,i){var u=n("<button/>").addClass(i.addClass?i.addClass:"gray").html(i.text).appendTo(r.$bar.find(".noty_buttons")).bind("click",function(){n.isFunction(i.onClick)&&i.onClick.call(u,r)})}));this.$message=this.$bar.find(".noty_message");this.$closeButton=this.$bar.find(".noty_close");this.$buttons=this.$bar.find(".noty_buttons");n.noty.store[this.options.id]=this},show:function(){var t=this;if(n(t.options.layout.container.selector).append(t.$bar),t.options.theme.style.apply(t),n.type(t.options.layout.css)==="function"?this.options.layout.css.apply(t.$bar):t.$bar.css(this.options.layout.css||{}),t.$bar.addClass(t.options.layout.addClass),t.options.layout.container.style.apply(n(t.options.layout.container.selector)),t.options.theme.callback.onShow.apply(this),n.inArray("click",t.options.closeWith)>-1)t.$bar.css("cursor","pointer").one("click",function(n){t.stopPropagation(n);t.options.callback.onCloseClick&&t.options.callback.onCloseClick.apply(t);t.close()});if(n.inArray("hover",t.options.closeWith)>-1)t.$bar.one("mouseenter",function(){t.close()});if(n.inArray("button",t.options.closeWith)>-1)t.$closeButton.one("click",function(n){t.stopPropagation(n);t.close()});return n.inArray("button",t.options.closeWith)==-1&&t.$closeButton.remove(),t.options.callback.onShow&&t.options.callback.onShow.apply(t),t.$bar.animate(t.options.animation.open,t.options.animation.speed,t.options.animation.easing,function(){t.options.callback.afterShow&&t.options.callback.afterShow.apply(t);t.shown=!0}),t.options.timeout&&t.$bar.delay(t.options.timeout).promise().done(function(){t.close()}),this},close:function(){var t,i;if(!this.closed&&(!this.$bar||!this.$bar.hasClass("i-am-closing-now"))){if(t=this,!this.shown){i=[];n.each(n.noty.queue,function(n,r){r.options.id!=t.options.id&&i.push(r)});n.noty.queue=i;return}t.$bar.addClass("i-am-closing-now");t.options.callback.onClose&&t.options.callback.onClose.apply(t);t.$bar.clearQueue().stop().animate(t.options.animation.close,t.options.animation.speed,t.options.animation.easing,function(){t.options.callback.afterClose&&t.options.callback.afterClose.apply(t)}).promise().done(function(){t.options.modal&&(n.notyRenderer.setModalCount(-1),n.notyRenderer.getModalCount()==0&&n(".noty_modal").fadeOut("fast",function(){n(this).remove()}));n.notyRenderer.setLayoutCountFor(t,-1);n.notyRenderer.getLayoutCountFor(t)==0&&n(t.options.layout.container.selector).remove();typeof t.$bar!="undefined"&&t.$bar!==null&&(t.$bar.remove(),t.$bar=null,t.closed=!0);delete n.noty.store[t.options.id];t.options.theme.callback.onClose.apply(t);t.options.dismissQueue||(n.noty.ontap=!0,n.notyRenderer.render());t.options.maxVisible>0&&t.options.dismissQueue&&n.notyRenderer.render()})}},setText:function(n){return this.closed||(this.options.text=n,this.$bar.find(".noty_text").html(n)),this},setType:function(n){return this.closed||(this.options.type=n,this.options.theme.style.apply(this),this.options.theme.callback.onShow.apply(this)),this},setTimeout:function(n){if(!this.closed){var t=this;this.options.timeout=n;t.$bar.delay(t.options.timeout).promise().done(function(){t.close()})}return this},stopPropagation:function(n){n=n||window.event;typeof n.stopPropagation!="undefined"?n.stopPropagation():n.cancelBubble=!0},closed:!1,shown:!1},t;n.notyRenderer={};n.notyRenderer.init=function(t){var r=Object.create(i).init(t);return r.options.force?n.noty.queue.unshift(r):n.noty.queue.push(r),n.notyRenderer.render(),n.noty.returns=="object"?r:r.options.id};n.notyRenderer.render=function(){var t=n.noty.queue[0];n.type(t)==="object"?t.options.dismissQueue?t.options.maxVisible>0?n(t.options.layout.container.selector+" li").length<t.options.maxVisible&&n.notyRenderer.show(n.noty.queue.shift()):n.notyRenderer.show(n.noty.queue.shift()):n.noty.ontap&&(n.notyRenderer.show(n.noty.queue.shift()),n.noty.ontap=!1):n.noty.ontap=!0};n.notyRenderer.show=function(t){t.options.modal&&(n.notyRenderer.createModalFor(t),n.notyRenderer.setModalCount(1));n(t.options.layout.container.selector).length==0?t.options.custom?t.options.custom.append(n(t.options.layout.container.object).addClass("i-am-new")):n("body").append(n(t.options.layout.container.object).addClass("i-am-new")):n(t.options.layout.container.selector).removeClass("i-am-new");n.notyRenderer.setLayoutCountFor(t,1);t.show()};n.notyRenderer.createModalFor=function(t){n(".noty_modal").length==0&&n("<div/>").addClass("noty_modal").data("noty_modal_count",0).css(t.options.theme.modal.css).prependTo(n("body")).fadeIn("fast")};n.notyRenderer.getLayoutCountFor=function(t){return n(t.options.layout.container.selector).data("noty_layout_count")||0};n.notyRenderer.setLayoutCountFor=function(t,i){return n(t.options.layout.container.selector).data("noty_layout_count",n.notyRenderer.getLayoutCountFor(t)+i)};n.notyRenderer.getModalCount=function(){return n(".noty_modal").data("noty_modal_count")||0};n.notyRenderer.setModalCount=function(t){return n(".noty_modal").data("noty_modal_count",n.notyRenderer.getModalCount()+t)};n.fn.noty=function(t){return t.custom=n(this),n.notyRenderer.init(t)};n.noty={};n.noty.queue=[];n.noty.ontap=!0;n.noty.layouts={};n.noty.themes={};n.noty.returns="object";n.noty.store={};n.noty.get=function(t){return n.noty.store.hasOwnProperty(t)?n.noty.store[t]:!1};n.noty.close=function(t){return n.noty.get(t)?n.noty.get(t).close():!1};n.noty.setText=function(t,i){return n.noty.get(t)?n.noty.get(t).setText(i):!1};n.noty.setType=function(t,i){return n.noty.get(t)?n.noty.get(t).setType(i):!1};n.noty.clearQueue=function(){n.noty.queue=[]};n.noty.closeAll=function(){n.noty.clearQueue();n.each(n.noty.store,function(n,t){t.close()})};t=window.alert;n.noty.consumeAlert=function(t){window.alert=function(i){t?t.text=i:t={text:i};n.notyRenderer.init(t)}};n.noty.stopConsumeAlert=function(){window.alert=t};n.noty.defaults={layout:"top",theme:"defaultTheme",type:"alert",text:"",dismissQueue:!0,template:'<div class="noty_message"><span class="noty_text"><\/span><div class="noty_close"><\/div><\/div>',animation:{open:{height:"toggle"},close:{height:"toggle"},easing:"swing",speed:500},timeout:!1,force:!1,modal:!1,maxVisible:5,closeWith:["click"],callback:{onShow:function(){},afterShow:function(){},onClose:function(){},afterClose:function(){},onCloseClick:function(){}},buttons:!1};n(window).resize(function(){n.each(n.noty.layouts,function(t,i){i.container.style.apply(n(i.container.selector))})})}(jQuery);window.noty=function(n){var t=0,i={animateOpen:"animation.open",animateClose:"animation.close",easing:"animation.easing",speed:"animation.speed",onShow:"callback.onShow",onShown:"callback.afterShow",onClose:"callback.onClose",onCloseClick:"callback.onCloseClick",onClosed:"callback.afterClose"};return jQuery.each(n,function(r,u){if(i[r]){t++;var f=i[r].split(".");n[f[0]]||(n[f[0]]={});n[f[0]][f[1]]=u?u:function(){};delete n[r]}}),n.closeWith||(n.closeWith=jQuery.noty.defaults.closeWith),n.hasOwnProperty("closeButton")&&(t++,n.closeButton&&n.closeWith.push("button"),delete n.closeButton),n.hasOwnProperty("closeOnSelfClick")&&(t++,n.closeOnSelfClick&&n.closeWith.push("click"),delete n.closeOnSelfClick),n.hasOwnProperty("closeOnSelfOver")&&(t++,n.closeOnSelfOver&&n.closeWith.push("hover"),delete n.closeOnSelfOver),n.hasOwnProperty("custom")&&(t++,n.custom.container!="null"&&(n.custom=n.custom.container)),n.hasOwnProperty("cssPrefix")&&(t++,delete n.cssPrefix),n.theme=="noty_theme_default"&&(t++,n.theme="defaultTheme"),n.hasOwnProperty("dismissQueue")||(n.dismissQueue=jQuery.noty.defaults.dismissQueue),n.hasOwnProperty("maxVisible")||(n.maxVisible=jQuery.noty.defaults.maxVisible),n.buttons&&jQuery.each(n.buttons,function(n,i){i.click&&(t++,i.onClick=i.click,delete i.click);i.type&&(t++,i.addClass=i.type,delete i.type)}),t&&typeof console!="undefined"&&console.warn&&console.warn("You are using noty v2 with v1.x.x options. @deprecated until v2.2.0 - Please update your options."),jQuery.notyRenderer.init(n)},function(n){n.noty.layouts.bottomRight={name:"bottomRight",options:{},container:{object:'<ul id="noty_bottomRight_layout_container" />',selector:"ul#noty_bottomRight_layout_container",style:function(){n(this).css({bottom:20,right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});window.innerWidth<600&&n(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.themes.defaultTheme={name:"defaultTheme",style:function(){this.$message.css({fontSize:"13px",lineHeight:"16px",textAlign:"center",padding:"8px 10px 9px",width:"auto",position:"relative"});this.$bar.css({borderRadius:"5px",border:"1px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"});this.$message.css({fontSize:"13px",textAlign:"left"});this.$bar.css({backgroundColor:"#FFF",borderColor:"#CCC",color:"#444"})},callback:{onShow:function(){},onClose:function(){}}}}(jQuery);
(function(n){n.fn.emoticonize=function(t){for(var o,s,l,e=n.extend({},n.fn.emoticonize.defaults,t),u=[":-)",":o)",":c)",":^)",":-D",":-(",":-9",";-)",":-P",":-p",":-",":-b",":-O",":-/",":-X",":-#",":'(","B-)","8-)",";*(",":-*",":-\\","?-)",": )",": ]","= ]","= )","8 )",": }",": D","8 D","X D","x D","= D",": (",": [",": {","= (","; )","; ]","; D",": P",": p","= P","= p",": b",": ",": O","8 O",": /","= /",": S",": #",": X","B )",": |",": \\","= \\",": *",": &gt;",": &lt;"],f=[":)",":]","=]","=)","8)",":}",":D",":(",":[",":{","=(",";)",";]",";D",":P",":p","=P","=p",":b",":",":O",":/","=/",":S",":#",":X","B)",":|",":\\","=\\",":*",":&gt;",":&lt;"],r={"&gt;:)":{cssClass:"red-emoticon small-emoticon spaced-emoticon"},"&gt;;)":{cssClass:"red-emoticon small-emoticon spaced-emoticon"},"&gt;:(":{cssClass:"red-emoticon small-emoticon spaced-emoticon"},"&gt;: )":{cssClass:"red-emoticon small-emoticon"},"&gt;; )":{cssClass:"red-emoticon small-emoticon"},"&gt;: (":{cssClass:"red-emoticon small-emoticon"},";(":{cssClass:"red-emoticon spaced-emoticon"},"&lt;3":{cssClass:"pink-emoticon counter-rotated"},O_O:{cssClass:"no-rotate"},o_o:{cssClass:"no-rotate"},"0_o":{cssClass:"no-rotate"},O_o:{cssClass:"no-rotate"},T_T:{cssClass:"no-rotate"},"^_^":{cssClass:"no-rotate"},"O:)":{cssClass:"small-emoticon spaced-emoticon"},"O: )":{cssClass:"small-emoticon"},"8D":{cssClass:"small-emoticon spaced-emoticon"},XD:{cssClass:"small-emoticon spaced-emoticon"},xD:{cssClass:"small-emoticon spaced-emoticon"},"=D":{cssClass:"small-emoticon spaced-emoticon"},"8O":{cssClass:"small-emoticon spaced-emoticon"},"[+=..]":{cssClass:"no-rotate nintendo-controller"}},h=new RegExp("(\\)|\\(|\\*|\\[|\\]|\\{|\\}|\\||\\^|\\<|\\>|\\\\|\\?|\\+|\\=|\\.)","g"),c="(^|[\\s\\0])",i=u.length-1;i>=0;--i)u[i]=u[i].replace(h,"\\$1"),u[i]=new RegExp(c+"("+u[i]+")","g");for(i=f.length-1;i>=0;--i)f[i]=f[i].replace(h,"\\$1"),f[i]=new RegExp(c+"("+f[i]+")","g");for(o in r)r[o].regexp=o.replace(h,"\\$1"),r[o].regexp=new RegExp(c+"("+r[o].regexp+")","g");return s="span.css-emoticon",e.exclude&&(s+=","+e.exclude),l=s.split(","),this.not(s).each(function(){var t=n(this),i="css-emoticon",o;e.animate&&(i+=" un-transformed-emoticon animated-emoticon");for(o in r)specialCssClass=i+" "+r[o].cssClass,t.html(t.html().replace(r[o].regexp,"$1<span class='"+specialCssClass+"'>$2<\/span>"));n(u).each(function(){t.html(t.html().replace(this,"$1<span class='"+i+"'>$2<\/span>"))});n(f).each(function(){t.html(t.html().replace(this,"$1<span class='"+i+" spaced-emoticon'>$2<\/span>"))});n.each(l,function(i,r){t.find(n.trim(r)+" span.css-emoticon").each(function(){n(this).replaceWith(n(this).text())})});e.animate&&setTimeout(function(){n(".un-transformed-emoticon").removeClass("un-transformed-emoticon")},e.delay)})};n.fn.unemoticonize=function(t){var i=n.extend({},n.fn.emoticonize.defaults,t);return this.each(function(){var t=n(this);t.find("span.css-emoticon").each(function(){var t=n(this);i.animate?(t.addClass("un-transformed-emoticon"),setTimeout(function(){t.replaceWith(t.text())},i.delay)):t.replaceWith(t.text())})})};n.fn.emoticonize.defaults={animate:!0,delay:500,exclude:"pre,code,.no-emoticons"}})(jQuery);
/*!
	Autosize 3.0.17
	license: MIT
	http://www.jacklmoore.com/autosize
*/
!function(n,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var i={exports:{}};t(i.exports,i);n.autosize=i.exports}}(this,function(n,t){"use strict";function f(n){function l(){var r=window.getComputedStyle(n,null);"vertical"===r.resize?n.style.resize="none":"both"===r.resize&&(n.style.resize="horizontal");i="content-box"===r.boxSizing?-(parseFloat(r.paddingTop)+parseFloat(r.paddingBottom)):parseFloat(r.borderTopWidth)+parseFloat(r.borderBottomWidth);isNaN(i)&&(i=0);t()}function f(t){var i=n.style.width;n.style.width="0px";n.offsetWidth;n.style.width=i;n.style.overflowY=t;e()}function a(n){for(var t=[];n&&n.parentNode&&n.parentNode instanceof Element;)n.parentNode.scrollTop&&t.push({node:n.parentNode,scrollTop:n.parentNode.scrollTop}),n=n.parentNode;return t}function e(){var u=n.style.height,f=a(n),t=document.documentElement&&document.documentElement.scrollTop,r;return n.style.height="auto",r=n.scrollHeight+i,0===n.scrollHeight?void(n.style.height=u):(n.style.height=r+"px",o=n.clientWidth,f.forEach(function(n){n.node.scrollTop=n.scrollTop}),void(t&&(document.documentElement.scrollTop=t)))}function t(){var u;e();var t=window.getComputedStyle(n,null),i=Math.round(parseFloat(t.height)),o=Math.round(parseFloat(n.style.height));(i!==o?"visible"!==t.overflowY&&f("visible"):"hidden"!==t.overflowY&&f("hidden"),s!==i)&&(s=i,u=r("autosize:resized"),n.dispatchEvent(u))}if(n&&n.nodeName&&"TEXTAREA"===n.nodeName&&!u.has(n)){var i=null,o=n.clientWidth,s=null,h=function(){n.clientWidth!==o&&t()},c=function(i){window.removeEventListener("resize",h,!1);n.removeEventListener("input",t,!1);n.removeEventListener("keyup",t,!1);n.removeEventListener("autosize:destroy",c,!1);n.removeEventListener("autosize:update",t,!1);u["delete"](n);Object.keys(i).forEach(function(t){n.style[t]=i[t]})}.bind(n,{height:n.style.height,resize:n.style.resize,overflowY:n.style.overflowY,overflowX:n.style.overflowX,wordWrap:n.style.wordWrap});n.addEventListener("autosize:destroy",c,!1);"onpropertychange"in n&&"oninput"in n&&n.addEventListener("keyup",t,!1);window.addEventListener("resize",h,!1);n.addEventListener("input",t,!1);n.addEventListener("autosize:update",t,!1);u.add(n);n.style.overflowX="hidden";n.style.wordWrap="break-word";l()}}function e(n){if(n&&n.nodeName&&"TEXTAREA"===n.nodeName){var t=r("autosize:destroy");n.dispatchEvent(t)}}function o(n){if(n&&n.nodeName&&"TEXTAREA"===n.nodeName){var t=r("autosize:update");n.dispatchEvent(t)}}var u="function"==typeof Set?new Set:function(){var n=[];return{has:function(t){return Boolean(n.indexOf(t)>-1)},add:function(t){n.push(t)},"delete":function(t){n.splice(n.indexOf(t),1)}}}(),r=function(n){return new Event(n)},i;try{new Event("test")}catch(s){r=function(n){var t=document.createEvent("Event");return t.initEvent(n,!0,!1),t}}i=null;"undefined"==typeof window||"function"!=typeof getComputedStyle?(i=function(n){return n},i.destroy=function(n){return n},i.update=function(n){return n}):(i=function(n,t){return n&&Array.prototype.forEach.call(n.length?n:[n],function(n){return f(n,t)}),n},i.destroy=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],e),n},i.update=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],o),n});t.exports=i});
var SmallChat=function(){function ff(){if(!(t&&ASC.Resources.Master.Hub.WebChat)){jq(".small_chat_main_window").addClass("display-none");return}t.on("disconnected",function(){ft();er()}).on("initDataRetrieved",function(t,i,o,c,l){var p,w,nt,y,tt;r={TenantName:l,TenantId:c,UserName:t,ShowUserName:i};var ht=jq(".user_list"),ut={},ft={},et={},ot={},k;for(ht.length&&jq(".user_list").remove(),y=0;y<o.length;y++){o[y]=vi(o[y],uf);k=o[y].State;o[y].State=rr(k);switch(k){case s:ut[y]=o[y];break;case d:ft[y]=o[y];break;case g:et[y]=o[y];break;default:ot[y]=o[y]}}p=sessionStorageManager.getItem("TenantGuid");p||(p=of(),sessionStorageManager.setItem("TenantGuid",p));var ct=jq("#contactListTmpl").tmpl({UsersOnline:ut,UsersAway:ft,UsersNotAvailable:et,UsersOffline:ot}),lt=jq("#tenantBlockTmpl").tmpl({TenantGuid:p,TenantName:r.TenantName}),st=sessionStorageManager.getItem("SmallChatHeight");st&&jq(".small_chat_main_window").css("height",st);jq(".chat_contact_loader").addClass("display-none");jq(".conversation_block").removeClass("display-none");jq(ct).appendTo(".contact_container");jq(".contact_container").find(".tenant_user_list").append(lt);sessionStorageManager.setItem("WasConnected",!0);vt();w=sessionStorageManager.getItem("CurrentStatus");w&&w!=u&&at(dt(w));for(nt in b)si(nt,b[nt]);for(b={},y=0;y<n.length;y++)n[y]==""&&(n[y]=sessionStorageManager.getItem("TenantGuid")),h(n[y])&&v(n[y]),nu(n[y]),f(n[y]),tt=rt(n[y],!0),tt&&(a[n[y]]=tt);hf(n);n=[];jq(".extend_chat_icon").off("click").on("click",it);ASC.Controls.JabberClient.extendChat=it;tu();gr();e=!1}).on("sendInvite",function(n){i!==u&&(n=vi(n,di),h(sessionStorageManager.getItem("TenantGuid"))||f(sessionStorageManager.getItem("TenantGuid")),ir({IsMessageOfCurrentUser:!1,Name:n.UserName,DateTime:Teamlab.getDisplayTime(new Date),Message:ni(ASC.Resources.Master.ChatResource.ChatRoomInvite+" "+n.Text+". "+ASC.Resources.Master.ChatResource.GoTalk),NotRead:!0},sessionStorageManager.getItem("TenantGuid")))}).on("send",function(n,t,e){var v,a;if(i!==u&&(n=vi(n,di),r!=null)){var o=undefined,c=undefined,l=jq(document),s=undefined;e?(o=sessionStorageManager.getItem("TenantGuid"),c=r.TenantName,s=o==r.UserName,f(o)):(o=n.UserName,s=o==r.UserName,c=s?r.ShowUserName:jq(".contact_block[data-username='"+n.UserName+"']").find(".contact_record").text());v=s?t:o;h(o)||h(t)?(s||(a=jq(".conversation_block[data-username='"+o+"']"),tr(a,a.find(".message_bus_container"))),ir({IsMessageOfCurrentUser:s,Name:c,DateTime:Teamlab.getDisplayTime(new Date),Message:ni(n.Text),NotRead:!s},v)):y&&!s&&pf({UserName:o,Message:ni(n.Text),ShowUserName:c});s?f(t):(!lt&&kr&&localStorageManager.getItem("EnableSound")&&ye(kr),y||(e||(bt[bt.length]=o),pt||(ei=l.find("title").text(),l.find("title").text("*"+ASC.Resources.Master.ChatResource.NewMessageLabel+" "+ei),pt=setInterval(function(){wt++;l.find("title").text(sf(wt)+ASC.Resources.Master.ChatResource.NewMessageLabel+" "+ei);wt==3&&(wt=0)},br))))}}).on("sendOfflineMessage",function(t){var i,u;if(n=t,r&&sessionStorageManager.getItem("WasConnected")){for(i=0;i<n.length;i++)n[i]==""&&(n[i]=sessionStorageManager.getItem("TenantGuid")),h(n[i])&&v(n[i]),nu(n[i]),f(n[i]),u=rt(n[i],!0),u&&(a[n[i]]=u);n=[]}}).on("sendTypingSignal",function(n){if(i!==u&&h(n)){var t=jq(".conversation_block[data-username='"+n+"']"),r=t.find(".typing_message_notification");r.hasClass("display-none")&&($messageBusContainer=t.find(".message_bus_container"),r.css("bottom",t.find(".message_input_area").outerHeight()+o),r.removeClass("display-none"));tt&&(clearTimeout(tt),tt=null);tt=setTimeout(function(){tr(t,t.find(".message_bus_container"))},5e3)}}).on("setState",function(n,t,i){r!=null?si(n,t,i):b[n]=t}).on("statesRetrieved",function(t){var r=Object.keys(t),o=sessionStorageManager.getItem("CurrentStatus"),s=jq(".conversation_block"),c,l,i,y;for(s.removeClass("display-none"),i=0;i<r.length;i++)si(r[i],t[r[i]]);for(sessionStorageManager.setItem("WasConnected",!0),i=0;i<s.length;i++)c=jq(s[i]),c.find(".chat_messages_loading").hasClass("display-none")||ef(c.attr("data-username"));o&&o!=u&&at(dt(o));for(l in b)si(l,b[l]);for(vt(),b={},i=0;i<n.length;i++)n[i]==""&&(n[i]=sessionStorageManager.getItem("TenantGuid")),h(n[i])&&v(n[i]),f(n[i]),y=rt(n[i],!0),y&&(a[n[i]]=y);n=[];jq(".extend_chat_icon").off("click").on("click",it);ASC.Controls.JabberClient.extendChat=it;tu();gr();e=!1}).on("setStatus",function(n){at(n)}).on("disconnectUser",function(){e=!1}).on("connectUser",function(n){var i=jq(".small_chat_main_window");if(n){i.off("click",".show_small_chat_icon");i.on("click",".show_small_chat_icon",or);vr();ou();e=!1;return}i.off("click",".show_small_chat_icon");i.on("click",".show_small_chat_icon",or);ki&&(clearTimeout(ki),ki=null);r?t.emit("getStates",function(n){n&&(e=!1)}):t.emit("getInitData",function(n){n&&(e=!1)})}).on("e",function(){vr();ft();ou()})}function gr(){try{ASC.Controls.TalkNavigationItem.updateValue(0);ASC.SocketIO.Factory.counters.emit("sendMessagesCount",0)}catch(n){console.error(n.message)}}function ef(n){var i=n;t.emit("getRecentMessages",i==sessionStorageManager.getItem("TenantGuid")?"":i,wr,function(n){var t=jq(".conversation_block[data-username='"+i+"']"),r=t.find(".chat_messages_loading");hr(i,n,r,t,0)})}function nu(n){for(var t,i=sessionStorageManager.getItem("dialogsNumber"),r=0;r<i;r++)if(n==sessionStorageManager.getItem("userName"+r)){for(t=r;t<i;t++)sessionStorageManager.setItem("userName"+t,sessionStorageManager.getItem("userName"+(t+1)));sessionStorageManager.removeItem("userName"+i-1);sessionStorageManager.setItem("dialogsNumber",i-1);break}}function w(){return(0|(1+Math.random())*65536).toString(16).substring(1)}function of(){return w()+w()+"-"+w()+"-"+w()+"-"+w()+"-"+w()+w()+w()}function tu(){p&&clearInterval(p);p=setInterval(function(){sessionStorageManager.getItem("WasConnected")?t.emit("ping",dt(sessionStorageManager.getItem("CurrentStatus"))):(clearInterval(p),p=null)},du)}function tr(n,t){jq(n).find(".typing_message_notification").addClass("display-none");jq(t).css({height:"100%","padding-bottom":"0"});tt&&(clearTimeout(tt),tt=null)}function sf(n){switch(n){case 1:return"*";case 2:return"**";case 3:return"***"}}function hf(n){var t,e=sessionStorageManager.getItem("dialogsNumber"),r=sessionStorageManager.getItem("dialogsNumberInMenu"),i,o,u;if(e)for(i=0;i<e;i++)t=sessionStorageManager.getItem("userName"+i),jq.inArray(t,n)==-1&&(f(t,!0,i),wi&&(i--,e--,wi=!1),sessionStorageManager.getItem("MiniCB"+t)&&cr(jq(".conversation_block[data-username='"+t+"']")));if(r){for(i=0;i<r;i++)if(t=sessionStorageManager.getItem("dn_userName"+i),jq.inArray(t,n)==-1){if(o=jq(".contact_block[data-username='"+t+"']").find(".contact_record"),!o.length){for(sessionStorageManager.setItem("dialogsNumberInMenu",r-1),u=i;u<r-1;u++)sessionStorageManager.setItem("dn_userName"+u,sessionStorageManager.getItem("dn_userName"+(u+1)));sessionStorageManager.removeItem("dn_userName"+(r-1));i--;r--;continue}gt({UserName:t,ShowUserName:o.text()},!0,sessionStorageManager.getItem("messageInMenu"+t))}hi()>sessionStorageManager.getItem("dialogsNumber")&&(t=jq("#messageDialogPopupID").find(".message_dialog_item").first().attr("data-username"),messageInMenu=sessionStorageManager.getItem("messageInMenu"+t),ut(t),f(t,null,null,null,messageInMenu))}jq(".message_input_area").blur()}function h(n){return jq(".conversation_block[data-username='"+n+"']").length?!0:!1}function cf(n){return jq(".message_dialog_item[data-username='"+n+"']").length?!0:!1}function lf(n){for(var t,r=jq(".message_dialog_item[data-username='"+n+"']"),u=jq(".message_dialog_item"),f=sessionStorageManager.getItem("dialogsNumberInMenu")-1,e=jq(".message_dialog_item"),i=0;i<e.length;i++)t=u.index(e[i]),u.index(r)<t&&sessionStorageManager.setItem("dn_userName"+(t-1),sessionStorageManager.getItem("dn_userName"+t));r.remove();sessionStorageManager.removeItem("dn_userName"+f);sessionStorageManager.setItem("dialogsNumberInMenu",f)}function af(n){var t=sessionStorageManager.getItem("dialogsNumber");t?(sessionStorageManager.setItem("userName"+t,n),jq(".conversation_block[data-username='"+n+"']").attr("data-dialog-number",t),sessionStorageManager.setItem("dialogsNumber",++t)):(sessionStorageManager.setItem("userName0",n),jq(".conversation_block[data-username='"+n+"']").attr("data-dialog-number","0"),sessionStorageManager.setItem("dialogsNumber",1))}function vf(n){var t=sessionStorageManager.getItem("dialogsNumberInMenu");t?(sessionStorageManager.setItem("dn_userName"+t,n),sessionStorageManager.setItem("dialogsNumberInMenu",++t)):(sessionStorageManager.setItem("dn_userName0",n),sessionStorageManager.setItem("dialogsNumberInMenu",1))}function kt(n,t){for(var r=jq("."+t).children(),i=0;i<r.length;i++)if(n<=jq(r[i]).find(".contact_record").text().toLowerCase())break;return i}function si(n,i){var l,f,u,o,a,e,c;if(n!=r.UserName){if(l=rr(i),f=jq(".contact_block[data-username='"+n+"']"),f.length){if(o=f.find(".chat_user_state"),o.attr("class")!=undefined){c=o.attr("class").split(" ")[1];o.removeClass(c);o.addClass(l);f.detach();switch(i){case s:u="online_user_list";break;case d:u="away_user_list";break;case g:u="not_available_user_list";break;default:u="offline_user_list"}a=kt(f.find(".contact_record").text().toLowerCase(),u);a?f.insertAfter("."+u+" li:nth-child("+a+")"):f.prependTo("."+u)}}else sessionStorageManager.getItem("WasConnected")&&t.emit("getContactInfo",n,function(t,i,r){if(r){vr();return}switch(i){case s:u="online_user_list";break;case d:u="away_user_list";break;case g:u="not_available_user_list";break;default:u="offline_user_list"}yf({UserName:n,ShowUserName:t,StateClass:u},u)});h(n)&&(e=jq(".conversation_block[data-username='"+n+"']").find(".conversation_block_user_state"),e.attr("class")!=undefined&&(c=e.attr("class").split(" ")[1],e.removeClass(c),e.addClass(l),e.attr("title",bf(i))))}else at(i)}function yf(n,t){var i=kt(n.UserName,t),r=jq("#contactTmpl").tmpl(n);i?r.insertAfter("."+t+" li:nth-child("+i+")"):r.prependTo("."+t)}function at(n,t){var e=df(n);if(e!=i){var l=i,f=jq(".show_small_chat_icon"),h=jq("#smallChatPopupID"),o=jq(".small_chat_text_status"),r=jq("."+i),s;h.removeClass("display_block");h.addClass("display-none");r.removeClass("disable");o.removeClass(c);r.click(ti);e==u?(f.addClass("small_chat_icon_white"),f.removeClass("small_chat_icon_green"),ft()):i==u?ai():t||(f.addClass("small_chat_icon_green"),f.removeClass("small_chat_icon_white"));c=rr(n);i=e;sessionStorageManager.setItem("CurrentStatus",i);r=jq("."+i);r.off("click");r.addClass("disable");o.addClass(c);s=ru(i);o.text(s);jq("small_chat_status_menu").attr("title",s)}}function pf(n){noty({text:jq("#messageNotificationTmpl").tmpl(n),layout:"bottomRight",theme:"defaultTheme",type:"alert",animation:{easing:"swing",open:{height:"toggle"},close:{height:"toggle"},speed:"400"},timeout:"7000",maxVisible:7,force:!0})}function ir(n,t){var f=jq(".conversation_block[data-username='"+t+"']"),r=f.find(".message_bus_container"),i=r.find(".message_of_user:last"),u;(i.hasClass("message_of_other_user")&&n.IsMessageOfCurrentUser||i.hasClass("message_of_current_user")&&!n.IsMessageOfCurrentUser)&&l[t]&&(clearTimeout(l[t]),delete l[t]);n.IsMessageOfCurrentUser||t in a||(u=rt(t,!0),u&&(a[t]=u));l[t]?(i.next().text(n.DateTime),i.after("<div class='message_of_user "+(i.hasClass("message_of_current_user")?"message_of_current_user":"message_of_other_user not_read_message")+"'>"+n.Message+"<\/div>"),clearTimeout(l[t]),delete l[t]):(r.append(jq("#messageTmpl").tmpl(n)),i=r.find(".message_of_user:last"));l[t]=setTimeout(function(){clearTimeout(l[t]);delete l[t]},3e4);i=r.find(".message_of_user:last");t!=sessionStorageManager.getItem("TenantGuid")&&su(i);i.linkify();iu(r)}function iu(n){var t=jq(n);scrollHeight=t.prop("scrollHeight");scrollHeight>t.scrollTop()&&scrollHeight>t.height()&&t.scrollTop(scrollHeight)}function wf(n){var o=jq(n.currentTarget),u=jq(".smile_menu"),s=u.attr("id").split("smilesPopupID")[1],f=jq(".conversation_block[data-dialog-number='"+s+"']"),t=f.find(".message_input_area"),i=t.prop("selectionStart"),r=t.val(),e=f.attr("data-username");smileString=" "+o.text();t.val(r.substring(0,i)+smileString+r.substring(i,r.length));t.val(t.val()+" ");lu(t,i+smileString.length);autosize.update(t);sessionStorageManager.setItem("message"+e,t.val());t.scrollTop(t.prop("scrollHeight"));au(e);u.css("display","none")}function ru(n){switch(n){case k:return ASC.Resources.Master.ChatResource.StatusOnline;case et:return ASC.Resources.Master.ChatResource.StatusAway;case ot:return ASC.Resources.Master.ChatResource.StatusNA;default:return ASC.Resources.Master.ChatResource.StatusOffline}}function bf(n){switch(n){case s:return ASC.Resources.Master.ChatResource.StatusOnline;case d:return ASC.Resources.Master.ChatResource.StatusAway;case g:return ASC.Resources.Master.ChatResource.StatusNA;default:return ASC.Resources.Master.ChatResource.StatusOffline}}function kf(n){switch(n){case nt:return ASC.Resources.Master.ChatResource.StatusOnline;case st:return ASC.Resources.Master.ChatResource.StatusAway;case ht:return ASC.Resources.Master.ChatResource.StatusNA;default:return ASC.Resources.Master.ChatResource.StatusOffline}}function rr(n){switch(n){case s:return nt;case d:return st;case g:return ht;default:return ii}}function df(n){switch(n){case s:return k;case d:return et;case g:return ot;default:return u}}function dt(n){switch(n){case k:return s;case et:return d;case ot:return g;default:return pr}}function uu(){var n=dt(sessionStorageManager.getItem("CurrentStatus"));return n&&n!=pr||(n=s),n}function ur(n){var i,t,r;if(!lt&&(fr(),sessionStorageManager.getItem("WasConnected"))){if(i=jq(n.currentTarget),t=i.attr("data-username"),!i.is(":hover")||t==sessionStorageManager.getItem("TenantGuid"))return;r=setTimeout(function(){if(i.is(":hover")&&sessionStorageManager.getItem("WasConnected")){var n=jq(".detail_user_list");n.length&&n.remove();gi[t]?fu(t,gi[t],i):Teamlab.getProfile({},t,{success:function(n,r){var f={},u;if(r.groups&&r.groups.length)for(u=0;u<r.groups.length;u++)f[r.groups[u].id]=r.groups[u].name;else f=undefined;userInformation={UserName:t,ShowUserName:r.displayName,Email:r.email,UserType:r.isVisitor?ASC.Resources.Master.Guest:ASC.Resources.Master.User,Title:r.title,PhotoURL:r.avatar,Departments:f};gi[t]=userInformation;fu(t,userInformation,i)}})}},ku);i.data("timeoutId",r)}}function fu(n,t,i){if(jq(i).is(":hover")&&t){var h=jq("#detailUserListTmpl").tmpl(t),r=jq(h).appendTo(".mainPageTableSidePanel"),u=jq(".contact_block[data-username='"+n+"']").offset(),f=u.top-30,e=jq(window),s=e.scrollTop();r.css("left",u.left+220+o);f+r.outerHeight(!0)<e.height()+s?r.css("top",f-s+o):r.css("bottom",15+o);r.fadeIn(170);r.removeClass("display-none")}}function fr(n){lt||sessionStorageManager.getItem("WasConnected")&&setTimeout(function(){var t=jq(".detail_user_list");n&&clearTimeout(jq(n.currentTarget).data("timeoutId"));t.length&&!t.hasClass("hover")&&t.fadeOut(100)},50)}function eu(){var n=sessionStorageManager.getItem("SmallChatHeight"),t=jq(".show_small_chat_icon"),f=jq(".small_chat_main_window");jq(".extend_chat_icon").off("click");ASC.Controls.JabberClient.extendChat=function(){ASC.Controls.JabberClient.open()};sessionStorageManager.setItem("WasLoad",!0);f.addClass("small_chat_main_window_full");t.addClass("small_chat_icon_green");t.removeClass("small_chat_icon_white");jq(".contact_container").removeClass("display-none");jq(".small_chat_top_panel").removeClass("display-none");jq(".icon_ch_size").removeClass("display-none");pe();jq(".conversation_block").removeClass("display-none");jq(".message_dialog_btn").removeClass("display-none");n&&f.css("height",n);r||jq(".chat_contact_loader").removeClass("display-none");i==u&&vu(k)}function ou(){var h=sessionStorageManager.getItem("SmallChatHeight"),u=jq(".show_small_chat_icon"),t=jq(".small_chat_main_window"),i=jq(".notification_username"),c=jq(".chat_contact_loader"),f=jq(".contact_container"),e,o,n;for(sessionStorageManager.setItem("WasConnected",!1),sessionStorageManager.setItem("WasLoad",!1),e=sessionStorageManager.getItem("dialogsNumber"),o=sessionStorageManager.getItem("dialogsNumberInMenu")||0,n=0;n<e;n++)sessionStorageManager.removeItem("userName"+n);for(n=0;n<o;n++)sessionStorageManager.removeItem("dn_userName");if(sessionStorageManager.setItem("dialogsNumber",0),sessionStorageManager.setItem("dialogsNumberInMenu",0),jq(".conversation_block").remove(),jq(".message_dialog_btn").remove(),jq(".detail_user_list").remove(),f.empty(),f.html(c),r=null,i.length)for(n=0;n<i.length;n++)jq(i[n]).closest("li").remove();h&&t.css("height","initial");t.removeClass("small_chat_main_window_full");u.addClass("small_chat_icon_white");u.removeClass("small_chat_icon_green");jq(".contact_container").addClass("display-none");jq(".small_chat_top_panel").addClass("display-none");jq(".icon_ch_size").addClass("display-none");nr&&t.resizable("disable").removeClass("ui-state-disabled");at(s,!0)}function er(){var i=sessionStorageManager.getItem("SmallChatHeight"),t=jq(".show_small_chat_icon"),n=jq(".small_chat_main_window");i&&n.css("height","auto");n.removeClass("small_chat_main_window_full");t.addClass("small_chat_icon_white");t.removeClass("small_chat_icon_green");jq(".contact_container").addClass("display-none");jq(".small_chat_top_panel").addClass("display-none");jq(".icon_ch_size").addClass("display-none");nr&&n.resizable("disable").removeClass("ui-state-disabled");jq(".conversation_block").addClass("display-none");jq(".message_dialog_btn").addClass("display-none");jq(".detail_user_list").remove();at(s,!0)}function or(){sessionStorageManager.getItem("WasConnected")||i==u?(ft(),er()):t.connect(function(){ai();eu()})}function gf(){var n;if(oi){oi=!1;var i=sessionStorageManager.getItem("dialogsNumber"),u=sessionStorageManager.getItem("dialogsNumberInMenu")||0,f=i+u,t;for(n=0;n<i;n++)t=sessionStorageManager.getItem("userName"+n),t==sessionStorageManager.getItem("TenantGuid")?ASC.Controls.JabberClient.openTenant(r.TenantName):ASC.Controls.JabberClient.openContact(t);for(n=i;n<f;n++)t=sessionStorageManager.getItem("dn_userName"+(n-i)),t==sessionStorageManager.getItem("TenantGuid")?ASC.Controls.JabberClient.openTenant(r.TenantName):ASC.Controls.JabberClient.openContact(t)}}function it(){(!bi||bi.closed)&&(bi=ASC.Controls.JabberClient.open(),oi=sessionStorageManager.getItem("WasConnected")||i==u?!0:!1,setTimeout(function(){sessionStorageManager.getItem("WasConnected")&&ft();sessionStorageManager.getItem("WasLoad")&&er()},100))}function ne(n,t){var u=jq(".conversation_block[data-username='"+t+"']"),o=u.find(".message_bus_container"),s=[],h=undefined,e,c,f,l,i;for(n.length!=tf?u.attr("data-internal-id","stop"):n[0]&&u.attr("data-internal-id",n[0].Id),c=new Date,i=0;i<n.length;i++)e=n[i].UserName==r.UserName,f=Teamlab.serializeDate(n[i].DateTimeText),s[i]={IsMessageOfCurrentUser:e,Name:e?r.ShowUserName:u.find(".header_of_conversation_block").text(),DateTime:new Date(f.valueOf()).setHours(0,0,0,0)==c.setHours(0,0,0,0)?Teamlab.getDisplayTime(f):Teamlab.getDisplayDatetime(f),Message:ni(n[i].Text),Emoticon:!0};for(l=jq("#messagesTmpl").tmpl({Messages:s}),o.find(".chat_messages_loading").after(l),h=o.find(".message_of_user"),i=0;i<n.length;i++)jq(h[i]).linkify();t!=sessionStorageManager.getItem("TenantGuid")&&su(null,u)}function su(n,t){if(n)jq(n).emoticonize({delay:400});else{var i=jq(t).find(".emoticon_message");i.emoticonize({delay:400});i.removeClass("emoticon_message")}}function hu(n,t,i){var r=undefined,e,o,u;i&&(t==i&&(r=sessionStorageManager.getItem("userName"+(t-1)),e=sessionStorageManager.getItem("message"+r),v(r)),o=sessionStorageManager.getItem("messageInMenu"+n),ut(n),f(n,null,null,null,o),sessionStorageManager.getItem("WasConnected")||jq(".conversation_block[data-username='"+n+"']").addClass("display-none"),t==i&&(u=jq(".contact_block[data-username='"+r+"']").find(".contact_record"),u.length&&gt({UserName:r,ShowUserName:u.text()},null,e)))}function hi(){var n=0|(jq(window).width()-(jq(".mainPageTableSidePanel:first").width()+130))/fi;return n<0?0:n}function sr(n){n=n||window.event;n.preventDefault&&n.preventDefault();n.returnValue=!1}function te(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",sr,!1);window.onmousewheel=document.onmousewheel=null}function ie(){window.addEventListener&&window.addEventListener("DOMMouseScroll",sr,!1);window.onmousewheel=document.onmousewheel=sr}function f(n,i,r,u,e){var l=sessionStorageManager.getItem("dialogsNumber")||0,s=undefined,y=undefined,b,k,d,g,p,a,w,e,c;if(!sessionStorageManager.getItem("dialogsNumber")){b=jq(".small_chat_minimize_all_windows");b.length||(b=jq(".small_chat_restore_all_windows"));b.removeClass("disable");jq(".small_chat_close_all_windows").removeClass("disable");jq("body").on("click",".small_chat_minimize_all_windows",function(){li(!0)}).on("click",".small_chat_restore_all_windows",lr).on("click",".small_chat_close_all_windows",bu)}if(h(n))rt(n);else if(ct=hi(),l<ct||i){if(k=jq(".contact_block[data-username='"+n+"']"),!k.length&&l){for(sessionStorageManager.setItem("dialogsNumber",l-1),sessionStorageManager.removeItem("MiniCB"+n),p=r;p<l-1;p++)sessionStorageManager.setItem("userName"+p,sessionStorageManager.getItem("userName"+(p+1)));sessionStorageManager.removeItem("userName"+(l-1));wi=!0;return}g=n!=sessionStorageManager.getItem("TenantGuid")?k.find(".chat_user_state").attr("class").split(" ")[1]:!1;s=jq("#messageDialogTmpl").tmpl({UserName:n,HeaderText:k.find(".contact_record").text(),ImageStatus:g,ImageTitle:kf(g)});a=s.find(".message_input_area");jq(s).appendTo(".mainPageContent");rt(n);lt||a.focus();autosize(a);a.on("autosize:resized",re);c=e;c&&c!=""||(c=sessionStorageManager.getItem("message"+n));c&&c!=""&&(a.val(c),autosize.update(a),sessionStorageManager.setItem("message"+n,a.val()));w=s.find(".chat_messages_loading");s.find(".message_bus_container").scroll(function(){if(s.attr("data-internal-id")!="stop"&&!s.find(".message_bus_container").scrollTop()&&sessionStorageManager.getItem("WasConnected")){w.removeClass("display-none");var i=n==sessionStorageManager.getItem("TenantGuid")?"":n,r=s.attr("data-internal-id");ie();t.emit("getRecentMessages",i,r,function(t,i){(te(),i)||hr(n,t,w,s,s.attr("data-scroll-height"))})}});sessionStorageManager.getItem("WasConnected")&&(w.removeClass("display-none"),t.emit("getRecentMessages",n==sessionStorageManager.getItem("TenantGuid")?"":n,wr,function(t){hr(n,t,w,s,0)}));i?(jq(".conversation_block[data-username='"+n+"']").css("right",r*fi+10+o),s.attr("data-dialog-number",r),d=r):(jq(".conversation_block[data-username='"+n+"']").css("right",l*fi+10+o),af(n),d=l);dr||(fe(),dr=!0);ue(n,d)}else ct?(cf(n)&&(e=sessionStorageManager.getItem("messageInMenu"+n),ut(n)),y=sessionStorageManager.getItem("userName"+(l-1)),c=sessionStorageManager.getItem("message"+y),v(y),f(n,null,null,null,e),gt({UserName:y,ShowUserName:jq(".contact_block[data-username='"+y+"']").find(".contact_record").text()},u,c)):gt({UserName:n,ShowUserName:jq(".contact_block[data-username='"+n+"']").find(".contact_record").text()},u,sessionStorageManager.getItem("message"+n))}function hr(n,t,i,r,u){var e=jq(r),f,s,o;if(t){for(f=0;f<t.length;f++)t[f]=vi(t[f],di);jq(i).addClass("display-none");ne(t,n);s=e.find(".message_bus_container");o=e.find(".message_bus_container").prop("scrollHeight");s.scrollTop(o-u);e.attr("data-scroll-height",o)}}function re(){var n=jq(this),i=n.closest(".conversation_block"),t=0,u=i.find(".message_bus_container"),r=parseInt(n.css("height")),f=+n.attr("data-height"),e=parseInt(i.css("height"))-r+f;r==f||e>300||(i.css("height",e+o),i.css("padding-bottom",parseInt(i.css("padding-bottom"))+r-f+o),t=u.prop("scrollHeight"),u.scrollTop()<t&&u.scrollTop(t),t=n.prop("scrollHeight"),n.scrollTop()<t&&n.scrollTop(t),n.attr("data-height",r))}function rt(n,t){var i=jq(".conversation_block[data-username='"+n+"']").find(".header_of_conversation_block");if(i.length){if(t)return setInterval(function(){i.hasClass("main-header-color-hover")?(i.addClass("main-header-color"),i.removeClass("main-header-color-hover")):(i.addClass("main-header-color-hover"),i.removeClass("main-header-color"))},300);i.addClass("main-header-color-hover");i.removeClass("main-header-color");setTimeout(function(){i.addClass("main-header-color");i.removeClass("main-header-color-hover")},100)}}function gt(n,t,i){if(jq(".message_dialog_btn").length){html=jq("#messageDialogItemTmpl").tmpl(n);jq("#messageDialogPopupID").find(".dropdown-content").append(html);var r=jq(".message_dialog_text");r.text(+r.text()+1)}else html=jq("#messageDialogMenuTmpl").tmpl(n),jq(".mainPageContent").append(html),sessionStorageManager.getItem("WasConnected")||jq(".message_dialog_btn").addClass("display-none"),jq.dropdownToggle({switcherSelector:".message_dialog_btn",dropdownID:"messageDialogPopupID",addTop:-4,addLeft:0,alwaysUp:!0});t||vf(n.UserName);i&&i!=""&&sessionStorageManager.setItem("messageInMenu"+n.UserName,i)}function ue(n,t){jq(".conversation_block[data-username='"+n+"']").find(".smile_icon").attr("id","smileIcon"+t)}function fe(){jq("#smileMenuTmpl").tmpl().appendTo(".mainPageContent");jq(".smile").emoticonize()}function ee(n){var i=jq(".smile_menu"),t=jq(n.currentTarget).closest(".conversation_block").attr("data-dialog-number");i.attr("id","smilesPopupID"+t);jq.dropdownToggle({switcherSelector:"#smileIcon"+t,dropdownID:"smilesPopupID"+t,addLeft:176,addTop:6,rightPos:!0,alwaysUp:!0});jq("#smilesPopupID"+t).addClass("smiles_menu_padding")}function oe(){var t=sessionStorageManager.getItem("dialogsNumber"),n;if(t)for(t--,n=t;n>=0;n--)v(sessionStorageManager.getItem("userName"+n))}function se(){var t=sessionStorageManager.getItem("dialogsNumberInMenu"),n;if(t)for(t--,n=t;n>=0;n--)ut(sessionStorageManager.getItem("dn_userName"+n))}function v(n){var i=jq(".conversation_block[data-username='"+n+"']"),t;sessionStorageManager.removeItem("userName"+i.attr("data-dialog-number"));autosize.destroy(i.find(".message_input_area"));i.remove();he(+i.attr("data-dialog-number"));sessionStorageManager.setItem("dialogsNumber",+sessionStorageManager.getItem("dialogsNumber")-1);sessionStorageManager.removeItem("MiniCB"+n);sessionStorageManager.removeItem("message"+n);sessionStorageManager.getItem("dialogsNumber")||(t=jq(".small_chat_restore_all_windows"),t&&t.hasClass("small_chat_restore_all_windows")?(t.removeClass("small_chat_restore_all_windows"),t.addClass("small_chat_minimize_all_windows"),t.text(ASC.Resources.Master.ChatResource.MinimizeAllWindows),t.closest("#smallChatOptionsPopupID").css("display","none"),sessionStorageManager.removeItem("minimizeWindows")):t=jq(".small_chat_minimize_all_windows"),t.addClass("disable"),jq(".small_chat_close_all_windows").addClass("disable"),jq("body").off("click",".small_chat_minimize_all_windows").off("click",".small_chat_restore_all_windows").off("click",".small_chat_close_all_windows"))}function ut(n){var t=jq(".message_dialog_text");lf(n);t.text(+t.text()-1);+t.text()||(jq(".message_dialog_btn").remove(),jq("#messageDialogPopupID").remove());sessionStorageManager.removeItem("messageInMenu"+n)}function he(n){for(var t,f,i,u=jq(".conversation_block"),r=0;r<u.length;r++)t=jq(u[r]),t.attr("data-dialog-number")>n&&(f=t.attr("data-username"),i=+t.attr("data-dialog-number")-1,t.css("right",parseInt(t.css("right"))-fi+o),t.attr("data-dialog-number",i),sessionStorageManager.setItem("userName"+i,f),t.find(".smile_icon").attr("id","smileIcon"+i));sessionStorageManager.removeItem("userName"+(sessionStorageManager.getItem("dialogsNumber")-1))}function cu(n){var t=jq(n.currentTarget).closest(".conversation_block");t.find(".smile_icon").hasClass("display-none")?ci(t):cr(t)}function cr(n){var t=jq(n),u=t.attr("data-username"),r=t.find(".minimize_restore_conversation_block"),i;t.find(".smile_icon").addClass("display-none");t.find(".message_bus_container").addClass("display-none");t.find(".message_input_area").addClass("display-none");r.addClass("restore_conversation_block");r.removeClass("minimize_conversation_block");r.attr("title",ASC.Resources.Master.ChatResource.RestoreMessageWindowAltTitle);t.attr({"data-height":t.css("height"),"data-padding-bottom":t.css("padding-bottom")});t.css({height:"15px","padding-bottom":"0",bottom:"26px"});jq(".smile_menu").css("display","none");sessionStorageManager.setItem("MiniCB"+u,!0);jq(".minimize_conversation_block").length||(i=jq(".small_chat_minimize_all_windows"),i&&i.hasClass("small_chat_minimize_all_windows")&&(i.removeClass("small_chat_minimize_all_windows"),i.addClass("small_chat_restore_all_windows"),i.text(ASC.Resources.Master.ChatResource.RestoreAllWindows),i.closest("#smallChatOptionsPopupID").css("display","none"),sessionStorageManager.setItem("minimizeWindows",!0)))}function ci(n){var t=jq(n),f=t.attr("data-username"),u=t.find(".message_bus_container"),r=t.find(".minimize_restore_conversation_block"),i;$messageInputArea=t.find(".message_input_area");t.find(".smile_icon").removeClass("display-none");u.removeClass("display-none");$messageInputArea.removeClass("display-none");r.addClass("minimize_conversation_block");r.removeClass("restore_conversation_block");r.attr("title",ASC.Resources.Master.ChatResource.MinimizeMessageWindowAltTitle);t.css({height:t.attr("data-height"),"padding-bottom":t.attr("data-padding-bottom"),bottom:"10px"});sessionStorageManager.removeItem("MiniCB"+f);iu(u);jq(".minimize_conversation_block").length&&(i=jq(".small_chat_restore_all_windows"),i&&i.hasClass("small_chat_restore_all_windows")&&(i.removeClass("small_chat_restore_all_windows"),i.addClass("small_chat_minimize_all_windows"),i.text(ASC.Resources.Master.ChatResource.MinimizeAllWindows),i.closest("#smallChatOptionsPopupID").css("display","none"),sessionStorageManager.removeItem("minimizeWindows")));$messageInputArea.focus()}function lr(){var i=jq(".conversation_block"),n=jq(".small_chat_restore_all_windows"),t;if(i.length)for(t=0;t<i.length;t++)jq(i[t]).find(".smile_icon").hasClass("display-none")&&ci(i[t]);n&&n.hasClass("small_chat_restore_all_windows")&&(n.removeClass("small_chat_restore_all_windows"),n.addClass("small_chat_minimize_all_windows"),n.text(ASC.Resources.Master.ChatResource.MinimizeAllWindows),n.closest("#smallChatOptionsPopupID").css("display","none"),sessionStorageManager.removeItem("minimizeWindows"))}function li(n){var r=jq(".conversation_block"),t=jq(".small_chat_minimize_all_windows"),i;if(r.length)for(i=0;i<r.length;i++)jq(r[i]).find(".smile_icon").hasClass("display-none")||cr(r[i]);t&&t.hasClass("small_chat_minimize_all_windows")&&(t.removeClass("small_chat_minimize_all_windows"),t.addClass("small_chat_restore_all_windows"),t.text(ASC.Resources.Master.ChatResource.RestoreAllWindows),n&&t.closest("#smallChatOptionsPopupID").css("display","none"),sessionStorageManager.setItem("minimizeWindows",!0))}function ce(n){var i=n.keyCode,w=n.ctrlKey,d,l,h,g,c,y,p;if(i==20||i==16||i==17||i==91||i==19||i==18||i==93||i>=35&&i<=40||i==45||i>=33&&i<=34||i>=112&&i<=123||i>=144&&i<=145)return!0;var u=jq(n.currentTarget),s=u.closest(".conversation_block"),e=s.attr("data-username"),b=u.val(),nt=!1,k=localStorageManager.getItem("EnableCtrlEnter"),o,tt;if(i==27)return v(e),d=sessionStorageManager.getItem("dialogsNumberInMenu"),d?(o=sessionStorageManager.getItem("dn_userName"+(d-1)),tt=sessionStorageManager.getItem("messageInMenu"+o),ut(o),f(o,null,null,null,tt)):(o=sessionStorageManager.getItem("userName"+(sessionStorageManager.getItem("dialogsNumber")-1)),jq(".conversation_block[data-username='"+o+"']").find(".message_input_area").focus()),!0;if(i==9){if(l=sessionStorageManager.getItem("dialogsNumber"),l>1)for(h=0;h<l;h++)if(sessionStorageManager.getItem("userName"+h)==e){o=h==0?sessionStorageManager.getItem("userName"+(l-1)):sessionStorageManager.getItem("userName"+(h-1));setTimeout(function(){var n=jq(".conversation_block[data-username='"+o+"']");n.find(".smile_icon").hasClass("display-none")&&ci(n);n.find(".message_input_area").focus()},1);break}return!1}if(g=a[e],g&&(s.find(".not_read_message").removeClass("not_read_message"),c=s.find(".header_of_conversation_block"),clearInterval(g),c.length&&c.hasClass("main-header-color-hover")&&(c.addClass("main-header-color"),c.removeClass("main-header-color-hover"))),delete a[e],sessionStorageManager.getItem("WasConnected")){if(au(e),$messageBusContainer=s.find(".message_bus_container"),tr(s,$messageBusContainer),e==sessionStorageManager.getItem("TenantGuid")&&(nt=!0),i==yi&&w&&!k)return y=u.prop("selectionStart"),p=u.val(),u.val(p.substring(0,y)+"\n"+p.substring(y,p.length)),lu(u,y+1),autosize.update(u),u.scrollTop(u.prop("scrollHeight")),!0;if(i==yi&&(!k&&!w||k&&w))return/^\s*$/.test(b)?!0:(t.emit("send",nt?"":e,b),ir({IsMessageOfCurrentUser:!0,Name:r.ShowUserName,DateTime:Teamlab.getDisplayTime(new Date),Message:ni(b)},e),s.css({height:"300px","padding-bottom":"61px"}),u.css("height","29px"),u.attr("data-height","29"),u.val(""),sessionStorageManager.removeItem("message"+e),!1)}}function le(n){var t=jq(n.currentTarget),i=t.closest(".conversation_block").attr("data-username");sessionStorageManager.setItem("message"+i,t.val())}function lu(n,t){var i=jq(n)[0],r;return i.value=i.value,i!==null?i.createTextRange?(r=i.createTextRange(),r.move("character",t),r.select(),!0):i.selectionStart||i.selectionStart===0?(i.focus(),i.setSelectionRange(t,t),!0):(i.focus(),!1):void 0}function ni(n){var t,i;if(n){for(t=n.trim().split(/\r\n|\n\r|\r|\n/),i=0;i<t.length;i++)t[i]=Encoder.htmlEncode(t[i]);return t.join("<br />")}return""}function au(n){n!=sessionStorageManager.getItem("TenantGuid")&&pi==null&&(pi=setTimeout(function(){pi=null},3e3),t.emit("sendTyping",n))}function ti(n){vu(jq(n.currentTarget).attr("class").split(" ")[2])}function vu(n){var h=i,f=jq(".show_small_chat_icon"),s=jq("#smallChatPopupID"),e=jq(".small_chat_text_status"),r=jq("."+i),o;s.removeClass("display_block");s.addClass("display-none");r.removeClass("disable");e.removeClass(c);r.click(ti);i=n;sessionStorageManager.setItem("CurrentStatus",i);switch(n){case k:c=nt;ar();break;case et:c=st;ar();break;case ot:c=ht;ar();break;default:c=ii;sessionStorageManager.getItem("WasConnected")&&ft()}r=jq("."+i);r.off("click");r.addClass("disable");e.addClass(c);o=ru(i);e.text(o);jq(".small_chat_status_menu").attr("title",o);n==u?(f.addClass("small_chat_icon_white"),f.removeClass("small_chat_icon_green")):(f.addClass("small_chat_icon_green"),f.removeClass("small_chat_icon_white"));n!=u&&sessionStorageManager.getItem("WasConnected")&&t.emit("sendStateToTenant",dt(i))}function ae(n){if(n.keyCode==yi)clearTimeout(jq(n.currentTarget).data("timeoutId")),vt();else var t=setTimeout(function(){clearTimeout(jq(n.currentTarget).data("timeoutId"));vt()},gu)}function ve(){var n=jq(".search_icon");jq(".small_chat_search_field").val("");vt()}function vt(){for(var u=jq(".small_chat_search_field").val().toLowerCase().trim(),f=jq(".contact_record"),e=jq(".contact_block"),n=jq(".search_icon"),t,i,r=0;r<f.length;r++)i=jq(f[r]),t=i.parent(),i.text().toLowerCase().indexOf(u)==-1?(t.removeClass("display_block"),t.addClass("display-none")):(t.addClass("display_block"),t.removeClass("display-none"));jq(".contact_block.display_block").length?jq(".small_chat_contact_not_found_record").addClass("display-none"):jq(".small_chat_contact_not_found_record").removeClass("display-none");u!=""?(n.removeClass("search_icon_image"),n.addClass("clear_text_image"),n.attr("title",ASC.Resources.Master.ChatResource.ClearText)):(n.removeClass("clear_text_image"),n.addClass("search_icon_image"),n.attr("title",ASC.Resources.Master.ChatResource.Search))}function ye(n){var t=jq("#soundContainer");t.length||(t=jq("<div>").attr("id","soundContainer").appendTo(jq("body")));t.html('<audio autoplay="autoplay"><source src="'+n+'.mp3" type="audio/mpeg" /><source src="'+n+'.ogg" type="audio/ogg" /><source src="'+n+'.wav" type="audio/wav" /><embed hidden="true" autostart="true" loop="false" src="'+n+'.mp3" /><\/audio>')}function yu(){sessionStorageManager.setItem("SmallChatHeight",jq(".small_chat_main_window").css("height"))}function pe(){if(!lt){var n=jq(".small_chat_main_window");n.resizable({handles:"n",minHeight:0,maxHeight:jq(window).height()-jq(".mainPageLayout").outerHeight(!0)-ri,start:function(){n.off("mouseenter",".contact_block",ur);n.resizable({maxHeight:jq(window).height()-jq(".mainPageLayout").outerHeight(!0)-ri})},stop:function(){n.on("mouseenter",".contact_block",ur);n.resizable({maxHeight:jq(window).height()-jq(".mainPageLayout").outerHeight(!0)-ri});yu()}}).bind("resize",function(){jq(this).css("top","auto")});n.resizable("enable");nr=!0}}function ar(){sessionStorageManager.getItem("WasConnected")||ai()}function ai(){t&&t.connected()&&!e&&(e=!0,t.emit("connectUser",uu()))}function vr(){var t=jq("body").find(".noty_text"),i=!1,r=jq(".small_chat_main_window").attr("data-error"),n;if(t.length)for(n=0;n<t.length;n++)jq(t[n]).text()==r&&(i=!0);i||noty({text:r,layout:"bottomRight",theme:"defaultTheme",type:"alert",animation:{easing:"swing",open:{height:"toggle"},close:{height:"toggle"},speed:"400"},timeout:1e5,maxVisible:7,force:!0});ASC.Controls.JabberClient.extendChat=function(){ASC.Controls.JabberClient.open()}}function ft(){var a=jq(".small_chat_main_window"),r,u,n,i;if(t&&t.connected()&&!e){e=!0;sessionStorageManager.setItem("WasConnected",!1);t.emit("disconnectUser",!0,function(){e=!1});p&&(clearInterval(p),p=null);r=jq(".chat_user_state");u=jq(".conversation_block_user_state");r.addClass(ii);u.addClass(ii);r.removeClass(nt);u.removeClass(nt);r.removeClass(st);u.removeClass(st);r.removeClass(ht);u.removeClass(ht);var h=jq(".online_user_list").children(),c=jq(".away_user_list").children(),l=jq(".not_available_user_list").children(),f,o,s;for(n=0;n<h.length;n++)f=jq(h[n]),f.detach(),i=kt(f.find(".contact_record").text().toLowerCase(),"offline_user_list"),i?f.insertAfter(".offline_user_list li:nth-child("+i+")"):f.prependTo(".offline_user_list");for(n=0;n<c.length;n++)o=jq(c[n]),o.detach(),i=kt(o.find(".contact_record").text().toLowerCase(),"offline_user_list"),i?o.insertAfter(".offline_user_list li:nth-child("+i+")"):o.prependTo(".offline_user_list");for(n=0;n<l.length;n++)s=jq(l[n]),s.detach(),i=kt(s.find(".contact_record").text().toLowerCase(),"offline_user_list"),i?s.insertAfter(".offline_user_list li:nth-child("+i+")"):s.prependTo(".offline_user_list")}}function we(){var n=jq("#smallChatPopupID");n.hasClass("display_block")?(n.removeClass("display_block"),n.addClass("display-none")):(n.removeClass("display-none"),n.addClass("display_block"))}function be(n){var i,t,r;if(jq(n.target).attr("class")!="notification_close"){if(i=jq(n.currentTarget).find(".notification_username").attr("data-username"),t=jq(".notification_username[data-username='"+i+"']"),t.length){for(t=jq(".notification_username[data-username='"+i+"']"),r=0;r<t.length;r++)jq(t[r]).closest("li").remove();f(i)}}else jq(n.currentTarget).closest("li").remove()}function pu(){var t=jq(document),n;if(!y&&(y=!0,pt)){for(clearInterval(pt),pt=null,wt=1,n=0;n<bt.length;n++)f(bt[n]);bt=[];setTimeout(function(){t.find("title").text(ei)},br)}}function vi(n,t){var i={};for(var r in t)i[t[r]]=n[r];return i}function yr(n,t){var r=jq(n),i=r.find(".small_chat_checkbox");i.hasClass("small_chat_checkbox_enabled")?(i.removeClass("small_chat_checkbox_enabled"),i.addClass("small_chat_checkbox_disabled"),localStorageManager.setItem(t,!1)):(i.addClass("small_chat_checkbox_enabled"),i.removeClass("small_chat_checkbox_disabled"),localStorageManager.setItem(t,!0));r.closest("#smallChatOptionsPopupID").css("display","none")}function wu(n,t){if(localStorageManager.getItem("EnableMinimizeAllWindowsIfLoseFocus")){if(t&&jq(t).closest(".conversation_block, .small_chat_main_window").length)return;setTimeout(function(){(t||!jq(".message_input_area:focus, .conversation_block:hover, .smile_menu:hover, .small_chat_main_window:hover").length)&&li()},100)}}function bu(){return oe(),se(),jq(this).closest("#smallChatOptionsPopupID").css("display","none"),!1}function ke(){var s=jq(".small_chat_main_window"),l=jq(".mainPageContent"),c=jq("body"),i=jq(window),r,e,n;ASC.SocketIO&&!ASC.SocketIO.disabled()&&(t=ASC.SocketIO.Factory.chat,ff());sessionStorageManager.setItem("WasLoad",!1);sessionStorageManager.getItem("dialogsNumber")||sessionStorageManager.setItem("dialogsNumber",0);sessionStorageManager.getItem("WasConnected")&&t.connect(function(){ai();eu()});i.bind("beforeunload",function(){rf=!0});c.on("mousedown",".noty_bar",be);s.off("click",".show_small_chat_icon").on("click",".show_small_chat_icon",or).on("click",".contact_block",function(n){var t=jq(n.currentTarget).attr("data-username"),i;h(t)?(i=jq(".conversation_block[data-username='"+t+"']"),i.find(".smile_icon").hasClass("display-none")&&ci(i)):f(t)}).on("mouseenter",".contact_block",ur).on("mouseleave",".contact_block",fr).on("mouseup",".small_chat_status_menu",we).on("click",".search_icon_image",vt).on("click",".clear_text_image",ve).on("keydown",".small_chat_search_field",ae);jq(".extend_chat_icon").on("click",it);jq(".mainPageTableSidePanel").on("mouseenter",".detail_user_list",function(){var n=jq(this);n.addClass("hover");n.find(".link").addClass("text_underline")}).on("mouseleave",".detail_user_list",function(){var n=jq(this);n.removeClass("hover");n.find(".link").removeClass("text_underline");fr()});l.on("keydown",".message_input_area",ce).on("keyup",".message_input_area",le).on("blur",".message_input_area",wu).on("mouseover",".conversation_block",function(n){var i=jq(n.currentTarget),u=i.attr("data-username"),r,t;i.find(".not_read_message").removeClass("not_read_message");r=a[u];r&&(clearInterval(r),t=i.find(".header_of_conversation_block"),t.length&&t.hasClass("main-header-color-hover")&&(t.addClass("main-header-color"),t.removeClass("main-header-color-hover")));delete a[u]}).on("click",".close_conversation_block",function(n){if(v(jq(n.currentTarget).closest(".conversation_block").attr("data-username")),jq(".message_dialog_btn").length){var t=jq("#messageDialogPopupID").find(".message_dialog_item").first().attr("data-username"),i=sessionStorageManager.getItem("messageInMenu"+t);ut(t);f(t,null,null,null,i)}}).on("click",".minimize_restore_conversation_block",function(n){cu(n)}).on("click",".extend_conversation_block",it).on("dblclick",".header_of_conversation_block",cu).on("click",".smile",wf).on("click",".message_dialog_close_item_icon",function(n){return ut(jq(n.currentTarget).closest(".message_dialog_item").attr("data-username")),jq("#messageDialogPopupID").css("top",parseInt(jq("#messageDialogPopupID").css("top"))+nf+o),!1}).on("click",".message_dialog_item_text",function(n){hu(jq(n.currentTarget).parent().attr("data-username"),sessionStorageManager.getItem("dialogsNumber"),hi())}).on("click",".smile_icon",ee);if(jq("."+et).click(ti),jq("."+ot).click(ti),jq("."+u).click(ti),jq(document).click(function(n){var t=jq(n.target),i=jq("#smallChatPopupID");!i.hasClass("display_block")||t.hasClass("small_chat_status_menu")||t.hasClass("small_chat_image_status")||t.hasClass("small_chat_text_status")||(i.removeClass("display_block"),i.addClass("display-none"))}),sessionStorageManager.getItem("dialogsNumber")){r=jq(".small_chat_minimize_all_windows");r.length||(r=jq(".small_chat_restore_all_windows"));r.removeClass("disable");c.on("click",".small_chat_minimize_all_windows",function(){li(!0)}).on("click",".small_chat_restore_all_windows",function(){lr()})}if(sessionStorageManager.getItem("minimizeWindows")&&(e=jq(".small_chat_minimize_all_windows"),e.addClass("small_chat_restore_all_windows"),e.removeClass("small_chat_minimize_all_windows"),e.text(ASC.Resources.Master.ChatResource.RestoreAllWindows)),sessionStorageManager.getItem("dialogsNumber")){c.on("click",".small_chat_close_all_windows",bu);jq(".small_chat_close_all_windows").removeClass("disable")}i.focus(function(){pu()}).blur(function(){y&&(y=!1)}).mouseenter(function(){pu()}).mouseleave(function(){y&&(y=!1)});i.on("resizeWinTimer",function(){var f,u,t,n,h,e,r;if(sessionStorageManager.getItem("WasConnected")&&(i.outerHeight(!0)-58>=ui&&yt-58<ui?lr():i.outerHeight(!0)-58<ui&&yt-58>=ui&&li(),i.outerHeight(!0)-yt&&(yt=i.outerHeight(!0),f=yt-jq(".mainPageLayout").outerHeight(!0)-ri,s.resizable({handles:"n",minHeight:0,maxHeight:f}),s.outerHeight(!0)>f&&(jq(".small_chat_main_window").css("height",f+o),yu()))),ct=hi(),u=sessionStorageManager.getItem("dialogsNumber"),t=u-ct,t)if(t>0)for(r=0;r<t;r++)n=sessionStorageManager.getItem("userName"+(u-1)),n&&(h=sessionStorageManager.getItem("message"+n),v(n),gt({UserName:n,ShowUserName:jq(".contact_block[data-username='"+n+"']").find(".contact_record").text()},null,h),u=sessionStorageManager.getItem("dialogsNumber"));else for(t=-t,r=0;r<t;r++)e=sessionStorageManager.getItem("dialogsNumberInMenu"),e&&(n=sessionStorageManager.getItem("dn_userName"+(e-1)),n&&hu(n,u,ct))});if(!lt){l.on("click",".message_bus_container",function(n){if(window.getSelection().toString()==""){var t=jq(n.currentTarget).parent();rt(t.attr("data-username"));t.find(".message_input_area").focus()}});jq.dropdownToggle({switcherSelector:".small_chat_option_icon",dropdownID:"smallChatOptionsPopupID",addTop:-155,addLeft:20,position:"fixed"});jq(".small_chat_en_dis_sounds").click(function(){yr(jq(this),"EnableSound")});jq(".small_chat_en_dis_ctrl_enter_sender").click(function(){yr(jq(this),"EnableCtrlEnter")});jq(".small_chat_minimize_all_windows_if_lose_focus").click(function(){yr(jq(this),"EnableMinimizeAllWindowsIfLoseFocus")});n=jq(".small_chat_en_dis_ctrl_enter_sender").find(".small_chat_checkbox");localStorageManager.getItem("EnableCtrlEnter")?(n.removeClass("small_chat_checkbox_disabled"),n.addClass("small_chat_checkbox_enabled")):(n.removeClass("small_chat_checkbox_enabled"),n.addClass("small_chat_checkbox_disabled"));n=jq(".small_chat_en_dis_sounds").find(".small_chat_checkbox");localStorageManager.getItem("EnableSound")===null&&localStorageManager.setItem("EnableSound",!0);localStorageManager.getItem("EnableSound")?(n.addClass("small_chat_checkbox_enabled"),n.removeClass("small_chat_checkbox_disabled")):(n.addClass("small_chat_checkbox_disabled"),n.removeClass("small_chat_checkbox_enabled"));n=jq(".small_chat_minimize_all_windows_if_lose_focus").find(".small_chat_checkbox");localStorageManager.getItem("EnableMinimizeAllWindowsIfLoseFocus")?(n.removeClass("small_chat_checkbox_disabled"),n.addClass("small_chat_checkbox_enabled")):(n.removeClass("small_chat_checkbox_enabled"),n.addClass("small_chat_checkbox_disabled"))}}function de(){t.connected()&&ft()}var t,r=null,e=!1,b={},n=[],k="online",et="away",ot="not_available",u="offline",s=1,d=2,g=3,pr=4,nt="image_online",st="image_away",ht="image_not_available",ii="image_offline",o="px",ri=100,ku=650,du=1e5,wr=2147483647,gu=750,br=400,yi=13,ui=300,fi=282,nf=21,i=k,c=nt,tf=10,yt=jq(window).height(),ei=null,y=!1,pt=null,wt=1,kr=jq(".small_chat_en_dis_sounds").attr("data-path"),pi=null,tt=null,bt=[],wi=!1,l={},p=null,a={},oi=!1,bi=null,dr=!1,ct=null,lt=jq.browser.mobile,ki=null,rf=!1,di={i:"Id",u:"UserName",t:"Text",d:"DateTimeText"},uf={u:"UserName",d:"DisplayUserName",s:"State"},gi={},nr;return Teamlab.profile.id&&sessionStorageManager.getItem("currentUserId")!=Teamlab.profile.id&&(sessionStorageManager.clear(),sessionStorageManager.setItem("currentUserId",Teamlab.profile.id)),{init:ke,openContacts:gf,extendChat:it,minimizeAllWindowsIfLoseFocus:wu,logoutEvent:de,getUserNumberByStateForConnection:uu}}();jq(document).ready(function(){ASC.Controls.JabberClient.extendChat=SmallChat.extendChat;SmallChat.init()});
window.TariffLimitExceed=function(){var n=function(){StudioBlockUIManager.blockUI("#tariffLimitExceedUsersPanel",500,300,0)};return{showLimitExceedUsers:n}}();
var SharingSettingsManager=function(n,t){var f=jq("#shareUserSelector"),e=jq("#shareGroupSelector"),y=new PopupBox("pb_SharingUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl"}),c=function(n){if(!n||"object"!=typeof n)return n;var r="function"==typeof n.pop?[]:{},i,t;for(i in n)n.hasOwnProperty(i)&&(t=n[i],r[i]=t&&"object"==typeof t?c(t):t);return r};this.OnSave=null;this.OnCopyLink=null;this.OnChange=null;var o=t,i=c(t),l=!1,s=null,r=this;jq(function(){n!=undefined&&jq("#"+n).click(function(){r.ShowDialog()});jq("#studio_sharingSettingsDialog").on("click",".sharing-save-button",r.SaveAndCloseDialog);jq("#studio_sharingSettingsDialog").on("click",".sharing-cancel-button",r.CloseDialog);jq("#studio_sharingSettingsDialog").on("click",".removeItem",function(){a(jq(this).attr("data"))});jq("#sharingSettingsItems").on("change",".action select",function(){w(jq(this).attr("data"),jq(this).val())});jq("#sharingSettingsItems").on("click",".combobox-title",function(){jq(this).closest(".sharingItem").is("#sharingSettingsItems .sharingItem:gt(-3)")&&jq("#sharingSettingsItems").scrollTo(jq(".sharingItem:has(.combobox-container:visible)"))});jq("#shareAddMessage").on("click",function(){return p(),!1});jq("#shareRemoveMessage").on("click",function(){return h(),jq("#shareMessage").val(""),!1});jq("#shareMessageSend").on("change",function(){jq("#shareMessageSend").is(":checked")||h()});f.useradvancedSelector({showGroups:!0,inPopup:!0}).on("showList",b);e.groupadvancedSelector({inPopup:!0,witheveryone:!0,withadmin:!0}).on("showList",d);h();ASC.Clipboard.enable||jq("#shareGetLink").remove();jq.dropdownToggle({switcherSelector:"#shareUserDefAction",dropdownID:"shareUserDefSelect",inPopup:!0,addLeft:-5,addTop:4});jq("#shareUserDefSelect").on("click",".dropdown-item",function(){var t,n;for(jq("#shareUserDefSelect .dropdown-item.active").removeClass("active"),jq(this).addClass("active"),jq("#shareUserDefSelect").hide(),t=jq(this).attr("data-id"),n=0;n<i.actions.length;n++)i.actions[n].defaultUserAction=i.actions[n].id==t;v()});jq.dropdownToggle({switcherSelector:"#shareGroupDefAction",dropdownID:"shareGroupDefSelect",inPopup:!0,addLeft:-5,addTop:4});jq("#shareGroupDefSelect").on("click",".dropdown-item",function(){var t,n;for(jq("#shareGroupDefSelect .dropdown-item.active").removeClass("active"),jq(this).addClass("active"),jq("#shareGroupDefSelect").hide(),t=jq(this).attr("data-id"),n=0;n<i.actions.length;n++)i.actions[n].defaultGroupAction=i.actions[n].id==t;v()})});var h=function(){jq("#shareRemoveMessage").hide();jq("#sharingSettingsDialogBody").removeClass("with-message");jq("#shareAddMessage").show()},p=function(){jq("#shareAddMessage").hide();jq("#shareRemoveMessage").show();jq("#sharingSettingsDialogBody").addClass("with-message");jq("#shareMessageSend").prop("checked",!0)},w=function(n,t){var f,r;for(u(!0),f=null,r=0;r<i.actions.length;r++)if(i.actions[r].id==t){f=i.actions[r];break}for(r=0;r<i.items.length;r++)if(i.items[r].id==n){i.items[r].selectedAction=f;break}},a=function(n){u(!0);for(var t=0;t<i.items.length;t++)if(i.items[t].id==n){if(i.items[t].canEdit===!1||i.items[t].hideRemove)return!1;i.items[t].isGroup?e.groupadvancedSelector("unselect",[n]):f.useradvancedSelector("unselect",[n]);i.items.splice(t,1);break}return jq("#sharing_item_"+n).remove(),jq("#sharingSettingsItems div.sharingItem.tintMedium").removeClass("tintMedium"),jq("#sharingSettingsItems div.sharingItem:even").addClass("tintMedium"),jq(".sharing-empty").toggle(i.items.length<=1),!0},b=function(n,t){var f,r,e,s,o;for(u(!0),f=jq(t).map(function(n,t){return t.id}).toArray(),r=0;r<i.items.length;r++)e=i.items[r],e.isGroup||(s=jq.inArray(e.id,f),s==-1?a(e.id)&&r--:f.splice(s,1));jq(t).each(function(n,t){jq.inArray(t.id,f)!=-1&&(k(t.id,t.title),o=o||t.id)});o&&jq("#sharingSettingsItems").scrollTo(jq("#sharing_item_"+o).prev());jq(".sharing-empty").toggle(i.items.length<=1)},k=function(n,t){var f,r,o,s,e;for(u(!0),f=null,r=0;r<i.actions.length;r++){if(i.actions[r].defaultUserAction){f=i.actions[r];break}i.actions[r].defaultAction&&(f=i.actions[r])}o={id:n,name:t,selectedAction:f,isGroup:!1,canEdit:!0};i.items.push(o);jq("#sharingSettingsItems").append(jq.tmpl("sharingListTemplate",{items:[o],actions:i.actions}));jq("#studio_sharingSettingsDialog .action select:last").tlcombobox();s=jq("#studio_sharingSettingsDialog .userLink:last");e=s.attr("id");e!=null&&e!=""&&y.RegistryElement(e,'"'+s.attr("data-uid")+'"');jq("#sharingSettingsItems div.sharingItem.tintMedium").removeClass("tintMedium");jq("#sharingSettingsItems div.sharingItem:even").addClass("tintMedium")},d=function(n,t){var f,r,e,s,o;for(u(!0),f=jq(t).map(function(n,t){return t.id}).toArray(),r=0;r<i.items.length;r++)e=i.items[r],e.isGroup&&(s=jq.inArray(e.id,f),s==-1?a(e.id)&&r--:f.splice(s,1));jq(t).each(function(n,t){jq.inArray(t.id,f)!=-1&&(g(t.id,t.title),o=o||t.id)});o&&jq("#sharingSettingsItems").scrollTo(jq("#sharing_item_"+o).prev());jq(".sharing-empty").toggle(i.items.length<=1)},g=function(n,t){var f,r,e;for(u(!0),f=null,r=0;r<i.actions.length;r++){if(i.actions[r].defaultGroupAction){f=i.actions[r];break}i.actions[r].defaultAction&&(f=i.actions[r])}e={id:n,name:t,selectedAction:f,isGroup:!0,canEdit:!0};i.items.push(e);jq("#sharingSettingsItems").append(jq.tmpl("sharingListTemplate",{items:[e],actions:i.actions}));jq("#studio_sharingSettingsDialog .action select:last").tlcombobox();jq("#sharingSettingsItems div.sharingItem.tintMedium").removeClass("tintMedium");jq("#sharingSettingsItems div.sharingItem:even").addClass("tintMedium")},nt=function(){var t,n;jq("#sharingSettingsItems").html(jq.tmpl("sharingListTemplate",i));jq(".sharing-empty").toggle(i.items.length<=1);jq.browser.mobile&&jq("#sharingSettingsItems").addClass("isMobileAgent");jq("#studio_sharingSettingsDialog .action select").each(function(){jq(this).tlcombobox()});f.useradvancedSelector("reset");e.groupadvancedSelector("reset");var r=[],u=[],o=[],s=[];for(t=0;t<i.items.length;t++)n=i.items[t],n.isGroup?(u.push(n.id),(n.hideRemove||!n.canEdit)&&s.push(n.id)):(r.push(n.id),(n.hideRemove||!n.canEdit)&&o.push(n.id));f.useradvancedSelector("select",r);f.useradvancedSelector("disable",o);e.groupadvancedSelector("select",u);e.groupadvancedSelector("disable",s)},tt=function(){jq("#shareUserDefSelect").html(jq.tmpl("sharingActionsTemplate",i));jq("#shareGroupDefSelect").html(jq.tmpl("sharingActionsTemplate",i));v()},v=function(){for(var t=!0,r=!0,u="",n=0;n<i.actions.length;n++)i.actions[n].defaultUserAction&&t?(jq("#shareUserDefAction").addClass("share-def-action-"+i.actions[n].defaultStyle),t=!1):jq("#shareUserDefAction").removeClass("share-def-action-"+i.actions[n].defaultStyle),i.actions[n].defaultGroupAction&&r?(jq("#shareGroupDefAction").addClass("share-def-action-"+i.actions[n].defaultStyle),r=!1):jq("#shareGroupDefAction").removeClass("share-def-action-"+i.actions[n].defaultStyle),i.actions[n].defaultAction&&(u=i.actions[n].defaultStyle);t&&jq("#shareUserDefAction").addClass("share-def-action-"+u);r&&jq("#shareGroupDefAction").addClass("share-def-action-"+u)},u=function(n){l=n;jq(".sharing-notchanged-buttons").toggleClass("display-none",n);jq(".sharing-changed-buttons").toggleClass("display-none",!n);r.OnChange!=null&&r.OnChange(l)};this.WhereChanges=function(n){return n&&u(!0),l};this.UpdateSharingData=function(n,t){u(!1);o=n;i=c(n);t&&jq("#shareGetLink").length?(jq("#shareGetLink").show(),s=ASC.Clipboard.destroy(s),s=ASC.Clipboard.create(t,"shareGetLink",{onComplete:r.OnCopyLink})):jq("#shareGetLink").hide()};this.GetSharingData=function(){return o};this.ShowDialog=function(n,t,i){nt();tt();h();jq("#studio_sharingSettingsDialog .userLink").each(function(){var n=jq(this).attr("id");n!=null&&n!=""&&y.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')});jq("#shareMessage").val("");jq("#shareMessageSend").prop("checked",!0);n=n||600;t=t||470;i?jq("#studio_sharingSettingsDialog").show().css({display:"block",width:n-48}):StudioBlockUIManager.blockUI("#studio_sharingSettingsDialog",n,0,-t/2,"absolute");PopupKeyUpActionProvider.EnterAction=PopupKeyUpActionProvider.CtrlEnterAction='jq(".sharing-save-button:visible").click();'};this.SaveAndCloseDialog=function(){return o=i,r.OnSave!=null&&r.OnSave(o),r.CloseDialog()};this.CloseDialog=function(){return ASC.Clipboard.destroy(s),PopupKeyUpActionProvider.CloseDialog()}};
