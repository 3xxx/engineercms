var OAuth2Redirect=function(n){n=n.substring(n.indexOf("?")==0?1:0);var t={};if(n.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,r){i&&(t[i]=r)}),t.error){OAuthError(t.error);return}t.code&&OAuthCallback(t.code)},OAuthCallback=function(){},OAuthError=function(n){ASC.Files.UI.displayInfoPanel(n,!0)},OAuthPopup=function(n,t,i){var r,u;try{u="height="+(i||600)+",width="+(t||1020)+",resizable=0,status=0,toolbar=0,menubar=0,location=1";r=window.open(n,"Authorization",u)}catch(f){r=window.open(n,"Authorization")}return r};
typeof jq=="undefined"&&(jq=jQuery.noConflict());typeof ASC=="undefined"&&(ASC={});typeof ASC.Files=="undefined"&&(ASC.Files=function(){return{}}());typeof ASC.Files.Constants=="undefined"&&(ASC.Files.Constants={});ASC.Files.Constants.REQUEST_STATUS_DELAY=2e3;ASC.Files.Constants.REQUEST_CONVERT_DELAY=2e3;ASC.Files.Constants.COUNT_ON_PAGE=30;ASC.Files.Constants.entryIdRegExpStr="(\\d+|[a-z]+-\\d+(-.+)*)";ASC.Files.Constants.storageKeyRecent="TeamLabRecentDocuments";ASC.Files.Constants.storageKeyCompactView="TeamLabDocumentsCompactView";ASC.Files.Constants.storageKeyUploaderCompactView="TeamLabDocumentsUploaderCompactView";ASC.Files.Common=function(){var t=function(n){if(typeof n=="undefined"||n===null||n===0)return!1;var t=new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr);return t.test(n)},i=function(n){return jq.browser.safari||jq.browser.mozilla?encodeURI(n):n},r=function(t,i){var r="",f,u;if(typeof t=="object")if(t===null)typeof i!="undefined"&&(r+="<"+i+"><\/"+i+">");else if(t.constructor.toString().indexOf("Array")!==-1)for(u=0,f=t.length;u<f;u++)r+=typeof i!="undefined"?"<"+i+">"+arguments.callee(t[u])+"<\/"+i+">":arguments.callee(t[u]);else{for(u in t)r+=arguments.callee(t[u],u);typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")}else typeof t=="string"?(r=n(t),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")):typeof t!="undefined"&&typeof t.toString!="undefined"&&(r=n(t.toString()),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">"));return r},n=function(n){return n.replace(/&/gim,"&amp;").replace(/</gim,"&lt;").replace(/>/gim,"&gt;")},u=function(){var n=jq.url.attr("protocol");return n+="://",n+=jq.url.attr("host"),jq.url.attr("port")!=null&&(n+=":",n+=jq.url.attr("port")),n},f=function(n){n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation()},e=new RegExp('[\t*+:"<>?|\\\\/]',"gim"),o=function(n){return(n||"").trim().replace(ASC.Files.Common.characterRegExp,"_")};return{getSitePath:u,cancelBubble:f,keyCode:{enter:13,esc:27,spaceBar:32,pageUP:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insertKey:45,deleteKey:46,A:65,C:67,F:70,N:78,a:97,c:99,f:102,n:110},characterString:'*+:"<>?|/',characterRegExp:e,replaceSpecCharacter:o,isCorrectId:t,getCorrectHash:i,jsonToXml:r,storeOriginal:!1}}();
window.ASC.Files.Filter=function(){var n=!1,i=function(){if(!n){var t=ASC.Files.Filter.getOrderDefault();ASC.Files.Filter.advansedFilter=jq(".files-filter div").advansedFilter({anykey:!0,anykeytimeout:800,hintDefaultDisable:!0,maxfilters:1,maxlength:ASC.Files.Constants.MAX_NAME_LENGTH,filters:[{type:"combobox",id:"selected-type",title:ASC.Files.FilesJSResources.Types,options:[{value:ASC.Files.Constants.FilterType.FilesOnly,title:ASC.Files.FilesJSResources.ButtonFilterFile},{value:ASC.Files.Constants.FilterType.FoldersOnly,title:ASC.Files.FilesJSResources.ButtonFilterFolder,def:!0},{value:ASC.Files.Constants.FilterType.DocumentsOnly,title:ASC.Files.FilesJSResources.ButtonFilterDocument},{value:ASC.Files.Constants.FilterType.PresentationsOnly,title:ASC.Files.FilesJSResources.ButtonFilterPresentation},{value:ASC.Files.Constants.FilterType.SpreadsheetsOnly,title:ASC.Files.FilesJSResources.ButtonFilterSpreadsheet},{value:ASC.Files.Constants.FilterType.ImagesOnly,title:ASC.Files.FilesJSResources.ButtonFilterImage},{value:ASC.Files.Constants.FilterType.ArchiveOnly,title:ASC.Files.FilesJSResources.ButtonFilterArchive}]},{type:"person",id:"selected-person",title:ASC.Files.FilesJSResources.Users},{type:"group",id:"selected-group",title:ASC.Files.FilesJSResources.Departments}],sorters:[{id:"DateAndTime",title:ASC.Files.FilesJSResources.ButtonSortModified,def:t.property=="DateAndTime",dsc:!t.is_asc},{id:"AZ",title:ASC.Files.FilesJSResources.ButtonSortName,def:t.property=="AZ",dsc:t.is_asc},{id:"Type",title:ASC.Files.FilesJSResources.ButtonSortType,def:t.property=="Type",dsc:t.is_asc},{id:"Size",title:ASC.Files.FilesJSResources.ButtonSortSize,def:t.property=="Size",dsc:!t.is_asc},{id:"Author",title:ASC.Files.FilesJSResources.ButtonSortAuthor,def:t.property=="Author",dsc:!t.is_asc},{id:"New",title:ASC.Files.FilesJSResources.ButtonSortNew,def:t.property=="New",dsc:!t.is_asc}]}).bind("setfilter",ASC.Files.Filter.setFilter).bind("resetfilter",ASC.Files.Filter.setFilter)}},r=function(){var i=ASC.Files.Folders.folderContainer=="forme",n=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT,t=ASC.Resources.Master.Personal==!0;ASC.Files.Filter.advansedFilter.advansedfilter("sort",!i&&!n);ASC.Files.Filter.advansedFilter.advansedFilter({filters:[{id:"selected-type",visible:!n},{id:"selected-person",visible:!n&&!t},{id:"selected-group",visible:!n&&!t}],sorters:[{id:"Author",visible:!t}]});ASC.Files.Filter.advansedFilter.advansedFilter({nonetrigger:!0,hasButton:!n,sorters:[{id:"New",visible:i}]})},u=function(){if(!n){n=!0;return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!1)},f=function(t){t=t===!0;var i=!1;t&&n&&(i=!0,n=!1);ASC.Files.Filter.advansedFilter.advansedFilter(null);t&&i&&(n=!0)},e=function(){ASC.Files.Filter.advansedFilter.advansedFilter("resize")},o=function(n){var i={sorter:ASC.Files.Filter.getOrderDefault(),text:"",filter:ASC.Files.Constants.FilterType.None,subject:""},r;return ASC.Files.Filter.advansedFilter==null?i:(r=ASC.Files.Filter.advansedFilter.advansedFilter(),jq(r).each(function(n,r){switch(r.id){case"sorter":var u=t(r.params.id,!r.params.dsc);i.sorter=u;break;case"text":i.text=r.params.value;break;case"selected-person":i.filter=ASC.Files.Constants.FilterType.ByUser;i.subject=r.params.id;break;case"selected-group":i.filter=ASC.Files.Constants.FilterType.ByDepartment;i.subject=r.params.id;break;case"selected-type":i.filter=parseInt(r.params.value||0)}}),n=n||ASC.Files.Folders.currentFolder.id,(n==ASC.Files.Constants.FOLDER_ID_SHARE||ASC.Files.Folders.folderContainer=="forme")&&(i.sorter=ASC.Files.Filter.getOrderByNew(!1)),n==ASC.Files.Constants.FOLDER_ID_PROJECT&&(i.sorter=ASC.Files.Filter.getOrderByAZ(!0)),i)},s=function(){return ASC.Files.Filter.getOrderByDateAndTime(!1)},h=function(n){return t("DateAndTime",n)},c=function(n){return t("AZ",n)},l=function(n){return t("New",n)},t=function(n,t){return n=typeof n!="undefined"&&n!=""?n:"DateAndTime",t=t===!0,{is_asc:t,property:n}};return{init:i,advansedFilter:null,disableFilter:r,getFilterSettings:o,getOrderDefault:s,getOrderByDateAndTime:h,getOrderByAZ:c,getOrderByNew:l,setFilter:u,clearFilter:f,resize:e}}(),function(n){n(function(){ASC.Files.Filter.init();jq("#files_clearFilter").click(function(){return ASC.Files.Filter.clearFilter(),!1})})}(jQuery);
window.ASC.Files.TemplateManager=function(){var n=null,u=function(){return n||jq.ajax({url:ASC.Files.Constants.URL_TEMPLATES_HANDLER,async:!1,success:function(t){n=t}}),n},f=function(n){var t=u();return r(n,t)},e=function(n){var t,f;return typeof n=="undefined"?"":(t=n,typeof n=="string"&&(t=i(n)),f=u(),r(t,f))},i,r;try{var o=new ActiveXObject("Microsoft.XMLDOM"),s=new ActiveXObject("Microsoft.XMLHTTP"),t=o&&s}catch(h){t=!1}return i=function(){return t?function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new ActiveXObject("Microsoft.XMLDOM");if(t.async="false",t.loadXML(n),t.parseError.errorCode!=0)throw"Can't create xml document";return t}:function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new DOMParser;try{t=t.parseFromString(n,"text/xml")}catch(i){throw"Can't create xml document : "+i;}return t}}(),r=function(){function n(n,t){var u=new ActiveXObject("Microsoft.XMLDOM"),f=new ActiveXObject("MSXML2.FreeThreadedDOMDocument"),r,i;return u.load(n),f.load(t),r=new ActiveXObject("Msxml2.XSLTemplate"),r.stylesheet=f,i=r.createProcessor(),i.input=u,i.transform(),i.output}return t?function(t,i){var r="";if(typeof t=="undefined"||t==null||typeof i=="undefined"||i==null)return r;try{i.resolveExternals=!0}catch(u){}try{try{r=t.transformNode(i)}catch(f){r=n(t,i)}}catch(u){throw"Can't translate xml : "+u;}return r}:function(n,t){var i="",u,r,f;if(typeof n=="undefined"||typeof t=="undefined")return i;try{r=new XSLTProcessor;r.importStylesheet(t);u=r.transformToFragment(n,document)}catch(e){throw"Can't translate xml : "+e;}try{f=new XMLSerializer;i=f.serializeToString(u)}catch(e){throw"Can't serialized xml : "+e;}return i}}(),{createXML:i,translate:f,translateFromString:e}}();
window.ASC.Files.ServiceManager=function(){var f=!1,e,a="/",v=6e4,t={},i=!0,r=[],y=function(n){if(typeof n!="string"||n.length===0)throw"Incorrect service path";e=n[n.length-1]==="/"?n:n+"/";f=!0},u=[],p=5e3,w=function(){return[ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.ServiceManager.events.GetNews,ASC.Files.ServiceManager.events.GetSiblingsImage,ASC.Files.ServiceManager.events.GetThirdParty,ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.ServiceManager.events.GetTreePath,]},b=function(n,t){for(var r,f,i=0;i<u.length;i++)if(r=u[i],r.eventType==n&&r.params==JSON.stringify(t)){if(f=new Date-r.timeStamp,0<f&&f<p)return c.apply(this,r.data),!0;u.splice(i,1);i--}return!1},o=function(n){return(typeof n!="undefined"?n+"-":"")+Math.floor(Math.random()*1e6)},k=function(n,t){for(var r=0,i=o();n.hasOwnProperty(i)&&r++<1e3;)i=o(t);return i},s=function(n,i,r){var u,f;if(n=n.toLowerCase(),i=i||window,r=r||[],t.hasOwnProperty(n)){u=t[n];for(f in u)u.hasOwnProperty(f)&&(u[f].handler.apply(i,r),u[f].type&1&&delete u[f])}},d=function(n,i,r){var e,u,f;return typeof n!="string"||typeof i!="function"?undefined:(n=n.toLowerCase(),typeof r!="object"&&(r={}),e=r.hasOwnProperty("once")?r.once:!1,u=0,u|=+e*1,t.hasOwnProperty(n)||(t[n]={}),f=k(t[n]),t[n][f]={handler:i,type:u},f)},g=function(n,i){return typeof n!="string"||typeof i=="undefined"?!1:(t(n)&&t[n].hasOwnProperty(i)&&delete userEventHandlers[n][i],!0)},nt=function(){var t,n,r,i;if(f||y(ASC.Files.Constants.URL_WCFSERVICE),t=e,arguments.length===0)return t;for(n=0,r=arguments.length-1;n<r;n++)t+=arguments[n]+a;return i=t+arguments[n],i+((i.search(/\?/)>0?"&":"?")+"_="+(new Date).getTime())},h=function(n){return!n||typeof n!="object"?"":n.text||n.textContent||function(n){var t="",u=n.childNodes,i,f,r;if(!u)return t;for(i=0,f=u.length;i<f;i++){r=u.item(i);switch(r.nodeType){case 1:case 5:t+=arguments.callee(r);break;case 3:case 2:case 4:t+=r.nodeValue}}return t}(n)},c=function(n,t,u,f,e){var y,c,w,k;if(i=!0,typeof LoadingBanner!="undefined"&&typeof LoadingBanner.hideLoading!="undefined"&&LoadingBanner.hideLoading(),e==="error"){var o="",b="",a=null,p,v=null;if(f.responseXML){if(a=f.responseXML.getElementsByTagName("message")[0],p=f.responseXML.getElementsByTagName("inner")[0],p&&(v=p.getElementsByTagName("message")[0]),o==="")try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){y=document.createElement("div");o=jq("#content",jq(y).html(f.responseText)).text()}}else if(f.responseText&&(y=document.createElement("div"),o=jq("#content",jq(y).html(f.responseText)).text(),o===""))try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){}a&&typeof a=="object"&&(o=h(a));v&&typeof v=="object"&&(b=h(v));s(n,window,[undefined,t,b||o]);return}if(w="<!DOCTYPE",f.responseText&&f.responseText.indexOf(w)!=0)try{switch(u){case"xml":c=ASC.Files.TemplateManager.createXML(f.responseText);break;case"json":c=jq.parseJSON(f.responseText);break;default:f.responseXML.xml.indexOf(w)!=0&&(c=ASC.Files.TemplateManager.createXML(f.responseXML.xml)||jq.parseJSON(f.responseText))}}catch(d){c=f.responseText}s(n,window,[c,t]);r.length!=0&&i==!0&&(k=r.shift(),i=!1,l(k))},tt=function(n,t,i){return function(){for(var r=[n,t,i],f=0,e=arguments.length;f<e;f++)r.push(arguments[f]);jq.inArray(n,w())>=0&&u.push({eventType:n,params:JSON.stringify(t),timeStamp:new Date,data:r});c.apply(this,r)}},n=function(n,t,u,f){var e,s,c;if(typeof n!="undefined"&&typeof t!="undefined"&&typeof u=="string"&&(typeof f=="undefined"&&(f={}),!b(u,f))){(typeof LoadingBanner=="undefined"||typeof LoadingBanner.displayLoading=="undefined")&&(f.showLoading=!1);var a={},h=[],o=f.ajaxcontentType||"application/xml";typeof f!="object"&&(f={});switch((n||"").toLowerCase()){case"delete":case"get":for(e=4,s=arguments.length;e<s;e++)h.push(arguments[e]);break;case"post":for(a=o=="text/xml"||o=="application/xml"?ASC.Files.Common.jsonToXml(arguments[4]):o=="application/json"?JSON.stringify(arguments[4]):arguments[4],e=5,s=arguments.length;e<s;e++)h.push(arguments[e]);break;default:return}c={async:f.ajaxsync!=!0,data:a,type:n,dataType:t,contentType:o,cache:!0,url:nt.apply(this,h),timeout:v,beforeSend:function(){if(f.showLoading)ASC.Files.Folders&&ASC.Files.Folders.isFirstLoad||(LoadingBanner.displayLoading(),jq(".advansed-filter").advansedFilter("resize"));else return null},complete:tt(u,f,t)};r.length==0&&i==!0?(i=!1,l(c)):r.push(c)}},l=function(n){jq.ajax({async:n.async,data:n.data,type:n.type,dataType:n.dataType,contentType:n.contentType,cache:n.cache,url:n.url,timeout:n.timeout,beforeSend:n.beforeSend,complete:n.complete})},it=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-create?parentId="+encodeURIComponent(i.parentFolderID)+"&title="+encodeURIComponent(i.title))},rt=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-files-createfile?parentId="+encodeURIComponent(i.folderID)+"&title="+encodeURIComponent(i.fileTitle))},ut=function(t,i,r){i.showLoading=i.append!=!0;n("post","xml",t,i,r,"folders?parentId="+encodeURIComponent(i.folderId)+"&from="+i.from+"&count="+i.count+"&filter="+i.filter+"&subjectID="+i.subject+"&search="+encodeURIComponent(i.text))},ft=function(t,i){n("get","xml",t,i,"folders-subfolders?parentId="+encodeURIComponent(i.folderId))},et=function(t,i){n("get","json",t,i,"folders-path?folderId="+encodeURIComponent(i.folderId))},ot=function(t,i){n("get","json",t,i,"folders-folder?folderId="+encodeURIComponent(i.folderId))},st=function(t,i,r){n("post","json",t,i,r,"folders-intries?filter="+i.filter+"&subjectID="+i.subject+"&search="+encodeURIComponent(i.text))},ht=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-files-getversion?fileId="+encodeURIComponent(i.fileId)+"&version="+(i.version||-1))},ct=function(t,i){n("get","xml",t,i,"folders-files-history?fileId="+encodeURIComponent(i.fileId))},lt=function(t,i){n("get","json",t,i,"folders-files-updateToVersion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version)},at=function(t,i){n("get","json",t,i,"folders-files-updateComment?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&comment="+encodeURIComponent(i.comment))},vt=function(t,i){n("get","json",t,i,"folders-files-completeversion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&continueVersion="+i.continueVersion)},yt=function(t,i,r){n("post","json",t,i,r,"folders-files-siblings?fileId="+encodeURIComponent(i.fileId)+"&filter="+i.filter+"&subjectID="+i.subjectId+"&search="+encodeURIComponent(i.search))},pt=function(t,i){n("get","xml",t,i,"folders-rename?folderId="+encodeURIComponent(i.folderId)+"&title="+encodeURIComponent(i.newname))},wt=function(t,i){n("get","xml",t,i,"folders-files-rename?fileId="+encodeURIComponent(i.fileId)+"&title="+encodeURIComponent(i.newname))},bt=function(t,i,r){n("post","json",t,i,r,"folders-files-moveOrCopyFilesCheck?destFolderId="+encodeURIComponent(i.folderToId))},kt=function(t,i,r){n("post","json",t,i,r,"moveorcopy?destFolderId="+encodeURIComponent(i.folderToId)+"&resolve="+i.resolve+"&ic="+(i.isCopyOperation==!0))},dt=function(t,i,r){n("post","json",t,i,r,"folders-files?action=delete")},gt=function(t,i){n("get","json",t,i,"emptytrash")},ni=function(t,i,r){i.showLoading=!0;i.ajaxcontentType="application/json";n("post","json",t,i,r,"bulkdownload")},ti=function(t,i){n("get","json",t,i,"tasks-statuses")},ii=function(t,i){n("get","json",t,i,"tasks")},ri=function(t,i){n("get","json",t,i,"trackeditfile?fileId="+encodeURIComponent(i.fileID)+"&tabId="+i.tabId+"&docKeyForTrack="+i.docKeyForTrack+"&isFinish="+(i.finish==!0)+i.shareLinkParam)},ui=function(t,i,r){n("post","json",t,i,r,"checkediting")},fi=function(t,i){n("get","json",t,i,"startEdit?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},ei=function(t,i){n("get","json",t,i,"setacelink?fileId="+encodeURIComponent(i.fileId)+"&share="+i.share)},oi=function(t,i,r){n("post","json",t,i,r,"sharedinfo")},si=function(t,i){n("get","json",t,i,"sharedinfoshort?objectId="+encodeURIComponent(i.objectID))},hi=function(t,i,r){n("post","json",t,i,r,"setaceobject?notify="+(i.notify===!0))},ci=function(t,i,r){n("post","json",t,i,r,"removeace")},li=function(t,i){n("get","json",t,i,"shorten?fileId="+encodeURIComponent(i.fileId))},ai=function(t,i,r){n("post","json",t,i,r,"checkconversion")},vi=function(t,i){n("get","json",t,i,"storeoriginal?set="+i.value)},yi=function(t,i){n("get","json",t,i,"updateifexist?set="+i.value)},pi=function(t,i){n("get","json",t,i,"changedeleteconfrim?set="+i.value)},wi=function(t,i){i.showLoading=!0;ASC.Files.Folders.isFirstLoad=!1;n("get","json",t,i,"thirdparty-list?folderType="+(i.folderType||0))},bi=function(t,i,r){n("post","json",t,i,r,"thirdparty-save")},ki=function(t,i){n("get","json",t,i,"thirdparty-delete?providerId="+i.providerId)},di=function(t,i){n("get","json",t,i,"thirdparty?enable="+(i.enable===!0))},gi=function(t,i,r){i.ajaxcontentType="application/json";n("post","json",t,i,r,"docusign-save")},nr=function(t,i){n("get","json",t,i,"docusign-delete")},tr=function(t,i,r){n("post","json",t,i,r,"docusign?fileId="+encodeURIComponent(i.fileId))},ir=function(t,i,r){n("post","json",t,i,r,"markasread")},rr=function(t,i){n("get","xml",t,i,"getnews?folderId="+encodeURIComponent(i.folderId))},ur=function(t,i){n("get","xml",t,i,"folders-files-lock?fileId="+encodeURIComponent(i.fileId)+"&lockfile="+(i.lock===!0))},fr=function(t,i){n("get","json",t,i,"edit-history?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},er=function(t,i){n("get","json",t,i,"edit-diff-url?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+i.shareLinkParam)},or=function(t,i){n("get","json",t,i,"restore-version?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+"&url="+encodeURIComponent(i.url)+i.shareLinkParam)},sr=function(t,i){n("get","json",t,i,"mailaccounts")},hr=function(t,i){n("get","json",t,i,"gethelpcenter")},cr=function(t,i,r){n("post","json",t,i,r,"changeowner?userId="+i.userId)};return{bind:d,unbind:g,events:{CreateNewFile:"createnewfile",CreateFolder:"createfolder",CheckEditing:"checkediting",GetTreeSubFolders:"gettreesubfolders",GetTreePath:"gettreepath",GetThirdPartyTree:"getthirdpartytree",GetFolderInfo:"getfolderinfo",GetFolderItems:"getfolderitems",GetItems:"getitems",GetFolderItemsTree:"getfolderitemstree",SetAceLink:"setacelink",GetSharedInfo:"getsharedinfo",GetSharedInfoShort:"getsharedinfoshort",SetAceObject:"setaceobject",UnSubscribeMe:"unsubscribeme",GetShortenLink:"getshortenlink",MarkAsRead:"markasread",GetNews:"getnews",ChangeOwner:"changeowner",FolderRename:"folderrename",FileRename:"filerename",DeleteItem:"deleteitem",EmptyTrash:"emptytrash",GetFileHistory:"getfilehistory",ReplaceVersion:"replaceversion",SetCurrentVersion:"setcurrentversion",UpdateComment:"updatecomment",CompleteVersion:"completeversion",Download:"download",GetTasksStatuses:"getTasksStatuses",TerminateTasks:"terminatetasks",MoveFilesCheck:"movefilescheck",MoveItems:"moveitems",GetSiblingsImage:"getsiblingsimage",GetThirdParty:"getthirdparty",SaveThirdParty:"savethirdparty",DeleteThirdParty:"deletethirdparty",ChangeAccessToThirdparty:"changeaccesstothirdparty",SaveDocuSign:"savedocusign",SendDocuSign:"senddocusign",UpdateIfExist:"updateifexist",GetHelpCenter:"gethelpcenter",ChangeDeleteConfrim:"changedeleteconfrim",StoreOriginalFiles:"storeoriginalfiles",ConvertCurrentFile:"convertcurrentfile",ChunkUploadCheckConversion:"chunkuploadcheckconversion",ChunkUploadGetFileFromServer:"chunkuploadgetfilefromserver",TrackEditFile:"trackeditfile",StartEdit:"startedit",LockFile:"lockfile",GetEditHistory:"getedithistory",GetDiffUrl:"getdiffurl",RestoreVersion:"restoreversion",GetMails:"getmails",StartMailMerge:"startmailmerge"},createFolder:it,createNewFile:rt,getFolderItems:ut,getTreeSubFolders:ft,getTreePath:et,getFolder:ot,getItems:st,getFile:ht,getFileHistory:ct,setCurrentVersion:lt,updateComment:at,completeVersion:vt,getSiblingsImage:yt,renameFolder:pt,renameFile:wt,changeOwner:cr,moveFilesCheck:bt,moveItems:kt,deleteItem:dt,emptyTrash:gt,download:ni,getTasksStatuses:ti,terminateTasks:ii,trackEditFile:ri,checkEditing:ui,startEdit:fi,setAceLink:ei,getSharedInfo:oi,getSharedInfoShort:si,setAceObject:hi,unSubscribeMe:ci,getShortenLink:li,checkConversion:ai,storeOriginalFiles:vi,updateIfExist:yi,changeDeleteConfrim:pi,getThirdParty:wi,saveThirdParty:bi,deleteThirdParty:ki,changeAccessToThirdparty:di,saveDocuSign:gi,deleteDocuSign:nr,sendDocuSign:tr,markAsRead:ir,getNews:rr,lockFile:ur,getEditHistory:fr,getDiffUrl:er,restoreVersion:or,getMailAccounts:sr,getHelpCenter:hr}}();
window.ASC.Files.UI=function(){var n=!1,i=new PopupBox("pb_filesUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl"}),r=function(){n===!1&&(n=!0);jq(window).resize(function(){t();ASC.Files.UI.fixContentHeaderWidth()});jq(window).bind("resizeWinTimerWithMaxDelay",function(){t();ASC.Files.UI.fixContentHeaderWidth()})},u=function(){},f=function(n,t){return n&&t?ASC.Files.Common.isCorrectId(t)?jq("#filesMainContent .file-row"+ASC.Files.UI.getSelectorId(n+"_"+t)):null:null},e=function(n){return'[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]'},o=function(n){var r,u,i,t;return(n=jq(n),r='input:hidden[name="entry_data"]',n.is(".file-row")||(u=".file-row",n.is(".jstree *")&&(u=".tree-node",r='> a input:hidden[name="entry_data"]'),n=n.closest(u)),n.length==0)?null:(i=n.find(r),!i.length)?null:(t={},t.id=t.entryId=i.attr("data-id"),!ASC.Files.Common.isCorrectId(t.id))?null:(t.entryObject=n,t.access=i.attr("data-access"),t.comment=i.attr("data-comment"),t.content_length=i.attr("data-content_length"),t.create_by=i.attr("data-create_by"),t.create_by_id=i.attr("data-create_by_id"),t.create_on=i.attr("data-create_on"),t.entryType=(i.attr("data-entryType")||"").trim()==="file"?"file":"folder",t.error=i.attr("data-error"),t.error=t.error!=""?t.error:!1,t.file_status=i.attr("data-file_status"),t.isnew=i.attr("data-isnew")|0,t.modified_by=i.attr("data-modified_by"),t.modified_on=i.attr("data-modified_on"),t.provider_id=i.attr("data-provider_id")|0,t.provider_key=i.attr("data-provider_key"),t.shared=i.attr("data-shared")==="true",t.title=(i.attr("data-title")||"").trim(),t.version=i.attr("data-version")|0,t.version_group=i.attr("data-version_group")|0,t)},s=function(n){if(typeof n=="undefined"||n==null)return null;var t=n.indexOf("file_")=="0"?"file":"folder",i=n.substring((t+"_").length);return ASC.Files.Common.isCorrectId(i)?{entryType:t,entryId:i}:null},h=function(n,t){return ASC.Files.Common.isCorrectId(t)?ASC.Files.UI.getObjectTitle(ASC.Files.UI.getEntryObject(n,t)):null},c=function(n){return(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),n.length==0)?null:ASC.Files.UI.getObjectData(n).title.trim()},l=function(n,t,i){if(n=="file"){var r=ASC.Files.Utility.GetFileDownloadUrl(t);ASC.Files.Utility.CanWebEdit(i)&&!ASC.Files.Utility.MustConvert(i)?r=ASC.Files.Utility.GetFileWebEditorUrl(t):ASC.Files.Utility.CanWebView(i)?r=ASC.Files.Utility.GetFileWebViewerUrl(t):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(i)&&(r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.ImageViewer.getPreviewHash(t)))}else r=ASC.Files.Constants.URL_BASE+"#"+ASC.Files.Common.getCorrectHash(t);return r},a=function(){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.move("");return}ASC.Files.UI.hideAllContent(!0);ASC.Files.UI.stickContentHeader();ASC.Files.Folders.getFolderItems(!1)},v=function(n){var t=ASC.Files.Constants.storageKeyCompactView;typeof n=="undefined"&&(n=localStorageManager.getItem(t)===!0);localStorageManager.setItem(t,n);jq("#switchViewFolder").toggleClass("compact",n===!0);jq("#filesMainContent").toggleClass("compact",n===!0);ASC.Files.Folders.showMore&&n!==!0&&jq(document).height()-jq(window).height()<=jq(window).scrollTop()+350&&ASC.Files.Folders.showMore();ASC.Files.Mouse&&ASC.Files.Mouse.updateMainContentArea()},y=function(){return jq("#settingCommon, #settingThirdPartyPanel, #helpPanel").is(":visible")},p=function(){var n=jq("#mainContentHeader.stick-panel:visible");n.css("width",n.parent().innerWidth()-parseInt(n.css("margin-left"))-parseInt(n.css("margin-right")))},t=function(){var n=jq("#mainContentHeader.stick-panel:visible"),t=jq(window);n.length!=0&&n.css("left",n.parent().offset().left-t.scrollLeft())},w=function(){var n=jq("#mainContentHeader .down_arrow"),t,i;n.length&&(t=n.offset().top+n.outerHeight(),i=jq("#filesSelectorPanel:visible"),ASC.Files.UI.stickMovingPanel("mainContentHeader",i,t,!1),ASC.Files.UI.fixContentHeaderWidth())},b=function(n,t,i,r){var u=jq("#"+n),e,f,s,c,o,l;if(u.is(":visible"))if(e="Spacer",f=jq("#"+n+e),s=jq("#"+n+e+":visible").length==0?u.offset().top:f.offset().top,i=i||0,c=jq(window),o=c.scrollTop(),o>=s){var a=u.outerHeight(),h=u.parent(),v=h.innerHeight()-parseInt(h.css("padding-top"))-parseInt(h.css("padding-bottom"));(!u.hasClass("stick-panel")||jq.browser.mobile)&&(!r||o-s<v-a)&&(f.length==0&&(l=document.createElement("div"),l.id=n+e,document.body.appendChild(l),f=jq("#"+n+e),f.insertAfter(u),f.css({height:u.css("height"),"padding-top":u.css("padding-top"),"padding-bottom":u.css("padding-bottom")})),f.show(),u.addClass("stick-panel").css("left",h.offset().left-c.scrollLeft()),t&&t.css({position:"fixed",top:i-o}),jq.browser.mobile&&u.css({top:jq(document).scrollTop()+"px",position:"absolute"}));r&&u.hasClass("stick-panel")&&u.css("top",-Math.max(0,o-s-(v-a)))}else u.hasClass("stick-panel")&&(f.hide(),u.removeClass("stick-panel"),jq("#mainContentHeader").css("width","auto"),t&&t.css({position:"absolute",top:i}),jq.browser.mobile&&u.css({position:"static"}))},k=function(n,t,i,r,u){return ASC.Files.UI.blockObject(ASC.Files.UI.getEntryObject(n,t),i,r,u)},d=function(n,t,i,r){if(t=t===!0,n=jq(n),n.length&&n.hasClass("checkloading")!=t){jq(n).removeClass("row-hover");n.toggleClass("loading checkloading",t===!0);t===!0?(n.block({message:"",baseZ:99}),typeof i!="undefined"&&i&&n.children("div.blockUI.blockOverlay").attr("title",i)):(n.unblock(),n.css("position","static"));var u=n.hasClass("row-selected"),f=n.attr("data-selected")=="true";ASC.Files.UI.selectRow(n,!t&&f);t&&n.attr("data-selected",u);r||ASC.Files.UI.updateMainContentHeader()}},g=function(n){return!n.hasClass("folder-row")&&n.hasClass("on-edit")},nt=function(n){return n.hasClass("file-locked-by")},tt=function(n){var t=n.entryObject,i=n.entryType,r=n.title;return i=="file"&&ASC.Files.Folders.folderContainer!="trash"&&!t.hasClass("row-rename")&&ASC.Files.UI.accessEdit(n,t,!0)&&ASC.Files.Utility.CanWebEdit(r)},it=function(n,t){var i=ASC.Files.Utility.GetFileExtension(t),r=t.substring(0,t.length-i.length);n.html('{0}<span class="file-extension">{1}<\/span>'.format(r,i))},rt=function(n){var t=n||jq("#filesMainContent .file-row");t.each(function(){var t=ASC.Files.UI.getObjectData(this),o=t.entryId,i=t.entryType,n=t.entryObject,f=t.title,r,h,u,e,s,c;ASC.Files.Folders.folderContainer=="trash"?(n.find(".file-lock").remove(),n.find(".entry-descr .title-created").remove(),n.find(".entry-descr .title-removed").show(),i=="folder"&&(n.find(".create-date").remove(),n.find(".modified-date").show())):(n.find(".entry-descr .title-removed").remove(),i=="folder"&&n.find(".modified-date").remove());r=n.find(".entry-title .name a");h=i=="file"?ASC.Files.Utility.getCssClassByFileTitle(f):ASC.Files.Utility.getFolderCssClass();n.find(".thumb-"+i).addClass(h);n.hasClass("checkloading")||(i=="file"?(r.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(r,f),ASC.Files.Folders.folderContainer!="trash"&&(u=ASC.Files.UI.getEntryLink(i,o,f),r.attr("href",u).attr("target","_blank"),e=n.find(".file-lock"),ASC.Files.UI.accessEdit(t,n)?n.hasClass("file-locked")&&(s=ASC.Files.FilesJSResources.TitleLockedFile,ASC.Files.UI.lockedForMe(n)&&(c=e.attr("data-name"),s=ASC.Files.FilesJSResources.TitleLockedFileBy.format(c)),e.attr("title",s)):e.remove()),ASC.Files.Utility.MustConvert(f)?(n.find(".pencil:not(.convert-action)").remove(),Teamlab.profile.isVisitor&&!ASC.Files.UI.accessEdit()||ASC.Files.Folders.folderContainer=="trash"?n.find(".convert-action").remove():n.find(".convert-action").show()):ASC.Files.UI.editableFile(t)?(ASC.Files.UI.lockEditFile(n,ASC.Files.UI.editingFile(n)),n.find(".convert-action").remove(),ASC.Files.Utility.CanCoAuhtoring(f)&&!n.hasClass("on-edit-alone")&&n.addClass("can-coauthoring"),u=ASC.Files.Utility.GetFileWebEditorUrl(o),n.find(".file-edit").attr("href",u)):(n.addClass("cannot-edit"),n.find(".pencil").remove())):ASC.Files.Folders.folderContainer!="trash"&&(u=ASC.Files.UI.getEntryLink(i,o),r.attr("href",u)),(ASC.Files.Folders.folderContainer=="trash"||t.error)&&r.attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)),jq("#filesMainContent").hasClass("without-share")||(ASC.Files.Folders.folderContainer!="forme"||ASC.Files.UI.accessEdit(t,n))&&(!ASC.Resources.Master.Personal||i!="folder")&&Teamlab.profile.isVisitor!==!0||n.addClass("without-share"),jq.browser.msie&&n.find("*").attr("unselectable","on"))});jq("#switchToNormal").length&&ASC.Files.UI.switchFolderView()},ut=function(n,t){var i=jq.fixEvent(n),r,u;if(!(i.button==0||jq.browser.msie&&i.button==1))return!0;t=t||jq(i.srcElement||i.target);try{if(t.is("a, .menu-small"))return!0}catch(i){return!0}if(r=t.is(".file-row")?t:t.closest(".file-row"),u=!jq(r).hasClass("row-selected")||jq(r).find(".checkbox input:visible").is("[type=radio]"),i.shiftKey&&ASC.Files.UI.lastSelectedEntry&&ASC.Files.UI.lastSelectedEntry.entryObj){u=!0;var f=jq(".file-row").index(r),e=jq(".file-row").index(ASC.Files.UI.lastSelectedEntry.entryObj),o=Math.min(f,e),s=Math.max(f,e);jq(".file-row:lt("+s+"):gt("+o+")").each(function(){ASC.Files.UI.selectRow(jq(this),u)})}else i.ctrlKey||t.is(".checkbox, .checkbox input")||(jq(".row-selected").length>1&&(u=!0),ASC.Files.UI.checkSelectAll(!1));return ASC.Files.UI.selectRow(r,u),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.lastSelectedEntry={entryObj:r},!0},ft=function(){ASC.Files.UI.resetSelectAll(jq("#filesMainContent .file-row:has(.checkbox input:visible:not(:checked))").length==0);jq("#filesMainContent .file-row:has(.checkbox input:checked)").length==0?(jq("#mainContentHeader .menuAction.unlockAction").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"&&jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Actions&&ASC.Files.Actions.showActionsViewPanel();typeof ASC.Files.UI.filesSelectedHandler=="function"&&ASC.Files.UI.filesSelectedHandler()},et=function(n,t){return n?(n.hasClass("file-row")||(n=n.closest(".file-row")),n.hasClass("row-selected")==t)?!1:n.hasClass("checkloading")&&t?!1:((n.hasClass("new-folder")||jq(n).hasClass("row-rename"))&&(t=!1),t===!0&&n.find(".checkbox input:visible").is("[type=radio]")&&(jq("#filesMainContent .checkbox input:checked").prop("checked",!1),jq("#filesMainContent .file-row.row-selected").removeClass("row-selected")),n.find(".checkbox input").prop("checked",t===!0),n.toggleClass("row-selected",t).removeAttr("data-selected"),jq("#filesMainContent .menu-small.active").removeClass("active"),!0):!1},ot=function(n){jq("#filesSelectAllCheck").prop("checked",n===!0);var t=n!==!0&&jq("#filesMainContent .file-row .checkbox input:checked").length!=0;jq("#filesSelectAllCheck").prop("indeterminate",t).toggleClass("indeterminate",t)},st=function(n){var t=!1,i=".row-selected";n&&(i=":not("+i+")");jq("#filesMainContent .file-row"+i+":not(.checkloading)").each(function(){t=ASC.Files.UI.selectRow(jq(this),n)||t});t&&ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null},ht=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#filesMainContent .file-row:not(.checkloading)").each(function(){var t,i=ASC.Files.UI.getObjectTitle(this);switch(n){case"folder":t=jq(this).hasClass("folder-row");break;case"file":t=!jq(this).hasClass("folder-row");break;case"document":t=ASC.Files.Utility.FileIsDocument(i)&&!jq(this).hasClass("folder-row");break;case"presentation":t=ASC.Files.Utility.FileIsPresentation(i)&&!jq(this).hasClass("folder-row");break;case"spreadsheet":t=ASC.Files.Utility.FileIsSpreadsheet(i)&&!jq(this).hasClass("folder-row");break;case"image":t=ASC.Files.Utility.FileIsImage(i)&&!jq(this).hasClass("folder-row");break;case"archive":t=ASC.Files.Utility.FileIsArchive(i)&&!jq(this).hasClass("folder-row");break;default:return!1}return ASC.Files.UI.selectRow(jq(this),t),!0});ASC.Files.UI.updateMainContentHeader()},ct=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},lt=function(n,t,i){var u,r,f,e;if(Teamlab.profile.isOutsider||(n=n||(t?ASC.Files.UI.getObjectData(t):ASC.Files.Folders.currentFolder),u=ASC.Files.Constants.ADMIN||!n||n.create_by_id==Teamlab.profile.id,n&&n.entryType=="folder"&&(n.entryId===ASC.Files.Constants.FOLDER_ID_SHARE||n.entryId===ASC.Files.Constants.FOLDER_ID_PROJECT||n.entryId===ASC.Files.Constants.FOLDER_ID_TRASH)&&(u=!1),r=n?n.entryId:null,f=n?n.entryType:null,f=="folder"&&(r==ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&!ASC.Files.Constants.ADMIN||r==ASC.Files.Constants.FOLDER_ID_SHARE||r==ASC.Files.Constants.FOLDER_ID_TRASH||r==ASC.Files.Constants.FOLDER_ID_PROJECT)))return!1;e=parseInt(n?n.access:ASC.Files.Constants.AceStatusEnum.None);f=="folder"&&ASC.Files.Folders&&ASC.Files.Folders.currentFolder&&r==ASC.Files.Folders.currentFolder.id&&(e=parseInt(ASC.Files.Folders.currentFolder.access));switch(e){case ASC.Files.Constants.AceStatusEnum.None:case ASC.Files.Constants.AceStatusEnum.ReadWrite:return!0;case ASC.Files.Constants.AceStatusEnum.Read:case ASC.Files.Constants.AceStatusEnum.Restrict:return!1;case ASC.Files.Constants.AceStatusEnum.Review:return!!i;default:return u}},at=function(n){if(Teamlab.profile.isOutsider)return!1;var t=n?ASC.Files.UI.getObjectData(n):ASC.Files.Folders.currentFolder,i=parseInt(t?t.access:ASC.Files.Constants.AceStatusEnum.None),r=t?t.entryId:null,u=t?t.entryType:null;return(u=="folder"&&r==ASC.Files.Folders.currentFolder.id&&(i=ASC.Files.Folders.currentFolder.access),i==ASC.Files.Constants.AceStatusEnum.Restrict)?(n.remove(),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.AceStatusEnum_Restrict,!0),!1):ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT?!1:i==ASC.Files.Constants.AceStatusEnum.Read?!1:i==ASC.Files.Constants.AceStatusEnum.None||ASC.Files.Folders.folderContainer=="corporate"&&ASC.Files.Constants.ADMIN||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT&&t.create_by_id==Teamlab.profile.id},vt=function(n,t,i){var r=ASC.Files.UI.getEntryObject("file",n);return ASC.Files.UI.lockEditFile(r,t,i)},yt=function(n,t,i){if(!n.hasClass("folder-row"))if(t){n.addClass("on-edit");var r=ASC.Files.FilesJSResources.TitleEditingFile;i&&(r=ASC.Files.FilesJSResources.TitleEditingFileBy.format(i));n.find(".pencil.file-editing").attr("title",r)}else n.removeClass("on-edit")},pt=function(){var t=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),n;t.length!=0&&(n={entry:jq(t).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray()},ASC.Files.ServiceManager.checkEditing(ASC.Files.ServiceManager.events.CheckEditing,{list:n.entry},{stringList:n}))},wt=function(){clearTimeout(ASC.Files.UI.timeCheckEditing);ASC.Files.UI.timeCheckEditing=setTimeout(ASC.Files.UI.checkEditing,2e4)},bt=function(n,t,i){var u;n=n||ASC.Files.UI.getEntryObject(t,i);var r=ASC.Files.UI.getObjectData(n),f={entryTooltip:{type:t,title:r.title,create_by:r.create_by,date_type:ASC.Files.Folders.folderContainer=="trash"?"remove":t=="folder"?"create":r.version>1?"update":"upload",modified_on:t=="file"?r.modified_on:ASC.Files.Folders.folderContainer=="trash"?r.modified_on:r.create_on,version:r.version,length:r.content_length,error:r.error,provider_key:r.provider_key,total_files:parseInt(n.find(".countFiles").html())||0,total_sub_folder:parseInt(n.find(".countFolders").html())||0,comment:r.comment}},e=ASC.Files.Common.jsonToXml(f),o=ASC.Files.TemplateManager.translateFromString(e);jq("#entryTooltip").html(o);u=jq("#filesMainContent .file-row").length>10&&n.is("#filesMainContent .file-row:gt(-4)");jq.dropdownToggle().toggle(n.find(".thumb-"+t),"entryTooltip",u?-12:0,0,!1,null,null,null,u)},kt=function(){clearTimeout(ASC.Files.UI.timeTooltip);jq("#entryTooltip").hide();var n=jq("#filesMainContent .file-row .entry-title .name a[data-title]").removeAttr("data-title");n.attr("title",n.text())},dt=function(){var n=ASC.Files.Constants.COUNT_ON_PAGE-jq("#filesMainContent .file-row").length;n>0&&(ASC.Files.UI.currentPage<ASC.Files.UI.amountPage?ASC.Files.Folders.getFolderItems(!0,n):ASC.Files.Folders.folderContainer&&n>=ASC.Files.Constants.COUNT_ON_PAGE&&ASC.Files.EmptyScreen.displayEmptyScreen())},gt=function(n,t){if(ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>1){var i=ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-2],r=ASC.Files.Tree.getFolderTitle(i);jq(n).attr("data-id",i).attr("href",ASC.Files.UI.getEntryLink("folder",i)).attr("title",r);jq(t||n).show()}else jq(t||n).hide()},ni=function(n){jq(n).unbind("keyup").bind("keyup",function(){var n=jq(this).val();n.search(ASC.Files.Common.characterRegExp)!=-1&&(jq(this).val(ASC.Files.Common.replaceSpecCharacter(n)),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SpecCharacter.format(ASC.Files.Common.characterString),!0))})},ti=function(n){if(ASC.Files.UI.canSetDocumentTitle){n=n||ASC.Files.Folders.currentFolder.title;n=n?n+" - ":"";var t=jq(".files-content-panel").attr("data-title")||"TeamLab";document.title=n+t}},ii=function(n){typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.ImageViewer.resetWorkspace();n=!!n;n||(jq("#treeViewContainer .selected").removeClass("selected"),jq("#treeViewContainer .parent-selected").removeClass("parent-selected"));jq("#treeSecondary .currentCategory").removeClass("currentCategory");jq("#treeSecondary .active").removeClass("active");jq("#settingCommon").hide();jq("#settingThirdPartyPanel").hide();jq("#helpPanel").hide();jq("#moreFeatures").hide();jq(".files-content-panel").toggle(n);jq(".mainPageContent").children(".loader-page").remove()},ri=function(n){if(!jq("#helpPanel").length){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.hideAllContent();var t={helpId:n};if(jq("#helpPanel").text().trim().length)ASC.Files.EventHandler.onGetHelpCenter(null,t);else t.update=!0,ASC.Files.ServiceManager.getHelpCenter(ASC.Files.ServiceManager.events.GetHelpCenter,t)},ui=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-common").addClass("active");jq("#settingCommon").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsCommon)},fi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();ASC.Files.CreateMenu.disableMenu();jq("#moreFeatures").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleMoreFeaturs)},ei=function(){return jq("#tariffLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedStoragePanel",500,300,0),!0):!1},oi=function(){return jq("#tariffLimitExceedFileSizePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedFileSizePanel",500,300,0),!0):!1},si=function(n,t,i,r){return ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),StudioBlockUIManager.blockUI(n,t,i,r,"absolute")},hi=function(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%")},ci=function(n){n.find(".userLink").each(function(){var n=jq(this).attr("id").trim();n!=null&&n!=""&&i.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')})};return{init:r,parseItemId:s,getEntryObject:f,getObjectData:o,getSelectorId:e,getEntryTitle:h,getObjectTitle:c,getEntryLink:l,currentPage:0,amountPage:0,countTotal:0,updateFolderView:a,switchFolderView:v,isSettingsPanel:y,blockObjectById:k,blockObject:d,highlightExtension:it,addRowHandlers:rt,updateMainContentHeader:ft,lastSelectedEntry:null,checkSelectAll:st,checkSelect:ht,selectRow:et,clickRow:ut,resetSelectAll:ot,displayInfoPanel:ct,editingFile:g,editableFile:tt,lockedForMe:nt,checkEditing:pt,timeCheckEditing:null,checkEditingDefer:wt,lockEditFileById:vt,lockEditFile:yt,accessEdit:lt,accessDelete:at,checkCharacter:ni,canSetDocumentTitle:!0,setDocumentTitle:ti,stickContentHeader:w,fixContentHeaderWidth:p,stickMovingPanel:b,displayEntryTooltip:bt,hideEntryTooltip:kt,timeTooltip:null,checkEmptyContent:dt,checkButtonBack:gt,hideAllContent:ii,displayHelp:ri,displayCommonSetting:ui,displayMoreFeaturs:fi,displayTariffLimitStorageExceed:ei,displayTariffFileSizeExceed:oi,blockUI:si,setProgressValue:hi,filesSelectedHandler:u,registerUserProfilePopup:ci}}(),function(n){ASC.Files.UI.init();n(function(){jq("#switchToNormal").click(function(){ASC.Files.UI.switchFolderView(!1)});jq("#switchToCompact").click(function(){ASC.Files.UI.switchFolderView(!0)});jq("#filesMainContent").on("click",".file-row",ASC.Files.UI.clickRow);jq("#filesMainContent").on("dblclick",".file-row:not(.checkloading)",function(n){jq(n.srcElement||n.target).is("input, .checkbox, .file-lock, .version, .pencil, .is-new, .btn-row, .menu-small, #contentVersions, #contentVersions *")||jq(this).closest(".file-row").find(".entry-title .name a").trigger("click")});jq("#filesMainContent").on("click",".checkbox input",function(n){ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.clickRow(n,jq(this));jq(this).blur();ASC.Files.Common.cancelBubble(n)});jq(".menu-action-on-top").click(function(){return jq(document).scrollTop(0),!1});jq(document).keydown(function(n){var t,r,i;if(jq(".blockUI:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);r=t.target||t.srcElement;try{if(jq(r).is("input,textarea"))return!0}catch(t){return!0}return(i=t.keyCode||t.which,(i==ASC.Files.Common.keyCode.a||i==ASC.Files.Common.keyCode.A)&&t.ctrlKey)?(jq.browser.opera&&setTimeout(function(){jq("#filesSelectAllCheck").focus()},1),ASC.Files.UI.checkSelectAll(!0),!1):!0});jq(document).keyup(function(n){var t,r,i;if(jq(".blockUI:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);r=t.target||t.srcElement;try{if(jq(r).is("input,textarea"))return!0}catch(t){return!0}if(i=t.keyCode||t.which,ASC.Files.Folders){if(i==ASC.Files.Common.keyCode.deleteKey&&!t.shiftKey)return ASC.Files.Folders.deleteItem(),!1;if((i==ASC.Files.Common.keyCode.f||i==ASC.Files.Common.keyCode.F)&&t.shiftKey)return ASC.Files.Folders.createFolder(),!1;if((i==ASC.Files.Common.keyCode.n||i==ASC.Files.Common.keyCode.N)&&t.shiftKey)return ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)&&(ASC.Files.Folders.typeNewDoc="document",ASC.Files.Folders.createNewDoc()),!1}if(i==ASC.Files.Common.keyCode.esc){if(ASC.Files.Mouse){if(jq("#filesMovingTooltip").is(":visible"))return ASC.Files.Mouse.finishMoveTo(),!1;if(jq("#filesSelector").is(":visible"))return ASC.Files.Mouse.finishSelecting(),!1}return ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ChunkUploads&&ASC.Files.ChunkUploads.hideDragHighlight(),!0}return!0});jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#bottomLoaderPanel").on("drag",".progress-dialog-header",function(){ASC.Files.Actions.hideAllActionPanels()});jq(".mobile-app-banner").trackEvent("mobileApp-banner","action-click","app-store")})}(jQuery);
window.ASC.Files.Mouse=function(){var t=!1,n=null,i=null,f=function(){t===!1&&(t=!0);ASC.Files.Mouse.mouseBtn=!1},e=function(n){return ASC.Files.Mouse.mouseBtn||jq("#filesSelector, #filesActionsPanel:visible, #filesActionPanel:visible").length!=0?!0:(n=jq.fixEvent(n),jq(this).toggleClass("row-hover",n.type=="mouseenter"),!0)},o=function(n){return n.nodeName=="HTML"?!0:jq(".popup-modal:visible").length!=0?!0:ASC.Files.ImageViewer&&ASC.Files.ImageViewer.isView()?!0:jq(n).is(".mainPageLayout:not(.studio-top-panel),             .mainPageTableSidePanel,             .mainPageContent,             .files-content-panel,             #mainContent,             .file-row:not(.row-rename):not(.row-selected),             .file-row:not(.row-rename):not(.row-selected) *")?jq(n).is(".textEdit, .checkbox, input"):!0},s=function(){jq("#filesSelector").length!=0&&(ASC.Files.Mouse.mouseSelector.entryItems=[],jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file)").each(function(){var n=jq(this).offset();n.right=n.left+this.offsetWidth;n.bottom=n.top+this.offsetHeight;n.entryObj=jq(this);ASC.Files.Mouse.mouseSelector.entryItems.push(n)}))},h=function(){n=jq("#filesMainContent").offset();n.right=n.left+jq("#filesMainContent")[0].offsetWidth;n.bottom=n.top+jq("#filesMainContent")[0].offsetHeight;n.documentWidth=jq(document).width();n.documentHeight=jq(document).height()},r=function(n,t){var i=n.x<t.x;return(i?n:t).y>(i?t:n).x},u=function(n,t){return r({x:n.top,y:n.bottom},{x:t.top,y:t.bottom})&&r({x:n.left,y:n.right},{x:t.left,y:t.right})},c=function(n){var t,i;if(n=jq.fixEvent(n),ASC.Files.Mouse.mouseBtn=n.target.nodeName!="HTML",!(n.button==0||jq.browser.msie&&n.button==1))return!0;t=n.target||n.srcElement;try{if(o(t))return!0}catch(r){return!0}return ASC.Files.Mouse.mouseSelector.startX=n.pageX,ASC.Files.Mouse.mouseSelector.startY=n.pageY,ASC.Files.Mouse.updateMainContentArea(),i=jq.browser.msie&&jq.browser.version<9?jq("body"):jq(window),i.unbind("mousemove.MouseSelect mouseup.MouseSelect").bind("mousemove.MouseSelect",ASC.Files.Mouse.continueSelecting).bind("mouseup.MouseSelect",ASC.Files.Mouse.finishSelecting),typeof SmallChat!="undefined"&&SmallChat.minimizeAllWindowsIfLoseFocus&&SmallChat.minimizeAllWindowsIfLoseFocus(n,t),!1},l=function(t){var l,e,r,f,c,o;if(t=jq.fixEvent(t),l=t.target||t.srcElement,typeof l=="undefined")return!0;var a=2,s=Math.min(t.pageX,n.documentWidth-a),h=Math.min(t.pageY,n.documentHeight-a),v=Math.abs(s-ASC.Files.Mouse.mouseSelector.startX),y=Math.abs(h-ASC.Files.Mouse.mouseSelector.startY);if(v<5&&y<5)return!0;if(jq("#filesSelector").length==0&&(ASC.Files.Actions.hideAllActionPanels(),jq("#studioPageContent").append('<div id="filesSelector"><\/div>'),ASC.Files.Mouse.collectEntryItems(),jq("body").addClass("select-action")),e={left:Math.min(ASC.Files.Mouse.mouseSelector.startX,s),top:Math.min(ASC.Files.Mouse.mouseSelector.startY,h),right:Math.max(ASC.Files.Mouse.mouseSelector.startX,s),bottom:Math.max(ASC.Files.Mouse.mouseSelector.startY,h)},jq("#filesSelector").css({width:v+"px",height:y+"px",left:e.left+"px",top:e.top+"px"}),r=n,t.ctrlKey||u(r,e)){for(f=!1,c=ASC.Files.Mouse.mouseSelector.entryItems.length,o=c;o;o--)r=ASC.Files.Mouse.mouseSelector.entryItems[c-o],u(r,e)?f=ASC.Files.UI.selectRow(r.entryObj,!0)||f:t.ctrlKey||(f=ASC.Files.UI.selectRow(r.entryObj,!1)||f);f&&(clearTimeout(i),i=setTimeout(ASC.Files.UI.updateMainContentHeader,10))}else ASC.Files.UI.checkSelectAll(!1);return!1},a=function(){jq("#filesSelector").remove();ASC.Files.Mouse.mouseSelector.startX=0;ASC.Files.Mouse.mouseSelector.startY=0;ASC.Files.Mouse.mouseSelector.entryItems=[];ASC.Files.Mouse.mouseBtn=!1;var n=jq.browser.msie&&jq.browser.version<9?jq("body"):jq(window);n.unbind("mousemove.MouseSelect mouseup.MouseSelect");jq("body").removeClass("select-action")},v=function(n,t){var i=["#treeViewContainer li:not(.access-read) > a",".to-parent-folder"],r;ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_TRASH&&i.push("#filesMainContent .folder-row:not(.checkloading):not(.new-folder):not(.error-entry):not(.row-selected)");r=i.join(",");jq(r).each(function(){var i,r=ASC.Files.UI.getObjectData(this),u;r?i=r.entryId:(i=jq(this).attr("data-id"),t&&i==ASC.Files.Constants.FOLDER_ID_TRASH&&(i=null));ASC.Files.Common.isCorrectId(i)&&(u=r?r.entryObject:ASC.Files.UI.getEntryObject("folder",i),i!=ASC.Files.Folders.currentFolder.id&&ASC.Files.UI.accessEdit(r,u)&&(i!=ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.UI.accessEdit())&&jq(this).addClass(n))})},y=function(n,t,i){var r,e,u,f;return(n=jq.fixEvent(n),n.type=="mouseleave")?(jq("."+i).removeClass(i),null):(r=jq("#treeViewContainer").offset().left,e=r+jq("#treeViewContainer")[0].offsetWidth,jq(this).is("#treeViewContainer *")&&(r>n.pageX||e<n.pageX))?null:(f=ASC.Files.UI.getObjectData(t),u=f?f.entryId:jq(t).attr("data-id"),ASC.Files.Common.isCorrectId(u))?(jq(t).addClass(i),u):null},p=function(n){return(n=jq.fixEvent(n),!(n.button==0||jq.browser.msie&&n.button==1))?!1:ASC.Files.Folders.folderContainer=="trash"?!1:jq("#treeViewPanelSelector").length==0?!1:jq("#promptRename").length!=0?!0:(ASC.Files.Mouse.moveToX=n.pageX,ASC.Files.Mouse.moveToY=n.pageY,jq("body").unbind("mouseout.MouseMove mousemove.MouseMove").bind("mouseout.MouseMove mousemove.MouseMove",ASC.Files.Mouse.beginMoveTo),!0)},w=function(n){if(n=jq.fixEvent(n),!(n.button==0||jq.browser.msie&&n.button==1)||ASC.Files.Mouse.mouseBtn==!1)return jq("body").unbind("mouseout.MouseMove mousemove.MouseMove"),!1;if(Math.abs(n.pageX-ASC.Files.Mouse.moveToX)<5&&Math.abs(n.pageY-ASC.Files.Mouse.moveToY)<5)return!1;ASC.Files.Actions.hideAllActionPanels();jq("#filesMainContent .row-hover").removeClass("row-hover");jq(".may-row-to").removeClass("may-row-to");jq("body").addClass("user-select-none file-mouse-move");ASC.Files.Mouse.highlightFolderTo("may-row-to");jq("body").unbind("mouseout.MouseMove mousemove.MouseMove mouseup.MouseMove").bind("mouseout.MouseMove mousemove.MouseMove",ASC.Files.Mouse.continueMoveTo).bind("mouseup.MouseMove",ASC.Files.Mouse.finishMoveTo).on("mouseenter.MouseMove mouseleave.MouseMove",".may-row-to",ASC.Files.Mouse.checkMoveTo);return!0},b=function(n){var u,f,i,r,t;if(n=jq.fixEvent(n),ASC.Files.Mouse.mouseBtn==!1)return ASC.Files.Mouse.finishMoveTo(n),!0;if(jq("#filesMovingTooltip").length==0&&(u=jq("#filesMainContent .file-row:has(.checkbox input:checked)"),f=u.length==1?ASC.Files.UI.getObjectTitle(u[0]):ASC.Files.FilesJSResources.InfoSelectCount.format(u.length),f=ASC.Files.FilesJSResources.InfoSelectingDescribe.format("<b>"+f+"<\/b><br/>"),jq("#filesMainContent").parent().after('<div id="filesMovingTooltip"><\/div>'),jq("#filesMovingTooltip").html(f)),jq("#filesMovingTooltip").css({left:n.pageX+"px",top:n.pageY+"px"}),!ASC.Files.UI.accessEdit()||n.ctrlKey?jq("body").addClass("file-mouse-copy"):jq("body").removeClass("file-mouse-copy"),jq.browser.opera){i=n.target||n.srcElement;i=jq(i);i.hasClass("file-row")||(i=jq(i).closest(".file-row"));r="fix_select_text";t=i.children("#"+r);t.length==0&&(jq("#"+r).remove(),t=document.createElement("INPUT"),t.style.width=0,t.style.height=0,t.style.border=0,t.style.margin=0,t.style.padding=0,t.id=r,t.disabled=!0,i.prepend(t),t=jq("#"+r));try{t.focus()}catch(n){t.disabled=!1;t.focus();t.disabled=!0}}return!0},k=function(n){ASC.Files.Mouse.moveToFolder=ASC.Files.Mouse.getOverFolderId(n,this,"row-to")},d=function(n){var t,i;n=jq.fixEvent(n);jq(".row-to").removeClass("row-to");jq(".may-row-to").removeClass("may-row-to");jq("body").removeClass("user-select-none file-mouse-move file-mouse-copy");t=ASC.Files.Mouse.moveToFolder;ASC.Files.Mouse.moveToFolder=null;ASC.Files.Common.isCorrectId(t)&&(t==ASC.Files.Constants.FOLDER_ID_TRASH?ASC.Files.Folders.deleteItem():(ASC.Files.Folders.isCopyTo=!ASC.Files.UI.accessEdit()||n&&n.ctrlKey===!0,i=ASC.Files.UI.getEntryTitle("folder",t),ASC.Files.Folders.curItemFolderMoveTo(t,i)));ASC.Files.Folders.isCopyTo=!1;jq("body").unbind("mouseout.MouseMove mousemove.MouseMove mouseup.MouseMove mouseenter.MouseMove mouseleave.MouseMove");jq("#filesMovingTooltip").remove()},g=function(){var n=jq(this);ASC.Files.UI.hideEntryTooltip();n.one("mouseleave",function(){ASC.Files.UI.hideEntryTooltip()});var t=ASC.Files.UI.getObjectData(n),i=t.entryId,r=t.entryType;n.attr("data-title",!0);n.removeAttr("title");ASC.Files.UI.timeTooltip=setTimeout(function(){ASC.Files.UI.displayEntryTooltip(t.entryObject,r,i)},750)};return{init:f,mouseBtn:!1,mouseSelector:{startX:0,startY:0,entryItems:[]},moveToX:0,moveToY:0,moveToFolder:"",updateMainContentArea:h,handleMove:e,collectEntryItems:s,beginSelecting:c,continueSelecting:l,finishSelecting:a,preparingMoveTo:p,beginMoveTo:w,continueMoveTo:b,checkMoveTo:k,finishMoveTo:d,overCompactTitle:g,highlightFolderTo:v,getOverFolderId:y}}(),function(n){ASC.Files.Mouse.init();n(function(){jq("#filesMainContent").on("mousedown",".file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)",ASC.Files.Mouse.preparingMoveTo);jq("#mainContent").on("mouseover","#filesMainContent.compact .file-row:not(.checkloading):not(.new-folder):not(.new-file) .entry-title .name a",ASC.Files.Mouse.overCompactTitle);jq(document).on("mousedown.MouseSelect","#studioPageContent:has(#filesMainContent .file-row:visible:not(.checkloading):not(.new-folder):not(.new-file))",ASC.Files.Mouse.beginSelecting);jq(document).bind("mouseup.Mouse",function(){ASC.Files.Mouse.mouseBtn=!1});jq("#filesMainContent").on("mouseenter mouseleave",".file-row:not(.checkloading)",ASC.Files.Mouse.handleMove);jq(document).on("dragstart",".row-selected a",function(n){n.preventDefault()})})}(jQuery);
window.ASC.Files.Marker=function(){var n=!1,t=function(){n===!1&&(n=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MarkAsRead,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetNews,ASC.Files.Marker.onGetNews),jq(document).click(function(n){jq.dropdownToggle().registerAutoHide(n,".is-new","#filesNewsPanel")}))},i=function(n){return typeof n=="undefined"||n==null?!1:(jq("#studio_sidePanel .page-menu .is-new").hide(),jq(n.childNodes).each(function(n,t){var i=t.childNodes[0],r=t.childNodes[1],f=i.textContent||i.text,u=r.textContent||r.text;u>0&&jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(f)).text(u).show()}),!0)},r=function(n,t){return ASC.Files.Marker.setNewCount(n,t,0)},u=function(n,t,i){var f=!1,o=(i|0)>0,r=ASC.Files.UI.getEntryObject(n,t).find(".is-new");if(r.is(":visible")){var s=n=="file"?-Math.pow(-1,i):i-(r.html()|0),h=ASC.Files.Tree.pathParts[0],u=jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(h)),c=u.html()|0,e=c+s;u.html(e>0?e:0);e>0?u.show():u.hide();o?n=="folder"&&r.html(i):r.remove();f=!0}return n==="folder"&&(r=jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(t)),r.is(":visible")&&(r.html(i>0?i:0),o?r.show():(r.hide(),jq.inArray(t+"",ASC.Files.Tree.pathParts)!=-1&&jq("#filesMainContent .is-new").remove()),f=!0)),f},f=function(n){var t,i={};return(i.entry=[],typeof n=="undefined"?jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)").each(function(){t=ASC.Files.UI.getObjectData(this);t.entryObject.find(".is-new").length>0&&i.entry.push(t.entryType+"_"+t.entryId)}):typeof n=="object"?(t=n,i.entry.push(t.entryType+"_"+t.entryId)):ASC.Files.Common.isCorrectId(n)&&i.entry.push("folder_"+n),i.entry.length==0)?!1:(ASC.Files.ServiceManager.markAsRead(ASC.Files.ServiceManager.events.MarkAsRead,{list:i.entry,doNow:!0},{stringList:i}),!1)},e=function(n,t){var i,r;if(ASC.Files.Actions.hideAllActionPanels(),!ASC.Files.Common.isCorrectId(t)){if(i=ASC.Files.UI.getObjectData(n),i.entryType=="file"){ASC.Files.Marker.markAsRead(i);return}t=i.entryId}trackingGoogleAnalitics("documents","shownews","folder");r={top:n.offset().top,left:n.offset().left,width:n.width(),height:n.height()};ASC.Files.ServiceManager.getNews(ASC.Files.ServiceManager.events.GetNews,{folderId:t,targetSize:r,showLoading:!0})},o=function(n){var t,i,r,u;for(jq("#studio_sidePanel .page-menu .is-new").hide(),t=0;t<n.length;t++){if(i=ASC.Files.UI.parseItemId(n[t]),i==null){if(n[t].indexOf("new_")==0){var o=n[t].substring(4).replace(/\?/g,":"),f=JSON.parse(o),s=f.key,e=f.value;e>0&&jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(s)).text(e).show()}continue}r=i.entryType;u=i.entryId;ASC.Files.UI.blockObjectById(i.entryType,i.entryId,!1,null,!0);ASC.Files.Marker.removeNewIcon(r,u);r=="folder"&&jq.inArray(u+"",ASC.Files.Tree.pathParts)!=-1&&jq("#filesMainContent .is-new").remove()}ASC.Files.UI.updateMainContentHeader();ASC.Files.Actions.showActionsViewPanel()},s=function(n,t,i){var u,r,f;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}u=ASC.Files.TemplateManager.translate(n);u.length?(jq("#filesNewsList").html(u),jq("#filesNewsList .file-row").each(function(){var n=ASC.Files.UI.getObjectData(this),e=n.entryId,t=n.entryType,u=n.entryObject,r=n.title,o=t=="file"?ASC.Files.Utility.getCssClassByFileTitle(r,!0):ASC.Files.Utility.getFolderCssClass(!0),i,f;u.find(".thumb-"+t).addClass(o);i=u.find(".entry-title .name a");t=="file"&&i.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(i,r);f=ASC.Files.UI.getEntryLink(t,e,r);i.attr("href",f).attr("target","_blank")}),r=t.targetSize,jq("#filesNewsPanel").css({top:r.top+r.height,left:r.left}).toggle().attr("data-id",t.folderId),f=jq("#filesNewsList .file-row").length,ASC.Files.Marker.setNewCount("folder",t.folderId,f)):ASC.Files.Marker.removeNewIcon("folder",t.folderId)};return{init:t,removeNewIcon:r,setNewCount:u,markAsRead:f,markRootAsNew:i,getNews:e,onMarkAsRead:o,onGetNews:s}}(),function(n){n(function(){ASC.Files.Marker.init();jq(document).on("click",".is-new",function(){var n=jq(this),t=n.attr("data-id");return ASC.Files.Marker.getNews(n,t),!1});jq("#mainMarkRead").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Marker.markAsRead()});jq("#filesNewsMarkRead").click(function(){ASC.Files.Actions.hideAllActionPanels();var n=jq("#filesNewsPanel").attr("data-id");ASC.Files.Marker.markAsRead(n)});jq("#filesNewsList").on("click",".folder-row:not(.error-entry) .entry-title .name a, .folder-row:not(.error-entry) .thumb-folder",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this).id;return ASC.Files.Folders.clickOnFolder(n),!1});jq("#filesNewsList").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(){var r=ASC.Files.UI.getObjectData(this),u=ASC.Files.Folders.clickOnFile(r),n,t,i;return u||(n=jq("#filesNewsPanel").attr("data-id"),t=jq(".is-new"+ASC.Files.UI.getSelectorId(n)),t.is(":visible")||(t=ASC.Files.UI.getEntryObject("folder",n).find(".is-new")),i=t.html()|0,ASC.Files.Marker.setNewCount("folder",n,i-1)),!1});jq("#studio_sidePanel .page-menu .is-new").trackEvent("files_tree","action-click","mark_as_read")})}(jQuery);
window.ASC.Files.Actions=function(){var n=!1,t=function(){n===!1&&(n=!0,jq(document).click(function(n){jq.dropdownToggle().registerAutoHide(n,"#filesActionsPanel","#filesActionsPanel");jq.dropdownToggle().registerAutoHide(n,".row-selected .menu-small","#filesActionPanel",function(){jq(".row-selected .menu-small.active").removeClass("active");jq(".row-selected.row-lonely-select").removeClass("row-lonely-select")})}),jq.dropdownToggle({switcherSelector:"#mainContentHeader .menuActionSelectAll",dropdownID:"filesSelectorPanel",anchorSelector:".menuActionSelectAll",addTop:4}),jq.dropdownToggle({addLeft:4,addTop:-4,afterShowFunction:function(){if(jq("#filesGetLink").is(":visible")){var n=ASC.Files.Actions.currentEntryData.entryObject.find(".entry-title .name a").prop("href");ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink);ASC.Files.Actions.clipGetLink=ASC.Clipboard.create(n,"filesGetLink",{onComplete:function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.Resource.LinkCopySuccess);ASC.Files.Actions.hideAllActionPanels()}})}},dropdownID:"filesAccessPanel",sideToggle:!0,switcherSelector:"#filesAccess",toggleOnOver:!0}),jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"filesVersionPanel",sideToggle:!0,switcherSelector:"#filesVersion",toggleOnOver:!0}),jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"filesMovePanel",sideToggle:!0,switcherSelector:"#filesMove",toggleOnOver:!0}),jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"foldersMovePanel",sideToggle:!0,switcherSelector:"#foldersMove",toggleOnOver:!0}),jq.dropdownToggle({addLeft:4,addTop:-4,afterShowFunction:function(){if(jq("#foldersGetLink").is(":visible")){var n=ASC.Files.Actions.currentEntryData.entryObject.find(".entry-title .name a").prop("href");ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink);ASC.Files.Actions.clipGetLink=ASC.Clipboard.create(n,"foldersGetLink",{onComplete:function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.Resource.LinkCopySuccess);ASC.Files.Actions.hideAllActionPanels()}})}},dropdownID:"foldersAccessPanel",sideToggle:!0,switcherSelector:"#foldersAccess",toggleOnOver:!0}))},i=function(n){jq("#buttonUnsubscribe, #buttonDelete, #buttonMoveto, #buttonCopyto, #buttonShare").hide();jq("#mainContentHeader .unlockAction").removeClass("unlockAction");var i=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").length,f=i,s=0,e=ASC.Files.ThirdParty&&!ASC.Files.ThirdParty.isThirdParty(),h=0,r=!1,o=0;if(jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var n=jq(this),t,i,u;(ASC.Files.UI.editingFile(n)||!ASC.Files.UI.accessDelete(n)||ASC.Files.UI.lockedForMe(n))&&f--;n.find(".is-new:visible").length>0&&s++;ASC.Files.ThirdParty?(t=ASC.Files.UI.getObjectData(n),!ASC.Files.ThirdParty.isThirdParty()&&ASC.Files.ThirdParty.isThirdParty(t)?h++:e=!1):e=!1;r||n.hasClass("folder-row")||(t=t||ASC.Files.UI.getObjectData(n),i=t.title,u=ASC.Files.Utility.GetConvertFormats(i),r=u.length>0);!ASC.Resources.Master.Personal&&n.is(":not(.without-share)")&&o++}),i>0&&(jq("#buttonDownload, #buttonUnsubscribe, #buttonRestore, #buttonCopyto").show().find("span").html(i),jq("#mainDownload, #mainUnsubscribe, #mainRestore, #mainCopy").addClass("unlockAction"),ASC.Files.Folders.folderContainer!="forme"&&jq("#buttonUnsubscribe").hide()),r?jq("#buttonConvert").show().find("span").html(i):jq("#buttonConvert").hide(),jq("#mainConvert").toggleClass("unlockAction",r),s>0&&jq("#mainMarkRead").addClass("unlockAction"),f>0&&(jq("#buttonDelete, #buttonMoveto").show().find("span").html(f-h),jq("#mainDelete, #mainMove").addClass("unlockAction")),ASC.Files.Folders.folderContainer=="trash"&&(jq("#buttonDelete, #buttonMoveto, #buttonCopyto").hide(),jq("#mainDelete, #mainMove, #mainCopy").removeClass("unlockAction")),jq("#buttonRestore, #buttonEmptyTrash").hide(),jq("#mainRestore, #mainEmptyTrash").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"?(i>0?(jq("#buttonDownload, #buttonDelete, #buttonRestore").show(),jq("#mainDownload, #mainDelete, #mainRestore").addClass("unlockAction")):(jq("#buttonDownload, #buttonConvert").hide(),jq("#mainDownload, #mainConvert").removeClass("unlockAction")),jq("#buttonEmptyTrash").show(),jq("#mainEmptyTrash").addClass("unlockAction")):o>0&&(jq("#buttonShare").show().find("span").html(o),jq("#mainShare").addClass("unlockAction")),e&&(jq("#buttonDelete, #buttonMoveto").hide(),jq("#mainDelete, #mainMove").removeClass("unlockAction")),typeof n!="undefined"){var u=jq.fixEvent(n),t=jq("#filesActionsPanel"),c=document.body.clientWidth-(u.pageX-pageXOffset+t.innerWidth())>0?0:t.innerWidth(),l=document.body.clientHeight-(u.pageY-pageYOffset+t.innerHeight())>0?0:t.innerHeight();t.css({top:u.pageY-l,left:u.pageX-c});t.toggle()}},r=function(n,t){var u,f,i,o,s,r,h,e;return(ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink),u=jq.fixEvent(n),f=jq(u.srcElement||u.target),t=t||ASC.Files.UI.getObjectData(f),i=t.entryObject,i.is(".loading"))?!0:(ASC.Files.Actions.currentEntryData=t,ASC.Files.UI.checkSelectAll(!1),ASC.Files.UI.selectRow(i,!0),ASC.Files.UI.updateMainContentHeader(),o=ASC.Files.UI.accessEdit(t,i),s=ASC.Files.UI.accessDelete(i),jq("#actionPanelFolders, #actionPanelFiles").hide(),t.entryType==="file"?(jq("#filesOpen,                #filesEdit,                #filesConvert,                #filesDownload,                #filesAccess,                #filesGetLink,                #filesShareAccess,                #filesChangeOwner,                #filesLock,                #filesUnlock,                #filesDocuSign,                #filesUnsubscribe,                #filesVersion,                #filesCompleteVersion,                #filesVersions,                #filesMove,                #filesMoveto,                #filesCopyto,                #filesCopy,                #filesRename,                #filesRestore,                #filesRemove").show().removeClass("display-none"),r=t.title,ASC.Files.Utility.GetConvertFormats(r).length||jq("#filesConvert").hide().addClass("display-none"),ASC.Files.Utility.CanWebView(r)||typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(r)||jq("#filesOpen").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.docuSignAttached()&&jq.inArray(ASC.Files.Utility.GetFileExtension(r),ASC.Files.Constants.DocuSignFormats)!=-1||jq("#filesDocuSign").hide(),(i.find("#contentVersions").length!=0||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty())&&jq("#filesVersions").hide().addClass("display-none"),h=ASC.Files.UI.editingFile(i),h&&(jq("#filesCompleteVersion,                    #filesMoveto,                    #filesRemove").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()&&jq("#filesRename").hide()),e=ASC.Files.UI.lockedForMe(i),(!ASC.Files.UI.editableFile(t)||h&&(!ASC.Files.Utility.CanCoAuhtoring(r)||i.hasClass("on-edit-alone"))||e)&&jq("#filesEdit").hide().addClass("display-none"),jq("#filesLock").toggle(!i.hasClass("file-locked")),jq("#filesUnlock").toggle(i.hasClass("file-locked")),ASC.Files.Folders.folderContainer=="trash"?jq("#filesOpen,                    #filesEdit,                    #filesGetLink,                    #filesShareAccess,                    #filesCompleteVersion,                    #filesLock,                    #filesUnlock,                    #filesDocuSign,                    #filesVersions,                    #filesMoveto,                    #filesCopyto,                    #filesRename").hide().addClass("display-none"):jq("#filesRestore").hide().addClass("display-none"),(!o||e)&&jq("#filesCompleteVersion,                    #filesRename,                    #filesLock,                    #filesUnlock").hide().addClass("display-none"),Teamlab.profile.isVisitor===!0&&jq("#filesLock,                    #filesDocuSign,                    #filesCompleteVersion").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="corporate"&&jq("#filesChangeOwner").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(t)&&jq("#filesChangeOwner,                    #filesCompleteVersion,                    #filesCopy").hide().addClass("display-none"),(!s||e)&&jq("#filesChangeOwner,                    #filesMoveto,                    #filesRemove").hide().addClass("display-none"),i.is(".without-share *, .without-share")&&jq("#filesShareAccess").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="forme"&&jq("#filesUnsubscribe").hide().addClass("display-none"),ASC.Files.UI.accessEdit()||jq("#filesCopy").hide().addClass("display-none"),jq("#filesAccessPanel li:not(.display-none)").length||jq("#filesAccess").hide().addClass("display-none"),jq("#filesVersionPanel li:not(.display-none)").length||jq("#filesVersion").hide().addClass("display-none"),jq("#filesMovePanel li:not(.display-none)").length||jq("#filesMove").hide().addClass("display-none"),jq("#actionPanelFiles").show()):(jq("#foldersOpen,                #foldersDownload,                #foldersAccess,                #foldersGetLink,                #foldersShareAccess,                #foldersChangeOwner,                #foldersUnsubscribe,                #foldersMove,                #foldersMoveto,                #foldersCopyto,                #foldersRename,                #foldersRestore,                #foldersRemove,                #foldersRemoveThirdparty,                #foldersChangeThirdparty").show().removeClass("display-none"),ASC.Files.Folders.folderContainer=="trash"?jq("#foldersOpen,                    #foldersGetLink,                    #foldersShareAccess,                    #foldersMove,                    #foldersMoveto,                    #foldersCopyto,                    #foldersRename").hide().addClass("display-none"):jq("#foldersRestore").hide().addClass("display-none"),o&&ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT||jq("#foldersRename,                    #foldersRemoveThirdparty,                    #foldersChangeThirdparty").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="corporate"&&jq("#foldersChangeOwner").hide().addClass("display-none"),s||jq("#foldersChangeOwner,                    #foldersMoveto,                    #foldersRemove,                    #foldersRemoveThirdparty,                    #foldersChangeThirdparty").hide().addClass("display-none"),i.is(".without-share *, .without-share")&&jq("#foldersShareAccess").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="forme"&&jq("#foldersUnsubscribe").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(t)?(jq("#foldersChangeOwner").hide().addClass("display-none"),ASC.Files.ThirdParty.isThirdParty()||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_SHARE?jq("#foldersRemoveThirdparty,                        #foldersChangeThirdparty").hide().addClass("display-none"):(ASC.Desktop&&jq("#foldersRemoveThirdparty,                        #foldersChangeThirdparty").hide().addClass("display-none"),t.create_by_id!=Teamlab.profile.id&&jq("#foldersChangeThirdparty").hide().addClass("display-none"),jq("#foldersRemove,                        #foldersMoveto").hide().addClass("display-none"),t.error&&jq("#foldersOpen,                            #foldersDownload,                            #foldersCopyto,                            #foldersRename").hide().addClass("display-none"))):jq("#foldersRemoveThirdparty,                    #foldersChangeThirdparty").hide().addClass("display-none"),jq("#foldersAccessPanel li:not(.display-none)").length||jq("#foldersAccess").hide().addClass("display-none"),jq("#foldersMovePanel li:not(.display-none)").length||jq("#foldersMove").hide().addClass("display-none"),jq("#actionPanelFolders").show()),ASC.Clipboard.enable||jq("#filesGetLink, #foldersGetLink").remove(),jq.showDropDownByContext(u,f,jq("#filesActionPanel")),f.is(".menu-small")&&i.addClass("row-lonely-select"),!0)},u=function(n){var t,r,u,i,f;return(ASC.Files.Actions.hideAllActionPanels(),t=jq.fixEvent(n),typeof t=="undefined"||!t)?!0:(r=jq(t.srcElement||t.target),r.is("input[type=text]"))?!0:(u=ASC.Files.UI.getObjectData(r),!u)?r.is("a[href]")?!0:!1:(i=u.entryObject,i.hasClass("new-folder")||i.hasClass("row-rename")||i.hasClass("error-entry"))?!0:(jq("#filesMainContent .row-hover").removeClass("row-hover"),jq("#filesMainContent .row-lonely-select").removeClass("row-lonely-select"),jq("#filesMainContent .menu-small").removeClass("active"),f=jq("#filesMainContent .file-row.row-selected").length,f>1&&i.hasClass("row-selected")?ASC.Files.Actions.showActionsViewPanel(n):ASC.Files.Actions.showActionsPanel(n,u),!1)},f=function(){ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink);jq(".studio-action-panel:visible").hide();jq("#filesMainContent .file-row.row-lonely-select").removeClass("row-lonely-select");jq("#filesMainContent .file-row .menu-small").removeClass("active");ASC.Files.UI.hideEntryTooltip()},e=function(n,t){var f=ASC.Files.UI.getEntryObject("file",n),i,r,e,u;if(ASC.Files.UI.lockEditFile(f,!0),i=ASC.Files.Utility.GetFileWebEditorUrl(n),t&&t.location?t.location.href=i:t=window.open(i,"_blank"),r=function(){var t=n;t&&(ASC.Files.UI.lockEditFileById(t,!0),ASC.Files.UI.checkEditing(),ASC.Files.Socket.subscribeChangeEditors(t))},t==undefined)ASC.Files.UI.lockEditFile(f,!0),ASC.Files.Socket.subscribeChangeEditors(n),ASC.Files.UI.checkEditingDefer();else{try{t.onload=r;jq.browser.msie&&(u=function(){e=t.document.getElementsByTagName("body");e[0]==null?setTimeout(u,10):r()},u())}catch(o){}try{t.onunload=function(){n&&ASC.Files.UI.checkEditing()}}catch(o){}}return ASC.Files.Marker.removeNewIcon("file",n)},o=function(n){if(ASC.Files.Folders.isCopyTo=n===!0,ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.folderContainer!="trash"&&!ASC.Files.Folders.isCopyTo&&!ASC.Files.UI.accessEdit()){var t=jq.grep(jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)"),function(n){return ASC.Files.UI.accessDelete(n)});if(!t.length){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveGroup.format(0));return}}if(ASC.Files.Tree.updateTreePath(),!n&&jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.on-edit):has(.checkbox input:checked)").length==0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveGroup.format(0));return}if(ASC.Files.ThirdParty&&!ASC.Files.Folders.isCopyTo&&!ASC.Files.ThirdParty.isThirdParty()&&jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.third-party-entry):has(.checkbox input:checked)").length==0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveGroup.format(0));return}jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").length!=0&&(jq("#treeViewPanelSelector").removeClass("without-third-party"),jq("#treeViewPanelSelector").next().is("#mainContentHeader")||jq("#treeViewPanelSelector").insertBefore("#mainContentHeader"),jq.dropdownToggle().toggle(".menuActionSelectAll","treeViewPanelSelector"),jq("#treeViewPanelSelector").scrollTo(jq("#treeViewPanelSelector").find(".tree-node"+ASC.Files.UI.getSelectorId(ASC.Files.Folders.currentFolder.id))),jq("body").bind("click",ASC.Files.Actions.registerHideTree))},s=function(n){jq(n.target?n.target:n.srcElement).parents().addBack().is("#treeViewPanelSelector, #foldersMoveto, #filesMoveto, #foldersCopyto, #filesCopyto,                 #foldersRestore, #filesRestore, #buttonMoveto, #buttonCopyto, #buttonRestore,                 #mainMove, #mainCopy, #mainRestore")||(ASC.Files.Actions.hideAllActionPanels(),jq("body").unbind("click",ASC.Files.Actions.registerHideTree))};return{init:t,showActionsViewPanel:i,showActionsPanel:r,onContextMenu:u,checkEditFile:e,hideAllActionPanels:f,clipGetLink:null,currentEntryData:null,showMoveToSelector:o,registerHideTree:s}}(),function(n){ASC.Files.Actions.init();n(function(){jq("#filesSelectAll").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.checkSelectAll(!0)});jq("#filesSelectFile, #filesSelectFolder, #filesSelectDocument,            #filesSelectPresentation, #filesSelectSpreadsheet, #filesSelectImage, #filesSelectArchive").click(function(){var n=this.id.replace("filesSelect","").toLowerCase();ASC.Files.UI.checkSelect(n)});jq("#filesDownload, #foldersDownload").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.download(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesRename, #foldersRename").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.rename(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesRemove, #foldersRemove").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.deleteItem(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesShareAccess, #foldersShareAccess").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Share.getSharedInfo(ASC.Files.Actions.currentEntryData.entryType+"_"+ASC.Files.Actions.currentEntryData.id,ASC.Files.Actions.currentEntryData.title)});jq("#filesChangeOwner, #foldersChangeOwner").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.changeOwnerDialog(ASC.Files.Actions.currentEntryData)});jq("#filesUnsubscribe, #foldersUnsubscribe").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Share.unSubscribeMe(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesConvert").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Converter.showToConvert(ASC.Files.Actions.currentEntryData.entryObject)});jq("#filesOpen").click(function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.clickOnFile(ASC.Files.Actions.currentEntryData,!1),ASC.Files.Actions.currentEntryData.entryObject.removeClass("isNewForWebEditor"),!1});jq("#filesLock, #filesUnlock").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.lockFile(ASC.Files.Actions.currentEntryData.entryObject,ASC.Files.Actions.currentEntryData.id)});jq("#filesCompleteVersion").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.versionComplete(ASC.Files.Actions.currentEntryData.id,0,!1)});jq("#filesVersions").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.showVersions(ASC.Files.Actions.currentEntryData.entryObject,ASC.Files.Actions.currentEntryData.id)});jq("#filesEdit").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.clickOnFile(ASC.Files.Actions.currentEntryData,!0)});jq("#filesCopy").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.createDuplicate(ASC.Files.Actions.currentEntryData)});jq("#foldersOpen").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.clickOnFolder(ASC.Files.Actions.currentEntryData.id)});jq("#foldersRemoveThirdparty").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.ThirdParty.showDeleteDialog(null,null,null,ASC.Files.Actions.currentEntryData.title,ASC.Files.Actions.currentEntryData)});jq("#foldersChangeThirdparty").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.ThirdParty.showChangeDialog(ASC.Files.Actions.currentEntryData)});jq("#filesMainContent").bind("contextmenu",function(n){return ASC.Files.Actions.onContextMenu(n)});jq("#filesMainContent").on("click",".menu-small",ASC.Files.Actions.showActionsPanel);jq("#studioPageContent").on("click","#buttonMoveto, #buttonCopyto, #buttonRestore,            #mainMove.unlockAction, #mainCopy.unlockAction, #mainRestore.unlockAction,            #filesMoveto, #filesRestore, #filesCopyto,            #foldersMoveto, #foldersRestore, #foldersCopyto",function(){ASC.Files.Actions.showMoveToSelector(this.id=="buttonCopyto"||this.id=="mainCopy"||this.id=="filesCopyto"||this.id=="foldersCopyto")});jq("#filesDocuSign").click(function(){return ASC.Files.ThirdParty.showDocuSignDialog(ASC.Files.Actions.currentEntryData),ASC.Files.Actions.hideAllActionPanels(),!1})})}(jQuery);
window.ASC.Files.Anchor=function(){var t=!1,n={error:new RegExp("^error(?:/(\\S+))?"),message:new RegExp("^message(?:/(\\S+))?"),preview:new RegExp("^preview(?:/|%2F)"+ASC.Files.Constants.entryIdRegExpStr),setting:new RegExp("^setting(?:=?(\\w+)?)?"),folder:new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr),help:new RegExp("^help(?:=(\\d+))?"),more:new RegExp("^more"),anyanchor:new RegExp("^(\\S+)?")},r=function(){t===!1&&(t=!0,ASC.Files.Folders&&(ASC.Controls.AnchorController.bind(n.anyanchor,u),ASC.Controls.AnchorController.bind(n.error,f),ASC.Controls.AnchorController.bind(n.message,e),ASC.Controls.AnchorController.bind(n.folder,s),ASC.Controls.AnchorController.bind(n.preview,h),ASC.Controls.AnchorController.bind(n.setting,l),ASC.Controls.AnchorController.bind(n.help,c),ASC.Controls.AnchorController.bind(n.more,o)))},u=function(t){n.error.test(t)||n.message.test(t)||n.preview.test(t)||n.setting.test(t)||n.folder.test(t)||n.help.test(t)||n.more.test(t)||ASC.Files.Anchor.defaultFolderSet()},f=function(n){ASC.Files.UI.displayInfoPanel(decodeURIComponent(n||ASC.Files.FilesJSResources.UnknownErrorText).replace(/\+/g," "),!0);jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},e=function(n){n.length&&ASC.Files.UI.displayInfoPanel(decodeURIComponent(n).replace(/\+/g," "));jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},o=function(){ASC.Files.UI.displayMoreFeaturs()},s=function(n){(jq.browser.safari||jq.browser.mozilla||jq.browser.chrome)&&(n=decodeURIComponent(n));ASC.Files.Folders.currentFolder.id=ASC.Files.Common.isCorrectId(n)?n:"";ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.updateFolderView()},h=function(n){(jq.browser.safari||jq.browser.mozilla||jq.browser.chrome)&&(n=decodeURIComponent(n));typeof ASC.Files.ImageViewer!="undefined"?ASC.Files.ImageViewer.init(n):ASC.Files.Anchor.defaultFolderSet()},c=function(n){ASC.Files.UI.displayHelp(n)},l=function(n){switch(n){case"thirdparty":if(ASC.Files.ThirdParty)ASC.Files.ThirdParty.showSettingThirdParty();else{ASC.Files.Anchor.defaultFolderSet();return}break;default:ASC.Files.UI.displayCommonSetting()}ASC.Files.CreateMenu.disableMenu()},a=function(n,t){n=ASC.Files.Common.getCorrectHash(n);t?ASC.Controls.AnchorController.safemove(n):ASC.Controls.AnchorController.move(n)},i=function(n,t){ASC.Files.Common.isCorrectId(n)||(n=ASC.Files.Folders.currentFolder.id);ASC.Files.UI.lastSelectedEntry=jq("#filesMainContent .file-row:has(.checkbox input:checked)").map(function(){var n=ASC.Files.UI.getObjectData(this);return{entryType:n.entryType,entryId:n.entryId}});ASC.Files.Anchor.move(n,t===!0)},v=function(n,t){ASC.Files.UI.resetSelectAll();ASC.Files.UI.amountPage=0;t=t===!0;ASC.Files.Common.isCorrectId(n)?(t&&ASC.Files.Folders.currentFolder.id==n||(ASC.Files.Folders.currentFolder.id=n,ASC.Files.Folders.folderContainer=""),i(null,t)):(ASC.Files.Folders.currentFolder.id="",ASC.Files.Folders.folderContainer=n,i(n,t))},y=function(){if(!ASC.Resources.Master.IsAuthenticated){location.reload(!0);return}ASC.Files.Tree&&(ASC.Files.Tree.folderIdCurrentRoot?ASC.Files.Folders.currentFolder.id!=ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Anchor.navigationSet(ASC.Files.Tree.folderIdCurrentRoot):ASC.Files.Constants.FOLDER_ID_MY_FILES?(ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_MY_FILES||ASC.Files.UI.isSettingsPanel())&&ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_MY_FILES):ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_COMMON_FILES))};return{init:r,move:a,navigationSet:v,defaultFolderSet:y}}(),function(n){n(function(){window.parent==window&&ASC.Files.Anchor.init()})}(jQuery);
window.ASC.Files.Folders=function(){var t=function(n,t){var i=ASC.Files.Filter.getFilterSettings(ASC.Files.Folders.currentFolder.id);ASC.Files.ServiceManager.getFolderItems(ASC.Files.ServiceManager.events.GetFolderItems,{folderId:ASC.Files.Folders.currentFolder.id,from:n?jq('#filesMainContent .file-row[name!="addRow"]').length:0,count:t||ASC.Files.Constants.COUNT_ON_PAGE,append:n===!0,filter:i.filter,subject:i.subject,text:i.text,orderBy:i.sorter},{orderBy:i.sorter})},i=function(n,t){var r={entry:jq(typeof n=="object"?n:[n]).map(function(n,t){return t}).toArray()},i=ASC.Files.Filter.getFilterSettings(ASC.Files.Folders.currentFolder.id);ASC.Files.ServiceManager.getItems(ASC.Files.ServiceManager.events.GetItems,{parentFolderID:t,filter:i.filter,subject:i.subject,text:i.text},{stringList:r})},r=function(n){var t=ASC.Files.UI.getEntryObject("folder",n);if(ASC.Files.Folders.folderContainer!="trash"||!jq("#filesMainContent").find(t).is(":visible")){if(n==ASC.Files.Constants.FOLDER_ID_PROJECT&&ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Tree.folderIdCurrentRoot!=ASC.Files.Constants.FOLDER_ID_PROJECT){location.href="tmdocs.aspx";return}ASC.Files.Anchor.navigationSet(n)}},u=function(n,t,i){var o=n.entryObject,r,u,f,e;return ASC.Files.Folders.folderContainer=="trash"&&jq("#filesMainContent").find(o).is(":visible")?!1:(r=n.id,u=n.title||ASC.Files.UI.getEntryTitle("file",r),i=i||n.version||0,ASC.Files.Utility.CanWebView(u))?ASC.Files.Converter.checkCanOpenEditor(r,u,i,t!=!1):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(u)?(f=ASC.Files.ImageViewer.getPreviewHash(r),ASC.Files.Anchor.move(f),!0):(e=ASC.Files.Utility.GetFileDownloadUrl(r,i),window.open(e,"_blank"),ASC.Files.Marker.removeNewIcon("file",r))},f=function(n){var t=jq(n).prop("checked");ASC.Files.ServiceManager.updateIfExist(ASC.Files.ServiceManager.events.UpdateIfExist,{value:t})},e=function(n,t,i){var r=[],f,u;if(!ASC.Files.Common.isCorrectId(t)){if(r=jq("#filesMainContent .file-row:has(.checkbox input:checked)"),r.length==0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.EmptyListSelectedForDownload,!0);return}r.length==1&&(f=ASC.Files.UI.getObjectData(r[0]),t=f.entryId,n=f.entryType)}if(n==="file"){ASC.Files.Marker.removeNewIcon(n,t);window.open(ASC.Files.Utility.GetFileDownloadUrl(t,i),"_blank");return}if(ASC.Files.Folders.bulkStatuses==!0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SecondDownload,!0);return}u=[];ASC.Files.Common.isCorrectId(t)?(u.push({Key:n+"_"+t,Value:""}),ASC.Files.Marker.removeNewIcon(n,t)):r.each(function(){var n=ASC.Files.UI.getObjectData(this);u.push({Key:n.entryType+"_"+n.entryId,Value:""});ASC.Files.Marker.removeNewIcon(n.entryType,n.entryId)});ASC.Files.Folders.bulkDownload(u)},o=function(n){ASC.Files.Folders.bulkStatuses=!0;ASC.Files.ServiceManager.download(ASC.Files.ServiceManager.events.Download,{doNow:!0},n)},n=function(){return'<div class="rename-action"><div class="button gray btn-action __apply name-aplly" title='+ASC.Files.FilesJSResources.TitleCreate+'><\/div><div class="button gray btn-action __reset name-cancel" title='+ASC.Files.FilesJSResources.TitleCancel+"><\/div><\/div>"},s=function(n,t){var i=jq(t||this).closest(".file-row");i.attr("name")?(i.remove(),jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen()):i.removeClass("row-rename").find("#promptRename, .rename-action").remove()},h=function(){var i,f,r,e,t,u;if(!ASC.Files.ImageViewer||!ASC.Files.ImageViewer.isView()){if(!ASC.Files.UI.accessEdit()||ASC.Files.UI.isSettingsPanel()){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SecurityException,!0);return}if(jq(document).scrollTop(0),i=ASC.Files.UI.getEntryObject("folder","0"),i.length==0){var o={folder:{id:"0",title:ASC.Files.FilesJSResources.TitleNewFolder,access:0,shared:!1,isnew:0}},s=ASC.Files.Common.jsonToXml(o),h=ASC.Files.TemplateManager.translateFromString(s);ASC.Files.EmptyScreen.hideEmptyScreen();f=jq("#filesMainContent");f.prepend(h);jq("#filesMainContent .new-folder").yellowFade().removeClass("new-folder");i=ASC.Files.UI.getEntryObject("folder","0");i.addClass("row-rename");r=i.find(".entry-title .name a");e=ASC.Files.Utility.getFolderCssClass();i.find(".thumb-folder").addClass(e);t=document.createElement("input");t.id="promptCreateFolder";t.type="text";t.style.display="none";document.body.appendChild(t);t=jq("#promptCreateFolder");t.attr("maxlength",ASC.Files.Constants.MAX_NAME_LENGTH);t.addClass("textEdit input-rename");t.val(ASC.Files.FilesJSResources.TitleNewFolder);t.insertAfter(r);t.show();r.hide();t.focus();jq.browser.mobile||t.select();ASC.Files.UI.checkCharacter(t);u=function(n,t){var r=jq(t||this).closest(".file-row"),i=ASC.Files.Common.replaceSpecCharacter(jq("#promptCreateFolder").val().trim()),u;(i==""||i==null)&&(i=ASC.Files.FilesJSResources.TitleNewFolder);r.find(".entry-title .name a").show().text(i);r.removeClass("row-rename");jq("#promptCreateFolder").remove();r.find(".rename-action").remove();u={parentFolderID:ASC.Files.Folders.currentFolder.id,title:i};ASC.Files.UI.blockObject(r,!0,ASC.Files.FilesJSResources.DescriptCreate);ASC.Files.ServiceManager.createFolder(ASC.Files.ServiceManager.events.CreateFolder,u)};i.append(n());i.find(".name-aplly").click(u);jq("#promptCreateFolder").bind(jq.browser.msie?"keydown":"keypress",function(n){var t,i;if(jq("#promptCreateFolder").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.cancelEnter(t,this);break;case ASC.Files.Common.keyCode.enter:u(t,this)}}})}}},c=function(){var r,i,e,o,s,u,t,f;if(!ASC.Files.ImageViewer||!ASC.Files.ImageViewer.isView()){if(!ASC.Files.UI.accessEdit()||ASC.Files.UI.isSettingsPanel()){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SecurityException,!0);return}jq(document).scrollTop(0);r=ASC.Files.UI.getEntryObject("file","0");r.remove();switch(ASC.Files.Folders.typeNewDoc){case"document":i=ASC.Files.FilesJSResources.TitleNewFileText+ASC.Files.Utility.Resource.InternalFormats.Document;break;case"spreadsheet":i=ASC.Files.FilesJSResources.TitleNewFileSpreadsheet+ASC.Files.Utility.Resource.InternalFormats.Spreadsheet;break;case"presentation":i=ASC.Files.FilesJSResources.TitleNewFilePresentation+ASC.Files.Utility.Resource.InternalFormats.Presentation;break;default:return}if(ASC.Files.Utility.CanWebEdit(i)){var h={file:{id:"0",title:i,access:0,shared:!1,version:0,version_group:0}},c=ASC.Files.Common.jsonToXml(h),l=ASC.Files.TemplateManager.translateFromString(c);ASC.Files.EmptyScreen.hideEmptyScreen();e=jq("#filesMainContent");e.prepend(l);jq("#filesMainContent .new-file").show().yellowFade().removeClass("new-file");r=ASC.Files.UI.getEntryObject("file","0");r.addClass("row-rename");o=r.find(".entry-title .name a");s=ASC.Files.Utility.getCssClassByFileTitle(i);r.find(".thumb-file").addClass(s);u=ASC.Files.Utility.GetFileExtension(i).length;i=i.substring(0,i.length-u);t=document.createElement("input");t.id="promptCreateFile";t.type="text";t.style.display="none";document.body.appendChild(t);t=jq("#promptCreateFile");t.attr("maxlength",ASC.Files.Constants.MAX_NAME_LENGTH-u);t.addClass("textEdit input-rename");t.val(i);t.insertAfter(o);t.show().focus();jq.browser.mobile||t.select();ASC.Files.UI.checkCharacter(t);f=function(n,t){var u=jq(t||this).closest(".file-row"),i=ASC.Files.Common.replaceSpecCharacter(jq("#promptCreateFile").val().trim()),e=ASC.Files.UI.getObjectTitle(u),o,s,f,h;i==""||i==null?i=e:(o=ASC.Files.Utility.GetFileExtension(e).length,i+=e.substring(e.length-o));u.removeClass("row-rename");jq("#promptCreateFile").remove();u.find(".rename-action").remove();u.find(".entry-title .name a").show().text(i);s=u.find(".entry-title .name a");ASC.Files.UI.highlightExtension(s,i);f=window.open("");try{f&&(f.document.write(ASC.Resources.Master.Resource.LoadingPleaseWait),f.document.close())}catch(c){}h={folderID:ASC.Files.Folders.currentFolder.id,fileTitle:i,winEditor:f};ASC.Files.UI.blockObject(r,!0,ASC.Files.FilesJSResources.DescriptCreate);ASC.Files.ServiceManager.createNewFile(ASC.Files.ServiceManager.events.CreateNewFile,h)};r.append(n());r.find(".name-aplly").click(f);jq("#promptCreateFile").bind(jq.browser.msie?"keydown":"keypress",function(n){var t,i;if(jq("#promptCreateFile").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.cancelEnter(t,this);break;case ASC.Files.Common.keyCode.enter:f(t,this)}}})}}},l=function(t,i){var u=ASC.Files.UI.getEntryObject(t,i),e=0,f,r,o;jq("#promptRename").length!=0&&jq("#filesMainContent .file-row.row-rename .name-cancel").click();u.find("#contentVersions").length&&ASC.Files.Folders.closeVersions();u.addClass("row-rename");ASC.Files.UI.selectRow(u,!1);ASC.Files.UI.updateMainContentHeader();f=ASC.Files.UI.getObjectTitle(u);t=="file"&&(e=ASC.Files.Utility.GetFileExtension(f).length,f=f.substring(0,f.length-e));r=document.createElement("input");r.id="promptRename";r.type="text";r.style.display="none";document.body.appendChild(r);r=jq("#promptRename");r.attr("maxlength",ASC.Files.Constants.MAX_NAME_LENGTH-e);r.addClass("textEdit input-rename");r.val(f);r.insertAfter(u.find(".entry-title .name a"));r.show().focus();jq.browser.mobile||r.select();ASC.Files.UI.checkCharacter(r);o=function(){var r=ASC.Files.UI.getObjectData(jq("#promptRename")),t=r.entryObject,u=r.entryType,f=r.entryId,i=ASC.Files.UI.getObjectTitle(t),n=ASC.Files.Common.replaceSpecCharacter(jq("#promptRename").val().trim()),e,o;n!=""&&n!=null&&(t.removeClass("row-rename"),t.find(".rename-action").remove(),jq("#promptRename").remove(),u=="file"&&(e=ASC.Files.Utility.GetFileExtension(i).length,n+=i.substring(i.length-e)),n!=i&&(t.find(".entry-title .name a").show().text(n),u=="file"&&(o=t.find(".entry-title .name a"),ASC.Files.UI.highlightExtension(o,n)),ASC.Files.UI.blockObject(t,!0,ASC.Files.FilesJSResources.DescriptRename),u=="file"?ASC.Files.ServiceManager.renameFile(ASC.Files.ServiceManager.events.FileRename,{fileId:f,name:i,newname:n,show:!0}):ASC.Files.ServiceManager.renameFolder(ASC.Files.ServiceManager.events.FolderRename,{parentFolderID:ASC.Files.Folders.currentFolder.id,folderId:f,name:i,newname:n})))};u.append(n());u.find(".name-aplly").click(o);u.removeClass("row-selected");jq("#promptRename").bind(jq.browser.msie?"keydown":"keypress",function(n){var t,i;if(jq("#promptRename").length!==0&&(t||(t=n),i=t.keyCode||t.which,(i==ASC.Files.Common.keyCode.esc||i==ASC.Files.Common.keyCode.enter)&&jq("#promptRename").length!=0))switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.cancelEnter(t,this);break;case ASC.Files.Common.keyCode.enter:o()}})},a=function(n,t){if(ASC.Files.Folders.folderContainer!="trash"&&(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),!ASC.Files.UI.lockedForMe(n)||ASC.Files.Constants.ADMIN)){var i=n.hasClass("file-locked");n.toggleClass("file-locked",!i);t=t||ASC.Files.UI.getObjectData(n).entryId;ASC.Files.ServiceManager.lockFile(ASC.Files.ServiceManager.events.LockFile,{fileId:t,lock:!i,fileObj:n})}},v=function(n,t){if(ASC.Files.Folders.folderContainer!="trash"&&(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),!n.hasClass("folder-row"))){if(jq("#contentVersions:visible").length!=0){var i=n.find("#contentVersions").length!=0;if(ASC.Files.Folders.closeVersions(),i)return}ASC.Files.UI.blockObject(n,!0,ASC.Files.FilesJSResources.DescriptLoadVersion);t=t||ASC.Files.UI.getObjectData(n).entryId;ASC.Files.ServiceManager.getFileHistory(ASC.Files.ServiceManager.events.GetFileHistory,{fileId:t})}},y=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#contentVersions .version-row[data-version-group='"+n+"']:not(.version-group-head)").toggle()},p=function(n,t){jq(".version-operation").css("visibility","hidden");ASC.Files.UI.blockObjectById("file",n,!0,ASC.Files.FilesJSResources.DescriptSetVersion);ASC.Files.ServiceManager.setCurrentVersion(ASC.Files.ServiceManager.events.SetCurrentVersion,{fileId:n,version:t})},w=function(n,t,i){return ASC.Files.Actions.hideAllActionPanels(),jq(".version-operation").css("visibility","hidden"),ASC.Files.UI.blockObjectById("file",n,!0,ASC.Files.FilesJSResources.DescriptCompleteVersion),ASC.Files.ServiceManager.completeVersion(ASC.Files.ServiceManager.events.CompleteVersion,{fileId:n,version:t,continueVersion:i}),!1},b=function(){var r,t,f;if(ASC.Files.Actions.hideAllActionPanels(),r=jq(this).closest(".file-row"),!ASC.Files.UI.accessEdit(null,r)||ASC.Files.UI.editingFile(r)||ASC.Files.UI.lockedForMe(r))return!0;var e=jq(this).closest(".version-row"),i=e.find(".version-comment"),u=i.attr("data-comment");ASC.Files.Folders.eraseComment();i.empty();e.addClass("version-row-comment");i.attr("colspan",4);t=document.createElement("input");t.id="promptVersionComment";t.type="text";t.style.display="none";document.body.appendChild(t);t=jq("#promptVersionComment");t.attr("maxlength",255);t.attr("placeholder",ASC.Files.FilesJSResources.EnterComment);t.addClass("textEdit input-rename");t.val(u);i.append(t);t.show();t.focus();jq.browser.mobile||t.select();f=function(){var n=jq("#promptVersionComment");i=n.closest(".version-comment");u=i.attr("data-comment");var r=ASC.Files.UI.getObjectData(i).id,f=i.closest(".version-row").attr("data-version"),t=n.val().trim();t!=u&&ASC.Files.ServiceManager.updateComment(ASC.Files.ServiceManager.events.UpdateComment,{fileId:r,version:f,comment:t});ASC.Files.Folders.eraseComment()};i.append(n());i.find(".name-aplly").click(f);jq("#promptVersionComment").bind(jq.browser.msie?"keydown":"keypress",function(n){var t,i;if(jq("#promptVersionComment").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.eraseComment();break;case ASC.Files.Common.keyCode.enter:f()}}});jq(document).on("click.Comment",function(n){n=jq.fixEvent(n);jq(n.target||n.srcElement).is(".version-comment:has(#promptVersionComment) *")||(ASC.Files.Folders.eraseComment(),jq(document).off("click.Comment"))});return!1},k=function(){var n=jq(".version-row-comment .version-comment").attr("data-comment");jq(".version-row-comment .version-comment").html('<div class="version-comment-fix">'+Encoder.htmlEncode(n)+"<\/div>").removeAttr("colspan");jq(".version-row-comment").removeClass("version-row-comment")},d=function(){jq("#contentVersions").remove();jq(".file-row-fix").removeClass("file-row-fix")},g=function(n,t){ASC.Files.Actions.hideAllActionPanels();ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.ReplaceVersion,{fileId:n,show:t,isStringXml:!1})},nt=function(n,t,i,r,u){var e=ASC.Files.UI.getEntryTitle("folder",t)||(ASC.Files.Tree?ASC.Files.Tree.getFolderTitle(t):""),o,s,f;if(u.length>1){for(s="",f=0;f<u.length;f++)s+='<li title="{0}">{0}<\/li>'.format(u[f].Value);jq("#overwriteList").html(s);jq("#overwriteListShow").show();o=ASC.Files.FilesJSResources.FilesAlreadyExist.format(u.length,'<b title="'+e+'">'+e+"<\/b>")}else jq("#overwriteListShow").hide(),o=ASC.Files.FilesJSResources.FileAlreadyExist.format('<span title="'+u[0].Value+'">'+u[0].Value+"<\/span>",'<b title="'+e+'">'+e+"<\/b>");jq("#overwriteList, #overwriteListHide").hide();jq("#overwriteMessage").html(o);jq("#buttonConfirmResolve").unbind("click").click(function(){var e=jq(".overwrite-resolve input:checked").val(),i;if(e==ASC.Files.Constants.ConflictResolveType.Skip){for(f=0;f<u.length;f++)ASC.Files.UI.blockObjectById("file",u[f].Key,!1,null,!0),i=jq.inArray("file_"+u[f].Key,n.entry),i!=-1&&n.entry.splice(i,1);ASC.Files.UI.updateMainContentHeader()}PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:t,resolve:e,isCopyOperation:r==!0,doNow:!0},{stringList:n})});jq("#buttonCancelOverwrite").unbind("click").click(function(){for(f=0;f<n.entry.length;f++){var t=ASC.Files.UI.parseItemId(n.entry[f]);ASC.Files.UI.blockObjectById(t.entryType,t.entryId,!1,null,!0)}ASC.Files.UI.updateMainContentHeader();PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog()});ASC.Files.UI.blockUI("#confirmOverwriteFiles",465,550);PopupKeyUpActionProvider.EnterAction='jq("#buttonConfirmResolve").click();';PopupKeyUpActionProvider.CloseDialogAction='jq("#buttonCancelOverwrite").click();'},tt=function(n,t,i,r){var f;if(ASC.Files.Actions.hideAllActionPanels(),n===ASC.Files.Folders.currentFolder.entryId){ASC.Files.Folders.isCopyTo=!1;return}if(f=typeof ASC.Files.ThirdParty!="undefined",!r&&!ASC.Files.Folders.isCopyTo&&f&&ASC.Files.ThirdParty.isThirdParty()&&ASC.Files.ThirdParty.isDifferentThirdParty(n,ASC.Files.Folders.currentFolder.entryId)){ASC.Files.ThirdParty.showMoveThirdPartyMessage(n,t,i);return}var o=f&&(ASC.Files.Folders.isCopyTo==!0||ASC.Files.ThirdParty.isThirdParty()),e=!1,u={};u.entry=[];jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var n=ASC.Files.UI.getObjectData(this),r=n.entryType,t=n.entryObject,s=n.entryId;ASC.Files.Folders.isCopyTo!=!0&&(ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t))||(ASC.Files.Folders.isCopyTo!=!1||ASC.Files.UI.accessDelete(t)?r=="folder"&&jq.inArray(s,i)!=-1?ASC.Files.UI.displayInfoPanel(ASC.Files.Folders.isCopyTo==!0?ASC.Files.FilesJSResources.InfoFolderCopyError:ASC.Files.FilesJSResources.InfoFolderMoveError,!0):!o&&f&&ASC.Files.ThirdParty.isThirdParty(n)||(ASC.Files.UI.blockObject(t,!0,ASC.Files.Folders.isCopyTo==!0?ASC.Files.FilesJSResources.DescriptCopy:ASC.Files.FilesJSResources.DescriptMove,!0),u.entry.push(r+"_"+s)):e=!0)});e&&ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveAccessError,!0);ASC.Files.UI.updateMainContentHeader();u.entry&&u.entry.length!=0&&ASC.Files.ServiceManager.moveFilesCheck(ASC.Files.ServiceManager.events.MoveFilesCheck,{folderToTitle:t,folderToId:n,list:u,isCopyOperation:ASC.Files.Folders.isCopyTo==!0},{stringList:u});ASC.Files.Folders.isCopyTo=!1},it=function(n){var t={};t.entry=[];jq(n).each(function(n,i){t.entry.push(i.entryType+"_"+i.id)});ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:ASC.Files.Folders.currentFolder.entryId,resolve:2,isCopyOperation:!0,doNow:!0},{stringList:t})},rt=function(){jq("#pageNavigatorHolder:visible").length!=0&&jq("#pageNavigatorHolder a").text()!=ASC.Files.FilesJSResources.ButtonShowMoreLoad&&(jq("#pageNavigatorHolder a").text(ASC.Files.FilesJSResources.ButtonShowMoreLoad),ASC.Files.Folders.getFolderItems(!0))},ut=function(n){jq("#ownerSelector .change-owner-selector").text(n.create_by);jq("#ownerSelector").attr("data-id",n.create_by_id).useradvancedSelector("reset").useradvancedSelector("disable",[n.create_by_id]);jq("#changeOwnerTitle").text(n.title);jq("#buttonSaveChangeOwner").addClass("disable");jq("#changeOwner").off("click").on("click","#buttonSaveChangeOwner:not(.disable)",function(){var t=jq("#ownerSelector").attr("data-id");PopupKeyUpActionProvider.CloseDialog();ASC.Files.Folders.changeOwner([n.entryType+"_"+n.entryId],t)});PopupKeyUpActionProvider.EnterAction='jq("#buttonSaveChangeOwner").click();';ASC.Files.UI.blockUI("#changeOwner",420,0,-150)},ft=function(n,t){var i={entry:n};ASC.Files.ServiceManager.changeOwner(ASC.Files.ServiceManager.events.ChangeOwner,{list:n,userId:t,parentFolderID:ASC.Files.Folders.currentFolder.id},{stringList:i})},et=function(){ASC.Files.Folders.folderContainer=="trash"&&(ASC.Files.Actions.hideAllActionPanels(),ASC.Files.UI.checkSelectAll(!0),jq("#confirmRemoveText").html(ASC.Files.FilesJSResources.ConfirmEmptyTrash),jq("#confirmRemoveList").hide(),jq("#confirmRemoveTextDescription").show(),jq("#removeConfirmBtn").unbind("click").click(function(){PopupKeyUpActionProvider.CloseDialog();ASC.Files.ServiceManager.emptyTrash(ASC.Files.ServiceManager.events.EmptyTrash,{doNow:!0})}),ASC.Files.UI.blockUI("#confirmRemove",420,0,-150),PopupKeyUpActionProvider.EnterAction='jq("#removeConfirmBtn").click();')},ot=function(n,t){var e,i,u,r,h,c,f,l;if(ASC.Files.Actions.hideAllActionPanels(),e=ASC.Files.FilesJSResources.ConfirmRemoveList,i=[],n&&t){if(u=ASC.Files.UI.getEntryObject(n,t),!ASC.Files.UI.accessDelete(u)||ASC.Files.UI.editingFile(u)||ASC.Files.UI.lockedForMe(u))return;i.push({entryType:n,entryId:t})}else jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var n=ASC.Files.UI.getObjectData(this),t=n.entryObject,r=n.entryType,u=n.entryId;if(ASC.Files.ThirdParty&&!ASC.Files.ThirdParty.isThirdParty()&&ASC.Files.ThirdParty.isThirdParty(n))return!0;!ASC.Files.UI.accessDelete(t)||ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t)||i.push({entryType:r,entryId:u})});if(i.length!=0){i.length==1&&(e=i[0].entryType=="file"?ASC.Files.FilesJSResources.ConfirmRemoveFile:ASC.Files.FilesJSResources.ConfirmRemoveFolder);var o="",s="",a='<label title="{0}"><input type="checkbox" class="checkbox" entryType="{1}" entryId="{2}" checked="checked">{0}<\/label>';for(r=0;r<i.length;r++)h=ASC.Files.UI.getEntryTitle(i[r].entryType,i[r].entryId),i[r].entryType=="file"?s+=a.format(h,i[r].entryType,i[r].entryId):o+=a.format(h,i[r].entryType,i[r].entryId);jq("#confirmRemoveText").html(e);jq("#confirmRemoveList dd.confirm-remove-files").html(s);jq("#confirmRemoveList dd.confirm-remove-folders").html(o);jq("#confirmRemoveList .confirm-remove-folders, #confirmRemoveList .confirm-remove-files").show();o==""&&jq("#confirmRemoveList .confirm-remove-folders").hide();s==""&&jq("#confirmRemoveList .confirm-remove-files").hide();c=function(){jq("#confirmRemoveList .confirm-remove-folders-count").text(jq("#confirmRemoveList dd.confirm-remove-folders :checked").length);jq("#confirmRemoveList .confirm-remove-files-count").text(jq("#confirmRemoveList dd.confirm-remove-files :checked").length)};c();jq("#confirmRemoveList dd [type='checkbox']").change(c);f=jq("#cbxDeleteConfirm").prop("checked")==!0;ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()?(f=!0,jq("#confirmRemoveSharpBoxTextDescription").show()):jq("#confirmRemoveSharpBoxTextDescription").hide();ASC.Files.Folders.folderContainer=="trash"?(f=!0,jq("#confirmRemoveTextDescription").show()):jq("#confirmRemoveTextDescription").hide();l=function(){PopupKeyUpActionProvider.CloseDialog();var n={},t=jq("#confirmRemoveList input:checked");t.length!=0&&(n.entry=jq(t).map(function(n,t){var i=jq(t).attr("entryType"),r=jq(t).attr("entryId"),u=ASC.Files.UI.getEntryObject(i,r);return ASC.Files.UI.blockObject(u,!0,ASC.Files.FilesJSResources.DescriptRemove,!0),i+"_"+r}).toArray(),ASC.Files.UI.updateMainContentHeader(),ASC.Files.ServiceManager.deleteItem(ASC.Files.ServiceManager.events.DeleteItem,{list:n.entry,doNow:!0},{stringList:n}))};f?(jq("#removeConfirmBtn").unbind("click").click(l),ASC.Files.UI.blockUI("#confirmRemove",420,0,-150),PopupKeyUpActionProvider.EnterAction='jq("#removeConfirmBtn").click();'):l()}},st=function(){ASC.Files.Folders.bulkStatuses=!1;ASC.Files.UI.setProgressValue("#tasksProgress",0);jq("#tasksProgress .asc-progress-percent").text("0%");jq("#tasksProgress .progress-dialog-header span").text("");jq("#tasksProgress").hide()},ht=function(){clearTimeout(ASC.Files.Folders.tasksTimeout);ASC.Files.ServiceManager.terminateTasks(ASC.Files.ServiceManager.events.TerminateTasks,{isTerminate:!0,doNow:!0})},ct=function(n){clearTimeout(ASC.Files.Folders.tasksTimeout);ASC.Files.Folders.tasksTimeout=setTimeout(function(){ASC.Files.ServiceManager.getTasksStatuses(ASC.Files.ServiceManager.events.GetTasksStatuses,{doNow:!1})},ASC.Files.Constants.REQUEST_STATUS_DELAY/(n===!0?8:1))};return{eventAfter:null,currentFolder:{},folderContainer:"",isCopyTo:!1,cancelEnter:s,createFolder:h,replaceVersion:g,lockFile:a,showVersions:v,closeVersions:d,toggleVersionSublist:y,makeCurrentVersion:p,enterComment:b,eraseComment:k,versionComplete:w,showOverwriteMessage:nt,curItemFolderMoveTo:tt,createDuplicate:it,changeOwnerDialog:ut,changeOwner:ft,rename:l,deleteItem:ot,emptyTrash:et,getFolderItems:t,getItems:i,clickOnFolder:r,clickOnFile:u,updateIfExist:f,showMore:rt,createNewDoc:c,typeNewDoc:"",download:e,bulkDownload:o,getTasksStatuses:ct,cancelTasksStatuses:st,terminateTasks:ht,tasksTimeout:null,bulkStatuses:!1,isFirstLoad:!0}}(),function(n){n(function(){jq("#pageNavigatorHolder a").click(function(){return ASC.Files.Folders.showMore(),!1});jq("#topNewFolder a").click(function(){ASC.Files.Folders.createFolder()});jq("#buttonDelete, #mainDelete").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.deleteItem()});jq("#buttonEmptyTrash, #mainEmptyTrash").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.emptyTrash()});jq("#studioPageContent").on("click","#buttonDownload, #mainDownload.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.download()});jq("#filesSelectAllCheck").click(function(n){n.stopPropagation();ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.checkSelectAll(jq("#filesSelectAllCheck:not(.indeterminate)").prop("checked")==!0);jq(this).blur()});jq("#filesMainContent").on("click",".file-lock",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.lockFile(this),!1});jq("#filesMainContent").on("click",".version",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.showVersions(this),!1});jq("#filesMainContent").on("click",".version-close",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.closeVersions(),!1});jq("#filesMainContent").on("click",".folder-row:not(.error-entry) .entry-title .name a, .folder-row:not(.error-entry) .thumb-folder",function(n){if(ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.folderContainer=="trash")return ASC.Files.UI.clickRow(n,jq(this).closest(".file-row")),!1;var t=ASC.Files.UI.getObjectData(this).id;return t!=0&&ASC.Files.Folders.clickOnFolder(t),!1});jq(".to-parent-folder, .empty-folder-toparent").on("click",function(){var n=jq(this).attr("data-id");return ASC.Files.Folders.clickOnFolder(n),!1});jq("#filesMainContent").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(n){var t,i;return(ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.folderContainer=="trash")?(ASC.Files.UI.clickRow(n,jq(this).closest(".file-row")),!1):(t=ASC.Files.UI.getObjectData(this),t.id!=0&&(i=t.entryObject,ASC.Files.Folders.clickOnFile(t),i.removeClass("isNewForWebEditor")),!1)});jq("#filesMainContent").on("mouseup",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(n){var t,i,r;return n.which==2&&(t=ASC.Files.UI.getObjectData(this),t.id!=0&&(i=t.title||ASC.Files.UI.getEntryTitle("file",t.id),!ASC.Files.Utility.MustConvert(i)&&(ASC.Files.Utility.CanWebView(i)||ASC.Files.Utility.CanWebEdit(i))&&(r=t.entryObject,ASC.Files.UI.lockEditFile(r,!0),ASC.Files.Socket.subscribeChangeEditors(t.id),ASC.Files.UI.checkEditingDefer(),ASC.Files.Actions.hideAllActionPanels(),r.removeClass("isNewForWebEditor")))),!0});jq("#filesMainContent").on("click","#contentVersions",function(){return!1});jq("#filesMainContent").on("click",".version-comment:not(:has(input)):not(:has(.version-comment-fix:empty)), .version-comment-edit",ASC.Files.Folders.enterComment);jq("#filesMainContent").on("click",".version-complete, .version-continue",function(){var n=ASC.Files.UI.getObjectData(this).id,t=jq(this).closest(".version-row").attr("data-version"),i=jq(this).hasClass("version-continue");ASC.Files.Folders.versionComplete(n,t,i)});jq("#filesMainContent").on("click",".version-group-head .version-sublist-toggle",function(){var n=jq(this).closest(".version-row").attr("data-version-group");return ASC.Files.Folders.toggleVersionSublist(n),!1});jq("#filesMainContent").on("click",".version-preview",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this),t=jq(this).closest(".version-row").attr("data-version");return ASC.Files.Folders.clickOnFile(n,!1,t),!1});jq("#filesMainContent").on("click",".version-download",function(){var n=ASC.Files.UI.getObjectData(this).id,t=jq(this).closest(".version-row").attr("data-version");return ASC.Files.Folders.download("file",n,t),!1});jq("#filesMainContent").on("click",".version-restore span",function(){var n=ASC.Files.UI.getObjectData(this).id,t=jq(this).closest(".version-row").attr("data-version");return ASC.Files.Folders.makeCurrentVersion(n,t),!1});jq("#filesMainContent").on("click",".version-comment .name-cancel",ASC.Files.Folders.eraseComment);jq("#filesMainContent").on("click",".file-row > .rename-action > .name-cancel",ASC.Files.Folders.cancelEnter);jq(".overwrite-resolve").on("click","input",function(){jq(".overwrite-resolve.selected").removeClass("selected");jq(this).closest(".overwrite-resolve").addClass("selected")});jq("#overwriteListShow").click(function(){jq("#overwriteList, #overwriteListHide").show();jq("#overwriteListShow").hide()});jq("#overwriteListHide").click(function(){jq("#overwriteListShow").show();jq("#overwriteList, #overwriteListHide").hide()});jq("#cbxDeleteConfirm").on("change",function(){var n=jq(this).prop("checked")==!0;return ASC.Files.ServiceManager.changeDeleteConfrim(ASC.Files.ServiceManager.events.ChangeDeleteConfrim,{value:n===!0}),!1});jq("#ownerSelector").useradvancedSelector({inPopup:!0,itemsChoose:[],canadd:!1,showGroups:!0,onechosen:!0,withGuests:!1}).on("showList",function(n,t){jq(this).attr("data-id",t.id).find(".change-owner-selector").html(t.title);jq("#buttonSaveChangeOwner").removeClass("disable")});jq(".update-if-exist").change(function(){ASC.Files.Folders.updateIfExist(this)});typeof ASC.Files.Share=="undefined"&&jq("#files_shareaccess_folders, #filesShareAccess,                #filesUnsubscribe, #foldersUnsubscribe").remove();jq(window).scroll(function(){return ASC.Files.UI.stickContentHeader(),jq(document).height()-jq(window).height()<=jq(window).scrollTop()+350&&ASC.Files.Folders.showMore(),!0});ASC.Files.Folders.eventAfter=function(){ASC.Files.Folders.isFirstLoad?(ASC.Files.Folders.isFirstLoad=!1,jq("#emptyContainer").is(":visible")||jq(".advansed-filter").advansedFilter("resize")):LoadingBanner.hideLoading()};ASC.Files.Folders.isFirstLoad||LoadingBanner.displayLoading();jq.browser.msie&&setInterval(function(){ASC.Files.UI.setDocumentTitle(ASC.Files.Folders.currentFolder.title)},200)})}(jQuery);
window.ASC.Files.EventHandler=function(){var r=!1,t=null,f=function(){r===!1&&(r=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.EventHandler.onGetFolderItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetItems,ASC.Files.EventHandler.onGetItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CheckEditing,ASC.Files.EventHandler.onCheckEditing),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.LockFile,ASC.Files.EventHandler.onLockFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateIfExist,ASC.Files.EventHandler.onUpdateIfExist),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.EventHandler.onGetHelpCenter),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateFolder,ASC.Files.EventHandler.onCreateFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateNewFile,ASC.Files.EventHandler.onCreateNewFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FolderRename,ASC.Files.EventHandler.onRenameFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FileRename,ASC.Files.EventHandler.onRenameFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeOwner,ASC.Files.EventHandler.onChangeOwner),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.EventHandler.onGetFileHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetCurrentVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CompleteVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ReplaceVersion,ASC.Files.EventHandler.onGetFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateComment,ASC.Files.EventHandler.onUpdateComment),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveFilesCheck,ASC.Files.EventHandler.onMoveFilesCheck),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveItems,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.DeleteItem,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.EmptyTrash,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.Download,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.TerminateTasks,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTasksStatuses,ASC.Files.EventHandler.onGetTasksStatuses))},e=function(t,i,r){var u,f;if(typeof r!="undefined"||typeof t=="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);ASC.Files.Tree&&ASC.Files.Tree.resetFolder(ASC.Files.Tree.getParentId(i.folderId));ASC.Files.Anchor.defaultFolderSet();return}if(!o(t.getElementsByTagName("folder_info")[0])){ASC.Files.Anchor.defaultFolderSet();return}if(!s(t.getElementsByTagName("path_parts")[0])){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.Marker&&ASC.Files.Marker.markRootAsNew(t.getElementsByTagName("root_folders_id_marked_as_new")[0]);u=t.getElementsByTagName("total")[0];ASC.Files.UI.countTotal=parseInt(u.text||u.textContent)||0;i.append||jq("#filesMainContent").empty();f=ASC.Files.TemplateManager.translate(t);n(f);jq(ASC.Files.UI.lastSelectedEntry).each(function(){var n=ASC.Files.UI.getEntryObject(this.entryType,this.entryId);ASC.Files.UI.selectRow(n,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null;ASC.Files.Folders.eventAfter!=null&&typeof ASC.Files.Folders.eventAfter=="function"&&(ASC.Files.Folders.eventAfter(),ASC.Files.Folders.eventAfter=null);ASC.Files.CreateMenu&&ASC.Files.CreateMenu.disableMenu(ASC.Files.UI.accessEdit());ASC.Files.UI.stickContentHeader()},n=function(n,t){var f,i,r,u,e,o;return ASC.Files.UI.resetSelectAll(),ASC.Files.EmptyScreen.hideEmptyScreen(),n==""?t||ASC.Files.EmptyScreen.displayEmptyScreen():(t?t.length?(f=t.hasClass("row-selected")||t.attr("data-selected")=="true",t.after(n),i=t.next(),t.remove()):(jq("#filesMainContent").prepend(n),i=jq('#filesMainContent .file-row[name="addRow"]')):(jq("#filesMainContent").append(n),i=jq("#filesMainContent .file-row:gt(-"+(ASC.Files.Constants.COUNT_ON_PAGE+1)+")")),jq('#filesMainContent .file-row[name="addRow"]').each(function(){var n=ASC.Files.UI.getObjectData(this),t=ASC.Files.UI.getEntryObject(n.entryType,n.id);t.filter('[name!="addRow"]').remove()}),r=parseInt(ASC.Files.Constants.COUNT_ON_PAGE)||0,ASC.Files.UI.amountPage=parseInt((ASC.Files.UI.countTotal/r).toFixed(0)),ASC.Files.UI.amountPage-ASC.Files.UI.countTotal/r<0&&ASC.Files.UI.amountPage++,ASC.Files.UI.currentPage=parseInt((jq('#filesMainContent .file-row[name!="addRow"]').length-1)/r)+1,u=ASC.Files.UI.countTotal-jq("#filesMainContent .file-row").length,ASC.Files.UI.currentPage<ASC.Files.UI.amountPage&&u>0?(jq("#pageNavigatorHolder").show(),ASC.Files.FilesJSResources&&jq("#pageNavigatorHolder a").text(r<u?ASC.Files.FilesJSResources.ButtonShowMoreOf.format(r,u):ASC.Files.FilesJSResources.ButtonShowMore.format(u))):jq("#pageNavigatorHolder").hide(),ASC.Files.Mouse&&ASC.Files.Mouse.collectEntryItems(),ASC.Files.UI.addRowHandlers(i),f&&(ASC.Files.UI.selectRow(i,f),ASC.Files.UI.updateMainContentHeader()),e=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),e.length>0&&(o=jq(e).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray(),ASC.Files.Socket.subscribeChangeEditors(o)),ASC.Files.UI.checkEditingDefer()),i&&i.attr("name",""),i},o=function(n){var t,i;if(typeof n=="undefined"||n==null)return!1;if(!ASC.Files.Folders)return!0;ASC.Files.Folders.currentFolder={};t=jq(n.childNodes);for(i in t)i&&typeof t[i]=="object"&&(ASC.Files.Folders.currentFolder[t[i].tagName]=t[i].textContent||t[i].text||"");if(ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))ASC.Files.Folders.currentFolder.entryId=ASC.Files.Folders.currentFolder.id;else return!1;if(ASC.Files.Folders.currentFolder.entryType="folder",ASC.Files.Share){if(ASC.Files.Folders.currentFolder.access=parseInt(ASC.Files.Folders.currentFolder.access||ASC.Files.Constants.AceStatusEnum.None),ASC.Files.Folders.currentFolder.access==ASC.Files.Constants.AceStatusEnum.Restrict)return ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.AceStatusEnum_Restrict,!0),!1;ASC.Files.Folders.currentFolder.shareable=ASC.Files.Folders.currentFolder.shareable==="true"}return ASC.Files.Tree&&ASC.Files.Folders.currentFolder.id==ASC.Files.Tree.folderIdCurrentRoot&&(ASC.Files.Folders.currentFolder.title=ASC.Files.FilesJSResources.ProjectFiles),ASC.Files.UI.setDocumentTitle(ASC.Files.Folders.currentFolder.title),!0},s=function(n){var t,i;if(typeof n=="undefined"||n==null||(t=jq(n.childNodes).map(function(n,t){var i=t.childNodes[0];return i.textContent||i.text}),t.length==0))return!1;i=parseInt(t[0]);ASC.Files.Tree&&(ASC.Files.Tree.pathParts=t);jq("#mainContentHeader .menuAction").removeClass("unlockAction").hide();jq("#filesMainContent").removeClass("myFiles").removeClass("corporateFiles").removeClass("shareformeFiles").removeClass("trashFiles").removeClass("projectFiles");switch(i){case ASC.Files.Constants.FOLDER_ID_MY_FILES:ASC.Files.Folders.folderContainer="my";jq("#filesMainContent").addClass("myFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_SHARE:ASC.Files.Folders.folderContainer="forme";jq("#filesMainContent").addClass("shareformeFiles");jq("#mainDownload, #mainCopy, #mainMarkRead, #mainUnsubscribe, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_COMMON_FILES:ASC.Files.Folders.folderContainer="corporate";jq("#filesMainContent").addClass("corporateFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_PROJECT:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_TRASH:ASC.Files.Folders.folderContainer="trash";jq("#filesMainContent").addClass("trashFiles");jq("#mainDownload, #mainRestore, #mainDelete, #mainEmptyTrash, #mainConvert").show();jq("#mainEmptyTrash").addClass("unlockAction");break;case ASC.Files.Tree.folderIdCurrentRoot:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;default:if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))return!1}return ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable&&!ASC.Resources.Master.Personal&&jq("#mainShare").show(),ASC.Files.Filter&&ASC.Files.Filter.disableFilter(),jq("#filesMainContent").toggleClass("without-share",!(ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable)),ASC.Files.Tree&&ASC.Files.Tree.updateTreePath(),ASC.Files.UI.checkButtonBack(".to-parent-folder",".folder-row-toparent"),!0},h=function(t,i,r){var e,u,o,f,s;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(ASC.Files.Folders.currentFolder.id==i.parentFolderID){for(i.lonelyType&&(t.__type=i.lonelyType,t=[t]),e="",u=0;u<t.length;u++)o=ASC.Files.Common.jsonToXml(t[u].__type.toLowerCase().indexOf("folder")==-1?{file:t[u]}:{folder:t[u]}),e+=ASC.Files.TemplateManager.translateFromString(o);f=n(e,{});f&&(s=f.hasClass("new-folder"),f.removeClass("new-file new-folder").show().yellowFade(),ASC.Files.Tree&&s&&ASC.Files.Tree.resetFolder(i.parentFolderID))}},c=function(t,i,r){var u=ASC.Files.UI.getEntryObject("file","0"),f,o,e;if(ASC.Files.UI.blockObject(u),f=i.winEditor,typeof r!="undefined"){u.remove();f.close();jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}if(ASC.Files.Folders.currentFolder.id==i.folderID){o=ASC.Files.TemplateManager.translate(t);e=n(o,u);e.show().yellowFade().removeClass("new-file");var s=ASC.Files.UI.getObjectData(e),h=s.title,c=s.entryId;ASC.Files.Actions.checkEditFile(c,f)}else h=i.fileTitle;ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFile.format(h))},l=function(t,i,r){var e=ASC.Files.UI.getEntryObject("folder","0"),o,u,f;if(typeof r!="undefined"){e.remove();jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}ASC.Files.Folders.currentFolder.id==i.parentFolderID?(o=ASC.Files.TemplateManager.translate(t),u=n(o,e),u.yellowFade().removeClass("new-folder"),f=ASC.Files.UI.getObjectData(u).title):f=i.title;ASC.Files.Tree&&ASC.Files.Tree.resetFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFolder.format(f));trackingGoogleAnalitics("documents","create","folder")},a=function(t,i,r){var f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var e=ASC.Files.TemplateManager.translate(t),o=i.folderId,u=ASC.Files.UI.getEntryObject("folder",o);u=n(e,u);u.yellowFade().removeClass("new-folder");ASC.Files.UI.selectRow(u,!0);ASC.Files.UI.updateMainContentHeader();f=ASC.Files.UI.getObjectData(u).title;ASC.Files.Tree&&ASC.Files.Tree.resetFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRenameFolder.format(i.name,f))},v=function(n,t,i){var r,u;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}r=ASC.Files.EventHandler.onGetFile(n,t,i);ASC.Files.UI.selectRow(r.entryObject,!0);ASC.Files.UI.updateMainContentHeader();u=r.title;ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRenameFile.format(t.name,u))},y=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var u,f;jq(i.list).each(function(e,o){var h=ASC.Files.UI.parseItemId(o),l,v,c;if(jq(t).each(function(n,t){return t.id==h.entryId?(l=t,!1):!0}),h.entryType=="folder"){var a=ASC.Files.Common.jsonToXml({folder:l}),y=ASC.Files.TemplateManager.translateFromString(a),p=h.entryId,s=ASC.Files.UI.getEntryObject("folder",p);s=n(y,s);s.yellowFade().removeClass("new-folder");ASC.Files.UI.selectRow(s,!0);ASC.Files.UI.updateMainContentHeader();ASC.Files.Tree&&ASC.Files.Tree.resetFolder(i.parentFolderID);v=ASC.Files.UI.getObjectData(s);u=v.create_by;f=v.title}else a=ASC.Files.Common.jsonToXml({file:l}),c=ASC.Files.EventHandler.onGetFile(a,{fileId:h.entryId,isStringXml:!0,show:!0},r),ASC.Files.UI.selectRow(c.entryObject,!0),ASC.Files.UI.updateMainContentHeader(),u=c.create_by,f=c.title});i.list.length>1?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoChangeOwnerArray.format(Encoder.htmlEncode(u),i.list.length)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoChangeOwner.format(Encoder.htmlEncode(u),f))},p=function(n,t,i){var f=t.fileId,e=ASC.Files.UI.getEntryObject("file",f),r,u;if(typeof i!="undefined"){ASC.Files.UI.blockObject(e);jq(".version-operation").css("visibility","");ASC.Files.UI.displayInfoPanel(i,!0);return}jq.extend(t,{isStringXml:!0,show:!0});r=ASC.Files.Common.jsonToXml({file:n.key});ASC.Files.EventHandler.onGetFile(r,t);u=ASC.Files.Common.jsonToXml({fileList:{entry:n.value}});ASC.Files.EventHandler.onGetFileHistory(u,t)},w=function(n,t,i){var h=t.fileId,r=ASC.Files.UI.getEntryObject("file",h),s,e,f,o,u;if(ASC.Files.UI.blockObject(r),ASC.Files.UI.updateMainContentHeader(),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}s=t.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(n):ASC.Files.TemplateManager.translate(n);jq("#contentVersions").remove();r.append(s).addClass("file-row-fix");e=ASC.Files.UI.getObjectData(r);f=!0;!ASC.Files.UI.accessEdit(e,r)||ASC.Files.UI.editingFile(r)||ASC.Files.UI.lockedForMe(r)?(jq(".version-comment-edit").remove(),f=!1):jq("#contentVersions").addClass("version-edit");f&&Teamlab.profile.isVisitor!==!0||(jq(".version-operation.version-restore").empty(),jq(".version-complete, .version-continue").remove(),jq(".version-num span").addClass("display-num"));ASC.Files.Utility.CanWebView(e.title)&&jq(".not-preview").removeClass("not-preview");o=jq("#contentVersions .version-row").length;u=jq("#contentVersions .version-row:first").attr("data-version-group");jq("#contentVersions .version-row[data-version='"+o+"'] .version-restore").empty();jq("#contentVersions .version-row[data-version='"+o+"'] .version-sublist span").text(ASC.Files.FilesJSResources.RevisionCurrent);jq("#contentVersions .version-row[data-version-group="+u+"]").show();jq("#contentVersions .version-row").each(function(){var n=jq(this),i=n.attr("data-version-group"),t;i!=u?(n.find(".version-complete").remove(),u=i,n.addClass("version-group-head"),t=jq("#contentVersions .version-row[data-version-group="+u+"]"),t.length>1&&n.find(".version-sublist span").addClass("version-sublist-toggle").text(jq.format(ASC.Files.FilesJSResources.RevisionCount,t.length))):f?n.find(".version-num span, .version-continue").remove():n.find(".version-num").empty()});ASC.Files.UI.registerUserProfilePopup(jq("#contentVersions"))},b=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}n=n||"";var r=ASC.Files.UI.getEntryObject("file",t.fileId);r.find(".version-row[data-version="+t.version+"]").removeClass("version-row-comment").find(".version-comment").attr("data-comment",n).attr("title",n.length?n:"").html('<div class="version-comment-fix">'+Encoder.htmlEncode(n)+"<\/div>")},k=function(t,i,r){var e,o,u,f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(e=i.fileId,ASC.Files.Common.isCorrectId(e))return o=i.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(t):ASC.Files.TemplateManager.translate(t),ASC.Files.Marker.removeNewIcon("file",e),u=ASC.Files.UI.getEntryObject("file",e),u=n(o,u),f=ASC.Files.UI.getObjectData(u),!f||(u=f.entryObject,i.show&&(ASC.Files.EmptyScreen.hideEmptyScreen(),u.removeClass("new-file").show().yellowFade()),u.find(".is-new").is(":visible")&&ASC.Files.Marker.setNewCount(f.entryType,f.entryId,1)),ASC.Files.UI.updateMainContentHeader(),f},d=function(n,t,i){if(typeof i!="undefined"){jq(t.list.entry).each(function(){var n=ASC.Files.UI.parseItemId(this);ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.displayInfoPanel(i,!0);return}n!=null&&n.length>0?ASC.Files.Folders.showOverwriteMessage(t.list,t.folderToId,t.folderToTitle,t.isCopyOperation,n):(ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:t.folderToId,resolve:0,isCopyOperation:t.isCopyOperation,doNow:!0},{stringList:t.list}),ASC.Files.Folders.isCopyTo=!1)},u=function(n,t,i){var e=ASC.Files.UI.parseItemId(n[0]).entryId,u,o,r,s,h,l,y,p,w;for(n=n.slice(1),u=[],o=[],r=0;r<n.length;r++)(s=ASC.Files.UI.parseItemId(n[r]),s!=null)&&(r%2?o.push(s):(u.push(s),ASC.Files.UI.blockObjectById(s.entryType,s.entryId,!1,null,!0)));ASC.Files.UI.updateMainContentHeader();h=ASC.Files.UI.getEntryObject("folder",e);h.removeClass("row-to");var a,v=0,c=0,f="";for(u.length==1&&(f=ASC.Files.UI.getEntryTitle(u[0].entryType,u[0].entryId),(typeof f==undefined||f==null)&&(f="")),r=0;r<u.length;r++)l=ASC.Files.UI.getEntryObject(u[r].entryType,u[r].entryId),u[r].entryType=="file"?c++:(v+=1+(parseInt(l.find(".countFolders").html())||0),c+=parseInt(l.find(".countFiles").html())||0,ASC.Files.Tree&&!a&&(a=ASC.Files.Tree.getParentId(u[r].entryId))),t||ASC.Files.Folders.currentFolder.id==e||(ASC.Files.Marker.removeNewIcon(u[r].entryType,u[r].entryId),l.remove());if(v>0&&(y=h.find(".countFolders"),y.html((parseInt(y.html())||0)+v),ASC.Files.Tree&&(ASC.Files.Tree.resetFolder(e),t||e==ASC.Files.Folders.currentFolder.id||(ASC.Files.Tree.resetFolder(a||ASC.Files.Folders.currentFolder.id),ASC.Files.Tree.updateTreePath()))),c>0&&(p=h.find(".countFiles"),p.html((parseInt(p.html())||0)+c)),u.length>0&&ASC.Files.Folders.currentFolder.id!=e&&ASC.Files.UI.checkEmptyContent(),t?u.length==1&&f!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCopyItem.format(f)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCopyGroup.format(i)):u.length==1&&f!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveItem.format(f)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveGroup.format(i)),ASC.Files.Folders.currentFolder.id==e){for(w=[],r=0;r<o.length;r++)ASC.Files.UI.getEntryObject(o[r].entryType,o[r].entryId).length||w.push(o[r].entryType+"_"+o[r].entryId);ASC.Files.Folders.getItems(w,e)}},g=function(n,t){var s=ASC.Files.UI.parseItemId(n[0]).entryId,i,r,f,c;for(n=n.slice(1),i=[],r=0;r<n.length;r++)(f=ASC.Files.UI.parseItemId(n[r]),f!=null)&&(i.push(f),ASC.Files.UI.blockObjectById(f.entryType,f.entryId,!1,null,!0));ASC.Files.UI.updateMainContentHeader();var o,e=!1,u="",h=ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>0&&(ASC.Files.Tree.pathParts[0]!=ASC.Files.Constants.FOLDER_ID_TRASH||s==ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty());for(i.length==1&&(u=ASC.Files.UI.getEntryTitle(i[0].entryType,i[0].entryId),(typeof u==undefined||u==null)&&(u="")),r=0;r<i.length;r++)c=ASC.Files.UI.getEntryObject(i[r].entryType,i[r].entryId),i[r].entryType=="folder"&&(e||(e=!0),ASC.Files.Tree&&!o&&(o=ASC.Files.Tree.getParentId(i[r].entryId))),h&&(ASC.Files.Marker.removeNewIcon(i[r].entryType,i[r].entryId),c.remove());e&&ASC.Files.Tree&&(ASC.Files.Tree.resetFolder(o||ASC.Files.Folders.currentFolder.id),ASC.Files.Tree.updateTreePath());i.length>0&&h&&ASC.Files.UI.checkEmptyContent();i.length==1&&u!=""?e>0?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveFolder.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveFile.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveGroup.format(i.length,t));s==ASC.Files.Constants.FOLDER_ID_TRASH&&ASC.Files.ChunkUploads.initTenantQuota()},nt=function(n,t,i){var s,u,e,o,r,c;if(clearTimeout(ASC.Files.UI.timeCheckEditing),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}for(n||(n=[]),s=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),u=0;u<s.length;u++){var h=ASC.Files.UI.getObjectData(s[u]),l=h.entryObject,f=h.entryId;for(ASC.Files.UI.lockEditFile(l,!1),e=!0,o=0;o<n.length&&e;o++)f==n[o].Key&&(e=!1);e&&ASC.Files.Folders.replaceVersion(f,!0)}for(r=0;r<n.length;r++)f=n[r].Key,c=n[r].Value,ASC.Files.UI.lockEditFileById(f,!0,c);n.length>0&&ASC.Files.UI.checkEditingDefer()},tt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq(".update-if-exist").prop("checked",n===!0)},it=function(n,t,i){var u,r;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(u=t.lock,u)r=t.fileObj,r.addClass("file-locked"),ASC.Files.UI.addRowHandlers(r);else{t.show=!0;ASC.Files.EventHandler.onGetFile(n,t,i)}},rt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Anchor.defaultFolderSet();return}t.update&&(jq("#helpPanel").html(n),StudioManager.initImageZoom());LoadingBanner.hideLoading();jq("#helpPanel").show();showHelpPage(t.helpId);ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsHelp);ASC.Files.CreateMenu.disableMenu()},ut=function(n,r,f){var h,s,e;if(typeof n!="object"&&typeof f!="undefined"||n==null){ASC.Files.Folders.cancelTasksStatuses();ASC.Files.UI.displayInfoPanel(f,!0);return}if(n.length==0){ASC.Files.Folders.cancelTasksStatuses();return}var o=0,c=!1,l,a=[ASC.Files.FilesJSResources.TasksOperationMove,ASC.Files.FilesJSResources.TasksOperationCopy,ASC.Files.FilesJSResources.TasksOperationDelete,ASC.Files.FilesJSResources.TasksOperationBulkdownload,ASC.Files.FilesJSResources.TasksOperationMarkAsRead],v=[ASC.Files.FilesJSResources.DescriptMove,ASC.Files.FilesJSResources.DescriptCopy,ASC.Files.FilesJSResources.DescriptRemove,ASC.Files.FilesJSResources.DescriptBulkdownload,ASC.Files.FilesJSResources.DescriptMarkAsRead];for(n.length!=0&&(jq("#tasksProgress:visible").length==0&&(clearTimeout(t),jq("#tasksProgress").length==0&&(jq("#progressTemplate").clone().attr("id","tasksProgress").prependTo("#bottomLoaderPanel"),jq("#tasksProgress .progress-dialog-header").append('<a title="{0}" class="actions-container close">&times;<\/a>'.format(ASC.Files.FilesJSResources.TitleCancel)),jq("#tasksProgress .progress-dialog-header").append("<span><\/span>")),ASC.Files.UI.setProgressValue("#tasksProgress",0),jq("#tasksProgress .asc-progress-percent").text("0%"),jq("#tasksProgress .progress-dialog-header span").text(""),jq("#tasksProgress").show(),jq.browser.mobile&&(jq("#bottomLoaderPanel").css("bottom","auto"),jq("#bottomLoaderPanel").css("top",jq(window).scrollTop()+jq(window).height()-jq("#bottomLoaderPanel").height()+"px"))),l=n.length>1?ASC.Files.FilesJSResources.TasksOperationMixed.format(n.length):a[n[0].operation],jq("#tasksProgress .progress-dialog-header span").text(l)),i=0;i<n.length;i++)if(h=":",s=n[i].source.trim().split(h),jq(s).each(function(){var t=ASC.Files.UI.parseItemId(this);if(t==null)return!0;ASC.Files.UI.blockObjectById(t.entryType,t.entryId,!0,v[n[i].operation],!0)}),ASC.Files.UI.updateMainContentHeader(),o+=n[i].progress,n[i].finished){if(n[i].result!=null){e=n[i].result.trim().split(h);switch(n[i].operation){case 0:u(e,!1,n[i].processed);break;case 1:u(e,!0,n[i].processed);break;case 2:g(e,s.length);break;case 3:e[0]&&(location.href=e[0]);ASC.Files.Folders.bulkStatuses=!1;break;case 4:ASC.Files.Marker.onMarkAsRead(e)}}jq(s).each(function(){var n=ASC.Files.UI.parseItemId(this);if(n==null)return!0;ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();n[i].error!=null&&ASC.Files.UI.displayInfoPanel(n[i].error,!0)}else c=!0;o=n.length==0?100:o/n.length;ASC.Files.UI.setProgressValue("#tasksProgress",o);jq("#tasksProgress .asc-progress-percent").text(o+"%");c?ASC.Files.Folders.getTasksStatuses(r.doNow):(clearTimeout(t),t=setTimeout(ASC.Files.Folders.cancelTasksStatuses,500))};return{init:f,onGetFolderItems:e,onGetItems:h,onGetFile:k,onCreateNewFile:c,onCreateFolder:l,onRenameFolder:a,onRenameFile:v,onChangeOwner:y,onUpdateHistory:p,onGetFileHistory:w,onUpdateComment:b,onCheckEditing:nt,onLockFile:it,onUpdateIfExist:tt,onGetHelpCenter:rt,onMoveFilesCheck:d,onGetTasksStatuses:ut}}(),function(n){n(function(){ASC.Files.EventHandler.init();jq("#bottomLoaderPanel").on("click","#tasksProgress a.close",function(){return ASC.Files.Folders.terminateTasks(),!1})})}(jQuery);
window.ASC.Files.Socket=function(){var n=!1,t,i=function(){if(n===!1&&ASC.SocketIO&&!ASC.SocketIO.disabled()){n=!0;t=ASC.SocketIO.Factory.files;t.connect(function(){}).on("changeEditors",function(){ASC.Files.UI.checkEditing()})}},r=function(i){n!==!1&&t.emit("subscribeChangeEditors",i,function(){})};return{init:i,subscribeChangeEditors:r}}(),function(n){n(function(){ASC.Files.Socket.init()})}(jQuery);
/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright 2015 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n:n(jQuery)}(function(n){function u(r){var u=r||window.event,w=c.call(arguments,1),l=0,s=0,e=0,a=0,b=0,k=0,v,y,p;if(r=n.event.fix(u),r.type="mousewheel","detail"in u&&(e=-1*u.detail),"wheelDelta"in u&&(e=u.wheelDelta),"wheelDeltaY"in u&&(e=u.wheelDeltaY),"wheelDeltaX"in u&&(s=-1*u.wheelDeltaX),"axis"in u&&u.axis===u.HORIZONTAL_AXIS&&(s=-1*e,e=0),l=0===e?s:e,"deltaY"in u&&(e=-1*u.deltaY,l=e),"deltaX"in u&&(s=u.deltaX,0===e&&(l=-1*s)),0!==e||0!==s)return 1===u.deltaMode?(v=n.data(this,"mousewheel-line-height"),l*=v,e*=v,s*=v):2===u.deltaMode&&(y=n.data(this,"mousewheel-page-height"),l*=y,e*=y,s*=y),(a=Math.max(Math.abs(e),Math.abs(s)),(!t||t>a)&&(t=a,o(u,a)&&(t/=40)),o(u,a)&&(l/=40,s/=40,e/=40),l=Math[l>=1?"floor":"ceil"](l/t),s=Math[s>=1?"floor":"ceil"](s/t),e=Math[e>=1?"floor":"ceil"](e/t),i.settings.normalizeOffset&&this.getBoundingClientRect)&&(p=this.getBoundingClientRect(),b=r.clientX-p.left,k=r.clientY-p.top),r.deltaX=s,r.deltaY=e,r.deltaFactor=t,r.offsetX=b,r.offsetY=k,r.deltaMode=0,w.unshift(r,l,s,e),f&&clearTimeout(f),f=setTimeout(h,200),(n.event.dispatch||n.event.handle).apply(this,w)}function h(){t=null}function o(n,t){return i.settings.adjustOldDeltas&&"mousewheel"===n.type&&t%120==0}var f,t,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],c=Array.prototype.slice,e,i;if(n.event.fixHooks)for(e=s.length;e;)n.event.fixHooks[s[--e]]=n.event.mouseHooks;i=n.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=r.length;t;)this.addEventListener(r[--t],u,!1);else this.onmousewheel=u;n.data(this,"mousewheel-line-height",i.getLineHeight(this));n.data(this,"mousewheel-page-height",i.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],u,!1);else this.onmousewheel=null;n.removeData(this,"mousewheel-line-height");n.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var r=n(t),i=r["offsetParent"in n.fn?"offsetParent":"parent"]();return i.length||(i=n("body")),parseInt(i.css("fontSize"),10)||parseInt(r.css("fontSize"),10)||16},getPageHeight:function(t){return n(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})});
jQuery.url=function(){var i={},n={},t={url:window.location,strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},u=function(){str=decodeURI(t.url);for(var r=t.parser[t.strictMode?"strict":"loose"].exec(str),n={},i=14;i--;)n[t.key[i]]=r[i]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,function(i,r,u){r&&(n[t.q.name][r]=u)}),n},f=function(t){return(n.length||r(),t=="base")?n.port!==null&&n.port!==""?n.protocol+"://"+n.host+":"+n.port+"/":n.protocol+"://"+n.host+"/":n[t]===""?null:n[t]},e=function(t){return n.length||r(),n.queryKey[t]===null?null:n.queryKey[t]},r=function(){n=u();o()},o=function(){var t=n.path;i=[];i=n.path.length==1?{}:(t.charAt(t.length-1)=="/"?t.substring(1,t.length-1):path=t.substring(1)).split("/")};return{setMode:function(n){return strictMode=n=="strict"?!0:!1,this},setUrl:function(n){return t.url=n===undefined?window.location:n,r(),this},segment:function(t){return(n.length||r(),t===undefined)?i.length:i[t]===""||i[t]===undefined?null:i[t]},attr:f,param:e}}();
(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery","jquery.ui.widget"],n):typeof exports=="object"?n(require("jquery"),require("./vendor/jquery.ui.widget")):n(window.jQuery)})(function(n){"use strict";function t(t){var i=t==="dragover";return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var u=r.dataTransfer;u&&n.inArray("Files",u.types)!==-1&&this._trigger(t,n.Event(t,{delegatedEvent:r}))!==!1&&(r.preventDefault(),i&&(u.dropEffect="copy"))}}n.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||n('<input type="file">').prop("disabled"));n.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);n.support.xhrFormDataFileUpload=!!window.FormData;n.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);n.widget("blueimp.fileupload",{options:{dropZone:n(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&n.each(i,function(n,i){t=t.replace("{"+n+"}",i)}),t},formData:function(n){return n.serializeArray()},add:function(t,i){if(t.isDefaultPrevented())return!1;(i.autoUpload||i.autoUpload!==!1&&n(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:n.support.blobSlice&&function(){var n=this.slice||this.webkitSlice||this.mozSlice;return n.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.loaded=0;this.bitrate=0;this.getBitrate=function(n,t,i){var r=n-this.timestamp;return(!this.bitrate||!i||r>i)&&(this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=n),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&n.support.xhrFileUpload||n.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return n.type(t.formData)==="function"?t.formData(t.form):n.isArray(t.formData)?t.formData:n.type(t.formData)==="object"?(i=[],n.each(t.formData,function(n,t){i.push({name:n,value:t})}),i):[]},_getTotal:function(t){var i=0;return n.each(t,function(n,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?n.extend(t._progress,i):t._progress=i},_initResponseObject:function(n){var t;if(n._response)for(t in n._response)n._response.hasOwnProperty(t)&&delete n._response[t];else n._response={}},_onProgress:function(t,i){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),u;if(i._time&&i.progressInterval&&r-i._time<i.progressInterval&&t.loaded!==t.total)return;i._time=r;u=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0);this._progress.loaded+=u-i._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,i.bitrateInterval);i._progress.loaded=i.loaded=u;i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(r,u,i.bitrateInterval);this._trigger("progress",n.Event("progress",{delegatedEvent:t}),i);this._trigger("progressall",n.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var r=this,i=t.xhr?t.xhr():n.ajaxSettings.xhr();i.upload&&(n(i.upload).bind("progress",function(n){var i=n.originalEvent;n.lengthComputable=i.lengthComputable;n.loaded=i.loaded;n.total=i.total;r._onProgress(n,t)}),t.xhr=function(){return i})},_isInstanceOf:function(n,t){return Object.prototype.toString.call(t)==="[object "+n+"]"},_initXHRData:function(t){var f=this,i,r=t.files[0],e=t.multipart||!n.support.xhrFileUpload,u=n.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=n.extend({},t.headers);t.contentRange&&(t.headers["Content-Range"]=t.contentRange);e&&!t.blob&&this._isInstanceOf("File",r)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"');e?n.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:u,value:t.blob}):n.each(t.files,function(r,f){i.push({name:n.type(t.paramName)==="array"&&t.paramName[r]||u,value:f})})):(f._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,n.each(this._getFormData(t),function(n,t){i.append(t.name,t.value)})),t.blob?i.append(u,t.blob,r.name):n.each(t.files,function(r,e){(f._isInstanceOf("File",e)||f._isInstanceOf("Blob",e))&&i.append(n.type(t.paramName)==="array"&&t.paramName[r]||u,e,e.uploadName||e.name)})),t.data=i):(t.contentType=r.type||"application/octet-stream",t.data=t.blob||r);t.blob=null},_initIframeSettings:function(t){var i=n("<a><\/a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||"");t.formData=this._getFormData(t);t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(n){this._isXHRUpload(n)?(this._chunkedUpload(n,!0)||(n.data||this._initXHRData(n),this._initProgressListener(n)),n.postMessage&&(n.dataType="postmessage "+(n.dataType||""))):this._initIframeSettings(n)},_getParamName:function(t){var r=n(t.fileInput),i=t.paramName;return i?n.isArray(i)||(i=[i]):(i=[],r.each(function(){for(var t=n(this),u=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)i.push(u),r-=1}),i.length||(i=[r.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=n(t.fileInput.prop("form")),t.form.length||(t.form=n(this.options.fileInput.prop("form"))));t.paramName=this._getParamName(t);t.url||(t.url=t.form.prop("action")||location.href);t.type=(t.type||n.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase();t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST");t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=n.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(n){return n.state?n.state():n.isResolved()?"resolved":n.isRejected()?"rejected":"pending"},_enhancePromise:function(n){return n.success=n.done,n.error=n.fail,n.complete=n.always,n},_getXHRPromise:function(t,i,r){var u=n.Deferred(),f=u.promise();return i=i||this.options.context||f,t===!0?u.resolveWith(i,r):t===!1&&u.rejectWith(i,r),f.abort=u.promise,this._enhancePromise(f)},_addConvenienceMethods:function(t,i){var r=this,u=function(t){return n.Deferred().resolveWith(r,t).promise()};i.process=function(t,f){return(t||f)&&(i._processQueue=this._processQueue=(this._processQueue||u([this])).then(function(){return i.errorThrown?n.Deferred().rejectWith(r,[i]).promise():u(arguments)}).then(t,f)),this._processQueue||u([this])};i.submit=function(){return this.state()!=="pending"&&(i.jqXHR=this.jqXHR=r._trigger("submit",n.Event("submit",{delegatedEvent:t}),this)!==!1&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()};i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))};i.state=function(){return this.jqXHR?r._getDeferredState(this.jqXHR):this._processQueue?r._getDeferredState(this._processQueue):void 0};i.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"};i.progress=function(){return this._progress};i.response=function(){return this._response}},_getUploadedBytes:function(n){var i=n.getResponseHeader("Range"),t=i&&i.split("-"),r=t&&t.length>1&&parseInt(t[1],10);return r&&r+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var u=this,f=t.files[0],e=f.size,r=t.uploadedBytes,c=t.maxChunkSize||e,l=this._blobSlice,o=n.Deferred(),s=o.promise(),a,h;return!(this._isXHRUpload(t)&&l&&(r||c<e))||t.data?!1:i?!0:r>=e?(f.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",f.error])):(h=function(){var i=n.extend({},t),s=i._progress.loaded;i.blob=l.call(f,r,r+c,f.type);i.chunkSize=i.blob.size;i.contentRange="bytes "+r+"-"+(r+i.chunkSize-1)+"/"+e;u._initXHRData(i);u._initProgressListener(i);a=(u._trigger("chunksend",null,i)!==!1&&n.ajax(i)||u._getXHRPromise(!1,i.context)).done(function(f,c,l){r=u._getUploadedBytes(l)||r+i.chunkSize;s+i.chunkSize-i._progress.loaded&&u._onProgress(n.Event("progress",{lengthComputable:!0,loaded:r-i.uploadedBytes,total:r-i.uploadedBytes}),i);t.uploadedBytes=i.uploadedBytes=r;i.result=f;i.textStatus=c;i.jqXHR=l;u._trigger("chunkdone",null,i);u._trigger("chunkalways",null,i);r<e?h():o.resolveWith(i.context,[f,c,l])}).fail(function(n,t,r){i.jqXHR=n;i.textStatus=t;i.errorThrown=r;u._trigger("chunkfail",null,i);u._trigger("chunkalways",null,i);o.rejectWith(i.context,[n,t,r])})},this._enhancePromise(s),s.abort=function(){return a.abort()},h(),s)},_beforeSend:function(n,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(t);this._initProgressObject(t);t._progress.loaded=t.loaded=t.uploadedBytes||0;t._progress.total=t.total=this._getTotal(t.files)||1;t._progress.bitrate=t.bitrate=0;this._active+=1;this._progress.loaded+=t.loaded;this._progress.total+=t.total},_onDone:function(t,i,r,u){var f=u._progress.total,e=u._response;u._progress.loaded<f&&this._onProgress(n.Event("progress",{lengthComputable:!0,loaded:f,total:f}),u);e.result=u.result=t;e.textStatus=u.textStatus=i;e.jqXHR=u.jqXHR=r;this._trigger("done",null,u)},_onFail:function(n,t,i,r){var u=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total);u.jqXHR=r.jqXHR=n;u.textStatus=r.textStatus=t;u.errorThrown=r.errorThrown=i;this._trigger("fail",null,r)},_onAlways:function(n,t,i,r){this._trigger("always",null,r)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var r=this,f,s,e,h,u=r._getAJAXSettings(i),o=function(){return r._sending+=1,u._bitrateTimer=new r._BitrateTimer,f=f||((s||r._trigger("send",n.Event("send",{delegatedEvent:t}),u)===!1)&&r._getXHRPromise(!1,u.context,s)||r._chunkedUpload(u)||n.ajax(u)).done(function(n,t,i){r._onDone(n,t,i,u)}).fail(function(n,t,i){r._onFail(n,t,i,u)}).always(function(n,t,i){if(r._onAlways(n,t,i,u),r._sending-=1,r._active-=1,u.limitConcurrentUploads&&u.limitConcurrentUploads>r._sending)for(var f=r._slots.shift();f;){if(r._getDeferredState(f)==="pending"){f.resolve();break}f=r._slots.shift()}r._active===0&&r._trigger("stop")})};return(this._beforeSend(t,u),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)?(this.options.limitConcurrentUploads>1?(e=n.Deferred(),this._slots.push(e),h=e.then(o)):(this._sequence=this._sequence.then(o,o),h=this._sequence),h.abort=function(){return(s=[undefined,"abort","abort"],!f)?(e&&e.rejectWith(u.context,s),o()):f.abort()},this._enhancePromise(h)):o()},_onAdd:function(t,i){var a=this,p=!0,f=n.extend({},this.options,i),u=i.files,v=u.length,o=f.limitMultiFileUploads,c=f.limitMultiFileUploadSize,b=f.limitMultiFileUploadSizeOverhead,w=0,l=this._getParamName(f),s,e,h,r,y=0;if(!v)return!1;if(c&&u[0].size===undefined&&(c=undefined),(f.singleFileUploads||o||c)&&this._isXHRUpload(f))if(f.singleFileUploads||c||!o)if(!f.singleFileUploads&&c)for(h=[],s=[],r=0;r<v;r=r+1)w+=u[r].size+b,(r+1===v||w+u[r+1].size+b>c||o&&r+1-y>=o)&&(h.push(u.slice(y,r+1)),e=l.slice(y,r+1),e.length||(e=l),s.push(e),y=r+1,w=0);else s=l;else for(h=[],s=[],r=0;r<v;r+=o)h.push(u.slice(r,r+o)),e=l.slice(r,r+o),e.length||(e=l),s.push(e);else h=[u],s=[l];return i.originalFiles=u,n.each(h||u,function(r,u){var f=n.extend({},i);return f.files=h?u:[u],f.paramName=s[r],a._initResponseObject(f),a._initProgressObject(f),a._addConvenienceMethods(t,f),p=a._trigger("add",n.Event("add",{delegatedEvent:t}),f)}),p},_replaceFileInput:function(t){var i=t.fileInput,r=i.clone(!0),u=i.is(document.activeElement);t.fileInputClone=r;n("<form><\/form>").append(r)[0].reset();i.after(r).detach();u&&r.focus();n.cleanData(i.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(n,t){return t===i[0]?r[0]:t});i[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(t,i){var s=this,r=n.Deferred(),u=function(n){n&&!n.entry&&(n.entry=t);r.resolve([n])},h=function(n){s._handleFileTreeEntries(n,i+t.name+"/").done(function(n){r.resolve(n)}).fail(u)},e=function(){o.readEntries(function(n){n.length?(f=f.concat(n),e()):h(f)},u)},o,f=[];return i=i||"",t.isFile?t._file?(t._file.relativePath=i,r.resolve(t._file)):t.file(function(n){n.relativePath=i;r.resolve(n)},u):t.isDirectory?(o=t.createReader(),e()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,i){var r=this;return n.when.apply(n,n.map(t,function(n){return r._handleFileTreeEntry(n,i)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(n.map(i,function(n){var t;return n.webkitGetAsEntry?(t=n.webkitGetAsEntry(),t&&(t._file=n.getAsFile()),t):n.getAsEntry()})):n.Deferred().resolve(n.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=n(t);var r=t.prop("webkitEntries")||t.prop("entries"),i,u;if(r&&r.length)return this._handleFileTreeEntries(r);if(i=n.makeArray(t.prop("files")),i.length)i[0].name===undefined&&i[0].fileName&&n.each(i,function(n,t){t.name=t.fileName;t.size=t.fileSize});else{if(u=t.prop("value"),!u)return n.Deferred().resolve([]).promise();i=[{name:u.replace(/^.*\\/,"")}]}return n.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return!(t instanceof n)||t.length===1?this._getSingleFileInputFiles(t):n.when.apply(n,n.map(t,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(t){var r=this,i={fileInput:n(t.target),form:n(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(u){i.files=u;r.options.replaceFileInput&&r._replaceFileInput(i);r._trigger("change",n.Event("change",{delegatedEvent:t}),i)!==!1&&r._onAdd(t,i)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};i&&i.length&&(n.each(i,function(n,t){var i=t.getAsFile&&t.getAsFile();i&&r.files.push(i)}),this._trigger("paste",n.Event("paste",{delegatedEvent:t}),r)!==!1&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var u=this,i=t.dataTransfer,r={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){r.files=i;u._trigger("drop",n.Event("drop",{delegatedEvent:t}),r)!==!1&&u._onAdd(t,r)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste}));n.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(t,i){var r=n.inArray(t,this._specialOptions)!==-1;r&&this._destroyEventHandlers();this._super(t,i);r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof n||(t.fileInput=n(t.fileInput));t.dropZone instanceof n||(t.dropZone=n(t.dropZone));t.pasteZone instanceof n||(t.pasteZone=n(t.pasteZone))},_getRegExp:function(n){var t=n.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return t!=="url"&&n.type(i)==="string"&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options,r=this.element.data();n.each(this.element[0].attributes,function(n,u){var f=u.name.toLowerCase(),e;/^data-/.test(f)&&(f=f.slice(5).replace(/-[a-z]/g,function(n){return n.charAt(1).toUpperCase()}),e=r[f],t._isRegExpOption(f,e)&&(e=t._getRegExp(e)),i[f]=e)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(n){t.files=n;i._onAdd(null,t)}):(t.files=n.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var e=this,i=n.Deferred(),u=i.promise(),r,f;return u.abort=function(){return(f=!0,r)?r.abort():(i.reject(null,"abort","abort"),u)},this._getFileInputFiles(t.fileInput).always(function(n){if(!f){if(!n.length){i.reject();return}t.files=n;r=e._onSend(null,t);r.then(function(n,t,r){i.resolve(n,t,r)},function(n,t,r){i.reject(n,t,r)})}}),this._enhancePromise(u)}if(t.files=n.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});
window.ASC.Files.Share=function(){var a=!1,n,t,o=[],r,u=null,s,i,h=jq("#shareLink").attr("data-shorten")!="true",e=!1,b=function(){if(a===!1){a=!0;ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfo,ht);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfoShort,w);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceObject,ct);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceLink,vt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UnSubscribeMe,lt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetShortenLink,at);u=new SharingSettingsManager(undefined,null);u.OnSave=p;u.OnChange=ft;u.OnCopyLink=function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.Resource.LinkCopySuccess)};jq(".embedded-size-item").on("click",l);jq(".embedded-size-custom").on("change",l);jq.dropdownToggle({switcherSelector:"#toggleEmbeddPanel",dropdownID:"shareEmbeddedPanel",inPopup:!0,rightPos:!0,addTop:10,afterShowFunction:function(){jq("#shareEmbedded").focus().select()}});jq(".sharing-empty").html(jq.format(ASC.Files.FilesJSResources.SharingSettingsEmpty,"<br />"))}},f=function(n){if(n=="owner")return ASC.Files.FilesJSResources.AceStatusEnum_Owner;n=parseInt(n);switch(n){case ASC.Files.Constants.AceStatusEnum.Read:return ASC.Files.FilesJSResources.AceStatusEnum_Read;case ASC.Files.Constants.AceStatusEnum.ReadWrite:return ASC.Files.FilesJSResources.AceStatusEnum_ReadWrite;case ASC.Files.Constants.AceStatusEnum.Restrict:return ASC.Files.FilesJSResources.AceStatusEnum_Restrict;case ASC.Files.Constants.AceStatusEnum.Varies:return ASC.Files.FilesJSResources.AceStatusEnum_Varies;case ASC.Files.Constants.AceStatusEnum.Review:return ASC.Files.FilesJSResources.AceStatusEnum_Review;default:return""}},c=function(){if(!ASC.Clipboard.enable){jq("#shareLinkCopy, #shareEmbedCopy").remove();return}ASC.Files.Share.clip=ASC.Clipboard.destroy(ASC.Files.Share.clip);ASC.Files.Share.clip=ASC.Clipboard.create(jq("#shareLink").val(),"shareLinkCopy",{onComplete:function(){typeof toastr!="undefined"?toastr.success(ASC.Resources.Master.Resource.LinkCopySuccess):jq("#shareLink, #shareLinkCopy").yellowFade()},textareaId:"shareLink"});ASC.Files.Share.clipEmbed=ASC.Clipboard.destroy(ASC.Files.Share.clipEmbed);ASC.Files.Share.clipEmbed=ASC.Clipboard.create(jq("#shareEmbedded").val(),"shareEmbedCopy",{onComplete:function(){typeof toastr!="undefined"?toastr.success(ASC.Files.FilesJSResources.CodeCopySuccess):jq("#shareEmbedded, #shareEmbedCopy").yellowFade()},textareaId:"shareEmbedded"})},v=function(){var n=jq("#shareViaSocPanel"),r=encodeURIComponent(i);n.find(".google").attr("href",ASC.Resources.Master.UrlShareGooglePlus.format(r));n.find(".facebook").attr("href",ASC.Resources.Master.UrlShareFacebook.format(r,encodeURIComponent(t),"",""));n.find(".twitter").attr("href",ASC.Resources.Master.UrlShareTwitter.format(r));var u=ASC.Files.FilesJSResources.shareLinkMailSubject.format(t),f=ASC.Files.FilesJSResources.shareLinkMailBody.format(t,i);n.find(".mail").attr("href","mailto:?subject={1}&body={0}".format(encodeURIComponent(f),encodeURIComponent(u)))},y=function(){var n=jq("#shareLinkOpen").is(":checked")?ASC.Files.Constants.AceStatusEnum.Read:ASC.Files.Constants.AceStatusEnum.Restrict;n==ASC.Files.Constants.AceStatusEnum.Restrict||it()?jq("#sharingLinkAce select").val()!=n&&jq("#sharingLinkAce select").val(n).change():st()},k=function(){var t=parseInt(jq("#sharingLinkAce select").val()),n;r!=t&&(e=!0);r=t;n=r==ASC.Files.Constants.AceStatusEnum.Restrict;jq("#shareLinkOpen").is(":checked")==n&&jq("#shareLinkOpen").prop("checked",!n);jq("#shareLinkPanel, #sharingLinkAce").toggle(!n);jq("#shareLinkDescr").toggle(n);jq("#sharingSettingsItems").toggleClass("with-share-link",!n);jq("#shareLink").val(i);jq("#shareLink").is(":visible")&&jq("#shareLink").focus().select();v();c();e&&et()},d=function(){if(jq("#shareLinkBody").show(),jq("#studio_sharingSettingsDialog #shareLinkBody").length==0){jq("#sharingSettingsDialogBody").prepend(jq("#shareLinkBody"));jq("#shareViaSocPanel").on("click","a:not(.mail)",function(){return window.open(jq(this).attr("href"),"new","height=600,width=1020,fullscreen=0,resizable=0,status=0,toolbar=0,menubar=0,location=1"),!1});if(!ASC.Resources.Master.Personal)jq("#shareViaSocPanel").on("click","a.mail",function(){var f=jq(this).attr("href"),n=window.open(""),r;try{n&&(n.document.write(ASC.Resources.Master.Resource.LoadingPleaseWait),n.document.close())}catch(h){}r=new ASC.Mail.Message;r.subject=ASC.Files.FilesJSResources.shareLinkMailSubject.format(t);var u='<a href="{0}">{1}<\/a>',e=u.format(Encoder.htmlEncode(i),Encoder.htmlEncode(t)),o=u.format(Encoder.htmlEncode(i),Encoder.htmlEncode(i)),s=ASC.Files.FilesJSResources.shareLinkMailBody.format(e,o);return r.body=s,ASC.Mail.Utility.SaveMessageInDrafts(r).done(function(t,i){var r=i.messageUrl;n&&n.location?n.location.href=r:n=window.open(r,"_blank")}).fail(function(){n.close();window.location.href=f}),!1});jq("#shareLinkOpen").on("click",y);jq("#sharingLinkAce select").on("change",k)}ASC.Files.Utility.CanWebView(t)||typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(t)?(jq("#shareLinkPanel").removeClass("without-emb"),l()):jq("#shareLinkPanel").addClass("without-emb");jq("#sharingLinkAce select").val(r).change();jq("#sharingLinkAce select [value="+ASC.Files.Constants.AceStatusEnum.ReadWrite+"]").attr("disabled",!ASC.Files.Utility.CanWebEdit(t)||ASC.Files.Utility.MustConvert(t));jq("#sharingLinkAce select [value="+ASC.Files.Constants.AceStatusEnum.Review+"]").attr("disabled",!ASC.Files.Utility.CanWebReview(t));jq("#sharingLinkAce select").tlcombobox()},l=function(){var i=jq(this),n,t;i.is(".embedded-size-item")&&(i.hasClass("embedded-size-6x8")?(jq("#embeddSizeWidth").val("600px"),jq("#embeddSizeHeight").val("800px")):i.hasClass("embedded-size-4x6")?(jq("#embeddSizeWidth").val("400px"),jq("#embeddSizeHeight").val("600px")):(jq("#embeddSizeWidth").val("100%"),jq("#embeddSizeHeight").val("100%")));n=jq("#embeddSizeWidth").val();t=jq("#embeddSizeHeight").val();n=(/\d+(px|%)?/gim.exec(n.toLowerCase().trim())||["100%"])[0];n==Math.abs(n)&&(n+="px");t=(/\d+(px|%)?/gim.exec(t.toLowerCase().trim())||["100%"])[0];t==Math.abs(t)&&(t+="px");jq("#embeddSizeWidth").val(n);jq("#embeddSizeHeight").val(t);jq(".embedded-size-item").removeClass("selected");n=="600px"&&t=="800px"?jq(".embedded-size-6x8").addClass("selected"):n=="400px"&&t=="600px"?jq(".embedded-size-4x6").addClass("selected"):n=="100%"&&t=="100%"&&jq(".embedded-size-1x1").addClass("selected");g(n,t)},g=function(n,i){var u,r;if(n=n||"100%",i=i||"100%",u=s,ASC.Files.Utility.CanWebView(t))r='<iframe src="{0}" width="{1}" height="{2}" frameborder="0" scrolling="no" allowtransparency><\/iframe>',u=u+"&action=embedded";else if(typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(t))r='<img src="{0}" width="{1}" height="{2}" alt="" />';else return;r=r.format(u,n,i);jq("#shareEmbedded").val(r).attr("title",r)},nt=function(n,t){var i;if(ASC.Files.Folders.folderContainer=="forme"){var e=[],r="",u="",f='<label title="{0}"><input type="checkbox" class="checkbox" entryType="{1}" entryId="{2}" checked="checked">{0}<\/label>';(n&&t?(e.push({entryType:n,entryId:t}),i=ASC.Files.UI.getEntryTitle(n,t),n=="file"?u+=f.format(i,n,t):r+=f.format(i,n,t)):jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)").each(function(){var t=ASC.Files.UI.getObjectData(this),n=t.entryType,o=t.entryId;e.push({entryType:n,entryId:o});i=t.title;n=="file"?u+=f.format(i,n,o):r+=f.format(i,n,o)}),e.length!=0)&&(jq("#confirmUnsubscribeList dd.confirm-remove-files").html(u),jq("#confirmUnsubscribeList dd.confirm-remove-folders").html(r),jq("#confirmUnsubscribeList .confirm-remove-folders, #confirmUnsubscribeList .confirm-remove-files").show(),r==""&&jq("#confirmUnsubscribeList .confirm-remove-folders").hide(),u==""&&jq("#confirmUnsubscribeList .confirm-remove-files").hide(),ASC.Files.UI.blockUI("#filesConfirmUnsubscribe",420,0,-150),PopupKeyUpActionProvider.EnterAction='jq("#unsubscribeConfirmBtn").click();')}},tt=function(){e?ASC.Files.Share.getSharedInfoShort():w(null)},it=function(){return h||!new RegExp("/products/files/").test(i)},rt=function(i,r,u,f){var o,e,s;n=i;typeof n=="object"&&n.length==1&&(n=n[0],r?typeof r=="object"&&r.length==1&&(r=r[0]):(o=ASC.Files.UI.parseItemId(n),r=ASC.Files.UI.getEntryTitle(o.entryType,o.entryId)));t=typeof n=="object"?ASC.Files.FilesJSResources.SharingSettingsCount.format(n.length):r;e=!1;typeof n!="object"?e=ASC.Files.Utility.CanWebReview(t):typeof r=="object"&&(e=!0,jq(r).each(function(n,t){return ASC.Files.UI.parseItemId(i[n]).entryType=="folder"||!ASC.Files.Utility.CanWebReview(t)?(e=!1,!1):!0}));s={entry:jq(typeof n=="object"?n:[n]).map(function(n,t){return t}).toArray()};ASC.Files.ServiceManager.getSharedInfo(ASC.Files.ServiceManager.events.GetSharedInfo,{showLoading:!0,asFlat:u===!0,rootFolderType:f,canWebReview:e},{stringList:s})},ut=function(){ASC.Files.ServiceManager.getSharedInfoShort(ASC.Files.ServiceManager.events.GetSharedInfoShort,{showLoading:!0,objectID:n})},ft=function(n){n&&(!ASC.Files.Folders||ASC.Files.Folders.folderContainer!="corporate")&&(jq("#studio_sharingSettingsDialog #shareMessagePanel").show(),jq("#sharingSettingsItems").addClass("with-message-panel"))},p=function(t){var s=t.items,r=[],i,u,f;if(jq(s).each(function(n,t){var i=!0;jq(o).each(function(n,r){return r.id===t.id?(i=r.selectedAction.id!=t.selectedAction.id,!1):!0});i&&r.push({id:t.id,is_group:t.isGroup,ace_status:t.selectedAction.id})}),jq(o).each(function(n,t){var i=!0;jq(s).each(function(n,r){return t.id===r.id?(i=!1,!1):!0});i&&r.push({id:t.id,is_group:t.isGroup,ace_status:ASC.Files.Constants.AceStatusEnum.None})}),i=jq("#shareOwnerSelector").attr("data-id"),i=i!=jq("#shareOwnerSelector").attr("data-id-old")?i:null,r.length)e=!0;else{i&&ASC.Files.Folders.changeOwner(typeof n=="object"?n:[n],i);return}u={entries:{entry:n},aces:{entry:r},message:""};f=jq("#shareMessageSend").prop("checked")==!0;f&&(u.message=(jq("#shareMessage:visible").val()||"").trim());ASC.Files.ServiceManager.setAceObject(ASC.Files.ServiceManager.events.SetAceObject,{owner:i,showLoading:!0,notify:f},{ace_collection:u})},et=function(){ASC.Files.ServiceManager.setAceLink(ASC.Files.ServiceManager.events.SetAceLink,{showLoading:!0,fileId:ASC.Files.UI.parseItemId(n).entryId,share:r})},ot=function(){var t,n,i;jq("#filesConfirmUnsubscribe:visible").length!=0&&(PopupKeyUpActionProvider.CloseDialog(),t=jq("#confirmUnsubscribeList input:checked"),t.length!=0)&&(n={},n.entry=[],i=t.map(function(t,i){var r=jq(i).attr("entryType"),u=jq(i).attr("entryId"),f=ASC.Files.UI.getEntryObject(r,u);return ASC.Files.UI.blockObject(f,!0,ASC.Files.FilesJSResources.DescriptRemove,!0),n.entry.push(r+"_"+u),{entryId:u,entryType:r}}).toArray(),ASC.Files.UI.updateMainContentHeader(),ASC.Files.ServiceManager.unSubscribeMe(ASC.Files.ServiceManager.events.UnSubscribeMe,{parentFolderID:ASC.Files.Folders.currentFolder.id,showLoading:!0,list:i},{stringList:n}))},st=function(){if(!h){var t=ASC.Files.UI.parseItemId(n).entryId;ASC.Files.ServiceManager.getShortenLink(ASC.Files.ServiceManager.events.GetShortenLink,{fileId:t})}},ht=function(h,l,a){var y,k,it,p,rt,b,nt,tt,g,v,w,ut;if(typeof a!="undefined"||typeof h=="undefined"){ASC.Files.UI.displayInfoPanel(a,!0);return}o=h;e=!1;k=[];r=ASC.Files.Constants.AceStatusEnum.None;jq(h).each(function(n){var t=h[n];t.id===ASC.Files.Constants.ShareLinkId?(s=t.link,i=t.link_short||s,r=t.ace_status,it=t.ace_status):k.push({id:t.id,name:t.title,isGroup:t.is_group,canEdit:!(t.locked||t.owner),hideRemove:t.disable_remove,selectedAction:{id:t.ace_status,name:f(t.owner?"owner":t.ace_status),defaultAction:!1}});t.owner&&(y=t)});p=[{id:ASC.Files.Constants.AceStatusEnum.ReadWrite,name:f(ASC.Files.Constants.AceStatusEnum.ReadWrite),defaultAction:!1,defaultStyle:"full"}];l.canWebReview&&(p=p.concat([{id:ASC.Files.Constants.AceStatusEnum.Review,name:f(ASC.Files.Constants.AceStatusEnum.Review),defaultAction:!1,defaultStyle:"review"}]));p=p.concat([{id:ASC.Files.Constants.AceStatusEnum.Read,name:f(ASC.Files.Constants.AceStatusEnum.Read),defaultAction:!0,defaultStyle:"read"},{id:ASC.Files.Constants.AceStatusEnum.Restrict,name:f(ASC.Files.Constants.AceStatusEnum.Restrict),defaultAction:!1,defaultStyle:"restrict"},{id:ASC.Files.Constants.AceStatusEnum.Varies,name:f(ASC.Files.Constants.AceStatusEnum.Varies),defaultAction:!1,disabled:!0}]);rt={actions:p,items:k};o=k;b=null;typeof n!="object"&&(nt=ASC.Files.UI.parseItemId(n),b=ASC.Files.UI.getEntryLink(nt.entryType,nt.entryId,t),tt=document.createElement("a"),tt.href=b,b=jq(tt).prop("href"));u.UpdateSharingData(rt,b);jq("#shareLinkBody").hide();g=460;it&&(d(),g=550,ASC.Resources.Master.Personal&&(g=260));u.ShowDialog(null,g,l.asFlat);l.asFlat&&(PopupKeyUpActionProvider.CloseDialogAction="ASC.Files.Share.updateForParent();",PopupKeyUpActionProvider.ForceBinding=!0);ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();c();v=jq(".share-container-head");v.is("span")&&(v.replaceWith('<div class="share-container-head"><\/div>'),v=jq(".share-container-head"),v.html(ASC.Files.FilesJSResources.SharingSettingsTitle.format("(<span><\/span>)")));w=jq(".share-container-head-corporate");l.rootFolderType?jq("#studio_sharingSettingsDialog #shareMessagePanel").remove():jq("#studio_sharingSettingsDialog #shareMessagePanel").hide();jq("#sharingSettingsItems").removeClass("with-message-panel");l.rootFolderType||ASC.Files.Folders&&ASC.Files.Folders.folderContainer=="corporate"?(w.length||(v.after('<div class="share-container-head-corporate"><\/div>'),w=jq(".share-container-head-corporate"),w.html(ASC.Files.FilesJSResources.AccessSettingsTitle.format("(<span><\/span>)"))),w.show().find("span").attr("title",t).text(t),v.hide()):(v.show().find("span").attr("title",t).text(t),w.hide());ASC.Files.Folders&&ASC.Files.Folders.folderContainer=="corporate"&&y&&(ut=jq("#sharingSettingsItems .userLink[data-uid='"+y.id+"']"),ut.replaceWith('<div id="shareOwnerSelector" class="advanced-selector-select" data-id=""><div class="change-owner-selector"><\/div><\/div>'),jq("#shareOwnerSelector").useradvancedSelector({inPopup:!0,itemsChoose:[],canadd:!1,showGroups:!0,onechosen:!0,withGuests:!1}).on("showList",function(n,t){jq(this).attr("data-id",t.id).find(".change-owner-selector").html(t.title);t.id!=y.id&&u.WhereChanges(!0)}).attr("data-id",y.id).attr("data-id-old",y.id).find(".change-owner-selector").text(y.title))},w=function(n,t,i){var r,u;if(typeof i!="undefined"||typeof n=="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}r=n?{needUpdate:!0,sharingSettings:n}:{needUpdate:!1};r.Referer="onlyoffice";u=JSON.stringify(r);window.parent.postMessage(u,"*")},ct=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}jq(typeof n=="object"?n:[n]).each(function(n,i){var r=ASC.Files.UI.parseItemId(i),u=ASC.Files.UI.getEntryObject(r.entryType,r.entryId);u.toggleClass("__active",jq.inArray(i,t)!=-1)});i.owner&&ASC.Files.Folders.changeOwner(typeof n=="object"?n:[n],i.owner)},lt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}var u=t.list,r=!1;jq(u).each(function(n,t){r||t.entryType!="folder"||(r=!0);ASC.Files.Marker.removeNewIcon(t.entryType,t.entryId);ASC.Files.UI.getEntryObject(t.entryType,t.entryId).remove()});r&&ASC.Files.Tree&&ASC.Files.Tree.resetFolder(t.parentFolderID);ASC.Files.UI.checkEmptyContent()},at=function(n,t,r){typeof r!="undefined"?(ASC.Files.UI.displayInfoPanel(r,!0),h=!0):n==null||n==""?h=!0:(i=n||s,jq("#shareLink").val(i),v(),c());y()},vt=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var u=ASC.Files.UI.parseItemId(n),f=ASC.Files.UI.getEntryObject(u.entryType,u.entryId);f.toggleClass("__active",t)};return{init:b,updateForParent:tt,getSharedInfo:rt,getSharedInfoShort:ut,setAceObject:p,unSubscribeMe:nt,confirmUnSubscribe:ot,clip:null,clipEmbed:null}}();jq(document).ready(function(){(function(n){jq("#shareLinkBody").length!=0&&(ASC.Files.Share.init(),n(function(){jq("#studioPageContent").on("click","#buttonUnsubscribe, #mainUnsubscribe.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Share.unSubscribeMe()});jq("#studioPageContent").on("click","#buttonShare, #mainShare.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();var n=[],t=[];jq("#filesMainContent .file-row:not(.without-share):not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var i=ASC.Files.UI.getObjectData(this),r=i.entryType,u=i.entryId;n.push(r+"_"+u);t.push(i.title)});ASC.Files.Share.getSharedInfo(n,t)});jq("#unsubscribeConfirmBtn").click(function(){ASC.Files.Share.confirmUnSubscribe()});jq("#filesMainContent").on("click",".btn-row",function(){var n=ASC.Files.UI.getObjectData(this),t=n.entryId,i=n.entryType,r=n.title;return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.UI.checkSelectAll(!1),ASC.Files.UI.selectRow(n.entryObject,!0),ASC.Files.Share.getSharedInfo(i+"_"+t,r),!1});if(jq("#studio_sharingSettingsDialog .containerBodyBlock").addClass("clearFix"),jq.browser.mobile)jq("#shareLink, #shareEmbedded").attr("readonly","false").attr("readonly","").removeAttr("readonly");else{jq("#shareLink, #shareEmbedded").on("mousedown",function(){return jq(this).select(),!1});jq("#shareLink, #shareEmbedded").on("keypress",function(n){return n.ctrlKey&&(n.charCode===ASC.Files.Common.keyCode.c||n.charCode===ASC.Files.Common.keyCode.C||n.keyCode===ASC.Files.Common.keyCode.insertKey)})}}))})(jQuery)});
window.ASC.Files.ChunkUploads=function(){var w=!1,r,u=0,t={fisrt:!0,can:!1},b=0,o=null,s=document.body,k=null,e="draggable"in document.createElement("span"),ht="value"in document.createElement("progress"),n={QUEUED:0,STARTED:1,STOPED:2,DONE:3,FAILED:4},ct=function(){w===!1&&(w=!0,StudioManager.addPendingRequest(ASC.Files.ChunkUploads.initTenantQuota),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChunkUploadCheckConversion,nr),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChunkUploadGetFileFromServer,oi));e||jq("#emptyContainer .emptyContainer_dragDrop").remove();window.onbeforeunload=function(){if(ASC.Files.ChunkUploads.uploaderBusy)return ASC.Files.FilesJSResources.ConfirmLeavePage||"Are you sure you want to leave the current page. Downloading files will be interrupted."}},lt=function(){window.Teamlab.getQuotas({},{success:function(n,t){ASC.Files.ChunkUploads.tenantQuota=t;ASC.Files.ChunkUploads.changeQuotaText();pt()}})},at=function(n){var i=jq.format("{0}files/{1}/upload/create_session.json",ASC.Resources.Master.ApiPath,n.fid),t=null;return jq.ajax({type:"POST",data:{fileName:n.name,fileSize:n.size,relativePath:n.relativePath||""},url:jq.format(i,n.fid),async:!1,success:function(n){t=n.response},error:function(n){try{var r=jq.parseJSON(n.responseText),i=r.error.message}catch(u){i=n.statusText}t={success:!1,message:i}}}),t},vt=function(){var t=ASC.Files.Constants.storageKeyUploaderCompactView,n=localStorageManager.getItem(t);jq("#chunkUploadDialog").toggleClass("min",n===!0);jq("#uploadCompactViewCbx").prop("checked",n===!0);jq(".store-original").prop("checked",ASC.Files.Common.storeOriginal===!0)},yt=function(n){var t=jq("<input/>").attr("id","fileupload").attr("type","file").attr("multiple","multiple").css("width","0").css("height","0");t.appendTo(n.parent());n.on("click",function(n){n.preventDefault();jq("#fileupload").click()})},pt=function(){if(jq("#buttonUpload").hasClass("not-ready")){u=0;yt(jq("#buttonUpload"));var n=jq("#fileupload").fileupload({url:null,autoUpload:!1,singleFileUploads:!0,sequentialUploads:!0,maxChunkSize:ASC.Files.Constants.CHUNK_UPLOAD_SIZE,progressInterval:1e3,dropZone:e?jq(s):null});n.bind("fileuploadadd",dt).bind("fileuploadsubmit",gt).bind("fileuploadsend",d).bind("fileuploadchunksend",d).bind("fileuploadprogress",g).bind("fileuploadchunkdone",g).bind("fileuploaddone",nt).bind("fileuploadfail",ni).bind("fileuploadalways",ti).bind("fileuploadstart",wt).bind("fileuploadstop",bt).bind("fileuploaddrop",kt);e&&(jq(s).bind("dragenter",function(){return!1}).bind("dragleave",ii).bind("dragover",ri).bind("drop",ui),jq(s).css({position:"static"}));jq("#buttonUpload").removeClass("not-ready")}},wt=function(){v(ASC.Files.FilesJSResources.Uploading);et();ASC.Files.ChunkUploads.uploaderBusy=!0;jq("#abortUploadigBtn").show()},bt=function(){u&&ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoUploadedSuccess.format(u));ASC.Files.ChunkUploads.initTenantQuota();v(ASC.Files.FilesJSResources.UploadComplete);ASC.Files.ChunkUploads.uploaderBusy=!1;jq("#abortUploadigBtn").hide();u=0;b++;ASC.Files.ChunkUploads.createdSubfolders={}},kt=function(n,t){r&&(jq.each(t.files,function(n,t){t.fid=r}),r=null)},dt=function(t,i){var r=i.files[0];if(r){var u=ASC.Files.Folders.currentFolder.id,e=ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable,f=!0;ASC.Files.Common.isCorrectId(r.fid)?u=r.fid:f=ASC.Files.UI.accessEdit();f&&fi(r,u)&&(r.id=st(),r.name=ASC.Files.Common.replaceSpecCharacter(r.name),r.fid=u,r.canShare=e,r.status=n.QUEUED,r.percent=0,r.loaded=0,tt(r,!1),i.id=st(),i.session=b,ASC.Files.ChunkUploads.uploadQueue.push(i));ASC.Files.ChunkUploads.uploaderBusy||rt()}},gt=function(t,r){var u=r.files[0],f=at(u);f.success?(r.url=f.data.location,u.status=n.STARTED,jq(this).fileupload("option","url",f.data.location),si(u.fid,u.relativePath,f.data.path||[])):(u.status=n.FAILED,jq(this).fileupload("option","url",null),ASC.Files.UI.displayInfoPanel(f.message,!0),i(u.id,f.message))},d=function(t,i){var r=i.files[0];return r.status==n.STARTED},g=function(t,r){var u=r.files[0],e=r.result,o;typeof e=="undefined"||e&&e.success?(u.percent=parseInt(r.loaded/r.total*100,10),u.loaded=r.loaded,u.actionText==ASC.Files.FilesJSResources.FileUploading&&(l(u),v(null,r.session)),e&&e.data&&e.data.uploaded&&(nt(t,r),o=f(n.STARTED),o&&o.files[0].id==u.id&&o.abort())):(o=f(n.STARTED),u.percent=100,u.loaded=u.size,u.status=n.FAILED,ASC.Files.UI.displayInfoPanel(e.message,!0),i(u.id,e.message),o&&o.files[0].id==u.id&&o.abort())},nt=function(t,r){var f=r.files[0],e,o,h,c,s;f.status!=n.DONE&&(f.percent=100,f.loaded=f.size,e=r.result,e.success?(f.status=n.DONE,f.data=e.data,u++,o=ki(f.data),h=!o||o&&ASC.Files.Common.storeOriginal,f.data.folderId!=ASC.Files.Folders.currentFolder.id?(c=(f.relativePath||"").split("/")[0],s=f.fid+"/"+c,ASC.Files.ChunkUploads.createdSubfolders[s]?y(ASC.Files.ChunkUploads.createdSubfolders[s]):y(f.data.folderId)):ASC.Files.UI.isSettingsPanel()||ei(f.data.id,f.data.version,h),o?(di(f.data.id,f.data.version),tt(f,!0),ASC.Files.ChunkUploads.converterBusy||(ASC.Files.ChunkUploads.converterBusy=!0,ft())):l(f),trackingGoogleAnalitics("documents","upload","file")):(f.status=n.FAILED,ASC.Files.UI.displayInfoPanel(e.message,!0),i(f.id,e.message)))},ni=function(t,r){var u=r.files[0],f,e;u.percent=100;u.loaded=u.size;r.errorThrown=="abort"||r.textStatus=="abort"?u.status!=n.FAILED&&(u.status=n.STOPED,a(u.id),f=jq(this).fileupload("option","url"),f+=(f.indexOf("?")==-1?"?":"&")+"abort=true",jq.ajax({type:"POST",url:f,async:!0,success:function(n){n.success||ASC.Files.UI.displayInfoPanel(n.message,!0)},error:function(n,t,i){ASC.Files.UI.displayInfoPanel(i,!0)}})):(u.status=n.FAILED,e=r.errorThrown||r.textStatus,e&&(ASC.Files.UI.displayInfoPanel(e,!0),i(u.id,e)))},ti=function(){rt()},ii=function(n){n.relatedTarget==null&&(k=setTimeout(ASC.Files.ChunkUploads.hideDragHighlight,1))},ri=function(n){clearTimeout(k);var t=n.originalEvent.dataTransfer;return it(t)?(jq.browser.webkit&&(t.dropEffect="copy"),li(n),!1):!0},ui=function(n){var t=n.originalEvent.dataTransfer;return it(t)?(ASC.Files.ChunkUploads.hideDragHighlight(),!1):!0},fi=function(n,t){var u=ASC.Files.Utility.GetFileExtension(n.name),i,r;if(ASC.Files.Constants.UPLOAD_FILTER&&jq.inArray(u,ASC.Files.Utility.Resource.ExtsUploadable)==-1)return ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_NotSupportedFormat,!0),!1;if(i=n.size,i<=0)return ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_EmptyFile,!0),!1;if(!ASC.Files.ThirdParty||!ASC.Files.ThirdParty.isThirdParty(null,"folder",t)){if(ASC.Files.ChunkUploads.tenantQuota==null)return!1;if(ASC.Files.ChunkUploads.tenantQuota.availableSize<i)return ASC.Files.UI.displayTariffLimitStorageExceed()||ASC.Files.UI.displayInfoPanel(jq.format(ASC.Files.FilesJSResources.ErrorMassage_StorageSize,FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.availableSize)),!0),!1;if(ASC.Files.ChunkUploads.tenantQuota.maxFileSize<i)return ASC.Files.UI.displayTariffFileSizeExceed()||ASC.Files.UI.displayInfoPanel(jq.format("{0} ({1})",ASC.Files.FilesJSResources.ErrorMassage_FileSize,FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.maxFileSize)),!0),!1}return(r=104857600,!!window.AscDesktopEditor&&i>r)?(ASC.Files.UI.displayInfoPanel(jq.format("{0} ({1})",ASC.Files.FilesJSResources.ErrorMassage_FileSize,FileSizeManager.filesSizeToString(r)),!0),!1):!0},h=function(n){if(n=jq(n),n.is(".fu-row")||(n=n.closest(".fu-row")),n.length==0)return null;var t=n.attr("id");return c(t)},c=function(n,t){for(var i=null,r=ASC.Files.ChunkUploads.uploadQueue.length;r>0;r--)if(i=ASC.Files.ChunkUploads.uploadQueue[r-1].files[0],(i.id==n||i.data&&i.data.id==n)&&(!t||i.data&&i.data.version==parseInt(t)))return i;return i},ei=function(n,t,i){ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.ChunkUploadGetFileFromServer,{fileId:n,version:t,show:i,isStringXml:!1})},oi=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}ot(t.fileId,n,t.show)},si=function(n,t,i){var f,e,r,u;n==ASC.Files.Folders.currentFolder.id&&(f=i[i.length-1],n&&f&&n!=f)&&((t=(t||"").split("/")[0],e=n+"/"+t,ASC.Files.ChunkUploads.createdSubfolders[e])||(r=-1,jq(i).each(function(t,i){return i==n?(r=t,!1):!0}),r!=-1)&&((u=i[r+1],ASC.Files.ChunkUploads.createdSubfolders[e]=u,ASC.Files.UI.getEntryObject("folder",u).length)||ASC.Files.ServiceManager.getFolder(ASC.Files.ServiceManager.events.GetItems,{folderId:u,parentFolderID:n,lonelyType:"folder"})))},tt=function(n,t){if(n){n.fileTypeCssClass=ASC.Files.Utility.getCssClassByFileTitle(n.name,!0);n.percent=0;n.showAnim=!ht;t?(n.actionText=ASC.Files.FilesJSResources.FileConverting,n.completeActionText=ASC.Files.FilesJSResources.FileConverted):(n.actionText=ASC.Files.FilesJSResources.FileUploading,n.completeActionText=ASC.Files.FilesJSResources.FileUploaded);var i=jq("#fileUploaderRowTmpl").tmpl(n),r=jq("#"+n.id);r.length!=0?r.replaceWith(i):(jq("#uploadFilesTable tbody").append(i),jq("#uploadFilesTable").parent().scrollTo("#"+n.id));t?jq("#"+n.id).addClass("convert"):jq("#"+n.id).addClass("upload")}},l=function(t){if(t){var i=jq("#"+t.id);ASC.Files.UI.setProgressValue(i,t.percent);t.status==n.DONE&&t.percent==100&&(i.removeClass("upload").removeClass("convert").addClass("done"),t.hasOwnProperty("convertedData")&&(i.find(".fu-title-cell span").text(t.convertedData.title).attr("title",t.convertedData.title),i.find(".ftFile_21").attr("class",ASC.Files.Utility.getCssClassByFileTitle(t.convertedData.title,!0))))}},i=function(n,t){jq("#"+n).removeClass("upload").removeClass("convert").removeClass("done").removeClass("canceled").addClass("error");jq("#"+n+" .popup_helper").text(t||ASC.Files.FilesJSResources.UnknownErrorText)},a=function(n){jq("#"+n).removeClass("upload").removeClass("convert").removeClass("done").removeClass("error").addClass("canceled")},v=function(t,i){var r;if(!t){var u=0,f=0,e=0;jq.each(ASC.Files.ChunkUploads.uploadQueue,function(t,r){if(r.session==i){var o=r.files[0];o.status!=n.STOPED&&(u++,f+=o.size,e+=o.loaded)}});r=parseInt(e/f*100,10);r==100&&(r=99);t=r>0?ASC.Files.FilesJSResources.UploadingProgress.format(u,r):ASC.Files.FilesJSResources.Uploading}jq("#chunkUploadDialogHeader").text(t)},hi=function(){var n=window.FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.usedSize),t=window.FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.storageSize);jq("#chunkUploadDialog .upload-info-container .free-space").text(ASC.Files.FilesJSResources.UsedSize.format(n,t))},it=function(n){return e?jq.browser.safari?!1:n?n.types.contains&&!n.types.contains("Files")?!1:n.types.indexOf&&n.types.indexOf("Files")==-1?!1:!0:!1:!1},ci=function(){jq(".may-drop-to").removeClass("may-drop-to");jq(".drop-to").removeClass("drop-to");jq("#mainContent").removeClass("selected");t.fisrt=!0},li=function(n){t.fisrt&&(ASC.Files.Mouse.highlightFolderTo("may-drop-to",!0),t.can=ASC.Files.UI.accessEdit(),jq("#mainContent").toggleClass("selected",t.can),t.fisrt=!1);jq(".drop-to").removeClass("drop-to");var u=n.target||n.srcElement,i=jq(u).closest(".may-drop-to");i.length?(r=ASC.Files.Mouse.getOverFolderId(n,i,"drop-to"),jq("#mainContent").toggleClass("selected",!1)):(jq("#mainContent").toggleClass("selected",t.can),r=null)},f=function(n){for(var t=0;t<ASC.Files.ChunkUploads.uploadQueue.length;t++)if(ASC.Files.ChunkUploads.uploadQueue[t].files[0].status==n)return ASC.Files.ChunkUploads.uploadQueue[t];return null},rt=function(){var t=f(n.QUEUED);t&&(ASC.Files.ChunkUploads.uploaderBusy=!0,t.submit())},ai=function(t){var i=h(t),r;i!=null&&(r=f(n.STARTED),r&&r.files[0].id==i.id?r.abort():i.status==n.QUEUED&&(i.percent=100,i.loaded=i.size,i.status=n.STOPED,a(i.id)))},vi=function(t){jq.each(ASC.Files.ChunkUploads.uploadQueue,function(t,i){var r=i.files[0];r.status==n.QUEUED&&(r.percent=100,r.loaded=r.size,r.status=n.STOPED)});var i=f(n.STARTED);i&&i.abort();t?(jq("#uploadFilesTable tbody").html(""),ASC.Files.ChunkUploads.uploadQueue=[]):jq("#uploadFilesTable .fu-row:not(.done)").each(function(){var n=jq(this).attr("id");a(n)})},yi=function(n){var t=h(n),i;t.canShare&&(i=t.convertedData?t.convertedData:t.data,ASC.Files.Share.getSharedInfo("file_"+i.id,i.title))},pi=function(n){var t=h(n),i=t.convertedData?t.convertedData:t.data;ASC.Files.Folders.clickOnFile(i,!0)},wi=function(n){var t=jq(n).closest(".fu-row"),i=t.attr("id");jq(n).helper({BlockHelperID:i+" .popup_helper",position:"fixed"})},bi=function(n){jq("#fileupload").prop("disabled",n).css("visibility",n?"hidden":"visible")},ki=function(n){return ASC.Files.Constants.ENABLE_UPLOAD_CONVERT?ASC.Files.Utility.MustConvert(n.title):!1},di=function(n,t){ASC.Files.Marker.removeNewIcon("file",n);ASC.Files.ChunkUploads.convertQueue.push({id:n,version:t,needToRun:!0})},ut=function(n,t){var i=-1;jq.each(ASC.Files.ChunkUploads.convertQueue,function(r,u){u.id==n&&u.version==t&&(i=r)});i!=-1&&ASC.Files.ChunkUploads.convertQueue.splice(i,1)},gi=function(n,t){jq.each(ASC.Files.ChunkUploads.convertQueue,function(i,r){r.id==n&&r.version==t&&(r.needToRun=!1)})},ft=function(){var n={};n.entry=[];jq.each(ASC.Files.ChunkUploads.convertQueue,function(t,i){n.entry.push({entry:[i.id,i.version,i.needToRun===!0]})});n.entry.length>0?ASC.Files.ServiceManager.checkConversion(ASC.Files.ServiceManager.events.ChunkUploadCheckConversion,{},{stringListList:n}):ASC.Files.ChunkUploads.converterBusy=!1},nr=function(n,t,r){var u,f,s,w,v,b;if(typeof n!="object"&&typeof r!="undefined"||n==null?r=r||ASC.Files.FilesJSResources.ErrorMassage_ErrorConvert:n.length||(r=ASC.Files.FilesJSResources.ErrorMassage_ErrorConvert),typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);clearTimeout(o);jq.each(ASC.Files.ChunkUploads.convertQueue,function(n,t){var u=c(t.id,t.version);u&&i(u.id,r)});p();ASC.Files.ChunkUploads.convertQueue.clear();ASC.Files.ChunkUploads.converterBusy=!1;return}for(u=0;u<n.length;u++)if(f=jq.parseJSON(n[u].source),s=c(f.id,f.version),gi(f.id,f.version),n[u].error!="")ASC.Files.UI.displayInfoPanel(n[u].error,!0),ut(f.id,f.version),s&&(i(s.id,n[u].error),p(s.data.id));else{var h=n[u].progress||0,a=!1,e=null;n[u].result&&(e=jq.parseJSON(n[u].result));e&&(w=ASC.Files.UI.getEntryObject("file",e.id),v=ASC.Files.UI.getObjectData(w));v&&v.version==e.version|0?(h=100,a=!0):h==100&&e&&(e.folderId!=ASC.Files.Folders.currentFolder.id?y(s.fid):ASC.Files.UI.isSettingsPanel()||(b=e.fileXml,ot(e.id,b,!0)),p(f.id),h=100,a=!0);a&&ut(f.id,f.version);s&&(s.percent=h,a&&e&&(s.convertedData=e),l(s))}ASC.Files.ChunkUploads.convertQueue.length==0?(ASC.Files.ChunkUploads.converterBusy=!1,clearTimeout(o)):o=setTimeout(ft,ASC.Files.Constants.REQUEST_CONVERT_DELAY)},y=function(n){var i=ASC.Files.UI.getEntryObject("folder",n),t=i.find(".countFiles");t.html((parseInt(t.html())||0)+1)},et=function(){jq("#chunkUploadDialog:visible").length==0&&(ASC.Files.Actions.hideAllActionPanels(),vt(),jq("#chunkUploadDialog").show())},tr=function(){ASC.Files.ChunkUploads.abortUploading(!0);jq("#chunkUploadDialog").hide()},ir=function(){jq("#chunkUploadDialog").toggleClass("min")},rr=function(n){var t=jq(n).prop("checked"),i=ASC.Files.Constants.storageKeyUploaderCompactView;localStorageManager.setItem(i,t)},ot=function(n,t,i){var r={fileId:n,show:i,isStringXml:!0};ASC.Files.EventHandler.onGetFile(t,r)},p=function(n){var t,i;n?(t=ASC.Files.UI.getEntryObject("file",n),t.length!=0&&t.hasClass("new-file")&&(ASC.Files.EmptyScreen.hideEmptyScreen(),t.removeClass("new-file").show().yellowFade())):(i=jq("#filesMainContent .new-file"),i.length>0&&(ASC.Files.EmptyScreen.hideEmptyScreen(),i.removeClass("new-file").show().yellowFade()))},st=function(){var n=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()};return{uploadQueue:[],uploaderBusy:!1,convertQueue:[],converterBusy:!1,init:ct,initTenantQuota:lt,tenantQuota:null,changeQuotaText:hi,abortFileUploading:ai,abortUploading:vi,clickOnUploadedFile:pi,shareUploadedFile:yi,showUploadingErrorText:wi,disableBrowseButton:bi,showUploadDialod:et,closeUploadDialod:tr,toggleUploadDialod:ir,changeCompactView:rr,createdSubfolders:{},hideDragHighlight:ci}}(),function(n){n(function(){if(jq("#chunkUploadDialog").length!=0){ASC.Files.ChunkUploads.init();ASC.Files.Common.storeOriginal=jq("#chunkUploadDialog .store-original").prop("checked");jq("#chunkUploadDialog .actions-container.close").click(function(){ASC.Files.ChunkUploads.closeUploadDialod()});jq("#chunkUploadDialog .actions-container.minimize, #chunkUploadDialog .actions-container.maximize").click(function(){ASC.Files.ChunkUploads.toggleUploadDialod()});jq("#chunkUploadDialog").on("dblclick",".progress-dialog-header",function(){ASC.Files.ChunkUploads.toggleUploadDialod()});jq("#chunkUploadDialog").on("click",".fu-row.done .share",function(){ASC.Files.ChunkUploads.shareUploadedFile(this)});jq("#chunkUploadDialog").on("click",".fu-row.done .fu-title-cell span",function(){ASC.Files.ChunkUploads.clickOnUploadedFile(this)});jq("#chunkUploadDialog").on("click",".fu-row.upload .abort-file-uploadig",function(){ASC.Files.ChunkUploads.abortFileUploading(this)});jq("#chunkUploadDialog").on("click","#abortUploadigBtn",function(){ASC.Files.ChunkUploads.abortUploading(!1)});jq("#chunkUploadDialog").on("click",".upload-error",function(){ASC.Files.ChunkUploads.showUploadingErrorText(this)});jq.dropdownToggle({switcherSelector:"#uploadSettingsSwitcher",dropdownID:"uploadSettingsPanel",afterShowFunction:function(){var n=jq("#uploadSettingsSwitcher").position(),t=jq("#uploadSettingsSwitcher").height()+5;jq("#uploadSettingsPanel").css({top:n.top+t+"px",left:n.left+"px"})}});jq("#chunkUploadDialog").on("change","#uploadCompactViewCbx",function(){ASC.Files.ChunkUploads.changeCompactView(this)});jq("#chunkUploadDialog .files-container").scroll(function(){ASC.Files.Actions.hideAllActionPanels()})}})}(jQuery);
window.ASC.Files.Converter=function(){var t=!1,i=function(){t===!1&&(t=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ConvertCurrentFile,ASC.Files.Converter.onConvertCurrentFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.StoreOriginalFiles,ASC.Files.Converter.onStoreOriginalFiles))},r=function(n,t,i,r){var u,f;if(!ASC.Files.Utility.MustConvert(t)||r==!1)return r==!1?(u=ASC.Files.Utility.GetFileWebViewerUrl(n,i),window.open(u,"_blank"),ASC.Files.Marker.removeNewIcon("file",n)):ASC.Files.Actions.checkEditFile(n);if(jq("#progressCopyConvertId").val(n),jq("#progressCopyConvertVersion").val(i),jq("#progressCopyConvertView").val(r==!1),!ASC.Files.Utility.FileIsDocument(t)&&!ASC.Files.Utility.FileIsSpreadsheet(t)&&!ASC.Files.Utility.FileIsPresentation(t))return!0;if(ASC.Files.UI.blockUI("#confirmCopyConvert",500,0,-120),PopupKeyUpActionProvider.EnterAction='jq("#confirmCopyConvert .blue:visible:not(.disable):first").click()',jq("#progressCopyConvert, #copyAndConvertOpen").hide(),jq("#copyConvertDescript, #confirmCopyAndConvert").show(),jq("#goToCopySplitter, #goToCopyFolder, #confirmCopyConvertToMyText, #confirmCopyConvertLabelText").hide(),f=ASC.Files.UI.getEntryObject("file",n),f.is(":visible"))if(ASC.Files.UI.accessEdit())ASC.Files.UI.accessDelete(f)&&!ASC.Files.UI.lockedForMe(f)&&(jq("#confirmCopyConvertLabelText").show(),jq("#confirmCopyConvertLabelText input").attr("disabled",!1));else{if(Teamlab.profile.isVisitor)return PopupKeyUpActionProvider.CloseDialog(),u=ASC.Files.Utility.GetFileDownloadUrl(n,i),window.open(u,"_blank"),ASC.Files.Marker.removeNewIcon("file",n);jq("#confirmCopyConvertToMyText").show()}else if(Teamlab.profile.isVisitor)return PopupKeyUpActionProvider.CloseDialog(),u=ASC.Files.Utility.GetFileDownloadUrl(n,i),window.open(u,"_blank"),ASC.Files.Marker.removeNewIcon("file",n);return!0},u=function(){PopupKeyUpActionProvider.CloseDialogAction="ASC.Files.Converter.convertFileEnd(null, true);";jq("#copyConvertDescript, #confirmCopyAndConvert, #progressCopyConvert .convert-status").hide();jq("#progressCopyConvert, #copyAndConvertOpen, #progressCopyConvertRun").show();jq("#copyAndConvertOpen").addClass("disable");var n=jq("#progressCopyConvertId").val(),t=jq("#progressCopyConvertVersion").val();ASC.Files.UI.setProgressValue("#progressCopyConvert",0);jq("#progressCopyConvert .asc-progress-percent").text("0%");ASC.Files.Marker.removeNewIcon("file",n);ASC.Files.Converter.convertFileStep(n,t,!0)},f=function(n,t){var o,f,i,s;if(PopupKeyUpActionProvider.CloseDialogAction="",jq("#progressCopyConvert .convert-status").hide(),!n){t?PopupKeyUpActionProvider.CloseDialog():jq("#progressCopyConvertError").show();return}jq("#copyAndConvertOpen").removeClass("disable");var r=jq.parseJSON(n),u=r.id,e=r.title;if(jq("#progressCopyConvertId").val(u),jq("#progressCopyConvertEnd").show(),r.folderId!=ASC.Files.Folders.currentFolder.id){jq("#progressCopyConvertEndTo, #goToCopySplitter, #goToCopyFolder").show();ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFileIn.format(e,r.folderTitle));jq(".convert-end-to").html(r.folderTitle);jq("#goToCopyFolder").attr("data-id",r.folderId);return}o=r.fileXml;f=ASC.Files.TemplateManager.translateFromString(o);ASC.Files.EmptyScreen.hideEmptyScreen();i=ASC.Files.UI.getEntryObject("file",u);i.length==0?jq("#filesMainContent").prepend(f):i.replaceWith(f);i=ASC.Files.UI.getEntryObject("file",u);s=ASC.Files.UI.getObjectData(i);i=s.entryObject;i.removeClass("new-file").yellowFade();ASC.Files.UI.addRowHandlers(i);ASC.Files.UI.resetSelectAll();ASC.Files.Actions.showActionsViewPanel();ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFile.format(e))},e=function(){var n,t;PopupKeyUpActionProvider.CloseDialog();n=jq("#progressCopyConvertId").val();jq("#progressCopyConvertView").val()=="true"?(t=ASC.Files.Utility.GetFileWebViewerUrl(n),window.open(t,"_blank")):ASC.Files.Actions.checkEditFile(n)},o=function(t){var i;t=t||jq("#filesMainContent .file-row:has(.checkbox input:checked)");i={documents:[],spreadsheets:[],presentations:[],other:[]};jq("#convertFileZip").toggle(jq(t).length>1);jq(t).each(function(){var o=ASC.Files.UI.getObjectData(this),n=o.title,r=o.id,u,s,f,e,t;if(o.entryType=="file"){if(u=[{name:ASC.Files.FilesJSResources.OriginalFormat,value:ASC.Files.Utility.GetFileExtension(n)}],f=ASC.Files.Utility.GetConvertFormats(n),f)for(e=0;e<f.length;e++)u.push({name:f[e],value:f[e]});s=ASC.Files.Utility.getCssClassByFileTitle(n);r="file_"+r}else u=[{name:"",value:""}],s=ASC.Files.Utility.getFolderCssClass(),r="folder_"+r;t={fileConvertFormats:{format:u},fileCssClass:s,fileTitle:n,fileId:r};u.length==1?i.other.push(t):ASC.Files.Utility.FileIsDocument(n)?i.documents.push(t):ASC.Files.Utility.FileIsSpreadsheet(n)?i.spreadsheets.push(t):ASC.Files.Utility.FileIsPresentation(n)?i.presentations.push(t):i.other.push(t)});var r=[{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(ASC.Files.Utility.Resource.InternalFormats.Document),blockTitle:ASC.Files.FilesJSResources.Documents,blockFormats:{format:n(i.documents)},files:{file:i.documents}},{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(ASC.Files.Utility.Resource.InternalFormats.Spreadsheet),blockTitle:ASC.Files.FilesJSResources.Spreedsheets,blockFormats:{format:n(i.spreadsheets)},files:{file:i.spreadsheets}},{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(ASC.Files.Utility.Resource.InternalFormats.Presentation),blockTitle:ASC.Files.FilesJSResources.Presentations,blockFormats:{format:n(i.presentations)},files:{file:i.presentations}},{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(),blockTitle:ASC.Files.FilesJSResources.Other,blockFormats:{format:[]},files:{file:i.other}}],u=ASC.Files.Common.jsonToXml({entryData:{fileTypeBlock:r}}),f=ASC.Files.TemplateManager.translateFromString(u);jq("#convertFileList").html(f);jq("#convertFileList select").each(function(){jq(this).tlcombobox()});jq(".cnvrt-file-block-body .cnvrt-title-content").each(function(){var n=jq(this),t=n.text();ASC.Files.UI.highlightExtension(n,t)});ASC.Files.UI.blockUI("#convertAndDownload",600,0,-150)},n=function(n){var i=[],h,u,t,f,o,r,s,e;if(n.length==0)return i;for(i.push({name:ASC.Files.FilesJSResources.OriginalFormat,value:"original"}),h=n[0].fileConvertFormats.format.length,u=0,t=1;t<n.length;t++)n[t].fileConvertFormats.format.length<h&&(u=t);for(t=0;t<n[u].fileConvertFormats.format.length;t++){for(f=n[u].fileConvertFormats.format[t].value,o=!0,r=0;r<n.length;r++){for(s=!1,e=0;e<n[r].fileConvertFormats.format.length;e++)n[r].fileConvertFormats.format[e].value==f&&(s=!0);s||(o=!1)}o&&i.push({name:f,value:f})}return i.push({name:ASC.Files.FilesJSResources.CustomFormat,value:"custom"}),i},s=function(n){var o=jq(n).find("option:selected").text(),r,t,f;if(jq(n).parents(".cnvrt-format-title-content").find(".cnvrt-format-title").text(o),jq(n).attr("file-id"))r=jq(n).parents(".cnvrt-file-block").find(".cnvrt-file-block-head"),t=jq(r).find("select.select-format"),jq(t).val("custom"),jq(t).tlcombobox(),f=jq(t).find("option:selected").text(),jq(r).find(".cnvrt-format-title").text(f);else{var i=jq(n).parents(".cnvrt-file-block"),e=jq(i).find(".cnvrt-file-block-body"),u=jq(n).val();u=="original"?(jq(i).removeClass("cnvrt-file-block-open").addClass("cnvrt-file-block-closed"),jq(e).find("select.select-format").each(function(){var n=jq(this).find("option:first").val(),t=jq(this).find("option:first").text();jq(this).val(n);jq(this).tlcombobox();jq(this).parents(".cnvrt-format-title-content").find(".cnvrt-format-title").text(t)})):u=="custom"?jq(i).removeClass("cnvrt-file-block-closed").addClass("cnvrt-file-block-open"):(jq(i).removeClass("cnvrt-file-block-open").addClass("cnvrt-file-block-closed"),jq(e).find("select.select-format").each(function(){jq(this).val(u);jq(this).tlcombobox();var n=jq(this).find("option:selected").text();jq(this).parents(".cnvrt-format-title-content").find(".cnvrt-format-title").text(n)}))}},h=function(n){var t=jq(n).prop("checked");ASC.Files.ServiceManager.storeOriginalFiles(ASC.Files.ServiceManager.events.StoreOriginalFiles,{value:t})},c=function(n,t,i){var r={},u;r.entry=[];u={entry:[n,t,i===!0]};r.entry.push([u]);ASC.Files.ServiceManager.checkConversion(ASC.Files.ServiceManager.events.ConvertCurrentFile,{fileId:n,version:t},{stringListList:r})},l=function(n,t,i){if(typeof n!="object"&&typeof i!="undefined"||n==null?i=i||ASC.Files.FilesJSResources.ErrorMassage_ErrorConvert:n.length&&n[0]?n[0].error&&(i=n[0].error):i=ASC.Files.FilesJSResources.ErrorMassage_ErrorConvert,typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Converter.convertFileEnd();return}var u=n[0],r=u.progress||0;if(ASC.Files.UI.setProgressValue("#progressCopyConvert",r),jq("#progressCopyConvert .asc-progress-percent").text(r+"%"),r>=100){ASC.Files.Converter.convertFileEnd(u.result);return}setTimeout(function(){ASC.Files.Converter.convertFileStep(t.fileId,t.version)},ASC.Files.Constants.REQUEST_CONVERT_DELAY)},a=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}ASC.Files.Common.storeOriginal=n===!0;jq(".store-original").prop("checked",ASC.Files.Common.storeOriginal)};return{init:i,checkCanOpenEditor:r,convertCurrentFile:u,convertFileStep:c,convertFileEnd:f,convertFileOpen:e,storeOriginalFiles:h,showToConvert:o,changeFormat:s,onConvertCurrentFile:l,onStoreOriginalFiles:a}}(),function(n){n(function(){ASC.Files.Converter.init();jq("#studioPageContent").on("click","#buttonConvert, #mainConvert.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Converter.showToConvert()});jq("#filesMainContent").on("click",".pencil.file-edit, .can-coauthoring .pencil.file-editing, .pencil.convert-action",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this),t=n.entryId,i=n.title,r=n.version;return ASC.Files.Converter.checkCanOpenEditor(t,i,r),!1});jq("#convertFileList").on("click",".cnvrt-status-content, .cnvrt-file-block-head .cnvrt-title-content, .cnvrt-file-block-head .cnvrt-format-icon-content",function(){var n=jq(this).parents(".cnvrt-file-block"),t=jq(n).hasClass("cnvrt-file-block-open");jq(n).toggleClass("cnvrt-file-block-open",!t).toggleClass("cnvrt-file-block-closed",t)});jq("#convertFileList").on("change","select.select-format",function(){ASC.Files.Converter.changeFormat(this)});jq("#convertFileList").on("click",".cnvrt-file-block-head input[type=checkbox]",function(){var n=jq(this).parents(".cnvrt-file-block"),t=jq(this).prop("checked");jq(n).toggleClass("cnvrt-file-block-active",t);jq(n).find("input[type=checkbox]").prop("checked",t);jq(n).find(".cnvrt-file-row").toggleClass("cnvrt-file-row-active",t)});jq("#convertFileList").on("click",".cnvrt-file-block-body input[type=checkbox]",function(){var n=jq(this).parents(".cnvrt-file-block"),r=jq(this).parents(".cnvrt-file-row"),u=jq(this).parents(".cnvrt-file-block-body").find("input[type=checkbox]").length,t=jq(this).parents(".cnvrt-file-block-body").find("input[type=checkbox]:checked").length,i=jq(this).prop("checked");jq(r).toggleClass("cnvrt-file-row-active",i);i?(jq(n).addClass("cnvrt-file-block-active"),t==u?jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!0).prop("indeterminate",!1):jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("indeterminate",!0)):(jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!1).prop("indeterminate",!1),t==0?jq(n).removeClass("cnvrt-file-block-active"):jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("indeterminate",!0))});jq("#buttonStartConvert").click(function(){var n=[],t,i;if(jq("#convertFileList .cnvrt-file-block-body select.select-format").each(function(){var r=jq(this).parents(".cnvrt-file-row"),t,i;jq(r).hasClass("cnvrt-file-row-active")&&(t=jq(this).val(),i=jq(this).attr("file-id"),n.push({Key:i,Value:t}))}),jq("#convertFileList .cnvrt-file-block-body input[type=hidden]").each(function(){var i=jq(this).parents(".cnvrt-file-row"),t;jq(i).hasClass("cnvrt-file-row-active")&&(t=jq(this).val(),fileId=jq(this).attr("file-id"),n.push({Key:fileId,Value:t}))}),n.length!=0){if(PopupKeyUpActionProvider.CloseDialog(),n.length==1&&(t=ASC.Files.UI.parseItemId(n[0].Key),t.entryType=="file")){fileId=t.entryId;i=ASC.Files.Utility.GetFileDownloadUrl(fileId,0,n[0].Value);window.open(i,"_blank");return}ASC.Files.Folders.bulkDownload(n)}});jq("#confirmCopyAndConvert").click(ASC.Files.Converter.convertCurrentFile);jq("#confirmCopyConvert").on("click","#copyAndConvertOpen:not(.disable)",function(){ASC.Files.Converter.convertFileOpen()});jq(".store-original").change(function(){ASC.Files.Converter.storeOriginalFiles(this)});jq("#confirmCopyConvert").on("click","#goToCopyFolder",function(){var n=jq(this).attr("data-id");ASC.Files.Anchor.navigationSet(n);PopupKeyUpActionProvider.CloseDialog()})})}(jQuery);
window.ASC.Files.CreateMenu=function(){var n=!1,t=function(){n===!1&&(n=!0);jq.dropdownToggle({switcherSelector:"#menuCreateNewButton:not(.disable)",dropdownID:"newDocumentPanel",inPopup:!0,addTop:4})},i=function(){ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)||(jq("#createDocument").remove(),jq("#emptyContainer .empty-folder-create-document").remove());ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Spreadsheet)||(jq("#createSpreadsheet").remove(),jq("#emptyContainer .empty-folder-create-spreadsheet").remove());ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Presentation)||(jq("#createPresentation").remove(),jq("#emptyContainer .empty-folder-create-presentation").remove());jq(".empty-folder-create-editor a").length||jq(".empty-folder-create-editor").remove()},r=function(n){var t=jq("#buttonUpload, #createDocument, #createSpreadsheet, #createPresentation, #createNewFolder"+(ASC.Files.Tree.folderIdCurrentRoot?"":", .page-menu .menu-actions .menu-main-button"));t.toggleClass("disable",!n);ASC.Files.ChunkUploads.disableBrowseButton(!n)};return{init:t,updateCreateDocList:i,disableMenu:r}}(),function(n){ASC.Files.CreateMenu.init();n(function(){ASC.Files.CreateMenu.updateCreateDocList();jq(document).on("click","#createDocument:not(.disable), #createSpreadsheet:not(.disable), #createPresentation:not(.disable)",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.typeNewDoc=this.id.replace("create","").toLowerCase();ASC.Files.Folders.createNewDoc()});jq("#emptyContainer .empty-folder-create a").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.typeNewDoc=jq(this).hasClass("empty-folder-create-document")?"document":jq(this).hasClass("empty-folder-create-spreadsheet")?"spreadsheet":jq(this).hasClass("empty-folder-create-presentation")?"presentation":"";ASC.Files.Folders.createNewDoc()});jq(document).on("click","#createNewFolder:not(.disable), #emptyContainer .empty-folder-create-folder",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.createFolder()})})}(jQuery);
window.ASC.Files.EmptyScreen=function(){var n=!1,t=function(){n===!1&&(n=!0);jq.dropdownToggle({switcherSelector:"#emptyContainer .hintCreate",dropdownID:"hintCreatePanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintUpload",dropdownID:"hintUploadPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintOpen",dropdownID:"hintOpenPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintEdit",dropdownID:"hintEditPanel",fixWinSize:!1})},i=function(){ASC.Files.UI.hideAllContent(!0);ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting());jq("#filesMainContent, #switchViewFolder, #mainContentHeader, #pageNavigatorHolder, .folder-row-toparent").hide();jq("#emptyContainer > div").hide();ASC.Files.Filter&&(ASC.Files.Filter.getFilterSettings().filter!=0||ASC.Files.Filter.getFilterSettings().text!="")?jq("#emptyContainer_filter").show():(jq(".files-filter").hide(),jq("#emptyContainer .empty-folder-create").toggle(ASC.Files.UI.accessEdit()),jq("#emptyContainer_"+ASC.Files.Folders.folderContainer).show(),ASC.Files.UI.checkButtonBack(".empty-folder-toparent"));jq("#emptyContainer").show();ASC.Files.UI.stickContentHeader()},r=function(){jq("#filesMainContent").is(":visible")||(ASC.Files.UI.hideAllContent(!0),ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),jq("#emptyContainer").hide(),ASC.Files.UI.checkButtonBack(".to-parent-folder",".folder-row-toparent"),jq(".files-filter").show(),ASC.Files.Filter&&ASC.Files.Filter.resize(),jq("#filesMainContent, #switchViewFolder, #mainContentHeader").show(),ASC.Files.UI.stickContentHeader())};return{init:t,hideEmptyScreen:r,displayEmptyScreen:i}}(),function(n){jq("#hintCreatePanel").length!=0&&(ASC.Files.EmptyScreen.init(),n(function(){}))}(jQuery);
window.ASC.Files.ImageViewer=function(){var k=!1,f=!1,c,n,p,r={},i={},t,w=0,u=0,l=15,a=0,b,e={},v={},o={},it=function(n){if(ASC.Files.Actions.hideAllActionPanels(),!f){if(ASC.Files.Mouse.mouseBtn=!1,k===!1){k=!0;ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSiblingsImage,ri);t=jq("#imageViewerContainer");t.dblclick(pt);t.mousedown(lt);t.on("load",ot);t.on("error",st)}ft();tt();c="open";var i=ASC.Files.Filter.getFilterSettings();ASC.Files.ServiceManager.getSiblingsImage(ASC.Files.ServiceManager.events.GetSiblingsImage,{fileId:n,filter:i.filter,subjectId:i.subject,search:i.text},{orderBy:i.sorter})}},rt=function(){return jq("#imageViewerClose").is(":visible")},ut=function(n){return"preview/"+n},y=function(){var t=n.selectedIndex+1;return t>n.length-1&&(t=0),t},s=function(){var t=n.selectedIndex-1;return t<0&&(t=n.length-1),t},ft=function(){LoadingBanner.hideLoading();jq(".loader-page").is(":visible")||LoadingBanner.displayLoading();ASC.Files.Mouse.finishMoveTo();jq("body").addClass("scroll-fix");jq.browser.msie&&jq.browser.version<=7&&(jq("html").addClass("scroll-fix"),jq('<style type="text/css"> .studioContentClassOverride{ position: static !important; } <\/style>').appendTo("head"),jq("#studioPageContent").addClass("studioContentClassOverride"));jq(window).bind("resize.ImageViewer",tt);jq(document).bind("mousewheel.ImageViewer",yt);jq(document).bind("keydown.ImageViewer",wt);jq.blockUI({message:jq("#fileViewerDialog"),css:{position:"inherit"},overlayCSS:{backgroundColor:"Black",cursor:"default",opacity:"0.5"},onOverlayClick:ASC.Files.ImageViewer.closeImageViewer});PopupKeyUpActionProvider.EnableEsc=!1;jq("#imageViewerToolbox, #imageViewerClose").show();jq(".blockUI.blockOverlay").css({cursor:"default"});jq(".blockUI.blockMsg").css({border:"none"})},et=function(){ASC.Files.ImageViewer.isView()&&(t.removeAttr("src"),jq("#viewerOtherActions").hide(),jq("body").removeClass("scroll-fix"),jq.browser.msie&&jq.browser.version<=7&&(jq("html").removeClass("scroll-fix"),jq("#studioPageContent").removeClass("studioContentClassOverride")),LoadingBanner.hideLoading(),PopupKeyUpActionProvider.CloseDialog(),f=!1,jq(window).unbind("resize.ImageViewer"),jq(document).unbind("mousewheel.ImageViewer"),jq(document).unbind("keydown.ImageViewer"),jq(document).unbind("mousemove.ImageViewer"),jq(document).unbind("mouseup.ImageViewer"),ASC.Files.Mouse.mouseBtn=!1)},d=function(n,t){var u=n=="w"?"h":"w",f;f=typeof t=="undefined"||t==null?i[u]*r[n]/r[u]:/%/.test(t)?parseInt(t)/100*r[n]:parseInt(t);i[n]=Math.round(f)},h=function(n,e){var c=r.w>r.h?["w","h"]:["h","w"],o,a,s,h;n[c[0]]=n.ls;n[c[1]]=null;o=n.w?["w","h"]:n.h?["h","w"]:[];a={w:i.w,h:i.h};d(o[0],n[o[0]]);d(o[1],n[o[1]]);f=!0;(typeof e=="undefined"||e==null)&&(e=function(){f=!1;jq("#imageViewerInfo").hide();w=u});(typeof n.speed=="undefined"||n.speed==null)&&(n.speed=250);n.speed!=0?(s=1,h=function(n){var t=(i[n]-a[n])/2;return t<0&&(s=-1),t>0?"-="+t+"px":"+="+-t+"px"},t.animate({width:i.w+"px",height:i.h+"px",left:h("w"),top:h("h")},{duration:n.speed,easing:"linear",complete:e,step:function(n,t){jq("#imageViewerInfo span").text(Math.round(w+s*l*t.pos)+"%")}})):(t.css({width:i.w+"px",height:i.h+"px"}),e())},ot=function(){var e,s,a;ASC.Files.ImageViewer.isView()&&(LoadingBanner.hideLoading(),jq(".mainPageContent").children(".loader-page").remove(),t[0].style.cssText="",e=jq('<img src="'+t.attr("src")+'" class="image-viewer-temp" />').prependTo("body"),r={w:e.width(),h:e.height()},r.w==0&&r.h==0&&(r.w=t.attr("naturalWidth")||t[0].naturalWidth,r.h=t.attr("naturalHeight")||t[0].naturalHeight),s={w:r.w/v.w,h:r.h/v.h},a=s.w>s.h?"w":"h",u=s[a]>1?Math.round(v[a]*100/r[a]):100,u=Math.max(u,l),c=="open"?(i={w:10,h:10},t.css({left:o.w-i.w/2,top:o.h-i.h/2}).show(),h({ls:u+"%"})):h({ls:u+"%",speed:0},function(){f=!1;t.css({left:o.w-i.w/2,top:o.h-i.h/2}).show();w=u}),e.remove(),ht(),ASC.Files.Marker.removeNewIcon("file",n[n.selectedIndex].fileId),n[n.selectedIndex].load=!0,ct())},st=function(){t.attr("src")&&t.attr("src").length&&(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.PreviewError.format(n[n.selectedIndex].title),!0),n.splice(n.selectedIndex,1),n.selectedIndex=s(),ASC.Files.ImageViewer.nextImage(!0))},ht=function(){if(g()){var t=n[n.selectedIndex].title,i="{0} ({1}x{2})".format(t,r.w,r.h);jq("#imageViewerToolbox div.image-info").text(i).attr("title",i);ASC.Files.UI.setDocumentTitle(t)}else jq("#imageViewerToolbox div.image-info").html("&nbsp").removeAttr("title")},g=function(){return!jq.isEmptyObject(r)},nt=function(){r={};i={};a=0;jq("#imageViewerInfo").hide();t.hide();jq(".loader-page").is(":visible")||LoadingBanner.displayLoading();t.attr("src",ASC.Files.Utility.GetFileDownloadUrl(n[n.selectedIndex].fileId,n[n.selectedIndex].version));jq("#imagePrev").attr("href",ASC.Files.UI.getEntryLink("file",n[s()].fileId,n[s()].title));jq("#imageNext").attr("href",ASC.Files.UI.getEntryLink("file",n[y()].fileId,n[y()].title));var u=ASC.Files.UI.getEntryObject("file",n[n.selectedIndex].fileId);ASC.Files.UI.accessDelete(u)&&!ASC.Files.UI.lockedForMe(u)?jq("#imageDelete").show():jq("#imageDelete").hide()},ct=function(){if(n.length!=0&&!jq.browser.mobile){var t=y();n[t].load||(jq("#imageViewerPreload").onload=function(){var i=t;n[i].load=!0},jq("#imageViewerPreload").removeAttr("src"),jq("#imageViewerPreload").attr("src",ASC.Files.Utility.GetFileDownloadUrl(n[t].fileId,n[t].version)))}},lt=function(n){b={x:n.pageX-t.offset().left,y:n.pageY-t.offset().top};jq(document).unbind("mouseup.ImageViewer");jq(document).bind("mouseup.ImageViewer",vt);jq(document).unbind("mousemove.ImageViewer");jq(document).bind("mousemove.ImageViewer",at);document.ondragstart=function(){return!1};document.body.onselectstart=function(){return!1};t[0].ondragstart=function(){return!1};jq("#imageViewerToolbox, #viewerOtherActions").hide()},at=function(n){var i=n.pageX,r=n.pageY;i<0||r<0||i>jq(window).width()||r+100>jq(window).height()||t.css({cursor:"pointer",left:i-b.x,top:r-b.y})},vt=function(){t.css("cursor","move");jq(document).unbind("mouseup.ImageViewer");jq(document).unbind("mousemove.ImageViewer");t[0].ondragstart=null;document.ondragstart=null;document.body.onselectstart=null;jq("#imageViewerToolbox").show()},yt=function(n,t){return f?!1:(t>0?ASC.Files.ImageViewer.zoomImage(!0):t<0&&ASC.Files.ImageViewer.zoomImage(!1),!1)},pt=function(){if(!f){var n=e.w>e.h?e.w:e.h;h({ls:n+"px"})}},wt=function(n){var i=n.keyCode||n.which,t=ASC.Files.Common.keyCode;switch(i){case t.left:return ASC.Files.ImageViewer.nextImage(!1),!1;case t.spaceBar:case t.right:return ASC.Files.ImageViewer.nextImage(!0),!1;case t.up:return ASC.Files.ImageViewer.zoomImage(!0),!1;case t.down:return ASC.Files.ImageViewer.zoomImage(!1),!1;case t.esc:return ASC.Files.ImageViewer.closeImageViewer(),!1;case t.deleteKey:if(!n.shiftKey)return ASC.Files.ImageViewer.deleteImage(),!1;break;case t.home:case t.end:case t.pageDown:case t.pageUP:return!1}return!0},bt=function(){e={w:jq(window).width(),h:jq(window).height()};var n=e.w/2+jq(window).scrollLeft(),t=e.h/2+jq(window).scrollTop()-jq("#imageViewerToolbox").height()/2;o={w:n,h:t};v={w:e.w,h:e.h-jq("#imageViewerToolbox").height()}},tt=function(){bt();jq("#imageViewerInfo").css({left:o.w,top:o.h});jq("#imageViewerClose").css({right:10,top:jq(window).scrollTop()+15});jq("#imageViewerToolbox").css({top:e.h+jq(window).scrollTop()-jq("#imageViewerToolbox").height()})},kt=function(n){var r,e;if(!f)if(a+=90*(n?-1:1),jq.browser.msie){var u=a*Math.PI/180,o='progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand", M11 = '+Math.cos(u)+", M12 = "+-Math.sin(u)+", M21 = "+Math.sin(u)+", M22 = "+Math.cos(u)+")",s=t.offset();t.css({"-ms-filter":o,filter:o});e={left:-Math.round((t.width()-i.w)/2),top:-Math.round((t.height()-i.h)/2)};t.css({left:s.left+e.left,top:s.top+e.top});i.w=t.width();i.h=t.height()}else r="rotate({0}deg)".format(a),t.css({"-moz-transform":r,"-o-transform":r,"-webkit-transform":r,transform:r})},dt=function(t){var i,r,u;if(!f){if(n.length==0||n.selectedIndex<0){ASC.Files.ImageViewer.closeImageViewer();return}(t?(c="nextImage",i=y()):(c="prevImage",i=s()),n.selectedIndex!=i)&&(n.selectedIndex=i,r=n[n.selectedIndex].fileId,u=ASC.Files.ImageViewer.getPreviewHash(r),ASC.Files.Anchor.move(u,!0),nt())}},gt=function(){g()?h({ls:"10px",speed:500},ASC.Files.ImageViewer.resetWorkspace):ASC.Files.ImageViewer.resetWorkspace();var n=ASC.Files.Folders.currentFolder.id==p;ASC.Files.Anchor.navigationSet(p,n);n&&ASC.Files.UI.setDocumentTitle()},ni=function(n,t){f||t&&u==100||(u+=l*(n?1:-1),u=t?100:u,u=Math.min(u,1e3),u=Math.max(u,l),jq("#imageViewerInfo span").text(u+"%"),jq("#imageViewerInfo").show(),h({ls:u+"%"}))},ti=function(){var t,r,i;f||(t=n[n.selectedIndex].fileId,r=ASC.Files.UI.getEntryObject("file",t),ASC.Files.UI.accessDelete(r)&&!ASC.Files.UI.lockedForMe(r))&&(i={},i.entry=[],ASC.Files.UI.blockObjectById("file",t,!0,ASC.Files.FilesJSResources.DescriptRemove),i.entry.push("file_"+t),ASC.Files.ServiceManager.deleteItem(ASC.Files.ServiceManager.events.DeleteItem,{list:[t],doNow:!0},{stringList:i}),n.splice(n.selectedIndex,1),n.selectedIndex=s(),ASC.Files.ImageViewer.nextImage(!0))},ii=function(){f||ASC.Files.Folders.download("file",n[n.selectedIndex].fileId,n[n.selectedIndex].version)},ri=function(t,i,r){var u,o,h;if(typeof r!="undefined"||typeof t=="undefined"||t.length==0){ASC.Files.UI.displayInfoPanel(r,!0);ASC.Files.ImageViewer.closeImageViewer();return}p=t.key;var f=t.value,s=f.length,e=[];for(u=0;u<f.length;u++)o=f[u].title,h=f[u].version,ASC.Files.Utility.CanImageView(o)&&(e.push({fileId:f[u].id,version:h,title:o}),f[u].id==i.fileId&&(s=e.length-1));if(n=e,n.selectedIndex=s,n.selectedIndex>=n.length){ASC.Files.ImageViewer.closeImageViewer();return}nt()};return{init:it,isView:rt,getPreviewHash:ut,nextImage:dt,closeImageViewer:gt,resetWorkspace:et,rotateImage:kt,zoomImage:ni,deleteImage:ti,downloadImage:ii}}(),function(n){jq("#fileViewerDialog").length!=0&&(jq.dropdownToggle({switcherSelector:"#viewerOtherActionsSwitch",dropdownID:"viewerOtherActions"}),n(function(){jq("#imageViewerClose").click(function(){return ASC.Files.ImageViewer.closeImageViewer(),!1});jq("#imageZoomIn").click(function(){return ASC.Files.ImageViewer.zoomImage(!0),!1});jq("#imageZoomOut").click(function(){return ASC.Files.ImageViewer.zoomImage(!1),!1});jq("#imageFullScale").click(function(){return ASC.Files.ImageViewer.zoomImage(!0,!0),!1});jq("#imagePrev").click(function(){return ASC.Files.ImageViewer.nextImage(!1),!1});jq("#imageNext").click(function(){return ASC.Files.ImageViewer.nextImage(!0),!1});jq("#imageRotateLeft").click(function(){return ASC.Files.ImageViewer.rotateImage(!0),!1});jq("#imageRotateRight").click(function(){return ASC.Files.ImageViewer.rotateImage(!1),!1});jq("#imageDelete").click(function(){return ASC.Files.ImageViewer.deleteImage(),!1});jq("#imageDownload").click(function(){return ASC.Files.ImageViewer.downloadImage(),!1})}))}(jQuery);
window.ASC.Files.ThirdParty=function(){var r=!1,o={Box:{key:"Box",customerTitle:ASC.Files.FilesJSResources.FolderTitleBoxNet,providerTitle:ASC.Files.FilesJSResources.TypeTitleBoxNet,getTokenUrl:ASC.Files.Constants.URL_OAUTH_BOX},BoxNet:{key:"BoxNet",customerTitle:ASC.Files.FilesJSResources.FolderTitleBoxNet,providerTitle:ASC.Files.FilesJSResources.TypeTitleBoxNet},DropBox:{key:"DropBox",customerTitle:ASC.Files.FilesJSResources.FolderTitleDropBox,providerTitle:ASC.Files.FilesJSResources.TypeTitleDropBox},DropboxV2:{key:"DropboxV2",customerTitle:ASC.Files.FilesJSResources.FolderTitleDropBox,providerTitle:ASC.Files.FilesJSResources.TypeTitleDropBox,getTokenUrl:ASC.Files.Constants.URL_OAUTH_DROPBOXV2},DocuSign:{key:"DocuSign",customerTitle:ASC.Files.FilesJSResources.FolderTitleDocuSign,providerTitle:ASC.Files.FilesJSResources.TypeTitleDocuSign,getTokenUrl:ASC.Files.Constants.URL_OAUTH_DOCUSIGN,link:ASC.Files.Constants.URL_OAUTH_DOCUSIGN_LINK},Google:{key:"Google",customerTitle:ASC.Files.FilesJSResources.FolderTitleGoogle,providerTitle:ASC.Files.FilesJSResources.TypeTitleGoogle,getTokenUrl:"http://www.onlyoffice.com"},GoogleDrive:{key:"GoogleDrive",customerTitle:ASC.Files.FilesJSResources.FolderTitleGoogle,providerTitle:ASC.Files.FilesJSResources.TypeTitleGoogle,getTokenUrl:ASC.Files.Constants.URL_OAUTH2_GOOGLE},OneDrive:{key:"OneDrive",customerTitle:ASC.Files.FilesJSResources.FolderTitleSkyDrive,providerTitle:ASC.Files.FilesJSResources.TypeTitleSkyDrive,getTokenUrl:ASC.Files.Constants.URL_OAUTH_SKYDRIVE},SharePoint:{key:"SharePoint",customerTitle:ASC.Files.FilesJSResources.FolderTitleSharePoint,providerTitle:ASC.Files.FilesJSResources.TypeTitleSharePoint,urlRequest:!0},SkyDrive:{key:"SkyDrive",customerTitle:ASC.Files.FilesJSResources.FolderTitleSkyDrive,providerTitle:ASC.Files.FilesJSResources.TypeTitleSkyDrive,getTokenUrl:ASC.Files.Constants.URL_OAUTH_SKYDRIVE},WebDav:{key:"WebDav",customerTitle:ASC.Files.FilesJSResources.FolderTitleWebDav,providerTitle:ASC.Files.FilesJSResources.TypeTitleWebDav,urlRequest:!0},Yandex:{key:"Yandex",customerTitle:ASC.Files.FilesJSResources.FolderTitleYandex,providerTitle:ASC.Files.FilesJSResources.TypeTitleYandex}},n,s=function(){r===!1&&(r=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetThirdParty,yt),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SaveThirdParty,pt),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.DeleteThirdParty,wt),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeAccessToThirdparty,bt),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SaveDocuSign,kt),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SendDocuSign,dt),jq(document).click(function(n){jq.dropdownToggle().registerAutoHide(n,".account-row .menu-small","#thirdPartyActionPanel")}));jq("#thirdpartyToDocuSignAddMessage").on("click",function(){return ot(),!1});jq("#thirdpartyToDocuSignRemoveMessage").on("click",function(){return u(),jq("#thirdpartyToDocuSignMessage").val(""),!1});jq.dropdownToggle({dropdownID:"thirdpartyToDocuSignFolderSelector",inPopup:!0,switcherSelector:"#thirdpartyToDocuSignFolder"});n=new ASC.Files.TreePrototype("#docuSignFolderSelector");n.clickOnFolder=f;jq("#thirdpartyToDocuSignUserSelector").useradvancedSelector({inPopup:!0,showGroups:!0,showme:!1}).on("showList",st);jq("#thirdpartyToDocuSignRecipientsList").on("click",".ds-user-link-delete",ht)},h=function(n,i,r){return n||i?n||(n=ASC.Files.UI.getObjectData(ASC.Files.UI.getEntryObject(i,r)),!n&&i=="folder"&&ASC.Files.Tree&&(n=ASC.Files.Tree.getFolderData(r))):n=ASC.Files.Folders.currentFolder,t(n)!=null},t=function(n){return ASC.Files.ThirdParty.thirdPartyList[n.provider_key]},c=function(){jq("#thirdPartyEditor").length!=0&&(lt(),ASC.Files.UI.hideAllContent(),jq("#treeSetting").addClass("currentCategory open"),jq(".settings-link-thirdparty").addClass("active"),jq("#settingThirdPartyPanel").show(),ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsThirdParty))},l=function(n){var u=t(n),i=jq.extend(u,{id:n.provider_id,customerTitle:n.title,folderId:n.id}),r;jq('#thirdPartyEditor div[id$="InfoPanel"]').hide();jq("#thirdPartyConnectionUrl, #thirdPartyPassword").val("");jq("#thirdPartyConnectionUrl").closest(".thirdparty-editor-row").hide();jq("#thirdPartyPassword").closest(".thirdparty-editor-row").hide();i.getTokenUrl?jq("#thirdPartyAccount").attr("data-provider",i.key).closest(".thirdparty-editor-row").show():(jq("#thirdPartyAccount").closest(".thirdparty-editor-row").hide(),jq("#thirdPartyPassword").closest(".thirdparty-editor-row").show(),i.urlRequest&&jq("#thirdPartyConnectionUrl").closest(".thirdparty-editor-row").show());for(r in ASC.Files.ThirdParty.thirdPartyList)jq("#thirdPartyAccount span, #thirdPartyTitle").removeClass(r);jq("#thirdPartyAccount").attr("data-token","");jq("#thirdPartyAccount span, #thirdPartyTitle").addClass(i.key);jq("#thirdPartyTitle").focus();jq("#thirdPartyTitle").val(i.customerTitle);ASC.Files.UI.checkCharacter(jq("#thirdPartyTitle"));jq("#thirdPartyPanel input").removeAttr("disabled");jq("#thirdPartyCorporate").removeAttr("checked");LoadingBanner.hideLoaderBtn("#thirdPartyEditor");jq("#submitThirdParty").unbind("click").click(function(){return a(i),!1});jq("#thirdPartyCorporate").prop("checked",ASC.Files.Folders.folderContainer=="corporate");jq("#thirdPartyDialogCaption").text(ASC.Files.FilesJSResources.ThirdPartyEditorCaption.format(i.providerTitle));ASC.Files.UI.blockUI("#thirdPartyEditor",400,300);PopupKeyUpActionProvider.EnterAction='jq("#submitThirdParty").click();'},a=function(n){var r=jq("#thirdPartyConnectionUrl").val().trim(),u=jq("#thirdPartyPassword").val().trim(),t=jq("#thirdPartyTitle").val().trim();t=ASC.Files.Common.replaceSpecCharacter(t);var f=jq("#thirdPartyCorporate").prop("checked")===!0,o=jq("#thirdPartyAccount").attr("data-token"),i=jq('#thirdPartyEditor div[id$="InfoPanel"]');if(i.hide(),t==""){i.show().find("div").text(ASC.Files.FilesJSResources.ErrorMassage_FieldsIsEmpty);return}jq("#thirdPartyPanel input").attr("disabled","disabled");LoadingBanner.showLoaderBtn("#thirdPartyEditor");n.folderId&&ASC.Files.UI.blockObjectById("folder",n.folderId,!0,ASC.Files.FilesJSResources.DescriptChangeInfo);e(n.id,n.key,t,r,"",u,o,f,n.folderId)},v=function(n,i,r,u,f){if(n=n||(f?f.provider_id:null),n!=null||i==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key){var e=f?f.entryId:null;r=r||t(f).providerTitle;jq("#thirdPartyDeleteDescr").html(ASC.Files.FilesJSResources.ConfirmDeleteThirdParty.format(u,r));jq("#deleteThirdParty").unbind("click").click(function(){return ASC.Files.UI.blockObjectById("folder",e,!0,ASC.Files.FilesJSResources.DescriptRemove),PopupKeyUpActionProvider.CloseDialog(),at(n,i,u,e),!1});ASC.Files.UI.blockUI("#thirdPartyDelete",400,300);PopupKeyUpActionProvider.EnterAction='jq("#deleteThirdParty").click();'}},y=function(n){if(!n)return!1;var t=jq("#account_"+n.key+"_0");return t.length>0?(jq(t).find("input:visible:first").focus(),jq(t).yellowFade(),!1):(n.getTokenUrl?(OAuthCallback=function(t){i(n,t)},OAuthPopup(n.getTokenUrl)):i(n),!1)},p=function(n){return!n||typeof n.provider_id=="undefined"?!1:(OAuthCallback=function(t){var i=jq("#account_"+n.key+"_"+n.provider_id);i.find(".account-hidden-token").val(t)},OAuthPopup(n.getTokenUrl),!1)},w=function(n){return!n||!jq("#thirdPartyEditor").is(":visible")?!1:(OAuthCallback=function(n){jq("#thirdPartyAccount").attr("data-token",n)},OAuthPopup(n.getTokenUrl),!1)},i=function(n,t){var r={canCorporate:ASC.Files.Constants.ADMIN&&!ASC.Resources.Master.Personal,canEdit:!0,corporate:!1,customer_title:n.customerTitle,isNew:!0,link:n.link,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,provider_id:0,provider_key:n.key,provider_title:n.providerTitle,getTokenUrl:n.getTokenUrl},u,f,i;if(n.key==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key){if(t){ASC.Files.ServiceManager.saveDocuSign(ASC.Files.ServiceManager.events.SaveDocuSign,{thirdParty:n},t);return}r.canEdit=!1;r.isNew=!1;ASC.Files.ThirdParty.docuSignAttached(!0)}u=ASC.Files.Common.jsonToXml({third_partyList:{entry:r}});f=ASC.Files.TemplateManager.translateFromString(u);jq("#thirdPartyAccountList").append(f);jq("#emptyThirdPartyContainer").hide();jq("#thirdPartyAccountContainer").show();i=jq("#account_"+n.key+"_"+r.provider_id);r.isNew&&(ASC.Files.UI.checkCharacter(jq(i).find(".account-input-folder")),jq(i).find(".account-hidden-token").val(t),jq(i).find(".account-settings-container").show(),n.getTokenUrl||(jq(i).find(".account-log-pass-container").show(),n.urlRequest&&jq(i).find(".account-field-url").show()),jq(i).find("input:visible:first").focus());jq(i).yellowFade()},b=function(n){var t=jq(n).parents(".account-row"),r,u,i;ASC.Files.UI.checkCharacter(jq(t).find(".account-input-folder"));r=jq(t).find(".account-hidden-customer-title").val().trim();jq(t).find(".account-input-folder").val(r);jq(t).find(".account-settings-container").show();u=jq(t).find(".account-hidden-provider-key").val().trim();i=ASC.Files.ThirdParty.thirdPartyList[u];i&&!i.getTokenUrl&&(jq(t).find(".account-log-pass-container").show(),i.urlRequest&&jq(t).find(".account-field-url").show());jq(t).find("input:visible:first").focus()},k=function(n){var t=jq(n).parents(".account-row"),i=parseInt(jq(t).find(".account-hidden-provider-id").val());if(i==0)return jq(t).remove(),jq("#thirdPartyAccountList .account-row").length==0&&(jq("#thirdPartyAccountContainer").hide(),jq("#emptyThirdPartyContainer").show()),!1;jq(t).find(".account-settings-container").hide()},d=function(n){var t=jq(n).parents(".account-row"),i=parseInt(jq(t).find(".account-hidden-provider-id").val()),r=jq(t).find(".account-hidden-provider-key").val().trim(),u=jq(t).find(".account-hidden-provider-title").val().trim(),f=jq(t).find(".account-hidden-customer-title").val().trim();ASC.Files.ThirdParty.showDeleteDialog(i,r,u,f)},g=function(n){var t=jq(n).parents(".account-row"),i,u=parseInt(jq(t).find(".account-hidden-provider-id").val());u!=0&&(i=u);var f=jq(t).find(".account-hidden-provider-key").val().trim(),o=jq(t).find(".account-input-folder").val().trim(),s=jq(t).find(".account-input-url").val().trim(),h=(jq(t).find(".account-input-login").val()||"").trim(),c=jq(t).find(".account-input-pass").val().trim(),l=jq(t).find(".account-hidden-token").val().trim(),a=jq(t).find(".account-cbx-corporate").prop("checked")===!0,r=ASC.Files.ThirdParty.thirdPartyList[f];if(o==""||!i&&!r.getTokenUrl&&(h==""||c=="")||!i&&r.urlRequest&&s==""){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_FieldsIsEmpty,!0);return}if(!i&&r.getTokenUrl&&l==""){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_MustLogin,!0);return}jq(t).find("input").attr("disabled",!0);jq(t).find("a.button.account-save-link").addClass("disable");e(i,f,o,s,h,c,l,a)},nt=function(n){var t=jq(n).prop("checked");vt(t===!0)},tt=function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.blockUI("#thirdPartyNewAccount",500,400)},it=function(n){var r=jq.fixEvent(n),t=jq(r.srcElement||r.target),u=jq(t).parents(".account-row"),i;return jq(u).is(":has(.account-settings-container)")?jq("#accountEditLinkContainer").show().unbind("click").click(function(){ASC.Files.Actions.hideAllActionPanels();b(t)}):jq("#accountEditLinkContainer").hide(),jq("#accountDeleteLinkContainer").unbind("click").click(function(){ASC.Files.Actions.hideAllActionPanels();d(t)}),i=jq("#thirdPartyActionPanel"),i.css({top:t.offset().top+t.outerHeight(),left:"auto",right:jq(window).width()-t.offset().left-t.width()-2,margin:"5px -8px 0 0"}),i.toggle(),!0},rt=function(n,t){if(!ASC.Files.Common.isCorrectId(n)||!ASC.Files.Common.isCorrectId(t))return!1;var i=function(n){var t=/^\d+/.exec(n),i;return t!=null?"onlyoffice":(i=/([^\|]+)(\|.*)?/,t=i.exec(n)[1],(t||"").replace(/-$/,""))},r=i(n),u=i(t);return r!=u},ut=function(n,i,r){var u=t(ASC.Files.Folders.currentFolder).providerTitle;jq("#moveThirdPartyMessage").html(jq.format(ASC.Files.FilesJSResources.ConfirmThirdPartyMoveMessage,"<br/><br/>",u));jq("#buttonMoveThirdParty").unbind("click").click(function(){PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();ASC.Files.Folders.curItemFolderMoveTo(n,i,r,!0)});jq("#buttonCopyThirdParty").unbind("click").click(function(){PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();ASC.Files.Folders.isCopyTo=!0;ASC.Files.Folders.curItemFolderMoveTo(n,i,r,!0)});jq("#buttonCancelMoveThirdParty").unbind("click").click(function(){ASC.Files.Folders.isCopyTo=!1;PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog()});ASC.Files.UI.blockUI("#thirPartyConfirmMove",420,300);PopupKeyUpActionProvider.EnterAction='jq("#buttonMoveThirdParty").click();';PopupKeyUpActionProvider.CloseDialogAction='jq("#buttonCancelMoveThirdParty").click();'},ft=function(n){return typeof n!="undefined"&&jq(".add-account-button.DocuSign").attr("data-signed",!!n),jq(".add-account-button.DocuSign").attr("data-signed")=="true"},et=function(t){var e=ASC.Files.FilesJSResources.DocuSignDialogHeader.format(t.title),i,r;jq("#thirdpartyToDocuSign .thirdparty-todocusign-header").attr("title",e).text(e);i=jq("#thirdpartyToDocuSign .thirdparty-todocusign-title");i.attr("title",t.title).attr("placeholder",t.title).val(t.title);ASC.Files.UI.checkCharacter(i);f(ASC.Files.Folders.currentFolder.id);n.setCurrent(ASC.Files.Folders.currentFolder.id);jq("#thirdpartyToDocuSignRecipientsList").hide();jq("#thirdpartyToDocuSignUserSelector").useradvancedSelector("reset");r=function(){var r=i.val(),u,n,f;if(r.length<1)return i.focus(),!1;var e=jq("#thirdpartyToDocuSignFolder").attr("data-id"),o=jq("#thirdpartyToDocuSignMessage:visible").val(),s=jq("#thirdpartyToDocuSignRecipientsList .userLink").map(function(n,t){return jq(t).attr("data-uid")}).toArray();PopupKeyUpActionProvider.CloseDialog();ASC.Files.UI.blockObject(t.entryObject,!0,ASC.Files.FilesJSResources.DescriptDocuSign);u={docusign_data:{folderId:e,message:o,name:r,users:{entry:s}}};n=window.open("");try{n&&(n.document.write(ASC.Resources.Master.Resource.LoadingPleaseWait),n.document.close())}catch(h){}return f={fileId:t.id,entryObject:t.entryObject,winSign:n},ASC.Files.ServiceManager.sendDocuSign(ASC.Files.ServiceManager.events.SendDocuSign,f,u),!1};jq("#thirdpartyToDocuSignSend").unbind("click").click(r);jq("#thirdpartyToDocuSign").bind(jq.browser.msie?"keydown":"keypress",function(n){var t,i,u;if(jq("#thirdpartyToDocuSign").is(":visible")){if(t||(t=n),i=jq(t.srcElement||t.target),jq(i).is("#thirdpartyToDocuSignMessage")&&!t.ctrlKey)return!0;u=t.keyCode||t.which;switch(u){case ASC.Files.Common.keyCode.enter:r()}}});u();ASC.Files.UI.blockUI("#thirdpartyToDocuSign",400,475)},u=function(){jq("#thirdpartyToDocuSignRemoveMessage").hide();jq("#thirdpartyToDocuSign").removeClass("with-message");jq("#thirdpartyToDocuSignAddMessage").show()},ot=function(){jq("#thirdpartyToDocuSignAddMessage").hide();jq("#thirdpartyToDocuSign").addClass("with-message");jq("#thirdpartyToDocuSignRemoveMessage").show()},st=function(n,t){jq("#thirdpartyToDocuSignRecipientsList").empty();t.forEach(function(n){n.decodedTitle=Encoder.htmlDecode(n.title);var t=ASC.Files.Common.jsonToXml({userItem:n}),i=ASC.Files.TemplateManager.translateFromString(t);jq("#thirdpartyToDocuSignRecipientsList").append(i)});jq("#thirdpartyToDocuSignRecipientsList").show();ASC.Files.UI.registerUserProfilePopup(jq("#thirdpartyToDocuSignRecipientsList"))},ht=function(){var n=jq(this).closest(".ds-user-link"),t=n.find(".userLink").attr("data-uid");jq("#thirdpartyToDocuSignUserSelector").useradvancedSelector("unselect",[t]);n.remove();jq("#thirdpartyToDocuSignRecipientsList .userLink").length||jq("#thirdpartyToDocuSignRecipientsList").hide()},f=function(t){var u=n.getFolderData(t),i,r;return ASC.Files.UI.accessEdit(u)?(i=n.getFolderTitle(t),jq("#thirdpartyToDocuSignFolder a").attr("title",i).text(i),jq("#thirdpartyToDocuSignFolder").attr("data-id",t),ASC.Files.Actions.hideAllActionPanels(),!0):(r=ASC.Files.FilesJSResources.ErrorMassage_SecurityException,(t==ASC.Files.Constants.FOLDER_ID_PROJECT||t==ASC.Files.Constants.FOLDER_ID_SHARE)&&(r=ASC.Files.FilesJSResources.ErrorMassage_SecurityException_PrivateRoot),ASC.Files.UI.displayInfoPanel(r,!0),n.expandFolder(t),!1)},ct=function(t){ASC.Files.Common.isCorrectId(t)&&jq("#thirdPartyEditor").length!=0&&n.resetFolder(t)},lt=function(){ASC.Files.ServiceManager.getThirdParty(ASC.Files.ServiceManager.events.GetThirdParty,{showLoading:!0})},e=function(n,t,i,r,u,f,e,o,s){var h={providerId:n,providerKey:t,folderTitle:i,login:u,password:f,token:e,corporate:o,folderId:s},c={third_party:{auth_data:{login:u,password:f,token:e,url:r},corporate:o,customer_title:i,provider_id:n,provider_key:t}};ASC.Files.ServiceManager.saveThirdParty(ASC.Files.ServiceManager.events.SaveThirdParty,h,c)},at=function(n,t,i,r){var u={providerId:n,providerKey:t,folderId:r,customerTitle:i};t==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key?(u.providerId=0,ASC.Files.ServiceManager.deleteDocuSign(ASC.Files.ServiceManager.events.DeleteThirdParty,u)):ASC.Files.ServiceManager.deleteThirdParty(ASC.Files.ServiceManager.events.DeleteThirdParty,u)},vt=function(n){ASC.Files.ServiceManager.changeAccessToThirdparty(ASC.Files.ServiceManager.events.ChangeAccessToThirdparty,{enable:n===!0})},yt=function(n,t,i){var r,u;if(LoadingBanner.hideLoading(),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(r=ASC.Files.ThirdParty.docuSignAttached(),n.length>0||r){u=jq(n).map(function(n,t){var i=ASC.Files.ThirdParty.thirdPartyList[t.provider_key];return{canCorporate:ASC.Files.Constants.ADMIN&&!ASC.Resources.Master.Personal,canEdit:!0,corporate:t.isnew==1,customer_title:t.title,error:t.error,id:t.id,isNew:!1,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,provider_id:t.provider_id,provider_key:t.provider_key,provider_title:i.providerTitle,getTokenUrl:i.getTokenUrl}}).toArray();r&&u.push({canEdit:!1,canCorporate:!1,corporate:!1,customer_title:ASC.Files.ThirdParty.thirdPartyList.DocuSign.customerTitle,id:0,isNew:!1,link:ASC.Files.ThirdParty.thirdPartyList.DocuSign.link,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,provider_id:0,provider_key:ASC.Files.ThirdParty.thirdPartyList.DocuSign.key,provider_title:ASC.Files.ThirdParty.thirdPartyList.DocuSign.providerTitle});var f={third_partyList:{entry:u}},e=ASC.Files.Common.jsonToXml(f),o=ASC.Files.TemplateManager.translateFromString(e);jq("#thirdPartyAccountList").html(o);jq("#emptyThirdPartyContainer").hide();jq("#thirdPartyAccountContainer").show()}else jq("#thirdPartyAccountList .account-row").remove(),jq("#thirdPartyAccountContainer").hide(),jq("#emptyThirdPartyContainer").show();ASC.Files.Folders.eventAfter!=null&&typeof ASC.Files.Folders.eventAfter=="function"&&(ASC.Files.Folders.eventAfter(),ASC.Files.Folders.eventAfter=null)},pt=function(n,t,i){var v=jq('#thirdPartyEditor div[id$="InfoPanel"]'),f,l,a,o;if(typeof i!="undefined"){jq("#settingThirdPartyPanel:visible").length>0?(ASC.Files.UI.displayInfoPanel(i,!0),f=typeof t.folderId!="undefined"?jq("#"+t.folderId):jq("#account_"+t.providerKey+"_"+(t.providerId||0)),f.find("input").removeAttr("disabled"),f.find("a.button.account-save-link").removeClass("disable")):(v.show().find("div").text(i),jq("#thirdPartyPanel input").removeAttr("disabled"),LoadingBanner.hideLoaderBtn("#thirdPartyEditor"));return}PopupKeyUpActionProvider.CloseDialog();var e=t.folderTitle,r=null,u=t.folderId;if(jq("#settingThirdPartyPanel:visible").length>0){t.providerId=t.providerId?t.providerId:0;var s=ASC.Files.ThirdParty.thirdPartyList[n.provider_key],y={id:n.id,corporate:t.corporate,customer_title:n.title,provider_id:n.provider_id,provider_title:s.providerTitle,provider_key:n.provider_key,isNew:!1,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,canCorporate:ASC.Files.Constants.ADMIN&&!ASC.Resources.Master.Personal,error:n.error,canEdit:n.provider_key!=ASC.Files.ThirdParty.thirdPartyList.DocuSign.key,getTokenUrl:s.getTokenUrl},p=ASC.Files.Common.jsonToXml({third_partyList:{entry:y}}),h=ASC.Files.TemplateManager.translateFromString(p),c=jq("#account_"+t.providerKey+"_"+t.providerId);c.length?jq(c).replaceWith(h):(jq("#thirdPartyAccountList").append(h),jq("#emptyThirdPartyContainer").hide(),jq("#thirdPartyAccountContainer").show())}else l=t.corporate?ASC.Files.Constants.FOLDER_ID_COMMON_FILES:ASC.Files.Constants.FOLDER_ID_MY_FILES,l==ASC.Files.Folders.currentFolder.id?(a=ASC.Files.Common.jsonToXml({folder:n}),o=ASC.Files.TemplateManager.translateFromString(a),ASC.Files.EmptyScreen.hideEmptyScreen(),r=ASC.Files.UI.getEntryObject("folder",u),r?(r.replaceWith(o),r=ASC.Files.UI.getEntryObject("folder",u)):(jq("#filesMainContent").prepend(o),r=jq("#filesMainContent .new-folder:first")),r.yellowFade().removeClass("new-folder"),ASC.Files.UI.resetSelectAll(),e=ASC.Files.UI.getObjectTitle(r)):u&&(ASC.Files.UI.getEntryObject("folder",u).remove(),ASC.Files.UI.checkEmptyContent()),r&&r.is(":visible")&&ASC.Files.UI.addRowHandlers(r);ASC.Files.Tree.resetFolder(ASC.Files.Constants.FOLDER_ID_COMMON_FILES);ASC.Files.Tree.resetFolder(ASC.Files.Constants.FOLDER_ID_MY_FILES);ASC.Files.UI.displayInfoPanel(u?ASC.Files.FilesJSResources.InfoChangeThirdParty.format(e):ASC.Files.FilesJSResources.InfoSaveThirdParty.format(e,t.corporate?ASC.Files.FilesJSResources.CorporateFiles:ASC.Files.FilesJSResources.MyFiles));t.providerId||ASC.Files.Anchor.navigationSet(n.id)},wt=function(n,t,i){var u,o;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}var s=t.providerId,f=t.providerKey,e=t.folderId||n,h=t.customerTitle,r=ASC.Files.UI.getEntryObject("folder",e);r!=null&&r.length?(r.remove(),ASC.Files.UI.checkEmptyContent()):f==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key&&ASC.Files.ThirdParty.docuSignAttached(!1);u=jq("#account_"+f+"_"+s);u.length>0&&(jq(u).remove(),jq("#thirdPartyAccountList .account-row").length==0&&(jq("#thirdPartyAccountContainer").hide(),jq("#emptyThirdPartyContainer").show()));o=ASC.Files.Tree.getParentId(e);ASC.Files.Tree.resetFolder(o);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveThirdParty.format(h))},bt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq("#cbxEnableSettings").prop("checked",n===!0)},kt=function(n,t,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}i(t.thirdParty)},dt=function(n,t,i){var r=t.winSign;if(ASC.Files.UI.blockObject(t.entryObject),typeof i!="undefined"){r.close();ASC.Files.UI.displayInfoPanel(i,!0);return}r&&r.location?r.location.href=n:r=window.open(n,"_blank")};return{init:s,thirdPartyList:o,isThirdParty:h,isDifferentThirdParty:rt,showChangeDialog:l,showDeleteDialog:v,addNewThirdPartyAccount:y,editTokenThirdPartyAccount:p,changeTokenThirdPartyAccount:w,cancelThirdPartyAccount:k,saveThirdPartyAccount:g,showSettingThirdParty:c,changeAccessToThirdpartySettings:nt,showThirdPartyNewAccount:tt,showThirdPartyActionsPanel:it,showMoveThirdPartyMessage:ut,docuSignAttached:ft,showDocuSignDialog:et,docuSignFolderSelectorReset:ct}}(),function(n){jq("#thirdPartyEditor").length!=0&&n(function(){jq('#thirdPartyEditor div[id$="InfoPanel"]').removeClass("infoPanel").addClass("errorBox").css("margin","10px 16px 0");var n=function(){var r,n,i,t;if(ASC.Files.Actions.hideAllActionPanels(),r=jq(this).attr("data-provider"),n=ASC.Files.ThirdParty.thirdPartyList[r],!n)return!0;if(jq("#thirdPartyEditor").is(":visible"))t=function(){return ASC.Files.ThirdParty.changeTokenThirdPartyAccount(n)};else if(PopupKeyUpActionProvider.CloseDialog(),i=jq(this).closest(".account-row"),i.length?(n.provider_id=parseInt(jq(i).find(".account-hidden-provider-id").val()),t=function(){return ASC.Files.ThirdParty.editTokenThirdPartyAccount(n)}):t=function(){return ASC.Files.ThirdParty.addNewThirdPartyAccount(n)},jq("#settingThirdPartyPanel:visible").length==0)return n.getTokenUrl?t():ASC.Files.Folders.eventAfter=t,ASC.Files.Anchor.move("setting=thirdparty"),!1;return t(),!1};jq(".add-account-button, .edit-account-button").click(n);jq("#thirdPartyAccountList").on("click",".edit-account-button",n);jq("#thirdPartyAccountList").on("click","a.account-cancel-link",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ThirdParty.cancelThirdPartyAccount(this),!1});jq("#thirdPartyAccountList").on("click","a.account-save-link:not(.disable)",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ThirdParty.saveThirdPartyAccount(this),!1});jq("#cbxEnableSettings").on("change",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ThirdParty.changeAccessToThirdpartySettings(this),!1});jq(".account-connect").on("click",function(){var n=function(){return ASC.Files.ThirdParty.showThirdPartyNewAccount()};if(jq("#settingThirdPartyPanel:visible").length==0){ASC.Files.Folders.eventAfter=n;ASC.Files.Anchor.move("setting=thirdparty");return}n()});jq("#thirdPartyAccountList").on("click",".menu-small",ASC.Files.ThirdParty.showThirdPartyActionsPanel);jq("#thirdPartyAccountList").on("keyup",".account-input-url, .account-input-login, .account-input-pass, .account-input-folder, .account-cbx-corporate",function(n){var i,r,t;i||(i=n);i=jq.fixEvent(i);r=i.keyCode||i.which;r==ASC.Files.Common.keyCode.enter?(t=jq(this).closest(".account-row"),jq(this).is(".account-input-url")?t.find(".account-input-login").is(":visible")?t.find(".account-input-login").focus():t.find(".account-input-pass").focus():jq(this).is(".account-input-login")?t.find(".account-input-pass").focus():jq(this).is(".account-input-pass")?t.find(".account-input-folder").focus():t.find(".account-save-link").click()):r==ASC.Files.Common.keyCode.esc&&(t=jq(this).closest(".account-row"),t.find(".account-cancel-link").click())});ASC.Files.ThirdParty.init()})}(jQuery);
window.ASC.Files.Tree=function(){var i=!1,t,n,r=function(){if(i===!1){i=!0;var r=null;jq(".files-content-panel").attr("data-rootid")&&(ASC.Files.Tree.folderIdCurrentRoot=jq(".files-content-panel").attr("data-rootid"),r=ASC.Files.Constants.FOLDER_ID_PROJECT);t=new ASC.Files.TreePrototype("#treeViewContainer",r);t.clickOnFolder=l;r&&t.expandFolder(r);n=new ASC.Files.TreePrototype("#treeViewSelector");n.clickOnFolder=a}},u=function(i){return t.getFolderTitle(i)||n.getFolderTitle(i)},f=function(n){return t.getParentId(n)},e=function(n){return t.getFolderData(n)},o=function(){for(var r,i=0;i<ASC.Files.Tree.pathParts.length-1;i++)r=ASC.Files.Tree.pathParts[i],t.getFolderData(ASC.Files.Tree.pathParts[i+1])||t.resetFolder(r),t.expandFolder(r,!0,!0);t.setCurrent(ASC.Files.Folders.currentFolder.id);ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_TRASH&&n.setCurrent(ASC.Files.Folders.currentFolder.id)},s=function(t){n.rollUp();n.setCurrent(t)},h=function(t){var r=n.getFolderTitle(t),u=n.getPath(t),i=jq(u).map(function(t,i){return n.getFolderTitle(i)});return i.push(r),i.toArray().join(" > ")},c=function(i){ASC.Files.Common.isCorrectId(i)&&(t.resetFolder(i),n.resetFolder(i),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.docuSignFolderSelectorReset(i))},l=function(n){var f,r,e,u,o,i;if(ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Tree.folderIdCurrentRoot!=ASC.Files.Constants.FOLDER_ID_PROJECT&&(f=jq.inArray(n+"",ASC.Files.Tree.pathParts)!=-1,!f&&(r=t.getPath(n),e=jq.inArray(ASC.Files.Folders.currentFolder.id,r)!=-1,!e))){u=n;r.length&&(u=r[0]);o=t.getFolderData(u);i=o.folderUrl;i=i.substring(0,i.lastIndexOf("#"));i=i+"#"+ASC.Files.Common.getCorrectHash(n);location.href=i;return}ASC.Files.Anchor.navigationSet(n);return},a=function(t){var f=n.getFolderData(t),u,i,r;return ASC.Files.UI.accessEdit(f)?(u=n.getFolderTitle(t),i=n.getPath(t),i.push(t),ASC.Files.Folders.curItemFolderMoveTo(t,u,i),!0):(r=ASC.Files.FilesJSResources.ErrorMassage_SecurityException,(t==ASC.Files.Constants.FOLDER_ID_PROJECT||t==ASC.Files.Constants.FOLDER_ID_SHARE)&&(r=ASC.Files.FilesJSResources.ErrorMassage_SecurityException_PrivateRoot),ASC.Files.UI.displayInfoPanel(r,!0),n.expandFolder(t),!1)};return{init:r,resetFolder:c,getFolderTitle:u,getParentId:f,pathParts:[],folderIdCurrentRoot:null,updateTreePath:o,showSelect:s,getPathTitle:h,getFolderData:e}}(),function(n){n(function(){jq("#treeViewPanelSelector").length!=0&&ASC.Files.Tree.init()})}(jQuery);
window.ASC.Files.TreePrototype=function(n,t){var r=function(n){return n==c?i:ASC.Files.UI?i.find(".tree-node"+ASC.Files.UI.getSelectorId(n)):i.find('.tree-node[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]')},u=function(n){return jq(n).attr("data-id")},o=function(n){var t=r(n);return t.parents(".jstree .tree-node")},l=function(n,t){(n.find("ul").html()||"").trim()!=""&&s(n);t!=""?(n.removeClass("jstree-empty").append("<ul>"+t+"<\/ul>"),n.find("ul a").each(function(){var n=u(this),t=ASC.Files.UI.getEntryLink("folder",n);jq(this).attr("href",t)})):n.addClass("jstree-empty");n.find(".jstree-load-node").removeClass("jstree-load-node");n.addClass("jstree-open").removeClass("jstree-closed")},s=function(n){n.is(".tree-node")||(n=n.find(".tree-node"));n.addClass("jstree-closed").removeClass("jstree-open jstree-empty").children("ul").remove()},e=function(n,t,i,f){if(ASC.Files.Common.isCorrectId(t))var e=r(t);else e=jq(this).parent(),t=u(e);e.length&&t!=ASC.Files.Constants.FOLDER_ID_TRASH&&(e.is(":has(ul)")?e.toggleClass("jstree-closed",i!=null?!i:null).toggleClass("jstree-open",i):v(t,f))},a=function(){var n=jq(this).parent(),t=u(n),i=f.clickOnFolder(t)!==!1;return h(n,i),!1},h=function(n,t){if(i.find("a.selected").removeClass("selected"),i.find(".parent-selected").removeClass("parent-selected"),n.children("a").addClass("selected"),n.parents(".jstree .jstree-closed").addClass("jstree-open").removeClass("jstree-closed"),n.parents(".jstree .tree-node").addClass("parent-selected"),n&&n.offset()){var r=n.offset().top;r-=i.offset().top;r+=i.scrollTop();r-=30;i.scrollTop(r)}f.selectedFolderId=t?u(n):null},v=function(n,t){ASC.Files.Common.isCorrectId(n)&&(r(n).find(".jstree-expander").addClass("jstree-load-node"),ASC.Files.ServiceManager.getTreeSubFolders(ASC.Files.ServiceManager.events.GetTreeSubFolders,{folderId:n,ajaxsync:t===!0}))},y=function(n){ASC.Files.Common.isCorrectId(n)&&ASC.Files.ServiceManager.getTreePath(ASC.Files.ServiceManager.events.GetTreePath,{folderId:n,ajaxsync:!0})},p=function(n,t,u){if(typeof u!="undefined"){f.errorMessage(u);return}var o=t.folderId,s=ASC.Files.TemplateManager.translate(n),e=r(o);if(!e.length){if(c!=null)return;e=i}l(e,s)},w=function(n,t,i){if(typeof i!="undefined"){f.errorMessage(i);return}n.pop();jq(n).each(function(n,t){e(null,t,!0,!0)})};this.getFolderTitle=function(n){return r(n).children("a:first").text().trim()};this.getPath=function(n){return o(n).map(function(n,t){return u(t)}).toArray().reverse()};this.getParentId=function(n){var t=o(n);return t.length?u(t[0]):0};this.setCurrent=function(n){var t=r(n);t.length||(y(n),t=r(n));h(t,!0)};this.resetFolder=function(n){s(r(n))};this.rollUp=function(){i.find("a.selected").removeClass("selected");i.find(".parent-selected").removeClass("parent-selected");i.find(".jstree-open").addClass("jstree-closed").removeClass("jstree-open");f.selectedFolderId=null};this.expandFolder=function(n,t,i){return e(null,n,t,i)};this.selectedFolderId=null;this.clickOnFolder=function(){};this.errorMessage=function(n){ASC.Files.UI&&ASC.Files.UI.displayInfoPanel(n,!0)};this.getFolderData=function(n){var t=r(n);return ASC.Files.UI?ASC.Files.UI.getObjectData(t):{entryId:n,entryType:"folder",entryObject:t,title:getFolderTitle(n)}};this.getDefaultFolderId=function(){return u(i.find(".tree-node:visible:first"))};var f=this,i=jq(n),c=t;i.on("click",".jstree-expander",e);i.on("dblclick","a",e);i.on("click","a",a);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreeSubFolders,p);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreePath,w)};
