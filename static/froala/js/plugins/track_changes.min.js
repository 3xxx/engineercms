/*!
 * froala_editor v4.0.0 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2021 Froala Labs
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(j){"use strict";function F(e){return function t(e){if(Array.isArray(e))return i(e)}(e)||function a(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function n(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return i(e,t)}(e)||function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}j=j&&j.hasOwnProperty("default")?j["default"]:j,Object.assign(j.DEFAULTS,{trackChangesEnabled:!1,showChangesEnabled:!1}),j.PLUGINS.track_changes=function(A){var _=A.$;_.fn.isAfter=function(e){var t=_(this),a=t.parents(),n=e.parents(),r=t;for(var i in a){var s=e;if(a.hasOwnProperty(i)){var l=_(a[i]);for(var o in n)if(n.hasOwnProperty(o)){var c=_(n[o]);if(l[0]===c[0]){var d=r.index();return s.index()<d}s=c}r=l}}return!1};var l,i,s=[],M="",w="",I="",L="",d=[],o=[],g=null,T=[],h=!1;function c(){return s.pop()}function f(e){var t=!(!e||8!=e.keyCode),a=e&&13==e.keyCode,n=!(!e||46!=e.keyCode);if(A.opts.trackChangesEnabled){A.selection.restore(),e&&e.composing&&(A.selection.save(),A.selection.ranges()[0].collapse(!1));var r=A.selection.ranges(0).startContainer,i=_(r).parentsUntil(A.$el,"[data-tracking=true]");if(_(r).data("tracking")&&t)return void A.selection.clear();if(!i.length||"TD"==r.tagName||a){if(A.selection.isCollapsed()){A.markers.insert();var s=A.$el.find(".fr-marker");if(e&&e.composing&&(s=_(s[1])),!s.length)return;var l="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),o=A.opts.showChangesEnabled?'class="fr-highlight-change"':"";if(t||n){if(t){for(;_(s[0].previousSibling).data("tracking");)s.insertBefore(s.prev());_(s[0].previousSibling).find("[data-tracking=true]").length&&s.insertBefore(_(s[0].previousSibling).find("[data-tracking=true]").eq(0))}else if(_(r).data("tracking")){if(!r.nextSibling)return;s.insertBefore(r.nextSibling),P(s)}else P(s);var c=s[0]&&s[0].previousSibling?s[0].previousSibling.nodeValue:"",d=c&&c.slice(0,-(e.selectionLength?e.selectionLength:1));n&&(s[0].nextSibling&&"SPAN"!==s[0].nextSibling.tagName&&null===s[0].nextSibling.nodeValue&&s[0].nextSibling.firstChild&&s[0].nextSibling.firstChild.before(s[0]),d=(c=s[0].nextSibling?s[0].nextSibling.nodeValue:" ")&&c.slice(1)),n&&s[0].nextSibling&&"isPasted"===s[0].nextSibling.id?d=(c=s[0].nextSibling?s[0].nextSibling.textContent:" ")&&c.slice(1):t&&s[0].previousSibling&&"isPasted"===s[0].previousSibling.id&&(d=(c=s[0].previousSibling?s[0].previousSibling.textContent:" ")&&c.slice(0,-(e.selectionLength?e.selectionLength:1)));var g,h=_('<span data-tracking="true" data-track-id="'.concat(l,'" ').concat(o,"></span>")),f=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" '.concat(A.helpers.isIOS()?"":'contenteditable="false"',"></span>"));A.opts.showChangesEnabled||(A.helpers.isMobile()?f.addClass("fr-track-hide-mobile"):f.addClass("fr-track-hide"));var p=!1,u=!1;if(t)try{var k=s[0]&&s[0].previousSibling;if(s[0]&&s[0].previousElementSibling&&"I"===s[0].previousElementSibling.tagName&&!c&&(g=s[0].previousElementSibling),k&&3===k.nodeType&&"SPAN"!==k.parentNode.tagName&&k.previousSibling&&"SPAN"===k.previousSibling.tagName&&" "===k.nodeValue?g=k.previousSibling:k&&"SPAN"===k.parentNode.tagName&&0<_(k.parentNode).find(".fr-emoticon").length?(g=k.parentNode,p=!0):k&&("SPAN"===k.tagName&&"isPasted"!==k.id||"HR"===k.tagName)?g=k:_(s).parent().prev().is("hr")&&(g=_(s).parent().prev().get(0),p=u=!0),A.helpers.isMobile()&&s[0]&&!g&&!c&&!d)return;p?(_(s[0].parentNode).after(h),u?_(s).parent().remove():_(s).remove()):s[0]?e.composing?_(s).after(h):_(s).before(h):_(L).before(h)}catch(e){L&&_(L).before(h)}else if(n){var m=s[0].nextSibling;s[0].nextElementSibling&&"I"===s[0].nextElementSibling.tagName&&!s[0].nextSibling.nodeValue?g=s[0].nextElementSibling:m&&3===m.nodeType&&"SPAN"!==m.parentNode.tagName&&m.nextSibling&&"SPAN"===m.nextSibling.tagName&&" "===m.nodeValue?g=m.nextSibling:m&&"SPAN"===m.parentNode.tagName&&0<_(m.parentNode).find(".fr-emoticon").length?(g=m.parentNode,p=!0):m&&"SPAN"===m.tagName&&s[0].nextSibling&&"isPasted"!==s[0].nextSibling.id&&(g=m),p?(_(s[0].parentNode).before(h),_(s).remove()):_(s).after(h)}if(e.composing?T.push({span:h,"delete":f}):(A.helpers.isIOS()&&T.push({"delete":f}),_(h).prepend(f)),!g&&(g=c&&c.replace(d,""),A.helpers.isMobile()&&M&&!e.composing)){var v=A.selection.get().focusNode,C=A.selection.get().focusOffset,b=1;w&&v&&w.isSameNode(v)&&(b=I-C),g=M.replace(/\u00a0/g," ").replace(c.replace(/\u00a0/g," "),"").slice(0,b)}if(g&&(p?(_(f).append(_(_(g).get(0).outerHTML)),A.markers.insert()):_(f).append(g)),g&&0==g.length)return;A.browser.msie&&t&&(_(h).prepend("".concat(j.MARKERS)),_(h).append("".concat(j.MARKERS))),t&&(d||""===d)&&s[0].previousSibling?s[0].previousSibling.nodeValue=d:n&&(_(h).append("".concat(j.MARKERS)),s[0].nextSibling.nodeValue=d)}else{var S=j.INVISIBLE_SPACE;if(e&&A.helpers.isMobile()&&((S=s[0]&&s[0].previousSibling&&s[0].previousSibling.nodeValue?s[0].previousSibling.nodeValue.slice(-1):j.INVISIBLE_SPACE)&&s[0]&&s[0].previousSibling&&s[0].previousSibling.nodeValue?s[0].previousSibling.nodeValue=s[0].previousSibling.nodeValue.slice(0,-1):!s[0]||s[0].previousSibling||s[0].nextSibling||S!==j.INVISIBLE_SPACE||(S=A.selection.get().focusNode.nodeValue.slice(I,A.selection.get().focusOffset),A.selection.get().focusNode.nodeValue=A.selection.get().focusNode.nodeValue.slice(A.selection.get().focusOffset))),a){if(s.parent().parent().is("li"))return;var N=_("<p></p>");return s.closest("p").after(N),N.append(s),A.markers.remove(),void setTimeout(function(){N.prev().text()===String.fromCharCode(8203)&&N.prev().remove(),A.selection.setAfter(N[0])},1)}s.replaceWith('<span data-tracking="true" data-track-id="'.concat(l,'" ').concat(o,">").concat(S+j.MARKERS,"</span>"))}A.selection.restore(),A.track_changes.pushChange(l)}else{A.selection.save();var y=A.$el.find('.fr-marker[data-type="true"]').length&&A.$el.find('.fr-marker[data-type="true"]').get(0),E=A.$el.find('.fr-marker[data-type="false"]').length&&A.$el.find('.fr-marker[data-type="false"]').get(0);if(_(y).parent().hasClass("fr-emoticon")&&_(y).parent().before(y),_(y).isAfter(_(E))){var x=y;y=E,E=x}$(y,E,e&&e.deletion),A.selection.restore()}A.helpers.isMobile()&&M&&A.markers.remove()}}}function P(e){if(_(e[0].nextSibling).data("tracking")){for(;_(e[0].nextSibling).data("tracking")&&(!(0<_(e[0].previousElementSibling).find("[data-tracking-deleted=true]").length&&0<_(e[0].nextElementSibling).find("[data-tracking-deleted=true]").length)||_(e[0].previousSibling).data("tracking"));)_(e).insertAfter(e.next());e.insertBefore(e[0].previousSibling)}}function $(e,t){var a=2<arguments.length&&arguments[2]!==undefined&&arguments[2];if(e&&(!e.isSameNode(t)||!_(e).hasClass("fr-marker"))){for(;e.nodeType===Node.COMMENT_NODE;)e=e.nextSibling;if(_(e).parent().is("table")&&0!==_(e).parent().next().text().length&&$(_(e).parent().next()[0],t,a),"TD"!==e.tagName||1!==e.childNodes.length||"BR"!==e.childNodes[0].tagName){if(A.node.isBlock(e)&&"HR"!==e.tagName)return A.node.hasClass(e.firstChild,"fr-marker")?$(e.firstChild.nextSibling,t,a):$(e.firstChild,t,a),!1;if("BR"===e.tagName&&"TD"===e.parentElement.tagName){var n=e.parentElement.nextElementSibling;_(e).remove(),$(n,t)}var r="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),i=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",s=_('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,"></span>")),l=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" '.concat(A.helpers.isIOS()?"":'contenteditable="false"',"></span>"));A.opts.showChangesEnabled||(A.helpers.isMobile()?l.addClass("fr-track-hide-mobile"):l.addClass("fr-track-hide"));var o=e;for(_(e).before(s),A.track_changes.pushChange(r);o&&_(o).hasClass("fr-marker");)o=o.nextSibling;for(var c=!1;o&&!c&&!_(o).hasClass("fr-marker")&&!_(o).is("[data-track-id]")&&0===_(o).find("fr-marker").length&&"UL"!==o.tagName&&"OL"!==o.tagName;){var d=o;if("IMG"===o.tagName&&_(o).data("tracking-img","true"),A.node.isBlock(o)&&"HR"!==e.tagName)return $(o.firstChild,t,a),!1;if(o)for(var g=o.childNodes,h=0;h<g.length;h++)if(g[h].className&&"fr-marker"===g[h].className){c=!0,$(o.firstChild,t,a);break}c||(o=o.nextSibling,_(l).append(d))}if(!o||"UL"!==o.tagName&&"OL"!==o.tagName||$(o,t,a),a?T.push({span:s,"delete":l}):(A.helpers.isIOS()&&T.push({"delete":l}),_(s).prepend(l)),A.browser.msie?_(s).prepend("".concat(j.INVISIBLE_SPACE+j.MARKERS)):_(s).prepend("".concat(j.INVISIBLE_SPACE)),_(s).append("".concat(j.INVISIBLE_SPACE+j.MARKERS)),!o&&!e.isSameNode(t)){for(var f=s.get(0).parentNode;f&&!f.nextSibling&&!A.node.isElement(f);)f=f.parentNode;if(f){var p=f.nextSibling;p&&(A.node.isBlock(p)?"HR"===p.tagName?$(p.nextSibling,t,a):(A.browser.mozilla&&"LI"===f.tagName&&"SPAN"===f.lastChild.tagName&&_(f.lastChild).hasClass("fr-marker")&&f.lastChild.remove(),$(p.firstChild,t,a)):$(p,t,a))}}}}}function p(e){if(A.opts.trackChangesEnabled){A.selection.restore();var t=A.selection.ranges(0).startContainer,a=_(t).parentsUntil(A.$el,"[data-tracking=true]");if(_(t).data("tracking"))return;if(!a.length&&!A.selection.isCollapsed()&&"quote"!=e){A.selection.save(),u(A.$el.find('.fr-marker[data-type="true"]').length&&A.$el.find('.fr-marker[data-type="true"]').get(0),A.$el.find('.fr-marker[data-type="false"]').length&&A.$el.find('.fr-marker[data-type="false"]').get(0));var n=A.$el.find('.fr-marker[data-type="true"]').length&&A.$el.find('.fr-marker[data-type="true"]').get(0),r=n.parentNode;if(r&&"A"===r.tagName&&r.firstChild&&"SPAN"===r.firstChild.tagName&&2<r.firstChild.childNodes.length&&"STRONG"===r.firstChild.childNodes[3].tagName)_(r.firstChild.childNodes[3].firstChild).before(n);else{for(var i=n.previousSibling.firstChild;i&&"SPAN"!==i.tagName;)i=i.nextSibling;_(i).after(n)}A.selection.restore()}}}function u(e,t,a){if(e&&!("<br>"===_(e).html()&&_(e).parent().is("td")||(_(e).parent().is("table")&&0!==_(e).parent().next().text().length&&u(_(e).parent().next()[0],t,a),_(e).is("br")&&_(e).parent().length&&_(e).parent().is("td")&&0===_(e).parent().text().length))){for(a||(a="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),A.track_changes.pushChange(a));e.nodeType===Node.COMMENT_NODE;)e=e.nextSibling;if(A.node.isBlock(e)&&"HR"!==e.tagName)return A.node.hasClass(e.firstChild,"fr-marker")?u(e.firstChild.nextSibling,t,a):u(e.firstChild,t,a),!1;var n=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=_('<span data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></span>")),i=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false" style="display:none"></span>'),s=e;for(_(e).before(r);s&&_(s).hasClass("fr-marker");)s=s.nextSibling;for(var l=!1;s&&!l&&!_(s).hasClass("fr-marker")&&0===_(s).find("fr-marker").length&&"UL"!==s.tagName&&"OL"!==s.tagName;){var o=s;if(A.node.isBlock(s)&&"HR"!==e.tagName)return u(s.firstChild,t,a),!1;if(s)for(var c=s.childNodes,d=0;d<c.length;d++)if(c[d].className&&"fr-marker"===c[d].className){l=!0,u(s.firstChild,t,a);break}l||(s=s.nextSibling,_(i).append(o.cloneNode(!0)),_(r).append(o))}if(!s||"UL"!==s.tagName&&"OL"!==s.tagName||u(s,t,a),_(s).hasClass("fr-marker")&&_(r).append(s),_(r).prepend(i),_(r).prepend("".concat(j.INVISIBLE_SPACE)),_(r).append("".concat(j.INVISIBLE_SPACE)),!s&&!e.isSameNode(t)){for(var g=r.get(0).parentNode;g&&!g.nextSibling&&!A.node.isElement(g);)g=g.parentNode;if(g){var h=g.nextSibling;h&&(A.node.isBlock(h)?"HR"===h.tagName?u(h.nextSibling,t,a):u(h.firstChild,t,a):u(h,t,a))}}}}function k(e,t,a){var n=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=_('<span data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></span>")),i=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');A.opts.showChangesEnabled||i.addClass("fr-track-hide"),i.append(t.get(0).innerHTML),r.append(i);var s=e.get(0).innerHTML;e.html(""),e.append(r),r.append(s)}function m(){if(A.events.trigger("image.hideResizer"),A.events.trigger("video.hideResizer"),A.html.cleanEmptyTags(),A.helpers.isMobile())for(var e=A.$el.find("img[data-tracking-img]"),t=0;t<e.length;t++){var a=_(e.get(t));a.parent()&&a.parent().data("tracking")||a.removeData("tracking-img")}}function e(){A.$el.find("li").each(function(){0===this.innerText.replace(/\u200B/g,"").length&&this.remove()})}function t(){var e=c();if(e){var t,a=A.$el.find("[data-track-id=".concat(e,"]"));if(a.length){var n=a.parent("a");if(n.length){var r=_(n.get(0).outerHTML).text();1===[].filter.call(r,function(e){return 8203!==e.charCodeAt(0)}).length&&(t=n)}for(var i=0;i<a.length;i++){var s=a.get(i),l=_(a).data("tracking-deleted")?_(a):_(s).find("[data-tracking-deleted=true]");l.length&&(l.get(0).remove?l.get(0).remove():l.get(0).parentNode.removeChild(l.get(0))),s.hasAttribute("style")?(_(s).removeData("tracking"),_(s).removeData("track-id"),_(s).removeClass("fr-highlight-change")):(A.selection.save(),0<_(s).find("IFRAME").length?(_(s).removeData("tracking"),_(s).removeData("track-id"),_(s).removeClass("fr-highlight-change")):s.outerHTML=s.innerHTML,A.selection.restore())}}t&&t.remove()}m()}function a(){var e=c();if(e){var t=A.$el.find("[data-track-id=".concat(e,"]"));if(t.length){A.selection.save();for(var a=t.length-1;0<=a;a--){var n=_(t).data("tracking-deleted")?_(t):_(t.get(a)).find("[data-tracking-deleted=true]");if(n.length)if(0<_(t).find("IFRAME").length)_(t).removeData("tracking"),_(t).removeData("track-id"),_(t).removeClass("fr-highlight-change"),_(t).removeClass("fr-tracking-deleted"),_(t).removeData("tracking-deleted"),_(t).removeAttr("contenteditable");else n.parent("[data-tracking=true]").data("track-id")==e?(_(t.get(a)).find("[data-tracking-deleted=true]").remove(),t.get(a).outerHTML=n.get(0).innerHTML+t.get(a).innerHTML):t.get(a).remove?t.get(a).remove():t.get(a).parentNode.removeChild(t.get(a));else t.get(a).remove?t.get(a).remove():t.get(a).parentNode.removeChild(t.get(a))}A.selection.restore()}}m()}return A.events.on("keydown",function(e){var t,a;if(!A.opts.trackChangesEnabled)return!0;if(l=null===(t=A.selection.get())||void 0===t?void 0:null===(a=t.focusNode)||void 0===a?void 0:a.nodeValue,A.helpers.isAndroid()){var n,r,i=A.selection.get();M=null==i?void 0:null===(n=i.focusNode)||void 0===n?void 0:n.nodeValue,w=null==i?void 0:i.focusNode,L=null===(r=w)||void 0===r?void 0:r.nextSibling,I=null==i?void 0:i.focusOffset}else if(function s(e){return(!A.keys.ctrlKey(e)||e.which!==j.KEYCODE.Z&&e.which!==j.KEYCODE.C)&&(48<=e.keyCode&&e.keyCode<=57||65<=e.keyCode&&e.keyCode<=90||97<=e.keyCode&&e.keyCode<=122||186<=e.keyCode&&e.keyCode<=222||13===e.keyCode||8===e.keyCode||32===e.keyCode||46===e.keyCode||96<=e.keyCode&&e.keyCode<=111)}(e))if(!A.keys.ctrlKey(e)||"b"!==e.key&&"i"!==e.key&&"u"!==e.key){if(A.keys.ctrlKey(e)&&"a"===e.key||A.keys.ctrlKey(e)&&"s"===e.key)return;f(e)}else p()},!0),A.events.on("keyup",function(e){if(!A.opts.trackChangesEnabled)return!0;var t,a;if(A.helpers.isMobile())if(i=null===(t=A.selection.get())||void 0===t?void 0:null===(a=t.focusNode)||void 0===a?void 0:a.nodeValue,h){for(var n=0;n<T.length;n++)A.opts.showChangesEnabled&&_(T[n].span).empty(),_(T[n].span).prepend(T[n]["delete"]);h=!(T=[])}else if(A.helpers.isIOS()){for(var r=0;r<T.length;r++)i&&1===i.length&&l&&1==l.length?(_(T[r]["delete"]).attr("contenteditable","true"),_(T[r]["delete"]).addClass("fr-ios-mobile-disable-select")):_(T[r]["delete"]).attr("contenteditable","false");T=[]}else{if(46===e.keyCode)return!0;f(e)}},!0),A.events.on("beforeinput",function(e){var t=e.originalEvent,a=!1;if(!A.opts.trackChangesEnabled)return!0;if(A.helpers.isAndroid()){var n=A.selection.get(),r=A.selection.ranges(0),i=r.startContainer,s=r.endContainer,l=_(i).parentsUntil(A.$el,"[data-tracking=true]"),o=_(s).parentsUntil(A.$el,"[data-tracking=true]");if("insertCompositionText"===t.inputType)if(""===t.data)a=!0;else if(n.toString().length>t.data.length){if(0<l.length||0<o.length)return h=!0,e.preventDefault(),!1;a=!0,e.composing=!0}if("insertText"!==t.inputType||A.selection.isCollapsed()||(a=!0),a||"deleteContentBackward"===t.inputType){var c,d;if(h=!0,i.lastChild&&!n.toString()&&null!==(c=i.lastChild.children)&&void 0!==c&&null!==(d=c.item(0))&&void 0!==d&&d.hasAttribute("contenteditable"))return;e.keyCode=8,e.deletion=!0,f(e)}}},!0),A.events.on("paste.before",function(e){A.opts.trackChangesEnabled&&A.helpers.isMobile()&&f(e)},!0),A.events.on("paste.after",function(e){if(A.opts.trackChangesEnabled){A.markers.insert();for(var t=A.$el.find(".fr-marker"),a=t.parent().data("tracking")?t.parent():t.parent().find("[data-tracking=true]"),n=a.children().eq(0).is("ul"),r=t.next();r.is("br");)(r=r.next()).prev().remove(),r.next().is("br")&&r.next().remove();if(r.is("ul")){var i=r.find("li");i.find("[data-tracking=true]").addClass("fr-highlight-change");var s=i[0].innerHTML;if(i.html(""),i.insertAfter(t.closest("li")),0==r.parent().find("[data-tracking=true]").length)return void i.append(s);if(r.remove(),a.data("tracking")){var l=a[0].innerHTML;0<l.trim().length&&a.parent().append(l),i.append(a),a.html(s)}else if(!n)return a.insertBefore(a.closest("ul")),void a.next().remove();A.markers.remove(),i.next().length&&i.next().is("li")&&""==i.next().text().trim()&&i.next().remove();var o=i.prev().children().eq(0);o.is("br")&&o.remove()}}},!0),A.events.on("image.inserted",function(e){A.helpers.isMobile()&&A.opts.trackChangesEnabled&&e.data("tracking-img",!0)}),A.events.on("image.removed",function(e){if(A.helpers.isMobile()&&A.opts.trackChangesEnabled&&!e.data("tracking-img")&&!e.parent().data("tracking")){var t=A.selection.ranges(0).startContainer,a=_(t).parentsUntil(A.$el,"[data-tracking=true]");A.markers.insert();var n=A.$el.find(".fr-marker"),r="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),i=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",s=_('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,"></span>")),l=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');A.opts.showChangesEnabled||l.addClass("fr-track-hide"),e.data("tracking-img",!0),_(t).data("tracking")||a.length?(_(n).replaceWith(l),_(l).append(e),A.markers.remove()):(_(n).replaceWith(s),_(s).prepend(l),_(l).append(e),A.markers.remove(),A.track_changes.pushChange(r))}}),A.events.on("commands.before",function(t){if(!A.opts.trackChangesEnabled)return!0;var e=["applytextColor","bold","italic","underline","strikeThrough","subscript","superscript","fontFamily","fontSize","textColor","backgroundColor","inlineClass","inlineStyle","alignLeft","alignCenter","formatOLSimple","alignRight","alignJustify","formatOL","formatUL","paragraphFormat","paragraphStyle","lineHeight","outdent","indent","quote"];if(["change","applyAll","applyLast","removeLast","showChanges","trackChanges","moreTrackChanges","undo","redo","fullscreen","print","getPDF","spellChecker","selectAll","html","help"].filter(function(e){return e===t}).length||e.filter(function(e){return e===t}).length){if(e.filter(function(e){return e===t}).length&&"paragraphFormat"!==t&&"paragraphStyle"!==t&&"lineHeight"!==t)p(t);else if("paragraphFormat"===t||"paragraphStyle"===t||"lineHeight"===t){A.selection.save();var a=A.$el.find('.fr-marker[data-type="true"]').length&&A.$el.find('.fr-marker[data-type="true"]').get(0),n=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",r="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),i=_('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(n,"></span>")),s=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false" style="display:none"></span>'),l=a.parentNode.cloneNode(!0);l.firstChild.remove(),l.lastChild.remove(),_(s).append(l),_(i).append(s),_(a.parentNode).after(_("<p></p>")),_(a.parentNode.nextSibling).append(i),i=_('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(n,"></span>")),_(a.parentNode.nextSibling).after(_("<p></p>")),_(a.parentNode.nextSibling.nextSibling).append(i),i.append(a.parentNode),A.track_changes.pushChange(r),A.selection.restore()}}else{if(j.COMMANDS[t]&&(j.COMMANDS[t].hasOwnProperty("type")&&"dropdown"===j.COMMANDS[t].type||j.COMMANDS[t].more_btn||j.COMMANDS[t].popup)){if("insertImage"!=t&&"insertFile"!=t)return}else if("clearFormatting"===t)return void(A.opts.trackChangesEnabled&&function(){g=A.selection.blocks();for(var a=[],n=0,e=0;e<g.length;e++){n=e<n?n:e;var t=_(g[e]);if(t.is("li"))t.siblings("li").each(function(e,t){_(t).find("li").length&&(a.push({index:n,item:t}),n+=1)});d[e]=_("<span>".concat(t.get(0).innerHTML,"</span>"))}for(var r=0,i=a;r<i.length;r++){var s=i[r],l=s.index,o=s.item,c=_(_(o).get(0).outerHTML);c.find("ul").remove(),c.find("ol").remove(),d=[].concat(F(d.slice(0,l+1)),[_("<span>".concat(c.get(0).innerHTML,"</span>"))],F(d.slice(l+1))),g=[].concat(F(g.slice(0,l+1)),[o],F(g.slice(l+1)))}}());f()}},!0),A.events.on("commands.after",function(e){if(!A.opts.trackChangesEnabled)return!0;if(0<=["undo","redo"].indexOf(e))!function r(){var e=A.$el.find("[data-tracking=true]");s.splice(0,s.length);for(var t=0;t<e.length;t++){var a=_(e.get(t)).data("track-id");s[a.slice(a.lastIndexOf("-")+1)]=a}}();else if("clearFormatting"==e&&A.opts.trackChangesEnabled){var t="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length);for(var a in g){var n=_(g[a]);d[a]&&(k(n,d[a],t),d[a]=null,o[a]=null)}A.track_changes.pushChange(t),d=[],g=null}},!0),A.events.on("quickInsert.commands.before",function(e){A.opts.trackChangesEnabled&&f(e)}),{toggleTracking:function n(){A.opts.trackChangesEnabled&&-1<A.html.get(!0,!0).indexOf("data-tracking")||A.opts.trackChangesEnabled&&0<A.$el.find("[data-tracking=true]").length?alert("Your editor has pending changes. Please resolve them before turning off Track Changes in the toolbar."):(A.commands.moreTrackChanges(),A.opts.trackChangesEnabled=!A.opts.trackChangesEnabled,A.opts.trackChangesEnabled||(A.opts.showChangesEnabled=!1))},pushChange:function r(e){s.push(e)},insertChangeAt:function v(e,t){s=[].concat(F(s.slice(0,e)),[t],F(s.slice(e)))},popChange:c,getPendingChanges:function C(){return s},showChanges:function b(){if(A.opts.showChangesEnabled=!A.opts.showChangesEnabled,function r(e,t){for(var a=0;a<e.length;a++)t?(_(e.get(a)).removeClass("fr-track-hide"),_(e.get(a)).removeClass("fr-track-hide-mobile")):A.helpers.isMobile()?_(e.get(a)).addClass("fr-track-hide-mobile"):_(e.get(a)).addClass("fr-track-hide")}(A.$el.find(".fr-tracking-deleted"),A.opts.showChangesEnabled),A.opts.showChangesEnabled)for(var e=A.$el.find("[data-tracking=true]").not(".fr-highlight-change"),t=0;t<e.length;t++)_(e.get(t)).addClass("fr-highlight-change");else for(var a=A.$el.find(".fr-highlight-change"),n=0;n<a.length;n++)_(a.get(n)).removeClass("fr-highlight-change")},acceptAllChanges:function S(){for(;0!=A.track_changes.getPendingChanges().length;)t();s=[],e(),A.$el.find("li").each(function(){!_(this).children()[0]||"OL"!==_(this).children()[0].tagName&&"UL"!==_(this).children()[0].tagName||e()})},rejectAllChanges:function N(){for(;0!=A.track_changes.getPendingChanges().length;)a();s=[]},acceptSingleChange:t,rejectSingleChange:a,refresh:function y(e){var t=A.$el.find("[data-tracking=true]");e.toggleClass("fr-disabled",!s.length),e.toggleClass("fr-active",s.length).attr("aria-pressed",s.length),0<!t.length&&(e.removeClass("fr-active"),e.addClass("fr-disabled"));var a=A.$tb.find('.fr-command[data-cmd="markdown"]');a&&A.opts.trackChangesEnabled?a.addClass("fr-disabled"):a&&!_(".fr-active.fr-popup").length&&a.removeClass("fr-disabled");var n=A.$tb.find('.fr-command[data-cmd="showChanges"]');n&&A.opts.trackChangesEnabled&&n.removeClass("fr-disabled")},replaceSpecialItem:function E(e){A.selection.setBefore(e.get(0)),A.selection.setAfter(e.get(0)),u(A.$el.find('.fr-marker[data-type="true"]').length&&A.$el.find('.fr-marker[data-type="true"]').get(0),A.$el.find('.fr-marker[data-type="false"]').length&&A.$el.find('.fr-marker[data-type="false"]').get(0))},removeSpecialItem:function x(e){A.selection.setBefore(e.get(0)),A.selection.setAfter(e.get(0)),$(A.$el.find('.fr-marker[data-type="true"]').length&&A.$el.find('.fr-marker[data-type="true"]').get(0),A.$el.find('.fr-marker[data-type="false"]').length&&A.$el.find('.fr-marker[data-type="false"]').get(0))},removedTable:function R(e){var t=!1;if(e.find("[data-tracking=true]").each(function(){0<this.innerText.replace(/\u200B/g,"").length&&(t=!0)}),t)alert("Your table has pending changes. Please resolve them before remove table.");else{var r="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),i=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",a=_('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,"></span>")),n=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');e.before(a),e.find("tr").find("> td").each(function(){var e=_('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,"></span>")),t=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>'),a=_(this),n=a[0].innerText;_(t)[0].innerText=n,a[0].innerText="",e.prepend(t),a.prepend(e)}),n.append(e),a.append(n),A.track_changes.pushChange(r)}},addQuote:function O(e){var t="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),a=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",n=_('<div data-tracking="true" data-track-id="'.concat(t,'" ').concat(a,"></div>")),r=_('<div data-tracking="true" data-track-id="'.concat(t,'" ').concat(a,"></div>")),i=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');A.opts.showChangesEnabled||i.addClass("fr-track-hide"),e.before(r),e.before(n);var s=e.get(0).innerHTML;i.append(s),n.append(i),r.append(e),r.find('[data-tracking="true"]').each(function(e,t){_(t).children().eq(0).insertBefore(_(t)),_(t).remove()}),A.track_changes.pushChange(t)},removeQuote:function V(e,t){if(!(0<t)){var a="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),n=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=_('<div data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></div>")),i=_('<div data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></div>")),s=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');A.opts.showChangesEnabled||s.addClass("fr-track-hide"),e.before(i),e.before(r);var l=e.find("blockQuote").eq(0).html();l||(l=e.html()),s.append(e),r.append(s),i.append(l),i.find('[data-tracking="true"]').each(function(e,t){_(t).children().eq(0).insertBefore(_(t)),_(t).remove()}),A.track_changes.pushChange(a)}},wrapInTracking:function D(e,t){var a="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),n=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=_('<span data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></span>"));t&&r.addClass(t);var i=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');return A.opts.showChangesEnabled||i.addClass("fr-track-hide"),e.before(r),r.append(e),A.track_changes.pushChange(a),r},wrapInDelete:function B(e){var t=_('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');return A.opts.showChangesEnabled||(A.helpers.isMobile()?t.addClass("fr-track-hide-mobile"):t.addClass("fr-track-hide")),t.append(e),t},wrapLinkInTracking:function H(e,t){var a="pending-".concat(A.id,"-").concat(A.track_changes.getPendingChanges().length),n=A.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=_('<span data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></span>"));return e.before(r),r.append(e),A.track_changes.insertChangeAt(t-1,a),r},pasteInEmptyEdior:function K(e){var t=A.$el.find(".fr-highlight-change");_(t)[0].style.display="block",_(t)[0].innerHTML=e},pasteInEdior:function U(e){var t=A.$el.find(".fr-marker");_(t)[0].outerHTML=e,A.markers.remove()}}},j.DefineIcon("trackChanges",{NAME:"enable-tracking",SVG_KEY:"trackChanges"}),j.DefineIcon("showChanges",{NAME:"show-changes",SVG_KEY:"showTrackChanges"}),j.DefineIcon("applyAll",{NAME:"apply-all",SVG_KEY:"acceptAllChanges"}),j.DefineIcon("removeAll",{NAME:"remove-all",SVG_KEY:"rejectAllChanges"}),j.DefineIcon("applyLast",{NAME:"apply-last",SVG_KEY:"acceptSingleChange"}),j.DefineIcon("removeLast",{NAME:"remove-last",SVG_KEY:"rejectSingleChange"}),j.RegisterCommand("trackChanges",{type:"button",title:"Enable Track Changes",plugin:"track_changes",showOnMobile:!0,callback:function(){this.track_changes.toggleTracking()},refreshAfterCallback:!0,forcedRefresh:!0,refresh:function(e){e.toggleClass("fr-active",this.opts.trackChangesEnabled).attr("aria-pressed",this.opts.trackChangesEnabled)}}),j.RegisterCommand("showChanges",{type:"button",icon:"showChanges",title:"Show Changes",plugin:"track_changes",undo:!1,focus:!1,accessibilityFocus:!0,forcedRefresh:!0,refreshAfterCallback:!0,toggle:!0,callback:function(){this.track_changes.showChanges()},refresh:function(e){e.toggleClass("fr-active",this.opts.showChangesEnabled).attr("aria-pressed",this.opts.showChangesEnabled)}}),j.RegisterCommand("applyAll",{type:"button",icon:"applyAll",title:"Accept All Changes",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.acceptAllChanges()},refresh:function(e){this.track_changes.refresh(e)}}),j.RegisterCommand("removeAll",{type:"button",icon:"removeAll",title:"Reject All Changes",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.rejectAllChanges()},refresh:function(e){this.track_changes.refresh(e)}}),j.RegisterCommand("applyLast",{type:"button",icon:"applyLast",title:"Accept Single Change",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.acceptSingleChange()},refresh:function(e){this.track_changes.refresh(e)}}),j.RegisterCommand("removeLast",{type:"button",icon:"removeLast",title:"Reject Single Change",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.rejectSingleChange()},refresh:function(e){this.track_changes.refresh(e)}})});