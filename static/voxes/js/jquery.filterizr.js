(function(c,a){if(!a){throw new Error("Filterizr requires jQuery to work.")}var d=function(f){this.init(f)};d.prototype={init:function(f){this.root={x:0,y:0,w:f}},fit:function(g){var k,l,f,j=g.length;var i=j>0?g[0].h:0;this.root.h=i;for(k=0;k<j;k++){f=g[k];if((l=this.findNode(this.root,f.w,f.h))){f.fit=this.splitNode(l,f.w,f.h)}else{f.fit=this.growDown(f.w,f.h)}}},findNode:function(g,i,f){if(g.used){return this.findNode(g.right,i,f)||this.findNode(g.down,i,f)}else{if((i<=g.w)&&(f<=g.h)){return g}else{return null}}},splitNode:function(g,i,f){g.used=true;g.down={x:g.x,y:g.y+f,w:g.w,h:g.h-f};g.right={x:g.x+i,y:g.y,w:g.w-i,h:f};return g},growDown:function(i,f){var g;this.root={used:true,x:0,y:0,w:this.root.w,h:this.root.h+f,down:{x:0,y:this.root.h,w:this.root.w,h:f},right:this.root};if((g=this.findNode(this.root,i,f))){return this.splitNode(g,i,f)}else{return null}}};a.fn.filterizr=function(){var g=this,f=arguments;if(!g._fltr){g._fltr=a.fn.filterizr.prototype.init(g.selector,(typeof f[0]==="object"?f[0]:undefined))}if(typeof f[0]==="string"){if(f[0].lastIndexOf("_")>-1){throw new Error("Filterizr error: You cannot call private methods")}if(typeof g._fltr[f[0]]==="function"){g._fltr[f[0]](f[1],f[2])}else{throw new Error("Filterizr error: There is no such function")}}return g};a.fn.filterizr.prototype={init:function(g,f){var h=a(g).extend(a.fn.filterizr.prototype);h.options={animationDuration:0.5,callbacks:{onFilteringStart:function(){},onFilteringEnd:function(){},onShufflingStart:function(){},onShufflingEnd:function(){},onSortingStart:function(){},onSortingEnd:function(){}},delay:0,delayMode:"progressive",easing:"ease-out",filter:"all",filterOutCss:{opacity:0,transform:"scale(0.5)"},filterInCss:{opacity:1,transform:"scale(1)"},layout:"sameSize",selector:(typeof g==="string")?g:".filtr-container",setupControls:true};if(arguments.length===0){g=h.options.selector;f=h.options}if(arguments.length===1&&typeof arguments[0]==="object"){f=arguments[0]}if(f){h.setOptions(f)}h.css({padding:0,position:"relative"});h._lastCategory=0;h._isAnimating=false;h._isShuffling=false;h._isSorting=false;h._mainArray=h._getFiltrItems();h._subArrays=h._makeSubarrays();h._activeArray=h._getCollectionByFilter(h.options.filter);h._toggledCategories={};h._typedText=a("input[data-search]").val()||"";h._uID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var j=Math.random()*16|0,k=i=="x"?j:(j&3|8);return k.toString(16)});h._setupEvents();if(h.options.setupControls){h._setupControls()}h.filter(h.options.filter);return h},filter:function(h){var f=this,g=f._getCollectionByFilter(h);f.options.filter=h;f.trigger("filteringStart");f._handleFiltering(g);if(f._isSearchActivated()){f.search(f._typedText)}},toggleFilter:function(j){var g=this,h=[],f=0;g.trigger("filteringStart");if(j){if(!g._toggledCategories[j]){g._toggledCategories[j]=true}else{delete g._toggledCategories[j]}}if(g._multifilterModeOn()){h=g._makeMultifilterArray();g._handleFiltering(h);if(g._isSearchActivated()){g.search(g._typedText)}}else{g.filter("all");if(g._isSearchActivated()){g.search(g._typedText)}}},search:function(l){var j=this,f=j._multifilterModeOn()?j._makeMultifilterArray():j._getCollectionByFilter(j.options.filter),k=[],h=0;if(j._isSearchActivated()){for(h=0;h<f.length;h++){var g=f[h].text().toLowerCase().indexOf(l.toLowerCase())>-1;if(g){k.push(f[h])}}}if(k.length>0){j._handleFiltering(k)}else{if(j._isSearchActivated()){for(h=0;h<j._activeArray.length;h++){j._activeArray[h]._filterOut()}}else{j._handleFiltering(f)}}},shuffle:function(){var f=this;f._isAnimating=true;f._isShuffling=true;f.trigger("shufflingStart");f._mainArray=f._fisherYatesShuffle(f._mainArray);f._subArrays=f._makeSubarrays();var g=f._multifilterModeOn()?f._makeMultifilterArray():f._getCollectionByFilter(f.options.filter);if(f._isSearchActivated()){f.search(f._typedText)}else{f._placeItems(g)}},sort:function(f,k){var j=this;f=f||"domIndex";k=k||"asc";j._isAnimating=true;j._isSorting=true;j.trigger("sortingStart");var h=f!=="domIndex"&&f!=="sortData"&&f!=="w"&&f!=="h";if(h){for(var g=0;g<j._mainArray.length;g++){j._mainArray[g][f]=j._mainArray[g].data(f)}}j._mainArray.sort(j._comparator(f,k));j._subArrays=j._makeSubarrays();var l=j._multifilterModeOn()?j._makeMultifilterArray():j._getCollectionByFilter(j.options.filter);if(j._isSearchActivated()){j.search(j._typedText)}else{j._placeItems(l)}},setOptions:function(g){var j=this,f=0;for(var h in g){j.options[h]=g[h]}if(j._mainArray&&(g.animationDuration||g.delay||g.easing||g.delayMode)){for(f=0;f<j._mainArray.length;f++){j._mainArray[f].css("transition","all "+j.options.animationDuration+"s "+j.options.easing+" "+j._mainArray[f]._calcDelay()+"ms")}}if(g.callbacks){if(!g.callbacks.onFilteringStart){j.options.callbacks.onFilteringStart=function(){}}if(!g.callbacks.onFilteringEnd){j.options.callbacks.onFilteringEnd=function(){}}if(!g.callbacks.onShufflingStart){j.options.callbacks.onShufflingStart=function(){}}if(!g.callbacks.onShufflingEnd){j.options.callbacks.onShufflingEnd=function(){}}if(!g.callbacks.onSortingStart){j.options.callbacks.onSortingStart=function(){}}if(!g.callbacks.onSortingEnd){j.options.callbacks.onSortingEnd=function(){}}}if(!j.options.filterInCss.transform){j.options.filterInCss.transform="translate3d(0,0,0)"}if(!j.options.filterOutCss.transform){j.options.filterOutCss.transform="translate3d(0,0,0)"}},_getFiltrItems:function(){var h=this,f=a(h.find(".filtr-item")),g=[];a.each(f,function(k,j){var l=a(j).extend(b)._init(k,h);g.push(l)});return g},_makeSubarrays:function(){var h=this,j=[];for(var f=0;f<h._lastCategory;f++){j.push([])}for(f=0;f<h._mainArray.length;f++){if(typeof h._mainArray[f]._category==="object"){var g=h._mainArray[f]._category.length;for(var k=0;k<g;k++){j[h._mainArray[f]._category[k]-1].push(h._mainArray[f])}}else{j[h._mainArray[f]._category-1].push(h._mainArray[f])}}return j},_makeMultifilterArray:function(){var l=this,m=[],f={};for(var h=0;h<l._mainArray.length;h++){var k=l._mainArray[h],g=false,j=k.domIndex in f===false;if(Array.isArray(k._category)){for(var n=0;n<k._category.length;n++){if(k._category[n] in l._toggledCategories){g=true;break}}}else{if(k._category in l._toggledCategories){g=true}}if(j&&g){f[k.domIndex]=true;m.push(k)}}return m},_setupControls:function(){var f=this;a("*[data-filter]").click(function(){var g=a(this).data("filter");if(f.options.filter===g){return}f.filter(g)});a("*[data-multifilter]").click(function(){var g=a(this).data("multifilter");if(g==="all"){f._toggledCategories={};f.filter("all")}else{f.toggleFilter(g)}});a("*[data-shuffle]").click(function(){f.shuffle()});a("*[data-sortAsc]").click(function(){var g=a("*[data-sortOrder]").val();f.sort(g,"asc")});a("*[data-sortDesc]").click(function(){var g=a("*[data-sortOrder]").val();f.sort(g,"desc")});a("input[data-search]").keyup(function(){f._typedText=a(this).val();f._delayEvent(function(){f.search(f._typedText)},250,f._uID)})},_setupEvents:function(){var f=this;a(c).resize(function(){f._delayEvent(function(){f.trigger("resizeFiltrContainer")},250,f._uID)});f.on("resizeFiltrContainer",function(){if(f._multifilterModeOn()){f.toggleFilter()}else{f.filter(f.options.filter)}}).on("filteringStart",function(){f.options.callbacks.onFilteringStart()}).on("filteringEnd",function(){f.options.callbacks.onFilteringEnd()}).on("shufflingStart",function(){f._isShuffling=true;f.options.callbacks.onShufflingStart()}).on("shufflingEnd",function(){f.options.callbacks.onShufflingEnd();f._isShuffling=false}).on("sortingStart",function(){f._isSorting=true;f.options.callbacks.onSortingStart()}).on("sortingEnd",function(){f.options.callbacks.onSortingEnd();f._isSorting=false})},_calcItemPositions:function(){var v=this,f=v._activeArray,j=0,g=Math.round(v.width()/v.find(".filtr-item").outerWidth()),t=0,o=f[0].outerWidth(),m=0,p=0,w=0,k=0,y=0,s=[];if(v.options.layout==="packed"){a.each(v._activeArray,function(z,x){x._updateDimensions()});var r=new d(v.outerWidth());r.fit(v._activeArray);for(k=0;k<f.length;k++){s.push({left:f[k].fit.x,top:f[k].fit.y})}j=r.root.h}if(v.options.layout==="horizontal"){t=1;for(k=1;k<=f.length;k++){o=f[k-1].outerWidth();m=f[k-1].outerHeight();s.push({left:p,top:w});p+=o;if(j<m){j=m}}}else{if(v.options.layout==="vertical"){for(k=1;k<=f.length;k++){m=f[k-1].outerHeight();s.push({left:p,top:w});w+=m}j=w}else{if(v.options.layout==="sameHeight"){t=1;var u=v.outerWidth();for(k=1;k<=f.length;k++){o=f[k-1].width();var n=f[k-1].outerWidth(),q=0;if(f[k]){q=f[k].width()}s.push({left:p,top:w});y=p+o+q;if(y>u){y=0;p=0;w+=f[0].outerHeight();t++}else{p+=n}}j=t*f[0].outerHeight()}else{if(v.options.layout==="sameWidth"){for(k=1;k<=f.length;k++){s.push({left:p,top:w});if(k%g===0){t++}p+=o;w=0;if(t>0){y=t;while(y>0){w+=f[k-(g*y)].outerHeight();y--}}if(k%g===0){p=0}}for(k=0;k<g;k++){var h=0,l=k;while(f[l]){h+=f[l].outerHeight();l+=g}if(h>j){j=h;h=0}else{h=0}}}else{if(v.options.layout==="sameSize"){for(k=1;k<=f.length;k++){s.push({left:p,top:w});p+=o;if(k%g===0){w+=f[0].outerHeight();p=0}}t=Math.ceil(f.length/g);j=t*f[0].outerHeight()}}}}}v.css("height",j);return s},_handleFiltering:function(h){var g=this,j=g._getArrayOfUniqueItems(g._activeArray,h);for(var f=0;f<j.length;f++){j[f]._filterOut()}g._activeArray=h;g._placeItems(h)},_multifilterModeOn:function(){var f=this;return Object.keys(f._toggledCategories).length>0},_isSearchActivated:function(){var f=this;return f._typedText.length>0},_placeItems:function(f){var h=this;h._isAnimating=true;h._itemPositions=h._calcItemPositions();for(var g=0;g<f.length;g++){f[g]._filterIn(h._itemPositions[g])}},_getCollectionByFilter:function(f){var g=this;return f==="all"?g._mainArray:g._subArrays[f-1]},_makeDeepCopy:function(f){var h={};for(var g in f){h[g]=f[g]}return h},_comparator:function(f,g){return function(h,i){if(g==="asc"){if(h[f]<i[f]){return -1}else{if(h[f]>i[f]){return 1}else{return 0}}}else{if(g==="desc"){if(i[f]<h[f]){return -1}else{if(i[f]>h[f]){return 1}else{return 0}}}}}},_getArrayOfUniqueItems:function(f,g){var m=[],k={},j=g.length,h,n;for(h=0;h<j;h++){k[g[h].domIndex]=true}j=f.length;for(h=0;h<j;h++){n=f[h];if(!(n.domIndex in k)){m.push(n)}}return m},_delayEvent:(function(){var f=this,g={};return function(h,i,j){if(j===null){throw Error("UniqueID needed")}if(g[j]){clearTimeout(g[j])}g[j]=setTimeout(h,i)}})(),_fisherYatesShuffle:function e(f){var h=f.length,j,g;while(h){g=Math.floor(Math.random()*h--);j=f[h];f[h]=f[g];f[g]=j}return f}};var b={_init:function(g,h){var i=this,f=0;i._parent=h;i._category=i._getCategory();i._lastPos={};i.domIndex=g;i.sortData=i.data("sort");i.w=0;i.h=0;i._isFilteredOut=true;i._filteringOut=false;i._filteringIn=false;i.css(h.options.filterOutCss).css({"-webkit-backface-visibility":"hidden",perspective:"1000px","-webkit-perspective":"1000px","-webkit-transform-style":"preserve-3d",position:"absolute",transition:"all "+h.options.animationDuration+"s "+h.options.easing+" "+i._calcDelay()+"ms"});i.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){i._onTransitionEnd()});return i},_updateDimensions:function(){var f=this;f.w=f.outerWidth();f.h=f.outerHeight()},_calcDelay:function(){var g=this,f=0;if(g._parent.options.delayMode==="progressive"){f=g._parent.options.delay*g.domIndex}else{if(g.domIndex%2===0){f=g._parent.options.delay}}return f},_getCategory:function(){var h=this,g=h.data("category");if(typeof g==="string"){g=g.split(", ");for(var f=0;f<g.length;f++){if(isNaN(parseInt(g[f]))){throw new Error("Filterizr: the value of data-category must be a number, starting from value 1 and increasing.")}if(parseInt(g[f])>h._parent._lastCategory){h._parent._lastCategory=parseInt(g[f])}}}else{if(g>h._parent._lastCategory){h._parent._lastCategory=g}}return g},_onTransitionEnd:function(){var f=this;if(f._filteringOut){a(f).addClass("filteredOut");f._isFilteredOut=true;f._filteringOut=false}else{if(f._filteringIn){f._isFilteredOut=false;f._filteringIn=false}}if(f._parent._isAnimating){if(f._parent._isShuffling){f._parent.trigger("shufflingEnd")}else{if(f._parent._isSorting){f._parent.trigger("sortingEnd")}else{f._parent.trigger("filteringEnd")}}f._parent._isAnimating=false}},_filterOut:function(){var g=this,f=g._parent._makeDeepCopy(g._parent.options.filterOutCss);f.transform+=" translate3d("+g._lastPos.left+"px,"+g._lastPos.top+"px, 0)";g.css(f);g.css("pointer-events","none");g._filteringOut=true},_filterIn:function(h){var g=this,f=g._parent._makeDeepCopy(g._parent.options.filterInCss);a(g).removeClass("filteredOut");g._filteringIn=true;g._lastPos=h;g.css("pointer-events","auto");f.transform+=" translate3d("+h.left+"px,"+h.top+"px, 0)";g.css(f)}}})(this,jQuery);